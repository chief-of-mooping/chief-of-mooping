<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการฟาร์มสุกรอัจฉริยะ</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIuC4o+C4sOC4muC4muC4iOC4seC4lOC4geC4suC4o+C4n+C4suC4o+C5jOC4oeC4quC4uOC4geC4o+C4reC4seC4iOC4ieC4o+C4tOC4jeC4sOIsCiAgInNob3J0X25hbWUiOiAi4LmA4Lit4LiXIOC4n+C4suC4o+C5jOC4oeC4quC4uOC4geC4oyIsCiAgImRlc2NyaXB0aW9uIjogIuC4o+C4sOC4muC4muC4iOC4seC4lOC4geC4suC4o+C4n+C4suC4o+C5jOC4oeC4quC4uOC4geC4o+C4reC4seC4iOC4ieC4o+C4tOC4jeC4sOC4quC4s+C4q+C4o+C4seC4muC4q+C4suC4o+C4suC4geC4suC4o+C4i+C4reC4meC5gOC4peC4suC4sOIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzA1OTY2OSIsCiAgInRoZW1lX2NvbG9yIjogIiMwNTk2NjkiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXlOREFpSUdobGFXZG9kRDBpTWpRd0lqNDhjR0YwYUNCa1BTSk5NVEkwTGpjZ01UZzJMalExTXpnc01UZzJMalEwTlRjdVl6a2lJR1pwYkd3OUlpTXdOVGsyTmpraUx6NDhMM04yWno0PSIsCiAgICAgICJzaXplcyI6ICIyNDB4MjQwIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Niramit:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-green: #059669;
            --primary-blue: #2563eb;
            --neutral-gray: #64748b;
            --light-gray: #f1f5f9;
            --white: #ffffff;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Niramit', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--light-gray) 0%, #e2e8f0 100%);
            color: #334155;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-blue) 100%);
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-desktop {
            display: none;
            gap: 2rem;
        }
        
        .nav-desktop button {
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            transition: all 0.3s ease;
        }
        
        .nav-desktop button:hover,
        .nav-desktop button.active {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .hamburger {
            display: flex;
            flex-direction: column;
            cursor: pointer;
            gap: 4px;
        }
        
        .hamburger span {
            width: 25px;
            height: 3px;
            background: white;
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        
        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }
        
        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        
        /* Mobile Menu */
        .mobile-menu {
            position: fixed;
            top: 0;
            left: -100%;
            width: 280px;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-blue) 100%);
            padding: 80px 2rem 2rem;
            transition: left 0.3s ease;
            z-index: 99;
            overflow-y: auto;
        }
        
        .mobile-menu.active {
            left: 0;
        }
        
        .mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 98;
        }
        
        .mobile-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .mobile-nav {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .mobile-nav button {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            padding: 1rem;
            text-align: left;
            border-radius: var(--radius);
            transition: all 0.3s ease;
        }
        
        .mobile-nav button:hover,
        .mobile-nav button.active {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        /* Main Content */
        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 100px);
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary-green);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card h3 {
            font-size: 0.9rem;
            color: var(--neutral-gray);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 0.5rem;
        }
        
        .stat-card .change {
            font-size: 0.8rem;
            color: var(--success);
            font-weight: 500;
        }
        
        .chart-container {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }
        
        .chart-container h3 {
            margin-bottom: 1rem;
            color: #1e293b;
            font-weight: 600;
        }
        
        .chart {
            height: 300px;
            display: flex;
            align-items: end;
            justify-content: space-between;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .chart-bar {
            flex: 1;
            background: linear-gradient(to top, var(--primary-green), var(--primary-blue));
            border-radius: 4px 4px 0 0;
            min-height: 20px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .chart-bar:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }
        
        .chart-label {
            text-align: center;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: var(--neutral-gray);
        }
        
        /* Alerts */
        .alerts-container {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .alert {
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .alert.warning {
            background: #fef3c7;
            border-color: var(--warning);
            color: #92400e;
        }
        
        .alert.error {
            background: #fee2e2;
            border-color: var(--error);
            color: #991b1b;
        }
        
        .alert.success {
            background: #d1fae5;
            border-color: var(--success);
            color: #065f46;
        }
        
        /* Forms */
        .form-container {
            background: var(--white);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-group label {
            font-weight: 600;
            color: #374151;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
            font-family: inherit;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-blue) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -5px rgba(5, 150, 105, 0.3);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        /* Tables */
        .table-container {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            text-align: left;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }
        
        tr:hover {
            background: #f8fafc;
        }
        
        /* Page Header */
        .page-header {
            margin-bottom: 2rem;
        }
        
        .page-header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }
        
        .page-header p {
            color: var(--neutral-gray);
            font-size: 1.1rem;
        }
        
        /* Responsive Design */
        @media (min-width: 768px) {
            .hamburger {
                display: none;
            }
            
            .nav-desktop {
                display: flex;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-grid {
                grid-template-columns: 2fr 1fr;
            }
            
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .form-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 1440px) {
            .form-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* PWA Styles */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: var(--white);
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1000;
        }
        
        .install-prompt.show {
            display: block;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --white: #1e293b;
                --light-gray: #0f172a;
                --neutral-gray: #94a3b8;
            }
            
            body {
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                color: #e2e8f0;
            }
        }

        /* Additional Modern Styling */
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Performance indicators */
        .performance-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }
        
        .performance-indicator.good {
            background: var(--success);
        }
        
        .performance-indicator.warning {
            background: var(--warning);
        }
        
        .performance-indicator.poor {
            background: var(--error);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 240 240" fill="none">
                        <path d="M124.7 186.453c0,0 38.186.457.6z9" fill="#ffffff"/>
                    </svg>
                    ระบบจัดการฟาร์มสุกร
                </div>
                
                <nav class="nav-desktop">
                    <button onclick="showSection('dashboard')" class="active">แผงควบคุม</button>
                    <button onclick="showSection('pigs')">จัดการสุกร</button>
                    <button onclick="showSection('feeding')">การให้อาหาร</button>
                    <button onclick="showSection('health')">สุขภาพ</button>
                    <button onclick="showSection('reports')">รายงาน</button>
                </nav>
                
                <div class="hamburger" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu-overlay" onclick="toggleMobileMenu()"></div>
    <nav class="mobile-menu">
        <div class="mobile-nav">
            <button onclick="showSection('dashboard'); toggleMobileMenu()" class="active">🏠 แผงควบคุม</button>
            <button onclick="showSection('pigs'); toggleMobileMenu()">🐷 จัดการสุกร</button>
            <button onclick="showSection('feeding'); toggleMobileMenu()">🥗 การให้อาหาร</button>
            <button onclick="showSection('health'); toggleMobileMenu()">💊 สุขภาพ</button>
            <button onclick="showSection('reports'); toggleMobileMenu()">📊 รายงาน</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="page-header">
                    <h1>แผงควบคุมฟาร์มสุกร</h1>
                    <p>ภาพรวมประสิทธิภาพฟาร์มของคุณ</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>จำนวนสุกรทั้งหมด</h3>
                        <div class="value" id="totalPigs">0</div>
                        <div class="change">+5% จากเดือนที่แล้ว</div>
                    </div>
                    <div class="stat-card">
                        <h3>FCR เฉลี่ย</h3>
                        <div class="value" id="avgFCR">0.00</div>
                        <div class="change" id="fcrChange">เป้าหมาย: 2.35</div>
                    </div>
                    <div class="stat-card">
                        <h3>ADG เฉลี่ย (กรัม/วัน)</h3>
                        <div class="value" id="avgADG">0</div>
                        <div class="change" id="adgChange">เป้าหมาย: 700g</div>
                    </div>
                    <div class="stat-card">
                        <h3>อัตราการตาย (%)</h3>
                        <div class="value" id="mortalityRate">0.0</div>
                        <div class="change">ต่ำกว่ามาตรฐาน</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="chart-container">
                        <h3>แนวโน้ม FCR รายเดือน</h3>
                        <div class="chart" id="fcrChart">
                            <div>
                                <div class="chart-bar" style="height: 80px;"></div>
                                <div class="chart-label">ม.ค.</div>
                            </div>
                            <div>
                                <div class="chart-bar" style="height: 120px;"></div>
                                <div class="chart-label">ก.พ.</div>
                            </div>
                            <div>
                                <div class="chart-bar" style="height: 100px;"></div>
                                <div class="chart-label">มี.ค.</div>
                            </div>
                            <div>
                                <div class="chart-bar" style="height: 90px;"></div>
                                <div class="chart-label">เม.ย.</div>
                            </div>
                            <div>
                                <div class="chart-bar" style="height: 85px;"></div>
                                <div class="chart-label">พ.ค.</div>
                            </div>
                            <div>
                                <div class="chart-bar" style="height: 75px;"></div>
                                <div class="chart-label">มิ.ย.</div>
                            </div>
                        </div>
                    </div>

                    <div class="alerts-container">
                        <h3>การแจ้งเตือนอัจฉริยะ</h3>
                        <div id="alertsContainer">
                            <!-- Alerts will be dynamically generated -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Pigs Management Section -->
            <section id="pigs" class="section">
                <div class="page-header">
                    <h1>จัดการสุกร</h1>
                    <p>เพิ่ม แก้ไข และติดตามข้อมูลสุกร</p>
                </div>

                <div class="form-container">
                    <h3>เพิ่มสุกรใหม่</h3>
                    <form id="pigForm" class="form-grid">
                        <div class="form-group">
                            <label for="pigId">รหัสสุกร *</label>
                            <input type="text" id="pigId" required>
                        </div>
                        <div class="form-group">
                            <label for="pigGroup">กลุ่ม</label>
                            <select id="pigGroup">
                               <option value="อนุบาล">อนุบาล</option>
                               <option value="รุ่น">รุ่น</option>
                               <option value="ขุน">ขุน</option>
                               <option value="พ่อพันธุ์">พ่อพันธุ์</option>
                               <option value="แม่พันธุ์">แม่พันธุ์</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label for="pigWeight">น้ำหนัก (กก.)</label>
                           <input type="number" id="pigWeight" step="0.1" min="0">
                       </div>
                       <div class="form-group">
                           <label for="pigAge">อายุ (วัน)</label>
                           <input type="number" id="pigAge" min="0">
                       </div>
                       <div class="form-group">
                           <label for="pigGender">เพศ</label>
                           <select id="pigGender">
                               <option value="ผู้">ผู้</option>
                               <option value="เมีย">เมีย</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label for="pigBreed">สายพันธุ์</label>
                           <input type="text" id="pigBreed" placeholder="เช่น ลาร์จไวท์, แลนด์เรซ">
                       </div>
                       <div class="form-group">
                           <label for="pigCost">ต้นทุนลูกพันธุ์ (บาท)</label>
                           <input type="number" id="pigCost" step="0.01" min="0" value="2700">
                       </div>
                       <div class="form-group">
                           <label for="pigTargetWeight">น้ำหนักเป้าหมาย (กก.)</label>
                           <input type="number" id="pigTargetWeight" step="0.1" min="0" value="110">
                       </div>
                       <div class="form-group" style="grid-column: 1 / -1;">
                           <button type="submit" class="btn btn-primary">เพิ่มสุกร</button>
                       </div>
                   </form>
               </div>

               <div class="table-container" style="margin-top: 2rem;">
                   <h3 style="padding: 1rem; margin: 0;">รายชื่อสุกรในฟาร์ม</h3>
                   <div class="table-responsive">
                       <table id="pigsTable">
                           <thead>
                               <tr>
                                   <th>รหัส</th>
                                   <th>กลุ่ม</th>
                                   <th>น้ำหนัก (กก.)</th>
                                   <th>อายุ (วัน)</th>
                                   <th>FCR</th>
                                   <th>ADG</th>
                                   <th>สถานะ</th>
                                   <th>การจัดการ</th>
                               </tr>
                           </thead>
                           <tbody id="pigsTableBody">
                               <!-- Pig data will be populated here -->
                           </tbody>
                       </table>
                   </div>
               </div>
           </section>

           <!-- Feeding Section -->
           <section id="feeding" class="section">
               <div class="page-header">
                   <h1>การให้อาหาร</h1>
                   <p>บันทึกการให้อาหารและคำนวณ FCR</p>
               </div>

               <div class="form-container">
                   <h3>บันทึกการให้อาหาร</h3>
                   <form id="feedingForm" class="form-grid">
                       <div class="form-group">
                           <label for="feedPigId">รหัสสุกร / กลุ่ม *</label>
                           <select id="feedPigId" required>
                               <option value="">เลือกสุกรหรือกลุ่ม</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label for="feedType">ประเภทอาหาร</label>
                           <select id="feedType">
                               <option value="อาหารหมูเล็ก">อาหารหมูเล็ก (20 บาท/กก.)</option>
                               <option value="อาหารหมูรุ่น">อาหารหมูรุ่น (18 บาท/กก.)</option>
                               <option value="อาหารหมูขุน">อาหารหมูขุน (16 บาท/กก.)</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label for="feedAmount">ปริมาณอาหาร (กก.)</label>
                           <input type="number" id="feedAmount" step="0.1" min="0" required>
                       </div>
                       <div class="form-group">
                           <label for="feedDate">วันที่ให้อาหาร</label>
                           <input type="date" id="feedDate" required>
                       </div>
                       <div class="form-group">
                           <label for="feedNotes">หมายเหตุ</label>
                           <textarea id="feedNotes" rows="3" placeholder="บันทึกเพิ่มเติม"></textarea>
                       </div>
                       <div class="form-group" style="grid-column: 1 / -1;">
                           <button type="submit" class="btn btn-primary">บันทึกการให้อาหาร</button>
                       </div>
                   </form>
               </div>

               <div class="stats-grid" style="margin-top: 2rem;">
                   <div class="stat-card">
                       <h3>อาหารใช้วันนี้ (กก.)</h3>
                       <div class="value" id="todayFeed">0</div>
                       <div class="change">ต้นทุน: <span id="todayFeedCost">0</span> บาท</div>
                   </div>
                   <div class="stat-card">
                       <h3>อาหารเหลือในสต็อก (กก.)</h3>
                       <div class="value" id="feedStock">0</div>
                       <div class="change">เพียงพอ <span id="daysRemaining">0</span> วัน</div>
                   </div>
                   <div class="stat-card">
                       <h3>FCR เฉลี่ยล่าสุด</h3>
                       <div class="value" id="latestFCR">0.00</div>
                       <div class="change" id="fcrStatus">-</div>
                   </div>
                   <div class="stat-card">
                       <h3>ต้นทุนอาหารรวม (บาท)</h3>
                       <div class="value" id="totalFeedCost">0</div>
                       <div class="change">เดือนนี้</div>
                   </div>
               </div>

               <div class="table-container" style="margin-top: 2rem;">
                   <h3 style="padding: 1rem; margin: 0;">ประวัติการให้อาหาร</h3>
                   <div class="table-responsive">
                       <table id="feedingTable">
                           <thead>
                               <tr>
                                   <th>วันที่</th>
                                   <th>รหัส/กลุ่ม</th>
                                   <th>ประเภทอาหาร</th>
                                   <th>ปริมาณ (กก.)</th>
                                   <th>ต้นทุน (บาท)</th>
                                   <th>หมายเหตุ</th>
                               </tr>
                           </thead>
                           <tbody id="feedingTableBody">
                               <!-- Feeding records will be populated here -->
                           </tbody>
                       </table>
                   </div>
               </div>
           </section>

           <!-- Health Section -->
           <section id="health" class="section">
               <div class="page-header">
                   <h1>สุขภาพและวัคซีน</h1>
                   <p>ติดตามสุขภาพสุกรและตารางวัคซีน</p>
               </div>

               <div class="form-container">
                   <h3>บันทึกข้อมูลสุขภาพ</h3>
                   <form id="healthForm" class="form-grid">
                       <div class="form-group">
                           <label for="healthPigId">รหัสสุกร *</label>
                           <select id="healthPigId" required>
                               <option value="">เลือกสุกร</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label for="healthType">ประเภท</label>
                           <select id="healthType">
                               <option value="วัคซีน">วัคซีน</option>
                               <option value="ตรวจสุขภาพ">ตรวจสุขภาพ</option>
                               <option value="รักษาโรค">รักษาโรค</option>
                               <option value="การตาย">การตาย</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label for="vaccineType">ประเภทวัคซีน/การรักษา</label>
                           <select id="vaccineType">
                               <option value="วัคซีนป้องกันโรคปากและเท้าเปื่อย">วัคซีนป้องกันโรคปากและเท้าเปื่อย</option>
                               <option value="วัคซีนป้องกันโรคหูน้ำเหลือง">วัคซีนป้องกันโรคหูน้ำเหลือง</option>
                               <option value="วัคซีนป้องกันโรค PRRS">วัคซีนป้องกันโรค PRRS</option>
                               <option value="วัคซีนป้องกันโรคพิษสุนัขบ้า">วัคซีนป้องกันโรคพิษสุนัขบ้า</option>
                               <option value="วัคซีนป้องกันโรคไข้หวัดใหญ่">วัคซีนป้องกันโรคไข้หวัดใหญ่</option>
                               <option value="ยาปฏิชีวนะ">ยาปฏิชีวนะ</option>
                               <option value="ยาบำรุงสุขภาพ">ยาบำรุงสุขภาพ</option>
                               <option value="อื่นๆ">อื่นๆ</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label for="healthDate">วันที่</label>
                           <input type="date" id="healthDate" required>
                       </div>
                       <div class="form-group">
                           <label for="nextVaccineDate">วัคซีนเข็มต่อไป</label>
                           <input type="date" id="nextVaccineDate">
                       </div>
                       <div class="form-group">
                           <label for="healthCost">ค่าใช้จ่าย (บาท)</label>
                           <input type="number" id="healthCost" step="0.01" min="0">
                       </div>
                       <div class="form-group">
                           <label for="healthNotes">หมายเหตุ</label>
                           <textarea id="healthNotes" rows="3" placeholder="อาการ การรักษา ผลข้างเคียง"></textarea>
                       </div>
                       <div class="form-group" style="grid-column: 1 / -1;">
                           <button type="submit" class="btn btn-primary">บันทึกข้อมูลสุขภาพ</button>
                       </div>
                   </form>
               </div>

               <div class="stats-grid" style="margin-top: 2rem;">
                   <div class="stat-card">
                       <h3>วัคซีนครบกำหนดวันนี้</h3>
                       <div class="value" id="vaccineDueToday">0</div>
                       <div class="change">ตัว</div>
                   </div>
                   <div class="stat-card">
                       <h3>วัคซีนครบกำหนด 7 วัน</h3>
                       <div class="value" id="vaccineDueWeek">0</div>
                       <div class="change">ตัว</div>
                   </div>
                   <div class="stat-card">
                       <h3>อัตราการตายเดือนนี้</h3>
                       <div class="value" id="monthlyMortality">0.0</div>
                       <div class="change">%</div>
                   </div>
                   <div class="stat-card">
                       <h3>ค่ารักษาพยาบาลเดือนนี้</h3>
                       <div class="value" id="monthlyHealthCost">0</div>
                       <div class="change">บาท</div>
                   </div>
               </div>

               <div class="table-container" style="margin-top: 2rem;">
                   <h3 style="padding: 1rem; margin: 0;">ตารางวัคซีนและสุขภาพ</h3>
                   <div class="table-responsive">
                       <table id="healthTable">
                           <thead>
                               <tr>
                                   <th>วันที่</th>
                                   <th>รหัสสุกร</th>
                                   <th>ประเภท</th>
                                   <th>วัคซีน/การรักษา</th>
                                   <th>เข็มต่อไป</th>
                                   <th>ค่าใช้จ่าย</th>
                                   <th>สถานะ</th>
                               </tr>
                           </thead>
                           <tbody id="healthTableBody">
                               <!-- Health records will be populated here -->
                           </tbody>
                       </table>
                   </div>
               </div>
           </section>

           <!-- Reports Section -->
           <section id="reports" class="section">
               <div class="page-header">
                   <h1>รายงานและการวิเคราะห์</h1>
                   <p>รายงานประสิทธิภาพและการเงินของฟาร์ม</p>
               </div>

               <div class="form-container">
                   <h3>สร้างรายงาน</h3>
                   <div class="form-grid">
                       <div class="form-group">
                           <label for="reportType">ประเภทรายงาน</label>
                           <select id="reportType">
                               <option value="performance">รายงานประสิทธิภาพการผลิต</option>
                               <option value="financial">รายงานการเงิน</option>
                               <option value="health">รายงานสุขภาพ</option>
                               <option value="feeding">รายงานการให้อาหาร</option>
                               <option value="growth">รายงานการเจริญเติบโต</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label for="reportPeriod">ช่วงเวลา</label>
                           <select id="reportPeriod">
                               <option value="today">วันนี้</option>
                               <option value="week">สัปดาห์นี้</option>
                               <option value="month">เดือนนี้</option>
                               <option value="quarter">ไตรมาสนี้</option>
                               <option value="year">ปีนี้</option>
                               <option value="custom">กำหนดเอง</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label for="reportStartDate">วันที่เริ่มต้น</label>
                           <input type="date" id="reportStartDate">
                       </div>
                       <div class="form-group">
                           <label for="reportEndDate">วันที่สิ้นสุด</label>
                           <input type="date" id="reportEndDate">
                       </div>
                       <div class="form-group" style="grid-column: 1 / -1;">
                           <button type="button" onclick="generateReport()" class="btn btn-primary">สร้างรายงาน</button>
                           <button type="button" onclick="exportReport()" class="btn btn-secondary" style="margin-left: 1rem;">ส่งออก PDF</button>
                       </div>
                   </div>
               </div>

               <div id="reportResults" class="table-container" style="margin-top: 2rem; display: none;">
                   <h3 style="padding: 1rem; margin: 0;">ผลการรายงาน</h3>
                   <div id="reportContent" style="padding: 2rem;">
                       <!-- Report content will be generated here -->
                   </div>
               </div>

               <!-- Financial Summary -->
               <div class="chart-container" style="margin-top: 2rem;">
                   <h3>สรุปการเงิน</h3>
                   <div class="stats-grid">
                       <div class="stat-card">
                           <h3>รายได้รวม</h3>
                           <div class="value" id="totalRevenue">0</div>
                           <div class="change">บาท</div>
                       </div>
                       <div class="stat-card">
                           <h3>ต้นทุนรวม</h3>
                           <div class="value" id="totalCosts">0</div>
                           <div class="change">บาท</div>
                       </div>
                       <div class="stat-card">
                           <h3>กำไรสุทธิ</h3>
                           <div class="value" id="netProfit">0</div>
                           <div class="change">บาท</div>
                       </div>
                       <div class="stat-card">
                           <h3>ROI (%)</h3>
                           <div class="value" id="roi">0.0</div>
                           <div class="change">%</div>
                       </div>
                   </div>
               </div>
           </section>
       </div>
   </main>

   <!-- PWA Install Prompt -->
   <div class="install-prompt" id="installPrompt">
       <div style="display: flex; justify-content: space-between; align-items: center;">
           <div>
               <strong>ติดตั้งแอปบนมือถือ</strong>
               <p style="margin: 0; font-size: 0.9rem; color: var(--neutral-gray);">ใช้งานได้แม้ไม่มีอินเทอร์เน็ต</p>
           </div>
           <div>
               <button onclick="installPWA()" class="btn btn-primary" style="margin-right: 0.5rem;">ติดตั้ง</button>
               <button onclick="dismissInstall()" class="btn btn-secondary">ปิด</button>
           </div>
       </div>
   </div>

   <script>
       // Application State
       let appData = {
           pigs: [],
           feeding: [],
           health: [],
           settings: {
               fcrTarget: 2.35,
               adgTarget: 700,
               mortalityTarget: 5.0
           }
       };

       // Load data from localStorage
       function loadData() {
           const savedData = localStorage.getItem('pigFarmData');
           if (savedData) {
               appData = { ...appData, ...JSON.parse(savedData) };
           }
           updateDashboard();
           populateDropdowns();
           populateTables();
       }

       // Save data to localStorage
       function saveData() {
           localStorage.setItem('pigFarmData', JSON.stringify(appData));
       }

       // Mobile menu functionality
       function toggleMobileMenu() {
           const mobileMenu = document.querySelector('.mobile-menu');
           const overlay = document.querySelector('.mobile-menu-overlay');
           const hamburger = document.querySelector('.hamburger');
           
           mobileMenu.classList.toggle('active');
           overlay.classList.toggle('active');
           hamburger.classList.toggle('active');
       }

       // Section navigation
       function showSection(sectionName) {
           // Hide all sections
           document.querySelectorAll('.section').forEach(section => {
               section.classList.remove('active');
           });
           
           // Show selected section
           document.getElementById(sectionName).classList.add('active');
           
           // Update navigation active state
           document.querySelectorAll('.nav-desktop button, .mobile-nav button').forEach(btn => {
               btn.classList.remove('active');
           });
           
           event.target.classList.add('active');
           
           // Update specific sections
           if (sectionName === 'dashboard') {
               updateDashboard();
           }
       }

       // Pig Management
       document.getElementById('pigForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const pigData = {
               id: document.getElementById('pigId').value,
               group: document.getElementById('pigGroup').value,
               weight: parseFloat(document.getElementById('pigWeight').value) || 0,
               age: parseInt(document.getElementById('pigAge').value) || 0,
               gender: document.getElementById('pigGender').value,
               breed: document.getElementById('pigBreed').value,
               cost: parseFloat(document.getElementById('pigCost').value) || 2700,
               targetWeight: parseFloat(document.getElementById('pigTargetWeight').value) || 110,
               startWeight: parseFloat(document.getElementById('pigWeight').value) || 0,
               startDate: new Date().toISOString().split('T')[0],
               totalFeed: 0,
               status: 'active'
           };

           // Check if pig ID already exists
           if (appData.pigs.find(pig => pig.id === pigData.id)) {
               alert('รหัสสุกรนี้มีอยู่แล้ว กรุณาใช้รหัสอื่น');
               return;
           }

           appData.pigs.push(pigData);
           saveData();
           
           // Reset form
           this.reset();
           
           // Update displays
           updateDashboard();
           populateDropdowns();
           populateTables();
           
           alert('เพิ่มข้อมูลสุกรเรียบร้อยแล้ว');
       });

       // Feeding Management
       document.getElementById('feedingForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const feedingData = {
               pigId: document.getElementById('feedPigId').value,
               type: document.getElementById('feedType').value,
               amount: parseFloat(document.getElementById('feedAmount').value),
               date: document.getElementById('feedDate').value,
               notes: document.getElementById('feedNotes').value,
               cost: calculateFeedCost(document.getElementById('feedType').value, parseFloat(document.getElementById('feedAmount').value))
           };

           appData.feeding.push(feedingData);
           
           // Update pig's total feed consumption
           const pig = appData.pigs.find(p => p.id === feedingData.pigId);
           if (pig) {
               pig.totalFeed = (pig.totalFeed || 0) + feedingData.amount;
           }
           
           saveData();
           
           // Reset form
           this.reset();
           document.getElementById('feedDate').value = new Date().toISOString().split('T')[0];
           
           // Update displays
           updateDashboard();
           populateTables();
           
           alert('บันทึกการให้อาหารเรียบร้อยแล้ว');
       });

       // Health Management
       document.getElementById('healthForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const healthData = {
               pigId: document.getElementById('healthPigId').value,
               type: document.getElementById('healthType').value,
               vaccineType: document.getElementById('vaccineType').value,
               date: document.getElementById('healthDate').value,
               nextVaccineDate: document.getElementById('nextVaccineDate').value,
               cost: parseFloat(document.getElementById('healthCost').value) || 0,
               notes: document.getElementById('healthNotes').value
           };

           appData.health.push(healthData);
           
           // If it's a death record, update pig status
           if (healthData.type === 'การตาย') {
               const pig = appData.pigs.find(p => p.id === healthData.pigId);
               if (pig) {
                   pig.status = 'dead';
                   pig.deathDate = healthData.date;
               }
           }
           
           saveData();
           
           // Reset form
           this.reset();
           document.getElementById('healthDate').value = new Date().toISOString().split('T')[0];
           
           // Update displays
           updateDashboard();
           populateTables();
           
           alert('บันทึกข้อมูลสุขภาพเรียบร้อยแล้ว');
       });

       // Calculation functions
       function calculateFeedCost(feedType, amount) {
           const prices = {
               'อาหารหมูเล็ก': 20,
               'อาหารหมูรุ่น': 18,
               'อาหารหมูขุน': 16
           };
           return (prices[feedType] || 18) * amount;
       }

       function calculateFCR(pig) {
           if (!pig.totalFeed || pig.weight <= pig.startWeight) return 0;
           return pig.totalFeed / (pig.weight - pig.startWeight);
       }

       function calculateADG(pig) {
           const today = new Date();
           const startDate = new Date(pig.startDate);
           const daysDiff = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24));
           
           if (daysDiff <= 0 || pig.weight <= pig.startWeight) return 0;
           return ((pig.weight - pig.startWeight) * 1000) / daysDiff; // Convert to grams
       }

       function predictSaleDate(pig) {
           const adg = calculateADG(pig);
           if (adg <= 0) return null;
           
           const remainingWeight = pig.targetWeight - pig.weight;
           const daysToTarget = Math.ceil((remainingWeight * 1000) / adg);
           
           const saleDate = new Date();
           saleDate.setDate(saleDate.getDate() + daysToTarget);
           return saleDate;
       }

       // Update Dashboard
       function updateDashboard() {
           const activePigs = appData.pigs.filter(pig => pig.status === 'active');
           const deadPigs = appData.pigs.filter(pig => pig.status === 'dead');
           
           // Total pigs
           document.getElementById('totalPigs').textContent = activePigs.length;
           
           // Average FCR
           const fcrs = activePigs.map(pig => calculateFCR(pig)).filter(fcr => fcr > 0);
           const avgFCR = fcrs.length > 0 ? fcrs.reduce((a, b) => a + b, 0) / fcrs.length : 0;
           document.getElementById('avgFCR').textContent = avgFCR.toFixed(2);
           
           // FCR status
           const fcrStatus = document.getElementById('fcrChange');
           if (avgFCR > 0) {
               if (avgFCR <= appData.settings.fcrTarget) {
                   fcrStatus.textContent = '✅ ดีกว่าเป้าหมาย';
                   fcrStatus.style.color = 'var(--success)';
               } else {
                   fcrStatus.textContent = '⚠️ สูงกว่าเป้าหมาย';
                   fcrStatus.style.color = 'var(--warning)';
               }
           }
           
           // Average ADG
           const adgs = activePigs.map(pig => calculateADG(pig)).filter(adg => adg > 0);
           const avgADG = adgs.length > 0 ? adgs.reduce((a, b) => a + b, 0) / adgs.length : 0;
           document.getElementById('avgADG').textContent = Math.round(avgADG);
           
           // ADG status
           const adgStatus = document.getElementById('adgChange');
           if (avgADG > 0) {
               if (avgADG >= appData.settings.adgTarget) {
                   adgStatus.textContent = '✅ ดีกว่าเป้าหมาย';
                   adgStatus.style.color = 'var(--success)';
               } else {
                   adgStatus.textContent = '⚠️ ต่ำกว่าเป้าหมาย';
                   adgStatus.style.color = 'var(--warning)';
               }
           }
           // Mortality rate
           const totalPigs = appData.pigs.length;
           const mortalityRate = totalPigs > 0 ? (deadPigs.length / totalPigs) * 100 : 0;
           document.getElementById('mortalityRate').textContent = mortalityRate.toFixed(1);
           
           // Update alerts
           updateAlerts();
           
           // Update feeding stats
           updateFeedingStats();
           
           // Update health stats
           updateHealthStats();
           
           // Update financial summary
           updateFinancialSummary();
       }

       // Update Alerts
       function updateAlerts() {
           const alertsContainer = document.getElementById('alertsContainer');
           alertsContainer.innerHTML = '';
           
           const alerts = [];
           
           // Check pigs ready for sale
           const readyForSale = appData.pigs.filter(pig => 
               pig.status === 'active' && pig.weight >= pig.targetWeight
           );
           if (readyForSale.length > 0) {
               alerts.push({
                   type: 'success',
                   message: `มีสุกร ${readyForSale.length} ตัว พร้อมขาย (น้ำหนักถึงเป้าหมายแล้ว)`
               });
           }
           
           // Check FCR performance
           const activePigs = appData.pigs.filter(pig => pig.status === 'active');
           const poorFCRPigs = activePigs.filter(pig => {
               const fcr = calculateFCR(pig);
               return fcr > 0 && fcr > appData.settings.fcrTarget * 1.1;
           });
           if (poorFCRPigs.length > 0) {
               alerts.push({
                   type: 'warning',
                   message: `มีสุกร ${poorFCRPigs.length} ตัว มี FCR สูงกว่าเป้าหมาย 10%`
               });
           }
           
           // Check vaccines due
           const today = new Date().toISOString().split('T')[0];
           const vaccinesDue = appData.health.filter(record => 
               record.nextVaccineDate === today && record.type === 'วัคซีน'
           );
           if (vaccinesDue.length > 0) {
               alerts.push({
                   type: 'warning',
                   message: `มีสุกร ${vaccinesDue.length} ตัว ครบกำหนดวัคซีนวันนี้`
               });
           }
           
           // Check feed stock (simulate low stock)
           const totalFeedUsed = appData.feeding.reduce((sum, record) => sum + record.amount, 0);
           const avgDailyFeed = totalFeedUsed / Math.max(1, appData.feeding.length);
           if (avgDailyFeed > 0) {
               const estimatedStock = 1000; // Simulated stock
               const daysRemaining = estimatedStock / avgDailyFeed;
               if (daysRemaining < 7) {
                   alerts.push({
                       type: 'error',
                       message: `อาหารคงเหลือเพียงพอ ${Math.round(daysRemaining)} วัน ควรสั่งซื้อเพิ่ม`
                   });
               }
           }
           
           // Display alerts
           if (alerts.length === 0) {
               alertsContainer.innerHTML = '<div class="alert success">ไม่มีการแจ้งเตือน ทุกอย่างปกติดี</div>';
           } else {
               alerts.forEach(alert => {
                   const alertDiv = document.createElement('div');
                   alertDiv.className = `alert ${alert.type}`;
                   alertDiv.innerHTML = `
                       <span class="performance-indicator ${alert.type === 'success' ? 'good' : alert.type === 'warning' ? 'warning' : 'poor'}"></span>
                       ${alert.message}
                   `;
                   alertsContainer.appendChild(alertDiv);
               });
           }
       }

       // Update Feeding Stats
       function updateFeedingStats() {
           const today = new Date().toISOString().split('T')[0];
           const todayFeeding = appData.feeding.filter(record => record.date === today);
           
           const todayFeed = todayFeeding.reduce((sum, record) => sum + record.amount, 0);
           const todayFeedCost = todayFeeding.reduce((sum, record) => sum + record.cost, 0);
           
           document.getElementById('todayFeed').textContent = todayFeed.toFixed(1);
           document.getElementById('todayFeedCost').textContent = todayFeedCost.toFixed(2);
           
           // Simulate feed stock
           const totalFeedUsed = appData.feeding.reduce((sum, record) => sum + record.amount, 0);
           const avgDailyFeed = totalFeedUsed / Math.max(1, appData.feeding.length);
           const estimatedStock = Math.max(0, 1000 - totalFeedUsed);
           const daysRemaining = avgDailyFeed > 0 ? estimatedStock / avgDailyFeed : 0;
           
           document.getElementById('feedStock').textContent = estimatedStock.toFixed(0);
           document.getElementById('daysRemaining').textContent = Math.round(daysRemaining);
           
           // Latest FCR
           const activePigs = appData.pigs.filter(pig => pig.status === 'active');
           const fcrs = activePigs.map(pig => calculateFCR(pig)).filter(fcr => fcr > 0);
           const latestFCR = fcrs.length > 0 ? fcrs.reduce((a, b) => a + b, 0) / fcrs.length : 0;
           
           document.getElementById('latestFCR').textContent = latestFCR.toFixed(2);
           
           const fcrStatusEl = document.getElementById('fcrStatus');
           if (latestFCR > 0) {
               if (latestFCR <= appData.settings.fcrTarget) {
                   fcrStatusEl.textContent = '✅ ดีเยี่ยม';
                   fcrStatusEl.style.color = 'var(--success)';
               } else if (latestFCR <= appData.settings.fcrTarget * 1.1) {
                   fcrStatusEl.textContent = '⚠️ ปานกลาง';
                   fcrStatusEl.style.color = 'var(--warning)';
               } else {
                   fcrStatusEl.textContent = '❌ ต้องปรับปรุง';
                   fcrStatusEl.style.color = 'var(--error)';
               }
           }
           
           // Total feed cost this month
           const currentMonth = new Date().toISOString().slice(0, 7);
           const monthlyFeeding = appData.feeding.filter(record => record.date.startsWith(currentMonth));
           const monthlyFeedCost = monthlyFeeding.reduce((sum, record) => sum + record.cost, 0);
           
           document.getElementById('totalFeedCost').textContent = monthlyFeedCost.toFixed(2);
       }

       // Update Health Stats
       function updateHealthStats() {
           const today = new Date().toISOString().split('T')[0];
           const nextWeek = new Date();
           nextWeek.setDate(nextWeek.getDate() + 7);
           const nextWeekDate = nextWeek.toISOString().split('T')[0];
           
           // Vaccines due today
           const vaccinesToday = appData.health.filter(record => 
               record.nextVaccineDate === today && record.type === 'วัคซีน'
           );
           document.getElementById('vaccineDueToday').textContent = vaccinesToday.length;
           
           // Vaccines due within 7 days
           const vaccinesWeek = appData.health.filter(record => 
               record.nextVaccineDate >= today && 
               record.nextVaccineDate <= nextWeekDate && 
               record.type === 'วัคซีน'
           );
           document.getElementById('vaccineDueWeek').textContent = vaccinesWeek.length;
           
           // Monthly mortality rate
           const currentMonth = new Date().toISOString().slice(0, 7);
           const monthlyDeaths = appData.health.filter(record => 
               record.date.startsWith(currentMonth) && record.type === 'การตาย'
           );
           const activePigs = appData.pigs.filter(pig => pig.status === 'active');
           const totalPigs = activePigs.length + monthlyDeaths.length;
           const monthlyMortality = totalPigs > 0 ? (monthlyDeaths.length / totalPigs) * 100 : 0;
           
           document.getElementById('monthlyMortality').textContent = monthlyMortality.toFixed(1);
           
           // Monthly health cost
           const monthlyHealthRecords = appData.health.filter(record => 
               record.date.startsWith(currentMonth)
           );
           const monthlyHealthCost = monthlyHealthRecords.reduce((sum, record) => sum + (record.cost || 0), 0);
           
           document.getElementById('monthlyHealthCost').textContent = monthlyHealthCost.toFixed(2);
       }

       // Update Financial Summary
       function updateFinancialSummary() {
           // Calculate revenue (simulated from sold pigs)
           const soldPigs = appData.pigs.filter(pig => pig.status === 'sold');
           const avgSalePrice = 65; // 65 baht per kg
           const totalRevenue = soldPigs.reduce((sum, pig) => sum + (pig.weight * avgSalePrice), 0);
           
           // Calculate costs
           const feedCosts = appData.feeding.reduce((sum, record) => sum + record.cost, 0);
           const healthCosts = appData.health.reduce((sum, record) => sum + (record.cost || 0), 0);
           const pigCosts = appData.pigs.reduce((sum, pig) => sum + pig.cost, 0);
           const totalCosts = feedCosts + healthCosts + pigCosts;
           
           // Calculate profit and ROI
           const netProfit = totalRevenue - totalCosts;
           const roi = totalCosts > 0 ? (netProfit / totalCosts) * 100 : 0;
           
           document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString();
           document.getElementById('totalCosts').textContent = totalCosts.toLocaleString();
           document.getElementById('netProfit').textContent = netProfit.toLocaleString();
           document.getElementById('roi').textContent = roi.toFixed(1);
       }

       // Populate dropdowns
       function populateDropdowns() {
           const pigSelects = [
               document.getElementById('feedPigId'),
               document.getElementById('healthPigId')
           ];
           
           pigSelects.forEach(select => {
               if (!select) return;
               
               // Clear existing options except first
               while (select.children.length > 1) {
                   select.removeChild(select.lastChild);
               }
               
               // Add active pigs
               const activePigs = appData.pigs.filter(pig => pig.status === 'active');
               activePigs.forEach(pig => {
                   const option = document.createElement('option');
                   option.value = pig.id;
                   option.textContent = `${pig.id} (${pig.group}, ${pig.weight}kg)`;
                   select.appendChild(option);
               });
               
               // Add groups for feeding
               if (select.id === 'feedPigId') {
                   const groups = [...new Set(activePigs.map(pig => pig.group))];
                   groups.forEach(group => {
                       const option = document.createElement('option');
                       option.value = `group:${group}`;
                       option.textContent = `กลุ่ม: ${group}`;
                       select.appendChild(option);
                   });
               }
           });
       }

       // Populate tables
       function populateTables() {
           populatePigsTable();
           populateFeedingTable();
           populateHealthTable();
       }

       function populatePigsTable() {
           const tbody = document.getElementById('pigsTableBody');
           tbody.innerHTML = '';
           
           appData.pigs.forEach(pig => {
               const fcr = calculateFCR(pig);
               const adg = calculateADG(pig);
               
               const row = document.createElement('tr');
               row.innerHTML = `
                   <td>${pig.id}</td>
                   <td>${pig.group}</td>
                   <td>${pig.weight}</td>
                   <td>${pig.age}</td>
                   <td>${fcr > 0 ? fcr.toFixed(2) : '-'}</td>
                   <td>${adg > 0 ? Math.round(adg) : '-'}</td>
                   <td>
                       <span class="performance-indicator ${pig.status === 'active' ? 'good' : pig.status === 'dead' ? 'poor' : 'warning'}"></span>
                       ${pig.status === 'active' ? 'ปกติ' : pig.status === 'dead' ? 'ตาย' : 'ขายแล้ว'}
                   </td>
                   <td>
                       <button onclick="editPig('${pig.id}')" class="btn btn-secondary" style="padding: 0.25rem 0.5rem; margin-right: 0.25rem;">แก้ไข</button>
                       <button onclick="deletePig('${pig.id}')" class="btn" style="padding: 0.25rem 0.5rem; background: var(--error); color: white;">ลบ</button>
                   </td>
               `;
               tbody.appendChild(row);
           });
       }

       function populateFeedingTable() {
           const tbody = document.getElementById('feedingTableBody');
           tbody.innerHTML = '';
           
           // Sort by date descending
           const sortedFeeding = [...appData.feeding].sort((a, b) => new Date(b.date) - new Date(a.date));
           
           sortedFeeding.slice(0, 50).forEach(record => { // Show last 50 records
               const row = document.createElement('tr');
               row.innerHTML = `
                   <td>${new Date(record.date).toLocaleDateString('th-TH')}</td>
                   <td>${record.pigId}</td>
                   <td>${record.type}</td>
                   <td>${record.amount}</td>
                   <td>${record.cost.toFixed(2)}</td>
                   <td>${record.notes || '-'}</td>
               `;
               tbody.appendChild(row);
           });
       }

       function populateHealthTable() {
           const tbody = document.getElementById('healthTableBody');
           tbody.innerHTML = '';
           
           // Sort by date descending
           const sortedHealth = [...appData.health].sort((a, b) => new Date(b.date) - new Date(a.date));
           
           sortedHealth.slice(0, 50).forEach(record => { // Show last 50 records
               const nextVaccine = record.nextVaccineDate ? new Date(record.nextVaccineDate).toLocaleDateString('th-TH') : '-';
               const isOverdue = record.nextVaccineDate && new Date(record.nextVaccineDate) < new Date();
               
               const row = document.createElement('tr');
               row.innerHTML = `
                   <td>${new Date(record.date).toLocaleDateString('th-TH')}</td>
                   <td>${record.pigId}</td>
                   <td>${record.type}</td>
                   <td>${record.vaccineType}</td>
                   <td style="color: ${isOverdue ? 'var(--error)' : 'inherit'}">${nextVaccine}</td>
                   <td>${record.cost ? record.cost.toFixed(2) : '-'}</td>
                   <td>
                       <span class="performance-indicator ${record.type === 'การตาย' ? 'poor' : isOverdue ? 'warning' : 'good'}"></span>
                       ${record.type === 'การตาย' ? 'เสียชีวิต' : isOverdue ? 'เกินกำหนด' : 'ปกติ'}
                   </td>
               `;
               tbody.appendChild(row);
           });
       }

       // CRUD Operations
       function editPig(pigId) {
           const pig = appData.pigs.find(p => p.id === pigId);
           if (!pig) return;
           
           // Populate form with pig data
           document.getElementById('pigId').value = pig.id;
           document.getElementById('pigGroup').value = pig.group;
           document.getElementById('pigWeight').value = pig.weight;
           document.getElementById('pigAge').value = pig.age;
           document.getElementById('pigGender').value = pig.gender;
           document.getElementById('pigBreed').value = pig.breed;
           document.getElementById('pigCost').value = pig.cost;
           document.getElementById('pigTargetWeight').value = pig.targetWeight;
           
           // Show pigs section
           showSection('pigs');
           
           // Scroll to form
           document.getElementById('pigForm').scrollIntoView({ behavior: 'smooth' });
       }

       function deletePig(pigId) {
           if (!confirm('คุณแน่ใจหรือไม่ที่จะลบข้อมูลสุกรนี้?')) return;
           
           appData.pigs = appData.pigs.filter(p => p.id !== pigId);
           appData.feeding = appData.feeding.filter(f => f.pigId !== pigId);
           appData.health = appData.health.filter(h => h.pigId !== pigId);
           
           saveData();
           updateDashboard();
           populateDropdowns();
           populateTables();
           
           alert('ลบข้อมูลสุกรเรียบร้อยแล้ว');
       }

       // Report Generation
       function generateReport() {
           const reportType = document.getElementById('reportType').value;
           const reportPeriod = document.getElementById('reportPeriod').value;
           const startDate = document.getElementById('reportStartDate').value;
           const endDate = document.getElementById('reportEndDate').value;
           
           let dateFilter = () => true;
           
           if (reportPeriod !== 'custom') {
               const today = new Date();
               let filterStartDate;
               
               switch (reportPeriod) {
                   case 'today':
                       filterStartDate = today.toISOString().split('T')[0];
                       dateFilter = (date) => date === filterStartDate;
                       break;
                   case 'week':
                       filterStartDate = new Date(today.setDate(today.getDate() - 7)).toISOString().split('T')[0];
                       dateFilter = (date) => date >= filterStartDate;
                       break;
                   case 'month':
                       filterStartDate = today.toISOString().slice(0, 7);
                       dateFilter = (date) => date.startsWith(filterStartDate);
                       break;
                   case 'quarter':
                       const quarterStart = new Date(today.getFullYear(), Math.floor(today.getMonth() / 3) * 3, 1);
                       filterStartDate = quarterStart.toISOString().split('T')[0];
                       dateFilter = (date) => date >= filterStartDate;
                       break;
                   case 'year':
                       filterStartDate = today.getFullYear().toString();
                       dateFilter = (date) => date.startsWith(filterStartDate);
                       break;
               }
           } else if (startDate && endDate) {
               dateFilter = (date) => date >= startDate && date <= endDate;
           }
           
           let reportContent = '';
           
           switch (reportType) {
               case 'performance':
                   reportContent = generatePerformanceReport(dateFilter);
                   break;
               case 'financial':
                   reportContent = generateFinancialReport(dateFilter);
                   break;
               case 'health':
                   reportContent = generateHealthReport(dateFilter);
                   break;
               case 'feeding':
                   reportContent = generateFeedingReport(dateFilter);
                   break;
               case 'growth':
                   reportContent = generateGrowthReport(dateFilter);
                   break;
           }
           
           document.getElementById('reportContent').innerHTML = reportContent;
           document.getElementById('reportResults').style.display = 'block';
           document.getElementById('reportResults').scrollIntoView({ behavior: 'smooth' });
       }

       function generatePerformanceReport(dateFilter) {
           const activePigs = appData.pigs.filter(pig => pig.status === 'active');
           const fcrs = activePigs.map(pig => calculateFCR(pig)).filter(fcr => fcr > 0);
           const adgs = activePigs.map(pig => calculateADG(pig)).filter(adg => adg > 0);
           
           const avgFCR = fcrs.length > 0 ? fcrs.reduce((a, b) => a + b, 0) / fcrs.length : 0;
           const avgADG = adgs.length > 0 ? adgs.reduce((a, b) => a + b, 0) / adgs.length : 0;
           
           const deadPigs = appData.pigs.filter(pig => pig.status === 'dead');
           const mortalityRate = appData.pigs.length > 0 ? (deadPigs.length / appData.pigs.length) * 100 : 0;
           
           return `
               <h4>รายงานประสิทธิภาพการผลิต</h4>
               <div class="stats-grid">
                   <div class="stat-card">
                       <h3>FCR เฉลี่ย</h3>
                       <div class="value">${avgFCR.toFixed(2)}</div>
                       <div class="change">เป้าหมาย: ${appData.settings.fcrTarget}</div>
                   </div>
                   <div class="stat-card">
                       <h3>ADG เฉลี่ย (กรัม/วัน)</h3>
                       <div class="value">${Math.round(avgADG)}</div>
                       <div class="change">เป้าหมาย: ${appData.settings.adgTarget}</div>
                   </div>
                   <div class="stat-card">
                       <h3>อัตราการตาย (%)</h3>
                       <div class="value">${mortalityRate.toFixed(1)}</div>
                       <div class="change">เป้าหมาย: < ${appData.settings.mortalityTarget}</div>
                   </div>
                   <div class="stat-card">
                       <h3>จำนวนสุกรทั้งหมด</h3>
                       <div class="value">${appData.pigs.length}</div>
                       <div class="change">ใช้งาน: ${activePigs.length}</div>
                   </div>
               </div>
               <h5 style="margin-top: 2rem;">การวิเคราะห์</h5>
               <p><strong>ประสิทธิภาพ FCR:</strong> ${avgFCR <= appData.settings.fcrTarget ? 'ดีเยี่ยม' : 'ต้องปรับปรุง'}</p>
               <p><strong>ประสิทธิภาพ ADG:</strong> ${avgADG >= appData.settings.adgTarget ? 'ดีเยี่ยม' : 'ต้องปรับปรุง'}</p>
               <p><strong>การจัดการสุขภาพ:</strong> ${mortalityRate <= appData.settings.mortalityTarget ? 'ดีเยี่ยม' : 'ต้องปรับปรุง'}</p>
           `;
       }

       function generateFinancialReport(dateFilter) {
           const feedCosts = appData.feeding.filter(record => dateFilter(record.date))
               .reduce((sum, record) => sum + record.cost, 0);
           const healthCosts = appData.health.filter(record => dateFilter(record.date))
               .reduce((sum, record) => sum + (record.cost || 0), 0);
           
           // Simulate revenue from sold pigs
           const soldPigs = appData.pigs.filter(pig => pig.status === 'sold');
           const avgSalePrice = 65; // 65 baht per kg
           const revenue = soldPigs.reduce((sum, pig) => sum + (pig.weight * avgSalePrice), 0);
           
           const totalCosts = feedCosts + healthCosts;
           const netProfit = revenue - totalCosts;
           const roi = totalCosts > 0 ? (netProfit / totalCosts) * 100 : 0;
           
           return `
               <h4>รายงานการเงิน</h4>
               <div class="stats-grid">
                   <div class="stat-card">
                       <h3>รายได้</h3>
                       <div class="value">${revenue.toLocaleString()}</div>
                       <div class="change">บาท</div>
                   </div>
                   <div class="stat-card">
                       <h3>ต้นทุนอาหาร</h3>
                       <div class="value">${feedCosts.toLocaleString()}</div>
                       <div class="change">บาท</div>
                   </div>
                   <div class="stat-card">
                       <h3>ต้นทุนสุขภาพ</h3>
                       <div class="value">${healthCosts.toLocaleString()}</div>
                       <div class="change">บาท</div>
                   </div>
                   <div class="stat-card">
                       <h3>กำไรสุทธิ</h3>
                       <div class="value" style="color: ${netProfit >= 0 ? 'var(--success)' : 'var(--error)'}">${netProfit.toLocaleString()}</div>
                       <div class="change">ROI: ${roi.toFixed(1)}%</div>
                   </div>
               </div>
               <h5 style="margin-top: 2rem;">รายละเอียดต้นทุน</h5>
               <p><strong>สัดส่วนต้นทุนอาหาร:</strong> ${totalCosts > 0 ? ((feedCosts / totalCosts) * 100).toFixed(1) : 0}%</p>
               <p><strong>สัดส่วนต้นทุนสุขภาพ:</strong> ${totalCosts > 0 ? ((healthCosts / totalCosts) * 100).toFixed(1) : 0}%</p>
               <p><strong>ต้นทุนต่อกิโลกรัม:</strong> ${appData.pigs.length > 0 ? (totalCosts / appData.pigs.reduce((sum, pig) => sum + pig.weight, 0)).toFixed(2) : 0} บาท/กก.</p>
           `;
       }

       function generateHealthReport(dateFilter) {
           const healthRecords = appData.health.filter(record => dateFilter(record.date));
           const vaccineRecords = healthRecords.filter(record => record.type === 'วัคซีน');
           const treatmentRecords = healthRecords.filter(record => record.type === 'รักษาโรค');
           const deathRecords = healthRecords.filter(record => record.type === 'การตาย');
           
           const totalHealthCost = healthRecords.reduce((sum, record) => sum + (record.cost || 0), 0);
           
           return `
               <h4>รายงานสุขภาพ</h4>
               <div class="stats-grid">
                   <div class="stat-card">
                       <h3>จำนวนวัคซีน</h3>
                       <div class="value">${vaccineRecords.length}</div>
                       <div class="change">ครั้ง</div>
                   </div>
                   <div class="stat-card">
                       <h3>จำนวนการรักษา</h3>
                       <div class="value">${treatmentRecords.length}</div>
                       <div class="change">ครั้ง</div>
                   </div>
                   <div class="stat-card">
                       <h3>จำนวนการตาย</h3>
                       <div class="value">${deathRecords.length}</div>
                       <div class="change">ตัว</div>
                   </div>
                   <div class="stat-card">
                       <h3>ค่าใช้จ่ายรวม</h3>
                       <div class="value">${totalHealthCost.toLocaleString()}</div>
                       <div class="change">บาท</div>
                   </div>
               </div>
               <h5 style="margin-top: 2rem;">สรุปการดูแลสุขภาพ</h5>
               <p><strong>อัตราการให้วัคซีน:</strong> ${appData.pigs.length > 0 ? ((vaccineRecords.length / appData.pigs.length) * 100).toFixed(1) : 0}%</p>
               <p><strong>อัตราการเจ็บป่วย:</strong> ${appData.pigs.length > 0 ? ((treatmentRecords.length / appData.pigs.length) * 100).toFixed(1) : 0}%</p>
               <p><strong>ค่าใช้จ่ายเฉลี่ยต่อตัว:</strong> ${appData.pigs.length > 0 ? (totalHealthCost / appData.pigs.length).toFixed(2) : 0} บาท</p>
           `;
       }

       function generateFeedingReport(dateFilter) {
           const feedingRecords = appData.feeding.filter(record => dateFilter(record.date));
           const totalFeed = feedingRecords.reduce((sum, record) => sum + record.amount, 0);
           const totalFeedCost = feedingRecords.reduce((sum, record) => sum + record.cost, 0);
           const avgFeedCost = totalFeed > 0 ? totalFeedCost / totalFeed : 0;
           
           // Group by feed type
           const feedByType = {};
           feedingRecords.forEach(record => {
               if (!feedByType[record.type]) {
                   feedByType[record.type] = { amount: 0, cost: 0 };
               }
               feedByType[record.type].amount += record.amount;
               feedByType[record.type].cost += record.cost;
           });
           
           return `
               <h4>รายงานการให้อาหาร</h4>
               <div class="stats-grid">
                   <div class="stat-card">
                       <h3>อาหารรวม</h3>
                       <div class="value">${totalFeed.toLocaleString()}</div>
                       <div class="change">กิโลกรัม</div>
                   </div>
                   <div class="stat-card">
                       <h3>ต้นทุนอาหาร</h3>
                       <div class="value">${totalFeedCost.toLocaleString()}</div>
                       <div class="change">บาท</div>
                   </div>
                   <div class="stat-card">
                       <h3>ราคาเฉลี่ย</h3>
                       <div class="value">${avgFeedCost.toFixed(2)}</div>
                       <div class="change">บาท/กก.</div>
                   </div>
                   <div class="stat-card">
                       <h3>อาหารต่อวัน</h3>
                       <div class="value">${feedingRecords.length > 0 ? (totalFeed / feedingRecords.length).toFixed(1) : 0}</div>
                       <div class="change">กก./วัน</div>
                   </div>
               </div>
               <h5 style="margin-top: 2rem;">รายละเอียดตามประเภทอาหาร</h5>
               ${Object.entries(feedByType).map(([type, data]) => `
                   <p><strong>${type}:</strong> ${data.amount.toFixed(1)} กก. (${data.cost.toFixed(2)} บาท)</p>
               `).join('')}
           `;
       }

       function generateGrowthReport(dateFilter) {
           const activePigs = appData.pigs.filter(pig => pig.status === 'active');
           const readyForSale = activePigs.filter(pig => pig.weight >= pig.targetWeight);
           
           // Calculate average weights by group
           const weightsByGroup = {};
           activePigs.forEach(pig => {
               if (!weightsByGroup[pig.group]) {
                   weightsByGroup[pig.group] = [];
               }
               weightsByGroup[pig.group].push(pig.weight);
           });
           
           const avgWeightsByGroup = {};
           Object.entries(weightsByGroup).forEach(([group, weights]) => {
               avgWeightsByGroup[group] = weights.reduce((a, b) => a + b, 0) / weights.length;
           });
           
           return `
               <h4>รายงานการเจริญเติบโต</h4>
               <div class="stats-grid">
                   <div class="stat-card">
                       <h3>สุกรพร้อมขาย</h3>
                       <div class="value">${readyForSale.length}</div>
                       <div class="change">ตัว</div>
                   </div>
                   <div class="stat-card">
                       <h3>น้ำหนักเฉลี่ย</h3>
                       <div class="value">${activePigs.length > 0 ? (activePigs.reduce((sum, pig) => sum + pig.weight, 0) / activePigs.length).toFixed(1) : 0}</div>
                       <div class="change">กิโลกรัม</div>
                   </div>
                   <div class="stat-card">
                       <h3>ADG เฉลี่ย</h3>
                       <div class="value">${activePigs.length > 0 ? Math.round(activePigs.map(pig => calculateADG(pig)).filter(adg => adg > 0).reduce((a, b) => a + b, 0) / activePigs.filter(pig => calculateADG(pig) > 0).length || 0) : 0}</div>
                       <div class="change">กรัม/วัน</div>
                   </div>
                   <div class="stat-card">
                       <h3>เปอร์เซ็นต์พร้อมขาย</h3>
                       <div class="value">${activePigs.length > 0 ? ((readyForSale.length / activePigs.length) * 100).toFixed(1) : 0}</div>
                       <div class="change">%</div>
                   </div>
               </div>
               <h5 style="margin-top: 2rem;">น้ำหนักเฉลี่ยตามกลุ่ม</h5>
               ${Object.entries(avgWeightsByGroup).map(([group, avgWeight]) => `
                   <p><strong>กลุ่ม${group}:</strong> ${avgWeight.toFixed(1)} กิโลกรัม</p>
               `).join('')}
           `;
       }

       function exportReport() {
           const reportContent = document.getElementById('reportContent').innerHTML;
           const reportType = document.getElementById('reportType').value;
           
           // Create a new window for printing
           const printWindow = window.open('', '_blank');
           printWindow.document.write(`
               <!DOCTYPE html>
               <html>
               <head>
                   <title>รายงานฟาร์มสุกร</title>
                   <meta charset="UTF-8">
                   <style>
                       body { font-family: 'Niramit', sans-serif; margin: 20px; }
                       .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 1rem 0; }
                       .stat-card { border: 1px solid #e5e7eb; padding: 1rem; border-radius: 8px; }
                       .value { font-size: 1.5rem; font-weight: bold; color: #059669; }
                       h4 { color: #1e293b; border-bottom: 2px solid #059669; padding-bottom: 0.5rem; }
                       @media print { .stats-grid { grid-template-columns: repeat(4, 1fr); } }
                   </style>
               </head>
               <body>
                   <h2>รายงานฟาร์มสุกรอัจฉริยะ</h2>
                   <p>วันที่สร้างรายงาน: ${new Date().toLocaleDateString('th-TH')}</p>
                   ${reportContent}
               </body>
               </html>
           `);
           printWindow.document.close();
           printWindow.print();
       }

       // PWA Functions
       let deferredPrompt;

       window.addEventListener('beforeinstallprompt', (e) => {
           e.preventDefault();
           deferredPrompt = e;
           document.getElementById('installPrompt').classList.add('show');
       });

       function installPWA() {
           if (deferredPrompt) {
               deferredPrompt.prompt();
               deferredPrompt.userChoice.then((choiceResult) => {
                   if (choiceResult.outcome === 'accepted') {
                       console.log('User accepted the install prompt');
                   }
                   deferredPrompt = null;
                   dismissInstall();
               });
           }
       }

       function dismissInstall() {
           document.getElementById('installPrompt').classList.remove('show');
       }

       // Service Worker Registration
       if ('serviceWorker' in navigator) {
           navigator.serviceWorker.register('data:application/javascript;base64,' + btoa(`
               const CACHE_NAME = 'pig-farm-v1';
               const urlsToCache = [
                   '/',
                   '/manifest.json'
               ];

               self.addEventListener('install', function(event) {
                   event.waitUntil(
                       caches.open(CACHE_NAME)
                           .then(function(cache) {
                               return cache.addAll(urlsToCache);
                           })
                   );
               });

               self.addEventListener('fetch', function(event) {
                   event.respondWith(
                       caches.match(event.request)
                           .then(function(response) {
                               if (response) {
                                   return response;
                               }
                               return fetch(event.request);
                           }
                       )
                   );
               });
           `)).then(function(registration) {
               console.log('ServiceWorker registration successful');
           }).catch(function(err) {
               console.log('ServiceWorker registration failed: ', err);
           });
       }

       // Initialize app
       document.addEventListener('DOMContentLoaded', function() {
           // Set default dates
           const today = new Date().toISOString().split('T')[0];
           document.getElementById('feedDate').value = today;
           document.getElementById('healthDate').value = today;
           document.getElementById('reportStartDate').value = today;
           document.getElementById('reportEndDate').value = today;
           
           // Load saved data
           loadData();
           
           // Show dashboard by default
           showSection('dashboard');
           
           // Update data every minute
           setInterval(updateDashboard, 60000);
           
           console.log('ระบบจัดการฟาร์มสุกรอัจฉริยะเริ่มทำงานแล้ว');
       });

       // Demo data for testing
       function loadDemoData() {
           const demoData = {
               pigs: [
                   {
                       id: 'P001',
                       group: 'ขุน',
                       weight: 95.5,
                       age: 150,
                       gender: 'ผู้',
                       breed: 'ลาร์จไวท์',
                       cost: 2700,
                       targetWeight: 110,
                       startWeight: 25,
                       startDate: '2025-01-01',
                       totalFeed: 180,
                       status: 'active'
                   },
                   {
                       id: 'P002',
                       group: 'ขุน',
                       weight: 102.3,
                       age: 160,
                       gender: 'เมีย',
                       breed: 'แลนด์เรซ',
                       cost: 2700,
                       targetWeight: 110,
                       startWeight: 25,
                       startDate: '2024-12-25',
                       totalFeed: 190,
                       status: 'active'
                   },
                   {
                       id: 'P003',
                       group: 'รุ่น',
                       weight: 45.2,
                       age: 90,
                       gender: 'ผู้',
                       breed: 'ลาร์จไวท์',
                       cost: 2700,
                       targetWeight: 110,
                       startWeight: 15,
                       startDate: '2025-03-01',
                       totalFeed: 85,
                       status: 'active'
                   }
               ],
               feeding: [
                   {
                       pigId: 'P001',
                       type: 'อาหารหมูขุน',
                       amount: 3.5,
                       date: '2025-06-06',
                       notes: 'ให้อาหารปกติ',
                       cost: 56
                   },
                   {
                       pigId: 'P002',
                       type: 'อาหารหมูขุน',
                       amount: 3.8,
                       date: '2025-06-06',
                       notes: 'ให้อาหารปกติ',
                       cost: 60.8
                   },
                   {
                       pigId: 'P003',
                       type: 'อาหารหมูรุ่น',
                       amount: 2.5,
                       date: '2025-06-06',
                       notes: 'ให้อาหารปกติ',
                       cost: 45
                   }
               ],
               health: [
                   {
                       pigId: 'P001',
                       type: 'วัคซีน',
                       vaccineType: 'วัคซีนป้องกันโรคปากและเท้าเปื่อย',
                       date: '2025-05-15',
                       nextVaccineDate: '2025-08-15',
                       cost: 150,
                       notes: 'ฉีดวัคซีนป้องกันโรคปากและเท้าเปื่อยตามกำหนด'
                   },
                   {
                       pigId: 'P002',
                       type: 'ตรวจสุขภาพ',
                       vaccineType: 'ตรวจสุขภาพทั่วไป',
                       date: '2025-06-01',
                       nextVaccineDate: '',
                       cost: 50,
                       notes: 'สุขภาพแข็งแรงดี'
                   }
               ],
               settings: {
                   fcrTarget: 2.35,
                   adgTarget: 700,
                   mortalityTarget: 5.0
               }
           };
           
           appData = demoData;
           saveData();
           loadData();
           alert('โหลดข้อมูลตัวอย่างเรียบร้อยแล้ว');
       }

       // Add demo data button (for testing)
       if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
           const demoButton = document.createElement('button');
           demoButton.textContent = 'โหลดข้อมูลตัวอย่าง';
           demoButton.className = 'btn btn-secondary';
           demoButton.style.position = 'fixed';
           demoButton.style.bottom = '20px';
           demoButton.style.right = '20px';
           demoButton.style.zIndex = '1000';
           demoButton.onclick = loadDemoData;
           document.body.appendChild(demoButton);
       }

       // Export functions for debugging
       window.appDebug = {
           appData,
           loadDemoData,
           calculateFCR,
           calculateADG,
           predictSaleDate
       };
   </script>
</body>
</html>
