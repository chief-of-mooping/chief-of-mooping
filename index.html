
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Pork Skewer Pricing Advisor AI</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDFETQF_lUuU_HeUa_9pnpAkDyMATUKB7g",
            authDomain: "pork-pricing-app.firebaseapp.com",
            projectId: "pork-pricing-app",
            storageBucket: "pork-pricing-app.firebasestorage.app",
            messagingSenderId: "604634104081",
            appId: "1:604634104081:web:cc318ac88d381cf4384cb0",
            measurementId: "G-0224PTLW7P"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        console.log("Firebase initialized successfully");
    </script>

    <style>
        :root {
            --primary-color: #FF5722;
            --primary-dark: #E64A19;
            --primary-light: #FFAB91;
            --secondary-color: #FF9800;
            --secondary-dark: #F57C00;
            --accent-color: #FFEB3B;
            --dark-color: #5D4037;
            --light-color: #FFF8E1;
            --light-alt-color: #FFECB3;
            --white-color: #FFFFFF;
            --success-color: #4CAF50;
            --success-dark: #388E3C;
            --error-color: #F44336;
            --error-dark: #D32F2F;
            --info-color: #2196F3;
            --info-dark: #1976D2;
            --warning-color: #FFC107;
            --warning-dark: #FFA000;
            --shadow-color: rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Sarabun', 'Prompt', 'Kanit', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(-45deg, #FFF8E1, #FFECB3, #E8F5E8, #E3F2FD, #FCE4EC);
            background-size: 400% 400%;
            animation: bodyGradientShift 15s ease infinite;
            color: var(--dark-color);
            line-height: 1.6;
            padding-bottom: 80px;
        }

        @keyframes bodyGradientShift {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 25%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 75%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 15px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            text-align: center;
            padding: 25px 0;
            margin-bottom: 25px;
            border-bottom: 5px solid var(--secondary-color);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 10px var(--shadow-color);
            animation: headerColorShift 10s infinite;
        }

        @keyframes headerColorShift {
            0% { background: linear-gradient(135deg, #FF5722, #E64A19); }
            20% { background: linear-gradient(135deg, #E91E63, #C2185B); }
            40% { background: linear-gradient(135deg, #9C27B0, #7B1FA2); }
            60% { background: linear-gradient(135deg, #3F51B5, #303F9F); }
            80% { background: linear-gradient(135deg, #00BCD4, #0097A7); }
            100% { background: linear-gradient(135deg, #FF5722, #E64A19); }
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMjAsMzAgQzIwLDY1IDgwLDY1IDgwLDMwIiBzdHJva2U9IiNGRkM3QTciIHN0cm9rZS13aWR0aD0iMi41IiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjMwIiByPSI2IiBmaWxsPSIjRkZDN0E3Ii8+PC9zdmc+') repeat;
            opacity: 0.2;
            z-index: 1;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        h2 {
            font-size: 1.3rem;
            font-weight: normal;
            margin-bottom: 12px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .date-display {
            background-color: var(--secondary-color);
            color: white;
            padding: 7px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
            font-size: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
            animation: dateDisplayShift 13s infinite;
        }

        @keyframes dateDisplayShift {
            0% { background-color: #FF9800; }
            20% { background-color: #F06292; }
            40% { background-color: #BA68C8; }
            60% { background-color: #7986CB; }
            80% { background-color: #4DD0E1; }
            100% { background-color: #FF9800; }
        }

        .tabs {
            display: flex;
            margin-bottom: 25px;
            border-radius: 10px;
            overflow: hidden;
            background-color: #FFF;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab {
            flex: 1;
            text-align: center;
            background-color: #FFF;
            color: var(--dark-color);
            padding: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            border-bottom: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .tab:hover {
            background-color: var(--light-alt-color);
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .tab:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            background-color: var(--light-alt-color);
            box-shadow: inset 0 -3px 0 var(--primary-color);
            animation: tabActiveShift 7s infinite;
        }

        @keyframes tabActiveShift {
            0% { border-bottom-color: #FF5722; }
            25% { border-bottom-color: #E91E63; }
            50% { border-bottom-color: #9C27B0; }
            75% { border-bottom-color: #3F51B5; }
            100% { border-bottom-color: #FF5722; }
        }

        .tab::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 3px;
            background-color: var(--primary-color);
            bottom: 0;
            left: 0;
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .tab:hover::after {
            transform: scaleX(1);
        }

        .tab-content {
            display: none;
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            animation: fadeIn 0.5s;
            transform: translateY(0);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--dark-color);
            font-size: 1.05rem;
        }

        input[type="text"],
        input[type="number"],
        input[type="password"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s;
            background-color: #f9f9f9;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="password"]:focus,
        input[type="date"]:focus,
        select:focus,
        textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--primary-light);
            outline: none;
            background-color: #fff;
        }

        .option-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-button {
            flex: 1;
            min-width: 85px;
            background-color: #FFF;
            border: 2px solid #DDD;
            border-radius: 10px;
            padding: 15px 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-size: 0.95rem;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .option-button:hover {
            border-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.15);
        }

        .option-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }

        .option-button.selected {
            background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
            border-color: var(--primary-dark);
            color: white;
            box-shadow: 0 4px 8px rgba(255, 87, 34, 0.3);
            transform: translateY(-2px);
            animation: selectedButtonShift 6s infinite;
        }

        @keyframes selectedButtonShift {
            0% { background: linear-gradient(145deg, #FF5722, #E64A19); }
            33% { background: linear-gradient(145deg, #E91E63, #C2185B); }
            66% { background: linear-gradient(145deg, #9C27B0, #7B1FA2); }
            100% { background: linear-gradient(145deg, #FF5722, #E64A19); }
        }

        .option-button.selected:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(255, 87, 34, 0.35);
        }

        .option-button.selected:active {
            transform: translateY(0);
            box-shadow: 0 3px 6px rgba(255, 87, 34, 0.3);
        }

        .option-button img, .option-button svg {
            display: block;
            width: 35px;
            height: 35px;
            margin: 0 auto 8px;
        }

        .calculate-btn, .action-btn {
            display: block;
            width: 100%;
            background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 18px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin: 25px 0;
            transition: all 0.3s;
            box-shadow: 0 6px 0 var(--primary-dark), 0 6px 15px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: buttonColorShift 8s infinite;
        }

        @keyframes buttonColorShift {
            0% { background: linear-gradient(145deg, #FF5722, #E64A19); }
            25% { background: linear-gradient(145deg, #E91E63, #C2185B); }
            50% { background: linear-gradient(145deg, #9C27B0, #7B1FA2); }
            75% { background: linear-gradient(145deg, #3F51B5, #303F9F); }
            100% { background: linear-gradient(145deg, #FF5722, #E64A19); }
        }

        .calculate-btn:hover, .action-btn:hover {
            background: linear-gradient(145deg, var(--secondary-color), var(--secondary-dark));
            box-shadow: 0 6px 0 var(--secondary-dark), 0 6px 20px rgba(0,0,0,0.2);
            transform: translateY(-2px);
        }

        .calculate-btn:active, .action-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 var(--primary-dark), 0 2px 5px rgba(0,0,0,0.1);
        }

        .calculate-btn::after, .action-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }

        .calculate-btn:hover::after, .action-btn:hover::after {
            left: 100%;
        }

        .result-section {
            background: linear-gradient(145deg, var(--secondary-color), var(--secondary-dark));
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 25px;
            display: none;
            box-shadow: 0 10px 25px rgba(255, 152, 0, 0.3);
            transform: translateY(0);
            transition: transform 0.3s ease;
            animation: resultColorShift 9s infinite;
        }

        @keyframes resultColorShift {
            0% { background: linear-gradient(145deg, #FF9800, #F57C00); }
            25% { background: linear-gradient(145deg, #F06292, #E91E63); }
            50% { background: linear-gradient(145deg, #BA68C8, #9C27B0); }
            75% { background: linear-gradient(145deg, #7986CB, #3F51B5); }
            100% { background: linear-gradient(145deg, #FF9800, #F57C00); }
        }

        .result-section:hover {
            transform: translateY(-5px);
        }

        .price-recommendation {
            font-size: 3rem;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }

        .profit-estimate {
            font-size: 1.4rem;
            margin-bottom: 20px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }

        .additional-tips {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            color: var(--dark-color);
            text-align: left;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .additional-tips h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .additional-tips ul {
            padding-left: 25px;
        }

        .additional-tips li {
            margin-bottom: 10px;
            position: relative;
        }

        .additional-tips li::before {
            content: '•';
            position: absolute;
            left: -15px;
            color: var(--primary-color);
            font-weight: bold;
        }

        .card {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .card-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            position: relative;
        }

        .card-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background-color: var(--primary-color);
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            animation: statBorderShift 11s infinite;
        }

        @keyframes statBorderShift {
            0% { background: linear-gradient(90deg, #FF5722, #FF9800); }
            25% { background: linear-gradient(90deg, #E91E63, #F06292); }
            50% { background: linear-gradient(90deg, #9C27B0, #BA68C8); }
            75% { background: linear-gradient(90deg, #3F51B5, #7986CB); }
            100% { background: linear-gradient(90deg, #FF5722, #FF9800); }
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.05);
        }

        .stat-label {
            font-size: 1rem;
            color: #666;
            margin-bottom: 5px;
        }

        .notification {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .notification:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .notification.info {
            background-color: rgba(33, 150, 243, 0.15);
            border-left: 4px solid var(--info-color);
        }

        .notification.warning {
            background-color: rgba(255, 193, 7, 0.15);
            border-left: 4px solid var(--warning-color);
        }

        .notification.error {
            background-color: rgba(244, 67, 54, 0.15);
            border-left: 4px solid var(--error-color);
        }

        .notification.success {
            background-color: rgba(76, 175, 80, 0.15);
            border-left: 4px solid var(--success-color);
        }

        .notification svg {
            width: 28px;
            height: 28px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 87, 34, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 87, 34, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 87, 34, 0);
            }
        }

        .hidden {
            display: none !important;
        }

        .footer {
            text-align: center;
            margin-top: 35px;
            color: var(--dark-color);
            font-size: 0.95rem;
            padding: 20px;
            background-color: rgba(255,255,255,0.5);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        /* Sales Tracking Specific Styles */
        .sales-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            overflow-x: auto;
            display: block;
            white-space: nowrap;
        }

        .sales-table thead,
        .sales-table tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        .sales-table th,
        .sales-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
            word-wrap: break-word;
        }

        .sales-table th {
            background-color: var(--light-color);
            color: var(--dark-color);
            font-weight: bold;
            border-bottom: 2px solid var(--primary-color);
        }

        .sales-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .sales-table tr:hover {
            background-color: var(--light-alt-color);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }

        .prediction-highlight {
            background: linear-gradient(135deg, var(--success-color), var(--success-dark));
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }

        .prediction-amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .prediction-reason {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.6rem;
            }

            h2 {
                font-size: 1.1rem;
            }

            .dashboard-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .option-button {
                font-size: 0.85rem;
                padding: 10px 8px;
            }

            .price-recommendation {
                font-size: 2.2rem;
            }

            .tab {
                padding: 12px 5px;
                font-size: 0.9rem;
            }

            .stat-value {
                font-size: 1.6rem;
            }

            .card, .tab-content {
                padding: 15px;
            }

            .calculate-btn, .action-btn {
                padding: 15px;
                font-size: 1.1rem;
            }

            .sales-table {
                font-size: 0.9rem;
            }

            .sales-table th,
            .sales-table td {
                padding: 8px;
            }
        }
    </style>
</head>

    <body>
    <header>
        <div class="header-bg"></div>
        <div class="header-content container">
            <h1>Smart Pork Skewer Pricing Advisor AI</h1>
            <h2>ที่ปรึกษาตั้งราคาหมูปิ้งอัจฉริยะ</h2>
            <div class="date-display" id="current-date">วันที่ ...</div>
        </div>
    </header>

    <div class="container">
        <div class="notification info" id="api-key-notification">
            <svg viewBox="0 0 24 24" fill="none" stroke="#2196F3" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12" y2="16"></line>
            </svg>
            <div class="notification-content">
                <p>ข้อมูลของคุณจะถูกบันทึกอย่างปลอดภัยใน Firebase Database แล้ว หากต้องการใช้งาน AI เต็มรูปแบบ โปรดตั้งค่า API Key ใน "การตั้งค่า"</p>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="dashboard">หน้าหลัก</div>
            <div class="tab" data-tab="calculator">คำนวณราคา</div>
            <div class="tab" data-tab="sales">บันทึกยอดขาย</div>
            <div class="tab" data-tab="advisor">ที่ปรึกษา AI</div>
            <div class="tab" data-tab="settings">การตั้งค่า</div>
        </div>

        <!-- แดชบอร์ด -->
        <div id="dashboard-tab" class="tab-content active">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-label">ราคาแนะนำวันนี้</div>
                    <div class="stat-value" id="today-price">-- บาท</div>
                    <div class="stat-label">ต่อไม้</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ราคาหมูในตลาด</div>
                    <div class="stat-value" id="market-price">-- บาท</div>
                    <div class="stat-label">ต่อกิโลกรัม</div>
                    <div class="stat-label" id="price-update-time">อัปเดตเมื่อ: --</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">สภาพอากาศ</div>
                    <div class="stat-value" id="weather-status">--</div>
                    <div class="stat-label">ความชื้น: <span id="humidity">--</span>%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">กำไรประมาณการ</div>
                    <div class="stat-value" id="estimated-profit">-- บาท</div>
                    <div class="stat-label">ต่อวัน</div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">แนะนำประจำวัน</div>
                <div id="daily-recommendation">
                    <div id="recommendation-content">
                        <p>วันนี้สภาพอากาศ <span id="weather-desc">--</span> เหมาะกับการขายที่ <span id="location-rec">--</span></p>
                        <p>แนะนำให้ตั้งราคาที่ <span id="price-rec">--</span> บาทต่อไม้</p>
                        <p>เพราะ <span id="price-reason">--</span></p>
                        <div class="additional-tips">
                            <h4>เทคนิคพิเศษสำหรับวันนี้</h4>
                            <ul id="daily-tips">
                                <li>กำลังโหลด...</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <button class="action-btn pulse" id="refresh-recommendation">รีเฟรชคำแนะนำ</button>
            </div>

            <div class="card">
                <div class="card-title">สรุปยอดขาย 7 วันย้อนหลัง</div>
                <div id="dashboard-sales-summary">
                    <p>ยังไม่มีข้อมูลการขาย กรุณาบันทึกยอดขายในแท็บ "บันทึกยอดขาย"</p>
                </div>
            </div>
        </div>

        <!-- คำนวณราคา -->
        <div id="calculator-tab" class="tab-content">
            <div class="card">
                <div class="card-title">ข้อมูลต้นทุน</div>
                <form id="calculator-form">
                    <div class="form-group">
                        <label for="meat-price">ราคาหมู (บาทต่อ 1 กิโลกรัม)</label>
                        <input type="number" id="meat-price" min="50" value="150">
                    </div>
                    <div class="form-group">
                        <label for="meat-per-skewer">น้ำหนักหมูต่อ 1 ไม้ (กรัม)</label>
                        <input type="number" id="meat-per-skewer" min="10" max="50" value="25">
                    </div>
                    <div class="form-group">
                        <label>ขนาดไม้หมูปิ้ง</label>
                        <div class="option-group">
                            <div class="option-button" data-value="small">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="2" x2="8" y2="22" stroke-linecap="round"></line>
                                    <circle cx="8" cy="12" r="3"></circle>
                                </svg>
                                เล็ก
                            </div>
                            <div class="option-button selected" data-value="medium">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="2" x2="12" y2="22" stroke-linecap="round"></line>
                                    <circle cx="12" cy="12" r="4"></circle>
                                </svg>
                                กลาง
                            </div>
                            <div class="option-button" data-value="large">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="16" y1="2" x2="16" y2="22" stroke-linecap="round"></line>
                                    <circle cx="16" cy="12" r="5"></circle>
                                </svg>
                                ใหญ่
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="additional-cost">ต้นทุนอื่นๆ ต่อ 1 ไม้ (กะเอาเลย AI คิดเผื่อให้แล้ว)</label>
                        <input type="number" id="additional-cost" min="0" step="0.1" value="1">
                    </div>
                </form>
            </div>

            <div class="card">
                <div class="card-title">ข้อมูลตลาด</div>
                <form>
                    <div class="form-group">
                        <label for="location">ตำแหน่งขาย</label>
                        <select id="location">
                            <option value="market">ตลาด</option>
                            <option value="street">ริมถนน</option>
                            <option value="community">ชุมชน</option>
                            <option value="school">สถานศึกษา</option>
                            <option value="office">ออฟฟิศ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sales-volume">จำนวนขายต่อวัน (ประมาณ)</label>
                        <select id="sales-volume">
                            <option value="low">น้อย (น้อยกว่า 100 ไม้)</option>
                            <option value="medium" selected>ปานกลาง (100-300 ไม้)</option>
                            <option value="high">มาก (มากกว่า 300 ไม้)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>สภาพอากาศ</label>
                        <div class="option-group">
                            <div class="option-button selected" data-value="sunny">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="5"></circle>
                                    <line x1="12" y1="1" x2="12" y2="3"></line>
                                    <line x1="12" y1="21" x2="12" y2="23"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="1" y1="12" x2="3" y2="12"></line>
                                    <line x1="21" y1="12" x2="23" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </svg>
                                แดดออก
                            </div>
                            <div class="option-button" data-value="cloudy">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>
                                </svg>
                                มีเมฆ
                            </div>
                            <div class="option-button" data-value="rainy">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 16.2A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9"></path>
                                    <line x1="8" y1="16" x2="8.01" y2="16"></line>
                                    <line x1="8" y1="20" x2="8.01" y2="20"></line>
                                    <line x1="12" y1="18" x2="12.01" y2="18"></line>
                                    <line x1="12" y1="22" x2="12.01" y2="22"></line>
                                    <line x1="16" y1="16" x2="16.01" y2="16"></line>
                                    <line x1="16" y1="20" x2="16.01" y2="20"></line>
                                </svg>
                                ฝนตก
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>สภาพเศรษฐกิจ</label>
                        <div class="option-group">
                            <div class="option-button" data-value="good">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"></path>
                                    <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                                    <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                    <line x1="15" y1="9" x2="15.01" y2="9"></line>
                                </svg>
                                ดี
                            </div>
                            <div class="option-button selected" data-value="normal">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"></path>
                                    <line x1="8" y1="15" x2="16" y2="15"></line>
                                    <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                    <line x1="15" y1="9" x2="15.01" y2="9"></line>
                                </svg>
                                ปกติ
                            </div>
                            <div class="option-button" data-value="bad">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"></path>
                                    <path d="M16 16s-1.5-2-4-2-4 2-4 2"></path>
                                    <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                    <line x1="15" y1="9" x2="15.01" y2="9"></line>
                                </svg>
                                แย่
                            </div>
                        </div>
                    </div>
                </form>
                <button type="button" class="calculate-btn pulse" id="calculate-btn">คำนวณราคา AI</button>
            </div>

            <div class="result-section" id="result-section">
                <h3>ราคาแนะนำจาก AI</h3>
                <div class="price-recommendation" id="price-recommendation">-- บาท/ไม้</div>
                <div class="profit-estimate" id="profit-estimate">ประมาณการกำไร: -- บาท/วัน</div>
                <div class="additional-tips" id="additional-tips">
                    <h4>วิเคราะห์และเทคนิคเพิ่มกำไร</h4>
                    <p id="analysis-text">กำลังวิเคราะห์...</p>
                    <ul id="tips-list">
                        <li>กำลังคำนวณเทคนิคที่เหมาะสมกับคุณ...</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- บันทึกยอดขาย -->
        <div id="sales-tab" class="tab-content">
            <div class="card">
                <div class="card-title">บันทึกยอดขายประจำวัน</div>
                
                <div class="form-group">
                    <label for="sale-date">วันที่</label>
                    <input type="date" id="sale-date">
                </div>
                
                <div class="form-group">
                    <label for="prepared-amount">จำนวนที่เตรียมไป (ไม้)</label>
                    <input type="number" id="prepared-amount" min="0" placeholder="เช่น 150">
                </div>
                
                <div class="form-group">
                    <label for="sold-amount">ขายได้จริง (ไม้)</label>
                    <input type="number" id="sold-amount" min="0" placeholder="เช่น 140">
                </div>
                
                <div class="form-group">
                    <label for="weather-condition">สภาพอากาศวันนั้น</label>
                    <select id="weather-condition">
                        <option value="sunny">แดดออก</option>
                        <option value="cloudy">มีเมฆ</option>
                        <option value="rainy">ฝนตก</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="sale-notes">หมายเหตุ (ถ้ามี)</label>
                    <textarea id="sale-notes" rows="3" placeholder="เช่น วันหยุด, เทศกาล, เงินเดือนออก"></textarea>
                </div>
                
                <button class="action-btn" id="save-sales-btn">บันทึกยอดขาย</button>
            </div>

            <!-- แสดงข้อมูล 7 วันย้อนหลัง -->
            <div class="card">
                <div class="card-title">ยอดขาย 7 วันย้อนหลัง</div>
                <div id="sales-history">
                    <p>ยังไม่มีข้อมูล กรุณาบันทึกยอดขายก่อน</p>
                </div>
            </div>

            <!-- พยากรณ์วันพรุ่งนี้ -->
            <div class="card">
                <div class="card-title">🔮 พยากรณ์การเตรียมวันพรุ่งนี้</div>
                <div id="prediction-result">
                    <div class="prediction-highlight">
                        <div class="prediction-amount" id="predicted-amount">-- ไม้</div>
                        <div class="prediction-reason" id="prediction-reason">กรุณาบันทึกข้อมูลอย่างน้อย 3 วัน เพื่อให้ระบบคำนวณได้</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ที่ปรึกษา AI -->
        <div id="advisor-tab" class="tab-content">
            <div class="card">
                <div class="card-title">💬 แชทกับที่ปรึกษา AI</div>
                <div class="chat-ui">
                    <div class="chat-messages" id="chat-messages">
                        <div class="message ai">
                            สวัสดีครับ ผมคือที่ปรึกษาหมูปิ้งอัจฉริยะ พร้อมให้คำแนะนำทั้งเรื่องราคา กลยุทธ์การขาย หรือการรับมือกับสถานการณ์ต่างๆ ลองถามได้เลยครับ
                            <div class="message-time">เมื่อสักครู่</div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chat-input" placeholder="ถามคำถามเกี่ยวกับธุรกิจหมูปิ้ง...">
                        <button class="chat-send-btn" id="chat-send-btn">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">💡 คำแนะนำตามสถานการณ์</div>
                
                <div class="strategy-item">
                    <div class="strategy-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#FF5722" stroke-width="2">
                            <path d="M20 16.2A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9"></path>
                            <line x1="8" y1="16" x2="8.01" y2="16"></line>
                            <line x1="8" y1="20" x2="8.01" y2="20"></line>
                            <line x1="12" y1="18" x2="12.01" y2="18"></line>
                            <line x1="12" y1="22" x2="12.01" y2="22"></line>
                            <line x1="16" y1="16" x2="16.01" y2="16"></line>
                            <line x1="16" y1="20" x2="16.01" y2="20"></line>
                        </svg>
                    </div>
                    <div class="strategy-content">
                        <h4>🌧️ วันฝนตก</h4>
                        <p>ทำที่กันฝนเล็กๆ ให้ลูกค้ายืนไม่เปียก หรือมีบริการส่งถึงรถ เตรียมถุงพลาสติกให้ลูกค้าใส่หมูปิ้งกลับบ้าน</p>
                        <p>ลดราคาลง 1-2 บาทเพื่อดึงดูดลูกค้า หรือทำโปรโมชั่นพิเศษเช่น "ซื้อ 10 แถม 1 เฉพาะวันฝนตก"</p>
                    </div>
                </div>

                <div class="strategy-item">
                    <div class="strategy-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#FF5722" stroke-width="2">
                            <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"></path>
                            <path d="M16 16s-1.5-2-4-2-4 2-4 2"></path>
                            <line x1="9" y1="9" x2="9.01" y2="9"></line>
                            <line x1="15" y1="9" x2="15.01" y2="9"></line>
                        </svg>
                    </div>
                    <div class="strategy-content">
                        <h4>📉 เศรษฐกิจแย่</h4>
                        <p>ลดขนาดไม้เล็กน้อยแต่คงราคาเดิม หรือเพิ่มโปรโมชั่น เช่น ซื้อ 5 ไม้แถม 1</p>
                        <p>เน้นการตลาดโดยใช้คำว่า "อิ่มคุ้ม" หรือ "ประหยัด" และนำเสนอชุดราคาพิเศษ เช่น หมูปิ้ง + ข้าวเหนียว</p>
                    </div>
                </div>

                <div class="strategy-item">
                    <div class="strategy-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#FF5722" stroke-width="2">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </div>
                    <div class="strategy-content">
                        <h4>☀️ อากาศร้อนจัด</h4>
                        <p>เตรียมน้ำดื่มเย็นๆ ไว้บริการฟรี หรือขายราคาถูก ใช้ร่มบังแดดให้ลูกค้า</p>
                        <p>ปิ้งหมูสดใหม่ตลอด ไม่ปิ้งเก็บไว้นานเกินไป และพิจารณาเพิ่มเมนูน้ำแข็งไสหรือเครื่องดื่มเย็นๆ</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- การตั้งค่า -->
        <div id="settings-tab" class="tab-content">
            <div class="card">
                <div class="card-title">🔑 ตั้งค่า API Key สำหรับ AI</div>
                <div class="form-group">
                    <label for="api-provider">ผู้ให้บริการ AI</label>
                    <select id="api-provider">
                        <option value="openai">OpenAI (GPT-4)</option>
                        <option value="anthropic">Anthropic (Claude)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="api-key">API Key</label>
                    <input type="password" id="api-key" placeholder="ใส่ API Key ของคุณ">
                </div>
                <button class="action-btn" id="save-api-key">บันทึก API Key</button>
                <p style="margin-top:10px; font-size:0.9rem; color:#666;">
                    หมายเหตุ: API Key จะถูกเก็บใน Firebase ของคุณเท่านั้น ปลอดภัยและเข้าถึงได้เฉพาะคุณ
                </p>
            </div>

            <div class="card">
                <div class="card-title">🏪 ข้อมูลร้านค้า</div>
                <div class="form-group">
                    <label for="business-name">ชื่อร้าน</label>
                    <input type="text" id="business-name" placeholder="ชื่อร้านของคุณ">
                </div>
                <div class="form-group">
                    <label for="business-location">ที่ตั้งร้าน</label>
                    <input type="text" id="business-location" placeholder="เช่น เชียงราย, กรุงเทพ">
                </div>
                <div class="form-group">
                    <label for="business-description">รายละเอียดร้าน</label>
                    <textarea id="business-description" rows="3" placeholder="เล่าเกี่ยวกับร้านของคุณ, จุดเด่น, ประสบการณ์"></textarea>
                </div>
                <button class="action-btn" id="save-business-info">บันทึกข้อมูลร้าน</button>
            </div>

            <div class="card">
                <div class="card-title">🔔 การแจ้งเตือน</div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="weather-alert" checked>
                        แจ้งเตือนสภาพอากาศ
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="price-alert" checked>
                        แจ้งเตือนการเปลี่ยนแปลงราคาวัตถุดิบ
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="event-alert" checked>
                        แจ้งเตือนกิจกรรมและเทศกาล
                    </label>
                </div>
                <button class="action-btn" id="save-alert-settings">บันทึกการตั้งค่าแจ้งเตือน</button>
            </div>
        </div>

        <div class="footer">
            <p>Smart Pork Skewer Pricing Advisor AI v3.0</p>
            <p>ที่ปรึกษาราคาหมูปิ้งอัจฉริยะ - พัฒนาโดยใช้ AI และ Firebase</p>
        </div>
    </div>

        <script>
        // =====================
        // ระบบจัดการข้อมูลผู้ใช้ด้วย Firebase
        // =====================
        const UserDataManager = {
            userData: {
                profile: {
                    businessName: '',
                    location: '',
                    description: ''
                },
                preferences: {
                    weatherAlert: true,
                    priceAlert: true,
                    eventAlert: true
                },
                apiSettings: {
                    provider: 'openai',
                    apiKey: ''
                },
                lastPorkPrice: 150,
                lastUpdate: new Date().toISOString()
            },
            currentUserId: null,
            isInitialized: false,

            // เริ่มต้นระบบ Auth
            initAuth: function() {
                return new Promise((resolve, reject) => {
                    auth.onAuthStateChanged(async (user) => {
                        if (user) {
                            this.currentUserId = user.uid;
                            console.log('User logged in:', this.currentUserId);
                            await this.loadUserData();
                            this.isInitialized = true;
                            resolve(user);
                        } else {
                            try {
                                const result = await auth.signInAnonymously();
                                this.currentUserId = result.user.uid;
                                console.log('Anonymous login successful:', this.currentUserId);
                                this.isInitialized = true;
                                resolve(result.user);
                            } catch (error) {
                                console.error('Authentication failed:', error);
                                reject(error);
                            }
                        }
                    });
                });
            },

            // บันทึกข้อมูลลง Firestore
            saveUserData: async function() {
                if (!this.isInitialized || !this.currentUserId) {
                    console.log('Not ready to save data');
                    return false;
                }

                try {
                    await db.collection('users').doc(this.currentUserId).set(this.userData);
                    console.log('Data saved successfully to Firebase');
                    return true;
                } catch (error) {
                    console.error('Error saving data to Firebase:', error);
                    return false;
                }
            },

            // โหลดข้อมูลจาก Firestore
            loadUserData: async function() {
                if (!this.currentUserId) {
                    console.log('No user ID available');
                    return false;
                }

                try {
                    const doc = await db.collection('users').doc(this.currentUserId).get();
                    if (doc.exists) {
                        this.userData = { ...this.userData, ...doc.data() };
                        console.log('Data loaded from Firebase:', this.userData);
                        this.updateUIWithUserData();
                        return true;
                    } else {
                        console.log('No user data found, using defaults');
                        await this.saveUserData();
                        return false;
                    }
                } catch (error) {
                    console.error('Error loading from Firebase:', error);
                    return false;
                }
            },

            // อัปเดต UI ด้วยข้อมูลผู้ใช้
            updateUIWithUserData: function() {
                const elements = {
                    'api-provider': this.userData.apiSettings.provider,
                    'api-key': this.userData.apiSettings.apiKey,
                    'business-name': this.userData.profile.businessName,
                    'business-location': this.userData.profile.location,
                    'business-description': this.userData.profile.description,
                    'weather-alert': this.userData.preferences.weatherAlert,
                    'price-alert': this.userData.preferences.priceAlert,
                    'event-alert': this.userData.preferences.eventAlert
                };

                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = value;
                        } else {
                            element.value = value;
                        }
                    }
                });

                updateApiKeyNotification();
            },

            updateBusinessInfo: async function(name, location, description) {
                this.userData.profile.businessName = name;
                this.userData.profile.location = location;
                this.userData.profile.description = description;
                return await this.saveUserData();
            },

            updateAlertSettings: async function(weatherAlert, priceAlert, eventAlert) {
                this.userData.preferences.weatherAlert = weatherAlert;
                this.userData.preferences.priceAlert = priceAlert;
                this.userData.preferences.eventAlert = eventAlert;
                return await this.saveUserData();
            },

            updateApiSettings: async function(provider, apiKey) {
                this.userData.apiSettings.provider = provider;
                this.userData.apiSettings.apiKey = apiKey;
                const result = await this.saveUserData();
                updateApiKeyNotification();
                return result;
            },

            hasApiKey: function() {
                return !!this.userData.apiSettings.apiKey;
            }
        };

        // ฟังก์ชันอัปเดตการแจ้งเตือน API Key
        function updateApiKeyNotification() {
            const notification = document.getElementById('api-key-notification');
            if (notification) {
                notification.style.display = UserDataManager.hasApiKey() ? 'none' : 'flex';
            }
        }

            // =====================
        // ระบบจัดการยอดขาย
        // =====================
        const SalesManager = {
            
            // บันทึกยอดขาย
            saveDailySales: async function(salesData) {
                if (!UserDataManager.isInitialized || !UserDataManager.currentUserId) {
                    console.log('User not initialized');
                    return false;
                }

                try {
                    await db.collection('daily_sales').add({
                        userId: UserDataManager.currentUserId,
                        date: salesData.date,
                        prepared: salesData.prepared,
                        sold: salesData.sold,
                        leftover: salesData.prepared - salesData.sold,
                        weather: salesData.weather,
                        notes: salesData.notes,
                        sellThroughRate: Math.round((salesData.sold / salesData.prepared) * 100),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log('Sales data saved successfully');
                    return true;
                } catch (error) {
                    console.error('Error saving sales data:', error);
                    return false;
                }
            },

            // ดึงข้อมูล 7 วันย้อนหลัง
            getLast7DaysSales: async function() {
                if (!UserDataManager.currentUserId) {
                    return [];
                }

                try {
                    const sevenDaysAgo = new Date();
                    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                    
                    const snapshot = await db.collection('daily_sales')
                        .where('userId', '==', UserDataManager.currentUserId)
                        .where('date', '>=', sevenDaysAgo.toISOString().split('T')[0])
                        .orderBy('date', 'desc')
                        .limit(7)
                        .get();
                    
                    return snapshot.docs.map(doc => doc.data());
                } catch (error) {
                    console.error('Error getting sales history:', error);
                    return [];
                }
            },

            // ดึงข้อมูลทั้งหมด
            getAllSalesData: async function() {
                if (!UserDataManager.currentUserId) {
                    return [];
                }

                try {
                    const snapshot = await db.collection('daily_sales')
                        .where('userId', '==', UserDataManager.currentUserId)
                        .orderBy('date', 'desc')
                        .get();
                    
                    return snapshot.docs.map(doc => doc.data());
                } catch (error) {
                    console.error('Error getting all sales data:', error);
                    return [];
                }
            },

            // คำนวณการพยากรณ์
            calculatePrediction: function(salesHistory) {
                if (salesHistory.length < 3) {
                    return { 
                        amount: 0, 
                        reason: 'ต้องมีข้อมูลอย่างน้อย 3 วัน เพื่อให้ระบบคำนวณได้แม่นยำ',
                        confidence: 'ต่ำ'
                    };
                }

                // คำนวณเฉลี่ยยอดขาย
                const avgSold = salesHistory.reduce((sum, day) => sum + day.sold, 0) / salesHistory.length;
                const avgPrepared = salesHistory.reduce((sum, day) => sum + day.prepared, 0) / salesHistory.length;
                
                // วิเคราะห์แพทเทิร์นวันในสัปดาห์
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const dayOfWeek = tomorrow.getDay(); // 0=อาทิทย์, 6=เสาร์
                
                let prediction = Math.round(avgSold);
                let reasonParts = [];
                
                // ปรับตามวันในสัปดาห์
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    prediction = Math.round(avgSold * 0.8); // วันหยุดลด 20%
                    reasonParts.push('วันหยุด (ลด 20%)');
                } else if (dayOfWeek === 5) {
                    prediction = Math.round(avgSold * 1.1); // วันศุกร์เพิ่ม 10%
                    reasonParts.push('วันศุกร์ (เพิ่ม 10%)');
                }
                
                // วิเคราะห์เทรนด์ 3 วันล่าสุด
                if (salesHistory.length >= 3) {
                    const last3Days = salesHistory.slice(0, 3);
                    const trend = (last3Days[0].sold - last3Days[2].sold) / 2;
                    
                    if (Math.abs(trend) > 5) {
                        prediction += Math.round(trend);
                        if (trend > 0) {
                            reasonParts.push('เทรนด์เพิ่มขึ้น');
                        } else {
                            reasonParts.push('เทรนด์ลดลง');
                        }
                    }
                }

                // เผื่อไว้ 10% เพื่อไม่ให้ขาดแคลน
                const recommendedAmount = Math.max(Math.round(prediction * 1.1), Math.round(avgSold * 0.8));
                
                // คำนวณความเชื่อมั่น
                const avgSellThrough = salesHistory.reduce((sum, day) => sum + day.sellThroughRate, 0) / salesHistory.length;
                let confidence = 'ปานกลาง';
                
                if (salesHistory.length >= 7 && avgSellThrough >= 80) {
                    confidence = 'สูง';
                } else if (avgSellThrough < 60) {
                    confidence = 'ต่ำ';
                }

                const reason = `จากข้อมูล ${salesHistory.length} วัน เฉลี่ยขาย ${Math.round(avgSold)} ไม้/วัน` + 
                             (reasonParts.length > 0 ? ` (${reasonParts.join(', ')})` : '');

                return {
                    amount: recommendedAmount,
                    reason: reason,
                    confidence: confidence,
                    avgSold: Math.round(avgSold),
                    sellThroughRate: Math.round(avgSellThrough)
                };
            },

            // สร้างสรุปสำหรับแดชบอร์ด
            generateDashboardSummary: function(salesHistory) {
                if (salesHistory.length === 0) {
                    return {
                        totalDays: 0,
                        totalSold: 0,
                        avgSold: 0,
                        totalLeftover: 0,
                        avgSellThrough: 0,
                        bestDay: null,
                        worstDay: null
                    };
                }

                const totalSold = salesHistory.reduce((sum, day) => sum + day.sold, 0);
                const totalPrepared = salesHistory.reduce((sum, day) => sum + day.prepared, 0);
                const totalLeftover = salesHistory.reduce((sum, day) => sum + day.leftover, 0);
                
                const avgSold = Math.round(totalSold / salesHistory.length);
                const avgSellThrough = Math.round((totalSold / totalPrepared) * 100);
                
                const bestDay = salesHistory.reduce((best, day) => 
                    day.sold > best.sold ? day : best, salesHistory[0]);
                const worstDay = salesHistory.reduce((worst, day) => 
                    day.sold < worst.sold ? day : worst, salesHistory[0]);

                return {
                    totalDays: salesHistory.length,
                    totalSold: totalSold,
                    avgSold: avgSold,
                    totalLeftover: totalLeftover,
                    avgSellThrough: avgSellThrough,
                    bestDay: bestDay,
                    worstDay: worstDay
                };
            }
        };

            // =====================
        // AI Engine Service
        // =====================
        const AIEngine = {
            mockResponses: {
                priceRecommendation: [
                    "จากการวิเคราะห์ต้นทุนและสภาพตลาด แนะนำให้ตั้งราคาที่ {price} บาทต่อไม้ ซึ่งจะทำให้คุณมีกำไรประมาณ 30% และยังแข่งขันในตลาดได้",
                    "เนื่องจากสภาพอากาศดี และที่ตั้งอยู่ใกล้สถานศึกษา แนะนำให้ตั้งราคาที่ {price} บาทต่อไม้ คุณสามารถทำกำไรได้ดีเพราะนักเรียนและนักศึกษาเป็นกลุ่มที่ชื่นชอบหมูปิ้ง",
                    "ด้วยราคาหมูที่ค่อนข้างสูงในช่วงนี้ แนะนำให้ตั้งราคาที่ {price} บาทต่อไม้ แต่เพิ่มขนาดหรือคุณภาพเล็กน้อยเพื่อสร้างความคุ้มค่า",
                    "ในช่วงเศรษฐกิจไม่ดี แต่คุณอยู่ในทำเลที่มีกำลังซื้อสูง แนะนำให้ตั้งราคาที่ {price} บาทต่อไม้ และทำโปรโมชั่น 'ซื้อ 10 แถม 1' เพื่อกระตุ้นยอดขาย"
                ],

                businessTips: [
                    "ลองปรับสูตรหมักให้มีเอกลักษณ์เฉพาะตัว จะช่วยสร้างความแตกต่างจากคู่แข่ง",
                    "สร้างแพ็คเกจพิเศษ เช่น 'เซ็ตครอบครัว' ที่มีหมูปิ้งหลายไม้พร้อมข้าวเหนียวและน้ำจิ้ม",
                    "ทำการตลาดออนไลน์ผ่าน Facebook หรือ Line เพื่อแจ้งตำแหน่งขายและโปรโมชั่น",
                    "เพิ่มเมนูพิเศษเป็นครั้งคราว เช่น 'หมูปิ้งซอสพริกไทยดำ' หรือ 'หมูปิ้งสมุนไพร' เพื่อสร้างความแปลกใหม่",
                    "สร้างบัตรสะสมแต้ม 'ซื้อครบ 10 ครั้ง รับฟรี 5 ไม้' เพื่อสร้างความภักดีของลูกค้า",
                    "จัดโปรโมชั่นตามช่วงเวลา เช่น 'Happy Hour 16.00-18.00 น. ลด 20%'",
                    "ใช้กลิ่นหอมเป็นการตลาด ปิ้งให้มีกลิ่นหอมลอยมาดึงดูดลูกค้า"
                ],

                weatherStrategies: {
                    sunny: [
                        "เตรียมร่มหรือที่กำบังแดดให้ลูกค้า",
                        "มีน้ำดื่มเย็นๆ ไว้บริการฟรีหรือราคาถูก",
                        "ปิ้งหมูสดใหม่ตลอด ไม่ปิ้งเก็บไว้นานเกินไป",
                        "เพิ่มเมนูเครื่องดื่มเย็น เช่น น้ำแข็งไส"
                    ],
                    cloudy: [
                        "เน้นการปิ้งให้มีกลิ่นหอมเพื่อดึงดูดลูกค้า",
                        "อากาศไม่ร้อนเกินไป เหมาะแก่การปิ้งหมูจำนวนมากเพื่อรองรับลูกค้า",
                        "เตรียมพร้อมในกรณีที่อาจมีฝนตก",
                        "เป็นช่วงเวลาที่ดีที่สุดสำหรับการขาย"
                    ],
                    rainy: [
                        "เตรียมที่กันฝนสำหรับลูกค้า",
                        "มีบริการส่งถึงรถหรือให้ถุงพลาสติกกันน้ำ",
                        "ทำโปรโมชั่นพิเศษช่วงฝนตก เช่น ซื้อ 10 แถม 1",
                        "ลดราคาลง 1-2 บาทเพื่อดึงดูดลูกค้า",
                        "จัดโซนนั่งกันฝนถ้าเป็นไปได้"
                    ]
                },

                chatResponses: [
                    "จากประสบการณ์ ในช่วงเย็นหลังเลิกงานประมาณ 17.00-19.00 น. มักจะขายดีที่สุด โดยเฉพาะบริเวณที่มีคนเดินผ่านไปมามาก เช่น ใกล้สถานีรถไฟฟ้า หรือจุดรอรถเมล์",
                    "สูตรหมักที่นิยมคือ ซีอิ๊วขาว น้ำตาล กระเทียม พริกไทย และเครื่องปรุงลับเฉพาะของแต่ละร้าน บางร้านเพิ่มน้ำผึ้งเพื่อให้หวานและมันวาว",
                    "คุณสามารถเพิ่มกำไรได้โดยขายเครื่องเคียง เช่น ข้าวเหนียว น้ำจิ้ม หรือเครื่องดื่ม ซึ่งมักมีอัตรากำไรสูงกว่าหมูปิ้งเอง",
                    "ในช่วงฝนตก ลองทำโปรโมชั่นพิเศษ เช่น ซื้อ 10 แถม 1 หรือลดราคาเล็กน้อย และมีบริการส่งถึงรถ จะช่วยรักษายอดขาย",
                    "ระวังเรื่องสุขอนามัย ควรสวมถุงมือ หน้ากาก และรักษาความสะอาดของอุปกรณ์ นอกจากจะดีต่อสุขภาพลูกค้าแล้ว ยังสร้างความเชื่อมั่นด้วย",
                    "การเลือกตำแหน่งขายสำคัญมาก ควรหาจุดที่มีคนเดินผ่าน จอดรถสะดวก และไม่มีกฎหมายห้าม",
                    "ถ้าขายประจำที่เดิม ลองสร้างความสัมพันธ์กับลูกค้าประจำ จำชื่อและความชอบของเขา จะทำให้เขากลับมาซื้อซ้ำ"
                ]
            },

            getRandomElement: function(array) {
                return array[Math.floor(Math.random() * array.length)];
            },

            // ฟังก์ชันคำนวณราคา
            getPriceRecommendation: async function(userData, marketData) {
                return new Promise(async (resolve) => {
                    try {
                        // ดึงราคาหมูจริง
                        const realPorkPrice = await fetchRealPorkPrice();
                        
                        // คำนวณราคาแนะนำ
                        const meatPricePerGram = realPorkPrice / 1000;
                        const meatCostPerSkewer = meatPricePerGram * userData.meatPerSkewer;
                        const totalCost = meatCostPerSkewer + userData.additionalCost;

                        // ปรับตามปัจจัยต่างๆ
                        const locationFactor = {
                            'market': 0,
                            'street': 1,
                            'community': 1,
                            'school': 2,
                            'office': 2
                        };

                        const weatherFactor = {
                            'sunny': 0,
                            'cloudy': -0.5,
                            'rainy': -1
                        };

                        const economyFactor = {
                            'good': 1,
                            'normal': 0,
                            'bad': -1
                        };

                        let basePrice = totalCost * 2; // กำไร 100%
                        basePrice += locationFactor[marketData.location] || 0;
                        basePrice += weatherFactor[marketData.weather] || 0;
                        basePrice += economyFactor[marketData.economy] || 0;

                        const recommendedPrice = Math.max(Math.round(basePrice), 5);

                        // คำนวณประมาณการกำไร
                        const salesVolume = {
                            'low': 80,
                            'medium': 200,
                            'high': 350
                        };

                        const dailySales = salesVolume[marketData.salesVolume] || 200;
                        const profitPerSkewer = recommendedPrice - totalCost;
                        const estimatedProfit = Math.round(profitPerSkewer * dailySales);

                        // ดึงคำแนะนำและเทคนิค
                        let analysisText = this.getRandomElement(this.mockResponses.priceRecommendation);
                        analysisText = analysisText.replace('{price}', recommendedPrice);

                        const tips = [];
                        // เลือกเทคนิคแบบสุ่ม 3 รายการ
                        while (tips.length < 3) {
                            const tip = this.getRandomElement(this.mockResponses.businessTips);
                            if (!tips.includes(tip)) {
                                tips.push(tip);
                            }
                        }

                        // เพิ่มเทคนิคตามสภาพอากาศ
                        const weatherTips = this.mockResponses.weatherStrategies[marketData.weather] || [];
                        if (weatherTips.length > 0) {
                            tips.push(this.getRandomElement(weatherTips));
                        }

                        setTimeout(() => {
                            resolve({
                                recommendedPrice,
                                estimatedProfit,
                                analysisText,
                                tips,
                                costBreakdown: {
                                    meatCost: meatCostPerSkewer.toFixed(2),
                                    additionalCost: userData.additionalCost,
                                    totalCost: totalCost.toFixed(2),
                                    profit: profitPerSkewer.toFixed(2),
                                    profitMargin: Math.round((profitPerSkewer / recommendedPrice) * 100)
                                }
                            });
                        }, 800);

                    } catch(error) {
                        console.error('เกิดข้อผิดพลาดในการคำนวณราคา:', error);
                        setTimeout(() => {
                            resolve({
                                recommendedPrice: 13,
                                estimatedProfit: 2000,
                                analysisText: "จากการวิเคราะห์ต้นทุนและสภาพตลาด แนะนำให้ตั้งราคาที่ 13 บาทต่อไม้ ซึ่งจะทำให้คุณมีกำไรประมาณ 30% และยังแข่งขันในตลาดได้",
                                tips: [
                                    "ลองปรับสูตรหมักให้มีเอกลักษณ์เฉพาะตัว จะช่วยสร้างความแตกต่างจากคู่แข่ง",
                                    "สร้างแพ็คเกจพิเศษ เช่น 'เซ็ตครอบครัว' ที่มีหมูปิ้งหลายไม้พร้อมข้าวเหนียวและน้ำจิ้ม",
                                    "ทำการตลาดออนไลน์ผ่าน Facebook หรือ Line เพื่อแจ้งตำแหน่งขายและโปรโมชั่น"
                                ]
                            });
                        }, 1000);
                    }
                });
            },

            getChatResponse: async function(message) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        const response = this.getRandomElement(this.mockResponses.chatResponses);
                        resolve(response);
                    }, 1200);
                });
            }
        };

        // =====================
        // ฟังก์ชันแสดงวันที่ปัจจุบันในรูปแบบไทย
        // =====================
        function setThaiDate() {
            const now = new Date();
            const thaiDay = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
            const thaiMonth = ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน',
                             'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'];

            const day = thaiDay[now.getDay()];
            const date = now.getDate();
            const month = thaiMonth[now.getMonth()];
            const year = now.getFullYear() + 543; // แปลงเป็นปี พ.ศ.

            document.getElementById('current-date').textContent = `วัน${day}ที่ ${date} ${month} ${year}`;
        }

        // =====================
        // ฟังก์ชันดึงราคาหมูจริงจากแหล่งข้อมูล
        // =====================
        async function fetchRealPorkPrice() {
            try {
                // ในความเป็นจริง คุณควรเชื่อมต่อกับ API จริง
                const currentPrice = 190; // ราคาจริงล่าสุด

                const now = new Date();
                const formattedDate = now.toLocaleString('th-TH', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                document.getElementById('price-update-time').textContent = `อัปเดตเมื่อ: ${formattedDate}`;
                document.getElementById('market-price').textContent = `${currentPrice} บาท`;

                return currentPrice;
            } catch (error) {
                console.error('ไม่สามารถดึงข้อมูลราคาหมูได้:', error);
                const fallbackPrice = 150;
                document.getElementById('market-price').textContent = `${fallbackPrice} บาท (offline)`;
                return fallbackPrice;
            }
        }

            // =====================
        // ระบบแท็บ
        // =====================
        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // ลบคลาส active จากทุกแท็บ
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                    // เพิ่มคลาส active ให้แท็บที่คลิก
                    this.classList.add('active');

                    // แสดงเนื้อหาที่ตรงกับแท็บ
                    const tabId = this.getAttribute('data-tab');
                    const tabContent = document.getElementById(`${tabId}-tab`);
                    
                    if (tabContent) {
                        tabContent.classList.add('active');

                        // เพิ่มเอฟเฟกต์ animation
                        tabContent.style.animation = 'none';
                        setTimeout(() => {
                            tabContent.style.animation = 'fadeIn 0.5s';
                        }, 10);

                        // อัปเดตข้อมูลเมื่อสวิตช์แท็บ
                        if (tabId === 'sales') {
                            updateSalesDisplay();
                        } else if (tabId === 'dashboard') {
                            updateDashboardSummary();
                        }
                    }
                });
            });
        }

        // =====================
        // ระบบเลือกออปชั่น
        // =====================
        function setupOptionButtons() {
            document.querySelectorAll('.option-button').forEach(button => {
                button.addEventListener('click', function() {
                    // เพิ่มเอฟเฟกต์คลิก
                    this.classList.add('pulse');
                    setTimeout(() => {
                        this.classList.remove('pulse');
                    }, 500);

                    // หา option-group ที่เป็นพาเรนต์
                    const parent = this.closest('.option-group');
                    
                    // ลบคลาส selected จากทุกปุ่มในกลุ่มเดียวกัน
                    parent.querySelectorAll('.option-button').forEach(btn => btn.classList.remove('selected'));
                    
                    // เพิ่มคลาส selected ให้ปุ่มที่คลิก
                    this.classList.add('selected');
                });
            });
        }

        // =====================
        // ระบบคำนวณราคา
        // =====================
        async function calculatePrice() {
            console.log("เริ่มการคำนวณราคา...");
            
            const calculateBtn = document.getElementById('calculate-btn');
            const originalText = calculateBtn.textContent;
            
            calculateBtn.textContent = "กำลังคำนวณ...";
            calculateBtn.style.backgroundColor = "#FFA726";
            calculateBtn.disabled = true;

            document.getElementById('result-section').style.display = 'block';
            document.getElementById('price-recommendation').textContent = 'กำลังคำนวณ...';
            document.getElementById('profit-estimate').textContent = 'กำลังวิเคราะห์...';
            document.getElementById('analysis-text').textContent = 'กำลังวิเคราะห์...';
            document.getElementById('tips-list').innerHTML = '<li>กำลังคำนวณเทคนิคที่เหมาะสมกับคุณ...</li>';

            try {
                const userData = {
                    meatPrice: parseFloat(document.getElementById('meat-price').value) || 150,
                    meatPerSkewer: parseFloat(document.getElementById('meat-per-skewer').value) || 25,
                    additionalCost: parseFloat(document.getElementById('additional-cost').value) || 1
                };

                const marketData = {
                    location: document.getElementById('location').value,
                    salesVolume: document.getElementById('sales-volume').value,
                    weather: document.querySelector('.option-group:nth-of-type(3) .option-button.selected')?.getAttribute('data-value') || 'sunny',
                    economy: document.querySelector('.option-group:nth-of-type(4) .option-button.selected')?.getAttribute('data-value') || 'normal'
                };

                console.log("ข้อมูลที่ใช้คำนวณ:", { userData, marketData });

                const result = await AIEngine.getPriceRecommendation(userData, marketData);
                console.log("ผลลัพธ์การคำนวณ:", result);

                // แสดงผลลัพธ์
                document.getElementById('price-recommendation').textContent = `${result.recommendedPrice} บาท/ไม้`;
                document.getElementById('profit-estimate').textContent = `ประมาณการกำไร: ${result.estimatedProfit} บาท/วัน`;
                document.getElementById('analysis-text').textContent = result.analysisText;

                const tipsList = document.getElementById('tips-list');
                tipsList.innerHTML = '';
                result.tips.forEach(tip => {
                    const li = document.createElement('li');
                    li.textContent = tip;
                    tipsList.appendChild(li);
                });

                // อัปเดตแดชบอร์ด
                document.getElementById('today-price').textContent = `${result.recommendedPrice} บาท`;
                document.getElementById('estimated-profit').textContent = `${result.estimatedProfit} บาท`;

                // เพิ่มเอฟเฟกต์
                const resultSection = document.getElementById('result-section');
                resultSection.style.animation = 'none';
                setTimeout(() => {
                    resultSection.style.animation = 'fadeIn 0.5s';
                }, 10);

            } catch (error) {
                console.error('เกิดข้อผิดพลาดในการคำนวณราคา:', error);
                
                // วิธีสำรอง
                document.getElementById('price-recommendation').textContent = '13 บาท/ไม้';
                document.getElementById('profit-estimate').textContent = 'ประมาณการกำไร: 2000 บาท/วัน';
                document.getElementById('analysis-text').textContent = 'เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ แต่เราคำนวณราคาแนะนำและประมาณการกำไรให้คุณแล้ว';
                document.getElementById('tips-list').innerHTML = '<li>ลองปรับสูตรหมักให้มีเอกลักษณ์เฉพาะตัว จะช่วยสร้างความแตกต่างจากคู่แข่ง</li><li>ทำการตลาดออนไลน์ผ่าน Facebook หรือ Line เพื่อแจ้งตำแหน่งขายและโปรโมชั่น</li>';
                
            } finally {
                calculateBtn.textContent = originalText;
                calculateBtn.style.backgroundColor = "";
                calculateBtn.disabled = false;
            }
        }

        // =====================
        // ระบบบันทึกยอดขาย
        // =====================
        function setupSalesTracking() {
            const saveSalesBtn = document.getElementById('save-sales-btn');
            
            // ตั้งวันที่เป็นวันนี้
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('sale-date').value = today;
            
            if (saveSalesBtn) {
                saveSalesBtn.addEventListener('click', async function() {
                    const salesData = {
                        date: document.getElementById('sale-date').value,
                        prepared: parseInt(document.getElementById('prepared-amount').value) || 0,
                        sold: parseInt(document.getElementById('sold-amount').value) || 0,
                        weather: document.getElementById('weather-condition').value,
                        notes: document.getElementById('sale-notes').value
                    };
                    
                    if (salesData.prepared === 0 || salesData.sold === 0) {
                        alert('กรุณากรอกจำนวนที่เตรียมไปและขายได้');
                        return;
                    }

                    if (salesData.sold > salesData.prepared) {
                        alert('จำนวนที่ขายได้ไม่ควรมากกว่าจำนวนที่เตรียมไป');
                        return;
                    }
                    
                    // แสดงสถานะกำลังบันทึก
                    const originalText = this.textContent;
                    this.textContent = "กำลังบันทึก...";
                    this.disabled = true;
                    
                    const success = await SalesManager.saveDailySales(salesData);
                    
                    if (success) {
                        this.textContent = "บันทึกเรียบร้อย ✓";
                        this.style.backgroundColor = "#4CAF50";
                        
                        // ล้างฟอร์ม
                        document.getElementById('prepared-amount').value = '';
                        document.getElementById('sold-amount').value = '';
                        document.getElementById('sale-notes').value = '';
                        
                        // อัปเดตแสดงผล
                        await updateSalesDisplay();
                        await updateDashboardSummary();
                        
                        // รีเซ็ตปุ่มหลังจาก 2 วินาที
                        setTimeout(() => {
                            this.textContent = originalText;
                            this.style.backgroundColor = "";
                            this.disabled = false;
                        }, 2000);
                        
                    } else {
                        alert('เกิดข้อผิดพลาดในการบันทึก');
                        this.textContent = originalText;
                        this.disabled = false;
                    }
                });
            }
        }

        // อัปเดตการแสดงผลข้อมูลยอดขาย
        async function updateSalesDisplay() {
            const salesHistory = await SalesManager.getLast7DaysSales();
            const historyContainer = document.getElementById('sales-history');
            
            if (!historyContainer) return;
            
            if (salesHistory.length === 0) {
                historyContainer.innerHTML = '<p>ยังไม่มีข้อมูล กรุณาบันทึกยอดขายก่อน</p>';
            } else {
                let html = '<div style="overflow-x: auto;">';
                html += '<table class="sales-table">';
                html += '<thead><tr><th>วันที่</th><th>เตรียม</th><th>ขาย</th><th>เหลือ</th><th>% ขาย</th><th>อากาศ</th></tr></thead>';
                html += '<tbody>';
                
                salesHistory.forEach(sale => {
                    const weatherIcon = sale.weather === 'sunny' ? '☀️' : 
                                       sale.weather === 'cloudy' ? '☁️' : '🌧️';
                    const sellThroughRate = sale.sellThroughRate || Math.round((sale.sold / sale.prepared) * 100);
                    
                    html += `<tr>
                        <td>${sale.date}</td>
                        <td>${sale.prepared}</td>
                        <td>${sale.sold}</td>
                        <td>${sale.leftover}</td>
                        <td>${sellThroughRate}%</td>
                        <td>${weatherIcon}</td>
                    </tr>`;
                });
                
                html += '</tbody></table></div>';
                historyContainer.innerHTML = html;
            }
            
            // อัปเดตการพยากรณ์
            const prediction = SalesManager.calculatePrediction(salesHistory);
            const predictionAmountEl = document.getElementById('predicted-amount');
            const predictionReasonEl = document.getElementById('prediction-reason');
            
            if (predictionAmountEl && predictionReasonEl) {
                predictionAmountEl.textContent = prediction.amount > 0 ? `${prediction.amount} ไม้` : '-- ไม้';
                predictionReasonEl.textContent = prediction.reason;
                
                // เปลี่ยนสีตามความเชื่อมั่น
                const predictionContainer = predictionAmountEl.closest('.prediction-highlight');
                if (predictionContainer) {
                    if (prediction.confidence === 'สูง') {
                        predictionContainer.style.background = 'linear-gradient(135deg, #4CAF50, #388E3C)';
                    } else if (prediction.confidence === 'ต่ำ') {
                        predictionContainer.style.background = 'linear-gradient(135deg, #FF9800, #F57C00)';
                    } else {
                        predictionContainer.style.background = 'linear-gradient(135deg, #2196F3, #1976D2)';
                    }
                }
            }
        }

        // อัปเดตสรุปในแดชบอร์ด
        async function updateDashboardSummary() {
            const salesHistory = await SalesManager.getLast7DaysSales();
            const summaryContainer = document.getElementById('dashboard-sales-summary');
            
            if (!summaryContainer) return;
            
            if (salesHistory.length === 0) {
                summaryContainer.innerHTML = '<p>ยังไม่มีข้อมูลการขาย กรุณาบันทึกยอดขายในแท็บ "บันทึกยอดขาย"</p>';
            } else {
                const summary = SalesManager.generateDashboardSummary(salesHistory);
                
                let html = '<div class="dashboard-stats" style="grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">';
                
                html += `
                    <div class="stat-card">
                        <div class="stat-label">เฉลี่ยขาย/วัน</div>
                        <div class="stat-value">${summary.avgSold}</div>
                        <div class="stat-label">ไม้</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">% ขายได้</div>
                        <div class="stat-value">${summary.avgSellThrough}%</div>
                        <div class="stat-label">เฉลี่ย</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ของเหลือรวม</div>
                        <div class="stat-value">${summary.totalLeftover}</div>
                        <div class="stat-label">ไม้</div>
                    </div>
                `;
                
                html += '</div>';
                
                if (summary.bestDay && summary.worstDay) {
                    html += `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div style="background: linear-gradient(135deg, #4CAF50, #388E3C); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 0.9rem; opacity: 0.9;">วันที่ขายดีที่สุด</div>
                                <div style="font-size: 1.5rem; font-weight: bold; margin: 5px 0;">${summary.bestDay.sold} ไม้</div>
                                <div style="font-size: 0.8rem; opacity: 0.8;">${summary.bestDay.date}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #FF9800, #F57C00); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 0.9rem; opacity: 0.9;">วันที่ขายน้อยที่สุด</div>
                                <div style="font-size: 1.5rem; font-weight: bold; margin: 5px 0;">${summary.worstDay.sold} ไม้</div>
                                <div style="font-size: 0.8rem; opacity: 0.8;">${summary.worstDay.date}</div>
                            </div>
                        </div>
                    `;
                }
                
                summaryContainer.innerHTML = html;
            }
        }

            // =====================
        // ระบบแชทกับ AI
        // =====================
        async function setupChatSystem() {
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const chatSendBtn = document.getElementById('chat-send-btn');

            if (!chatMessages || !chatInput || !chatSendBtn) {
                console.error('Chat elements not found');
                return;
            }

            async function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;

                // เพิ่มข้อความของผู้ใช้
                const userMessageElement = document.createElement('div');
                userMessageElement.className = 'message user';
                userMessageElement.innerHTML = `
                    ${message}
                    <div class="message-time">เมื่อสักครู่</div>
                `;
                chatMessages.appendChild(userMessageElement);

                chatInput.value = '';
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // แสดงว่ากำลังพิมพ์
                const typingElement = document.createElement('div');
                typingElement.className = 'message ai';
                typingElement.innerHTML = `
                    <div class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                `;
                typingElement.style.padding = '10px 15px';
                chatMessages.appendChild(typingElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                try {
                    const response = await AIEngine.getChatResponse(message);
                    chatMessages.removeChild(typingElement);

                    const aiMessageElement = document.createElement('div');
                    aiMessageElement.className = 'message ai';
                    aiMessageElement.innerHTML = `
                        ${response}
                        <div class="message-time">เมื่อสักครู่</div>
                    `;
                    chatMessages.appendChild(aiMessageElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;

                } catch (error) {
                    console.error('Error getting AI response:', error);
                    chatMessages.removeChild(typingElement);

                    const errorElement = document.createElement('div');
                    errorElement.className = 'message ai';
                    errorElement.innerHTML = `
                        ขออภัย เกิดข้อผิดพลาดในการรับคำตอบ โปรดลองใหม่อีกครั้ง
                        <div class="message-time">เมื่อสักครู่</div>
                    `;
                    chatMessages.appendChild(errorElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }

            chatSendBtn.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    sendMessage();
                }
            });

            // เพิ่ม CSS สำหรับ typing indicator
            const style = document.createElement('style');
            style.textContent = `
                .typing-indicator {
                    display: flex;
                    align-items: center;
                    padding: 10px 0;
                }
                .typing-indicator span {
                    height: 8px;
                    width: 8px;
                    float: left;
                    margin: 0 2px;
                    background-color: #9E9E9E;
                    display: block;
                    border-radius: 50%;
                    opacity: 0.4;
                    animation: 1s blink infinite;
                }
                .typing-indicator span:nth-of-type(1) { animation-delay: 0.3333s; }
                .typing-indicator span:nth-of-type(2) { animation-delay: 0.6666s; }
                .typing-indicator span:nth-of-type(3) { animation-delay: 0.9999s; }
                @keyframes blink {
                    50% { opacity: 1; }
                }
                .message {
                    margin-bottom: 20px;
                    max-width: 80%;
                    animation: messageIn 0.3s ease;
                    padding: 15px 20px;
                    border-radius: 18px;
                    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
                }
                .message.user {
                    margin-left: auto;
                    background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
                    color: white;
                    border-radius: 18px 18px 0 18px;
                }
                .message.ai {
                    margin-right: auto;
                    background-color: white;
                    color: var(--dark-color);
                    border-radius: 18px 18px 18px 0;
                }
                .message-time {
                    font-size: 0.8rem;
                    opacity: 0.8;
                    margin-top: 8px;
                    text-align: right;
                }
                @keyframes messageIn {
                    from { opacity: 0; transform: translateY(20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .chat-ui {
                    background-color: white;
                    border-radius: 15px;
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                    margin-bottom: 25px;
                    overflow: hidden;
                    display: flex;
                    flex-direction: column;
                    height: 450px;
                    transition: transform 0.3s ease, box-shadow 0.3s ease;
                }
                .chat-ui:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
                }
                .chat-messages {
                    flex: 1;
                    padding: 20px;
                    overflow-y: auto;
                    background-color: #f9f9f9;
                }
                .chat-input-container {
                    display: flex;
                    padding: 15px;
                    border-top: 1px solid #eee;
                    background-color: #fff;
                }
                .chat-input {
                    flex: 1;
                    padding: 15px;
                    border: 2px solid #ddd;
                    border-radius: 25px;
                    font-size: 1.05rem;
                    transition: all 0.3s;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                }
                .chat-input:focus {
                    border-color: var(--primary-color);
                    box-shadow: 0 0 0 3px var(--primary-light);
                    outline: none;
                }
                .chat-send-btn {
                    background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 50px;
                    height: 50px;
                    margin-left: 15px;
                    cursor: pointer;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    box-shadow: 0 4px 10px rgba(255, 87, 34, 0.3);
                    transition: all 0.3s;
                    animation: chatButtonShift 5s infinite;
                }
                @keyframes chatButtonShift {
                    0% { background: linear-gradient(145deg, #FF5722, #E64A19); }
                    50% { background: linear-gradient(145deg, #9C27B0, #7B1FA2); }
                    100% { background: linear-gradient(145deg, #FF5722, #E64A19); }
                }
                .chat-send-btn:hover {
                    transform: translateY(-2px) scale(1.05);
                    box-shadow: 0 6px 15px rgba(255, 87, 34, 0.4);
                }
                .chat-send-btn:active {
                    transform: translateY(1px) scale(0.98);
                    box-shadow: 0 2px 5px rgba(255, 87, 34, 0.2);
                }
            `;
            document.head.appendChild(style);
        }

        // =====================
        // ระบบการตั้งค่า
        // =====================
        function setupSettings() {
            const saveApiKeyBtn = document.getElementById('save-api-key');
            const saveBusinessInfoBtn = document.getElementById('save-business-info');
            const saveAlertSettingsBtn = document.getElementById('save-alert-settings');

            function showSaveSuccess(button) {
                const originalText = button.textContent;
                const originalColor = button.style.backgroundColor;
                
                button.textContent = "บันทึกเรียบร้อย ✓";
                button.style.backgroundColor = "#4CAF50";
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = originalColor;
                }, 2000);
            }

            if (saveApiKeyBtn) {
                saveApiKeyBtn.addEventListener('click', async function() {
                    const provider = document.getElementById('api-provider').value;
                    const apiKey = document.getElementById('api-key').value;
                    
                    const success = await UserDataManager.updateApiSettings(provider, apiKey);
                    if (success) {
                        showSaveSuccess(this);
                    }
                });
            }

            if (saveBusinessInfoBtn) {
                saveBusinessInfoBtn.addEventListener('click', async function() {
                    const name = document.getElementById('business-name').value;
                    const location = document.getElementById('business-location').value;
                    const description = document.getElementById('business-description').value;
                    
                    const success = await UserDataManager.updateBusinessInfo(name, location, description);
                    if (success) {
                        showSaveSuccess(this);
                    }
                });
            }

            if (saveAlertSettingsBtn) {
                saveAlertSettingsBtn.addEventListener('click', async function() {
                    const weatherAlert = document.getElementById('weather-alert').checked;
                    const priceAlert = document.getElementById('price-alert').checked;
                    const eventAlert = document.getElementById('event-alert').checked;
                    
                    const success = await UserDataManager.updateAlertSettings(weatherAlert, priceAlert, eventAlert);
                    if (success) {
                        showSaveSuccess(this);
                    }
                });
            }
        }

        // =====================
        // ระบบแดชบอร์ด
        // =====================
        async function setupDashboard() {
            const refreshBtn = document.getElementById('refresh-recommendation');

            async function refreshRecommendation() {
                console.log("กำลังรีเฟรชคำแนะนำ...");
                
                if (!refreshBtn) return;
                
                const originalText = refreshBtn.textContent;
                refreshBtn.textContent = "กำลังโหลด...";
                refreshBtn.disabled = true;

                try {
                    const realPorkPrice = await fetchRealPorkPrice();
                    
                    // สร้างข้อมูลสำหรับคำแนะนำ
                    const weatherTypes = ['sunny', 'cloudy', 'rainy'];
                    const weather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
                    
                    const weatherDesc = {
                        'sunny': 'แดดออก',
                        'cloudy': 'มีเมฆมาก', 
                        'rainy': 'ฝนตก'
                    }[weather];

                    const locations = ['ตลาด', 'หน้าโรงเรียน', 'ใกล้ออฟฟิศ', 'ในชุมชน', 'ริมถนนใหญ่'];
                    const recommendedLocation = locations[Math.floor(Math.random() * locations.length)];
                    
                    const costPerSkewer = (realPorkPrice / 1000) * 25 + 1;
                    const recommendedPrice = Math.round(costPerSkewer * 2);
                    
                    const reasons = [
                        'ราคาวัตถุดิบปัจจุบันและความต้องการในตลาด',
                        'สภาพอากาศวันนี้และพฤติกรรมผู้บริโภค',
                        'การแข่งขันในพื้นที่และต้นทุนการดำเนินงาน',
                        'กำลังซื้อของผู้บริโภคในช่วงนี้'
                    ];
                    const reason = reasons[Math.floor(Math.random() * reasons.length)];

                    // อัปเดตข้อมูลในแดชบอร์ด
                    document.getElementById('weather-desc').textContent = weatherDesc;
                    document.getElementById('location-rec').textContent = recommendedLocation;
                    document.getElementById('price-rec').textContent = recommendedPrice;
                    document.getElementById('price-reason').textContent = reason;

                    // อัปเดตสถิติ
                    document.getElementById('today-price').textContent = `${recommendedPrice} บาท`;
                    document.getElementById('weather-status').textContent = weatherDesc;
                    document.getElementById('humidity').textContent = 60 + Math.floor(Math.random() * 20);

                   const estimatedProfit = Math.round((recommendedPrice - costPerSkewer) * 200);
                   document.getElementById('estimated-profit').textContent = `${estimatedProfit} บาท`;

                   // อัปเดตเทคนิค
                   const dailyTips = [];
                   while (dailyTips.length < 3) {
                       const tip = AIEngine.getRandomElement(AIEngine.mockResponses.businessTips);
                       if (!dailyTips.includes(tip)) {
                           dailyTips.push(tip);
                       }
                   }

                   const weatherTips = AIEngine.mockResponses.weatherStrategies[weather] || [];
                   if (weatherTips.length > 0) {
                       dailyTips.push(AIEngine.getRandomElement(weatherTips));
                   }

                   const tipsList = document.getElementById('daily-tips');
                   if (tipsList) {
                       tipsList.innerHTML = '';
                       dailyTips.forEach(tip => {
                           const li = document.createElement('li');
                           li.textContent = tip;
                           tipsList.appendChild(li);
                       });
                   }

               } catch (error) {
                   console.error('Error refreshing recommendation:', error);
                   
                   // ข้อมูลสำรอง
                   document.getElementById('weather-desc').textContent = 'แดดออก';
                   document.getElementById('location-rec').textContent = 'ตลาด';
                   document.getElementById('price-rec').textContent = '13';
                   document.getElementById('price-reason').textContent = 'ราคาวัตถุดิบปัจจุบันและความต้องการในตลาด';
                   
               } finally {
                   refreshBtn.textContent = originalText;
                   refreshBtn.disabled = false;
               }
           }

           if (refreshBtn) {
               refreshBtn.addEventListener('click', refreshRecommendation);
           }

           // โหลดข้อมูลเริ่มต้น
           await refreshRecommendation();
           
           // อัปเดตสรุปยอดขาย
           await updateDashboardSummary();
       }

            // =====================
        // ตรวจสอบ DOM elements ที่จำเป็น
        // =====================
        function checkRequiredElements() {
            const requiredElements = [
                'current-date',
                'calculate-btn',
                'result-section',
                'price-recommendation',
                'profit-estimate',
                'analysis-text',
                'tips-list',
                'meat-price',
                'meat-per-skewer',
                'additional-cost',
                'location',
                'sales-volume'
            ];

            const missingElements = [];
            requiredElements.forEach(id => {
                if (!document.getElementById(id)) {
                    missingElements.push(id);
                    console.error(`ไม่พบ element ที่มี id: ${id}`);
                }
            });

            if (missingElements.length > 0) {
                console.error('ไม่พบองค์ประกอบที่จำเป็น:', missingElements);
                return false;
            }

            return true;
        }

        // =====================
        // Error Handler
        // =====================
        function setupErrorHandling() {
            window.addEventListener('error', function(event) {
                console.error('JavaScript Error:', event.error);
                
                // แสดงการแจ้งเตือนแบบเป็นมิตร
                const notification = document.createElement('div');
                notification.className = 'notification error';
                notification.style.position = 'fixed';
                notification.style.top = '20px';
                notification.style.right = '20px';
                notification.style.zIndex = '9999';
                notification.style.maxWidth = '300px';
                notification.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="#F44336" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12" y2="16"></line>
                    </svg>
                    <div class="notification-content">
                        <p>เกิดข้อผิดพลาดเล็กน้อย แต่แอปยังใช้งานได้ปกติ</p>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // ลบการแจ้งเตือนหลังจาก 5 วินาที
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 5000);
            });

            // Handle unhandled promise rejections
            window.addEventListener('unhandledrejection', function(event) {
                console.error('Unhandled Promise Rejection:', event.reason);
                event.preventDefault();
            });
        }

        // =====================
        // เริ่มต้นแอปพลิเคชัน
        // =====================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log("🚀 เริ่มต้นแอปพลิเคชัน Smart Pork Skewer AI...");

            // ตั้งค่า Error Handling
            setupErrorHandling();

            // แสดงวันที่ปัจจุบัน
            setThaiDate();

            // ตรวจสอบองค์ประกอบที่จำเป็น
            if (!checkRequiredElements()) {
                console.error("องค์ประกอบบางอย่างไม่พร้อมใช้งาน");
                
                const notification = document.createElement('div');
                notification.className = 'notification warning';
                notification.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="#FFC107" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <div class="notification-content">
                        <p>บางส่วนของแอปอาจไม่ทำงานอย่างสมบูรณ์ โปรดลองรีเฟรชหน้าเว็บ</p>
                    </div>
                `;
                
                const container = document.querySelector('.container');
                if (container) {
                    container.insertBefore(notification, container.firstChild);
                }
            }

            // รอให้ Firebase พร้อมและเข้าสู่ระบบ
            try {
                console.log("🔐 กำลังเชื่อมต่อ Firebase...");
                await UserDataManager.initAuth();
                console.log('✅ Firebase พร้อมใช้งาน - User ID:', UserDataManager.currentUserId);
                
            } catch (error) {
                console.error('❌ เกิดข้อผิดพลาดใน Firebase:', error);
                
                // แสดงการแจ้งเตือนแต่ยังให้ใช้งานต่อได้
                const notification = document.createElement('div');
                notification.className = 'notification info';
                notification.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="#2196F3" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12" y2="16"></line>
                    </svg>
                    <div class="notification-content">
                        <p>ไม่สามารถเชื่อมต่อฐานข้อมูลได้ แต่คุณยังสามารถใช้งานฟีเจอร์อื่นๆ ได้</p>
                    </div>
                `;
                
                const container = document.querySelector('.container');
                if (container) {
                    container.insertBefore(notification, container.firstChild);
                }
            }

            // ตั้งค่าระบบต่างๆ
            console.log("⚙️ กำลังตั้งค่าระบบ...");
            
            try {
                setupTabs();
                console.log("✅ ระบบแท็บพร้อมใช้งาน");
                
                setupOptionButtons();
                console.log("✅ ระบบปุ่มตัวเลือกพร้อมใช้งาน");
                
                await setupChatSystem();
                console.log("✅ ระบบแชทพร้อมใช้งาน");
                
                setupSalesTracking();
                console.log("✅ ระบบบันทึกยอดขายพร้อมใช้งาน");
                
                await setupDashboard();
                console.log("✅ แดชบอร์ดพร้อมใช้งาน");
                
                setupSettings();
                console.log("✅ ระบบการตั้งค่าพร้อมใช้งาน");
                
            } catch (error) {
                console.error("❌ เกิดข้อผิดพลาดในการตั้งค่าระบบ:", error);
            }

            // ดึงราคาหมูจริงและอัปเดตค่าเริ่มต้น
            try {
                console.log("💰 กำลังดึงราคาหมูล่าสุด...");
                const realPorkPrice = await fetchRealPorkPrice();
                
                const meatPriceInput = document.getElementById('meat-price');
                if (meatPriceInput) {
                    meatPriceInput.value = realPorkPrice;
                }
                console.log("✅ อัปเดตราคาหมูเรียบร้อย:", realPorkPrice, "บาท/กก.");
                
            } catch (error) {
                console.error("❌ เกิดข้อผิดพลาดในการดึงราคาหมู:", error);
            }

            // ตั้งค่าปุ่มคำนวณราคา
            const calculateBtn = document.getElementById('calculate-btn');
            if (calculateBtn) {
                // ลบ event listener เก่า (ถ้ามี)
                const newCalculateBtn = calculateBtn.cloneNode(true);
                calculateBtn.parentNode.replaceChild(newCalculateBtn, calculateBtn);
                
                newCalculateBtn.addEventListener('click', function() {
                    console.log("🧮 เริ่มคำนวณราคา...");
                    calculatePrice();
                });
                
                console.log("✅ ปุ่มคำนวณราคาพร้อมใช้งาน");
            } else {
                console.error("❌ ไม่พบปุ่มคำนวณราคา");
            }

            // แสดงการแจ้งเตือนเมื่อโหลดเสร็จ
            setTimeout(() => {
                const successNotification = document.createElement('div');
                successNotification.className = 'notification success';
                successNotification.style.position = 'fixed';
                successNotification.style.bottom = '20px';
                successNotification.style.right = '20px';
                successNotification.style.zIndex = '9999';
                successNotification.style.maxWidth = '300px';
                successNotification.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2">
                        <path d="M9 12l2 2 4-4"></path>
                        <circle cx="12" cy="12" r="10"></circle>
                    </svg>
                    <div class="notification-content">
                        <p><strong>🎉 พร้อมใช้งาน!</strong><br>Smart Pork Skewer AI โหลดเสร็จแล้ว</p>
                    </div>
                `;
                
                document.body.appendChild(successNotification);
                
                // ลบการแจ้งเตือนหลังจาก 3 วินาที
                setTimeout(() => {
                    if (successNotification.parentNode) {
                        successNotification.parentNode.removeChild(successNotification);
                    }
                }, 3000);
            }, 1000);

            console.log("🎉 เริ่มต้นแอปพลิเคชันเรียบร้อยแล้ว!");
        });

        // =====================
        // Service Worker สำหรับ PWA (เพิ่มในอนาคต)
        // =====================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // navigator.serviceWorker.register('/sw.js')
                // .then(function(registration) {
                //     console.log('ServiceWorker registration successful');
                // })
                // .catch(function(err) {
                //     console.log('ServiceWorker registration failed: ', err);
                // });
            });
        }

        // =====================
        // Performance Monitoring
        // =====================
        window.addEventListener('load', function() {
            setTimeout(function() {
                const perfData = performance.getEntriesByType('navigation')[0];
                if (perfData) {
                    console.log('📊 Performance Stats:');
                    console.log('- DOM Content Loaded:', Math.round(perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart), 'ms');
                    console.log('- Total Load Time:', Math.round(perfData.loadEventEnd - perfData.loadEventStart), 'ms');
                    console.log('- Page Load Complete:', Math.round(perfData.loadEventEnd - perfData.fetchStart), 'ms');
                }
            }, 0);
        });

    </script>
</body>
</html>

