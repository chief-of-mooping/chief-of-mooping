
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Farm Management System</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRmFybSBNYW5hZ2VtZW50IFN5c3RlbSIsInNob3J0X25hbWUiOiJGYXJtTVMiLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsInN0YXJ0X3VybCI6Ii8iLCJ0aGVtZV9jb2xvciI6IiMwMDc4ZDQiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXlORGtpSUdobGFXZG9kRDBpTWpRNUlqNDhjbVZqZENCM2FXUjBhRDBpTWpRNUlpQm9aV2xuYUhROUlqSTBPU0lnWm1sc2JEMGlJekkwTWpRaU1qUWlMejQ4TDNOMlp6ND0iLCJzaXplcyI6IjI0eDI0IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #323130;
            background-color: #faf9f8;
        }

        /* Desktop Styles - Enterprise/SAP Style */
        @media (min-width: 1200px) {
            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 0;
            }

            /* Menu Bar */
            .menu-bar {
                background: #f3f2f1;
                border-bottom: 1px solid #e1dfdd;
                padding: 8px 16px;
                font-size: 14px;
            }

            .menu-bar span {
                margin-right: 24px;
                cursor: pointer;
                padding: 4px 8px;
            }

            .menu-bar span:hover {
                background: #e1dfdd;
            }

            /* Header */
            .header {
                background: #0078d4;
                color: white;
                padding: 16px 24px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .header h1 {
                font-size: 20px;
                font-weight: 600;
            }

            .header-actions {
                display: flex;
                gap: 16px;
            }

            .header-actions span {
                padding: 8px 12px;
                background: rgba(255,255,255,0.2);
                cursor: pointer;
                border-radius: 4px;
            }

            /* Navigation Tabs */
            .nav-tabs {
                background: white;
                border-bottom: 1px solid #e1dfdd;
                padding: 0 24px;
                display: flex;
                gap: 32px;
            }

            .nav-tab {
                padding: 16px 0;
                cursor: pointer;
                border-bottom: 3px solid transparent;
                font-weight: 500;
            }

            .nav-tab.active {
                border-bottom-color: #0078d4;
                color: #0078d4;
            }

            /* Main Content */
            .main-content {
                padding: 24px;
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: 24px;
            }

            /* KPI Cards */
            .kpi-section h2 {
                margin-bottom: 16px;
                font-size: 18px;
                color: #323130;
            }

            .kpi-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                margin-bottom: 24px;
            }

            .kpi-card {
                background: white;
                padding: 20px;
                border: 1px solid #e1dfdd;
                border-radius: 4px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }

            .kpi-value {
                font-size: 28px;
                font-weight: 600;
                color: #0078d4;
                margin-bottom: 4px;
            }

            .kpi-label {
                font-size: 14px;
                color: #605e5c;
            }

            /* Form Section - SAP Style */
            .form-section {
                background: white;
                border: 1px solid #e1dfdd;
                border-radius: 4px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }

            .form-header {
                background: #f3f2f1;
                padding: 12px 20px;
                border-bottom: 1px solid #e1dfdd;
                font-weight: 600;
            }

            .form-toolbar {
                padding: 12px 20px;
                border-bottom: 1px solid #e1dfdd;
                display: flex;
                gap: 8px;
            }

            .toolbar-btn {
                padding: 6px 12px;
                border: 1px solid #e1dfdd;
                background: white;
                cursor: pointer;
                font-size: 12px;
                border-radius: 2px;
            }

            .toolbar-btn:hover {
                background: #f3f2f1;
            }

            .toolbar-btn.primary {
                background: #0078d4;
                color: white;
                border-color: #0078d4;
            }

            .form-content {
                padding: 20px;
            }

            .form-row {
                display: grid;
                grid-template-columns: 150px 1fr;
                gap: 16px;
                margin-bottom: 16px;
                align-items: center;
            }

            .form-label {
                font-weight: 500;
                text-align: right;
            }

            .form-label.required::after {
                content: "*";
                color: red;
                margin-left: 4px;
            }

            .form-input {
                padding: 8px 12px;
                border: 1px solid #e1dfdd;
                border-radius: 2px;
                font-size: 14px;
            }

            .form-input:focus {
                outline: none;
                border-color: #0078d4;
                box-shadow: 0 0 0 1px #0078d4;
            }

            .form-select {
                padding: 8px 12px;
                border: 1px solid #e1dfdd;
                border-radius: 2px;
                background: white;
            }

            .radio-group {
                display: flex;
                gap: 20px;
            }

            .radio-item {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .form-actions {
                margin-top: 24px;
                display: flex;
                gap: 12px;
                justify-content: flex-end;
            }

            .btn {
                padding: 10px 20px;
                border: 1px solid #e1dfdd;
                background: white;
                cursor: pointer;
                border-radius: 2px;
                font-size: 14px;
            }

            .btn.primary {
                background: #0078d4;
                color: white;
                border-color: #0078d4;
            }

            .btn.success {
                background: #107c10;
                color: white;
                border-color: #107c10;
            }

            /* Quick Actions */
            .quick-actions {
                background: white;
                border: 1px solid #e1dfdd;
                border-radius: 4px;
                padding: 20px;
                margin-bottom: 24px;
            }

            .quick-actions h3 {
                margin-bottom: 16px;
                font-size: 16px;
            }

            .quick-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .quick-btn {
                padding: 12px;
                border: 1px solid #e1dfdd;
                background: white;
                cursor: pointer;
                text-align: center;
                border-radius: 4px;
                font-size: 14px;
            }

            .quick-btn:hover {
                background: #f3f2f1;
            }

            /* Activities */
            .activities {
                background: white;
                border: 1px solid #e1dfdd;
                border-radius: 4px;
                padding: 20px;
            }

            .activities h3 {
                margin-bottom: 16px;
                font-size: 16px;
            }

            .activity-item {
                padding: 8px 0;
                border-bottom: 1px solid #f3f2f1;
                font-size: 14px;
                color: #605e5c;
            }
        }

        /* Tablet Styles - Dynamics Dashboard Style */
        @media (min-width: 768px) and (max-width: 1199px) {
            .container {
                padding: 16px;
            }

            .header {
                background: #0078d4;
                color: white;
                padding: 16px;
                text-align: center;
                margin-bottom: 20px;
            }

            .nav-tabs {
                display: flex;
                justify-content: center;
                background: white;
                margin-bottom: 20px;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }

            .nav-tab {
                flex: 1;
                padding: 16px;
                text-align: center;
                cursor: pointer;
                border: none;
                background: white;
            }

            .nav-tab.active {
                background: #0078d4;
                color: white;
            }

            .main-content {
                display: block;
            }

            .kpi-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                margin-bottom: 24px;
            }

            .kpi-card {
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                text-align: center;
            }

            .form-section {
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                margin-top: 20px;
            }

            .form-row {
                display: block;
                margin-bottom: 16px;
            }

            .form-label {
                display: block;
                margin-bottom: 8px;
                text-align: left;
            }

            .form-input, .form-select {
                width: 100%;
            }
        }

        /* Mobile Styles - Banking App Style */
        @media (max-width: 767px) {
            .menu-bar {
                display: none;
            }

            .container {
                padding: 0;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .header {
                background: linear-gradient(135deg, #10b981, #3b82f6);
                color: white;
                padding: 20px 16px;
                text-align: center;
                font-size: 18px;
                font-weight: 600;
            }

            .nav-tabs {
                display: none;
            }

            .main-content {
                flex: 1;
                padding: 16px;
                display: block;
            }

            .kpi-grid {
                display: flex;
                flex-direction: column;
                gap: 12px;
                margin-bottom: 20px;
            }

            .kpi-card {
                background: white;
                padding: 20px;
                border-radius: 12px;
                box-shadow: 0 2px 12px rgba(0,0,0,0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .kpi-info {
                flex: 1;
            }

            .kpi-value {
                font-size: 24px;
                font-weight: 700;
                color: #1f2937;
                margin-bottom: 4px;
            }

            .kpi-label {
                font-size: 14px;
                color: #6b7280;
            }

            .kpi-status {
                font-size: 12px;
                color: #10b981;
                font-weight: 500;
            }

            /* Mobile Form */
            .form-section {
                background: white;
                border-radius: 12px;
                box-shadow: 0 2px 12px rgba(0,0,0,0.1);
                margin-bottom: 80px;
            }

            .form-header {
                padding: 20px;
                border-bottom: 1px solid #f3f4f6;
                font-size: 18px;
                font-weight: 600;
            }

            .form-content {
                padding: 20px;
            }

            .form-row {
                margin-bottom: 20px;
            }

            .form-label {
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
                color: #374151;
            }

            .form-input, .form-select {
                width: 100%;
                padding: 12px 16px;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                font-size: 16px;
            }

            .form-input:focus, .form-select:focus {
                outline: none;
                border-color: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }

            .radio-group {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .radio-item {
                padding: 12px;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                text-align: center;
                cursor: pointer;
            }

            .radio-item input[type="radio"] {
                display: none;
            }

            .radio-item input[type="radio"]:checked + label {
                background: #3b82f6;
                color: white;
            }

            .radio-item label {
                display: block;
                cursor: pointer;
                width: 100%;
                padding: 4px;
                border-radius: 4px;
            }

            /* Quick Actions - Mobile */
            .quick-actions {
                background: white;
                border-radius: 12px;
                box-shadow: 0 2px 12px rgba(0,0,0,0.1);
                padding: 20px;
                margin-bottom: 20px;
            }

            .quick-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .quick-btn {
                padding: 16px 12px;
                border: none;
                background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
                border-radius: 12px;
                text-align: center;
                cursor: pointer;
                font-weight: 500;
                color: #374151;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .quick-btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            }

            /* Bottom Navigation */
            .bottom-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                border-top: 1px solid #e5e7eb;
                display: flex;
                padding: 8px 0;
                box-shadow: 0 -2px 12px rgba(0,0,0,0.1);
            }

            .bottom-nav-item {
                flex: 1;
                text-align: center;
                padding: 8px;
                cursor: pointer;
                font-size: 12px;
                color: #6b7280;
            }

            .bottom-nav-item.active {
                color: #3b82f6;
                font-weight: 600;
            }

            .bottom-nav-item div:first-child {
                font-size: 20px;
                margin-bottom: 4px;
            }

            /* Mobile Buttons */
            .btn {
                width: 100%;
                padding: 14px;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                margin-bottom: 12px;
            }

            .btn.primary {
                background: #3b82f6;
                color: white;
            }

            .btn.success {
                background: #10b981;
                color: white;
            }

            .btn.secondary {
                background: #f3f4f6;
                color: #374151;
            }

            .form-actions {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
        }

        /* Common Styles */
        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }

        .status-message {
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Desktop Menu Bar -->
        <div class="menu-bar">
            <span onclick="showMessage('File menu')">File</span>
            <span onclick="showMessage('Edit menu')">Edit</span>
            <span onclick="showMessage('View menu')">View</span>
            <span onclick="showMessage('Reports menu')">Reports</span>
            <span onclick="showMessage('Tools menu')">Tools</span>
            <span onclick="showMessage('Help menu')">Help</span>
        </div>

        <!-- Header -->
        <div class="header">
            <h1>Enterprise Farm Management System</h1>
            <div class="header-actions">
                <span onclick="showMessage('Profile clicked')">Profile</span>
                <span onclick="showMessage('Notifications clicked')">Notifications</span>
                <span onclick="showMessage('Settings clicked')">Settings</span>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="('dashboard')">Dashboard</div>
            <div class="nav-tab" onclick="('livestock')">Livestock</div>
            <div class="nav-tab" onclick="('finance')">Finance</div>
        </div>

        <!-- Status Message -->
        <div id="statusMessage" class="status-message hidden"></div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="left-panel">
                <!-- KPI Section -->
                <div class="kpi-section">
                    <h2>Key Performance Indicators</h2>
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-info">
                                <div class="kpi-value" id="totalLivestock">0</div>
                                <div class="kpi-label">Total Livestock</div>
                                <div class="kpi-status">เริ่มต้นใช้งาน</div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-info">
                                <div class="kpi-value" id="monthlyRevenue">0</div>
                                <div class="kpi-label">Monthly Revenue (บาท)</div>
                                <div class="kpi-status">ยังไม่มีรายการ</div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-info">
                                <div class="kpi-value" id="profitMargin">0%</div>
                                <div class="kpi-label">Profit Margin</div>
                                <div class="kpi-status">ยังไม่มีรายการ</div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-info">
                                <div class="kpi-value">ปกติ</div>
                                <div class="kpi-label">Health Status</div>
                                <div class="kpi-status">ระบบพร้อมใช้งาน</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Entry Form -->
                <div class="form-section">
                    <div class="form-header">เพิ่มข้อมูลสุกร - Transaction Entry</div>
                    
                    <div class="form-toolbar">
                        <button class="toolbar-btn" onclick="resetForm()">New</button>
                        <button class="toolbar-btn" onclick="showMessage('Edit mode')">Edit</button>
                        <button class="toolbar-btn" onclick="showMessage('Delete selected')">Delete</button>
                        <button class="toolbar-btn primary" onclick="saveData()">Save</button>
                        <button class="toolbar-btn" onclick="resetForm()">Cancel</button>
                        <button class="toolbar-btn" onclick="showMessage('Help opened')">Help</button>
                    </div>

                    <div class="form-content">
                        <form id="pigForm">
                            <div class="form-row">
                                <label class="form-label required">ประเภทสุกร:</label>
                                <select class="form-select" id="pigType" required>
                                    <option value="">เลือกประเภท</option>
                                    <option value="breedingSow">แม่พันธุ์</option>
                                    <option value="piglet">ลูกสุกร</option>
                                    <option value="finisher">สุกรขุน</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label class="form-label required">จำนวน:</label>
                                <input type="number" class="form-input" id="quantity" required min="1">
                            </div>

                            <div class="form-row">
                                <label class="form-label required">วันที่เข้าฟาร์ม:</label>
                                <input type="date" class="form-input" id="entryDate" required>
                            </div>

                            <div class="form-row">
                                <label class="form-label">น้ำหนักเฉลี่ย (กก.):</label>
                                <input type="number" class="form-input" id="avgWeight" step="0.1">
                            </div>

                            <div class="form-row">
                                <label class="form-label">สถานที่:</label>
                                <select class="form-select" id="location">
                                    <option value="">เลือกสถานที่</option>
                                    <option value="pen1">คอกที่ 1</option>
                                    <option value="pen2">คอกที่ 2</option>
                                    <option value="pen3">คอกที่ 3</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label class="form-label">หมายเหตุ:</label>
                                <input type="text" class="form-input" id="notes">
                            </div>

                            <div class="form-row">
                                <label class="form-label">สถานะสุขภาพ:</label>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <input type="radio" name="healthStatus" value="healthy" id="healthy" checked>
                                        <label for="healthy">ปกติ</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" name="healthStatus" value="sick" id="sick">
                                        <label for="sick">ป่วย</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" name="healthStatus" value="treatment" id="treatment">
                                        <label for="treatment">รักษา</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" name="healthStatus" value="quarantine" id="quarantine">
                                        <label for="quarantine">กักตัว</label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn success" onclick="saveData()">บันทึก</button>
                                <button type="button" class="btn secondary" onclick="resetForm()">ยกเลิก</button>
                                <button type="button" class="btn" onclick="printForm()">พิมพ์</button>
                                <button type="button" class="btn" onclick="exportData()">ส่งออก</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h3>Quick Actions</h3>
                    <div class="quick-grid">
                        <button class="quick-btn" onclick="focusForm()">เพิ่มสุกร</button>
                        <button class="quick-btn" onclick="showMessage('Treatment record opened')">บันทึกรักษา</button>
                        <button class="quick-btn" onclick="showMessage('Sale record opened')">ขายสุกร</button>
                        <button class="quick-btn" onclick="generateReport()">สร้างรายงาน</button>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="activities">
                    <h3>Recent Activities</h3>
                    <div class="activity-item">ระบบเริ่มต้นใช้งาน</div>
                    <div class="activity-item">รอการป้อนข้อมูลครั้งแรก</div>
                </div>
            </div>
        </div>

        <!-- Mobile Bottom Navigation -->
        <div class="bottom-nav">
            <div class="bottom-nav-item active" onclick="('dashboard')">
                <div>⌂</div>
                <div>หน้าหลัก</div>
            </div>
            <div class="bottom-nav-item" onclick="('livestock')">
                <div>🐷</div>
                <div>สุกร</div>
            </div>
            <div class="bottom-nav-item" onclick="('finance')">
                <div>💰</div>
                <div>การเงิน</div>
            </div>
            <div class="bottom-nav-item" onclick="('reports')">
                <div>📊</div>
                <div>รายงาน</div>
            </div>
        </div>
    </div>

    <script>
        // Farm data structure - Reset to 0
        let farmData = {
            breedingSows: 0,
            piglets: 0,
            finishers: 0,
            pregnant: 0,
            sick: 0,
            readyToSell: 0,
            revenue: 0,
            expenses: 0,
            totalPigs: 0,
            records: []
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            
            // Load data from GitHub (simulated)
            loadDataFromGitHub();
            
            // Update KPIs
            updateKPIs();
            
            // Auto-save every 30 seconds
            setInterval(autoSave, 30000);

            // Register service worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:text/javascript,console.log("SW registered")');
            }
        });
        
            // Tab switching
       function switchTab(tabName) {
           // Update tab appearance
           document.querySelectorAll('.nav-tab').forEach(tab => {
               tab.classList.remove('active');
           });
           document.querySelectorAll('.bottom-nav-item').forEach(item => {
               item.classList.remove('active');
           });
           
           // Add active class to clicked tab
           event.target.classList.add('active');
           
           // Show different content based on tab
           switch(tabName) {
               case 'dashboard':
                   showMessage('Dashboard view active');
                   break;
               case 'livestock':
                   showMessage('Livestock management view');
                   focusForm();
                   break;
               case 'finance':
                   showMessage('Finance management view');
                   break;
               case 'reports':
                   generateReport();
                   break;
           }
       }

       // Focus on form for data entry
       function focusForm() {
           document.getElementById('pigType').focus();
           showMessage('Ready to add new pig data');
       }

       // Save data function
       function saveData() {
           const form = document.getElementById('pigForm');
           
           // Validate required fields
           if (!form.checkValidity()) {
               showMessage('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน', 'error');
               return;
           }

           // Get form data
           const formData = {
               id: Date.now(),
               pigType: document.getElementById('pigType').value,
               quantity: parseInt(document.getElementById('quantity').value),
               entryDate: document.getElementById('entryDate').value,
               avgWeight: parseFloat(document.getElementById('avgWeight').value) || 0,
               location: document.getElementById('location').value,
               notes: document.getElementById('notes').value,
               healthStatus: document.querySelector('input[name="healthStatus"]:checked').value,
               timestamp: new Date().toISOString()
           };

           // Add to records
           farmData.records.push(formData);

           // Update farm data totals
           updateFarmTotals(formData);

           // Save to GitHub (simulated)
           saveToGitHub();

           // Update KPIs
           updateKPIs();

           // Show success message
           showMessage('บันทึกข้อมูลเรียบร้อยแล้ว', 'success');

           // Reset form
           resetForm();

           // Add to recent activities
           addActivity(`เพิ่ม${getTypeLabel(formData.pigType)} จำนวน ${formData.quantity} ตัว`);
       }

       // Update farm totals based on new data
       function updateFarmTotals(data) {
           switch(data.pigType) {
               case 'breedingSow':
                   farmData.breedingSows += data.quantity;
                   break;
               case 'piglet':
                   farmData.piglets += data.quantity;
                   break;
               case 'finisher':
                   farmData.finishers += data.quantity;
                   break;
           }
           
           farmData.totalPigs = farmData.breedingSows + farmData.piglets + farmData.finishers;
           
           // Update sick count based on health status
           if (data.healthStatus === 'sick' || data.healthStatus === 'treatment') {
               farmData.sick += data.quantity;
           }
       }

       // Get type label in Thai
       function getTypeLabel(type) {
           const labels = {
               'breedingSow': 'แม่พันธุ์',
               'piglet': 'ลูกสุกร',
               'finisher': 'สุกรขุน'
           };
           return labels[type] || type;
       }

       // Update KPI display
       function updateKPIs() {
           document.getElementById('totalLivestock').textContent = farmData.totalPigs;
           document.getElementById('monthlyRevenue').textContent = farmData.revenue.toLocaleString();
           document.getElementById('profitMargin').textContent = farmData.totalPigs > 0 ? 
               ((farmData.revenue - farmData.expenses) / farmData.revenue * 100).toFixed(1) + '%' : '0%';
       }

       // Reset form
       function resetForm() {
           document.getElementById('pigForm').reset();
           document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
           document.querySelector('input[name="healthStatus"][value="healthy"]').checked = true;
           showMessage('Form reset');
       }

       // Show status message
       function showMessage(message, type = 'info') {
           const messageEl = document.getElementById('statusMessage');
           messageEl.textContent = message;
           messageEl.className = `status-message status-${type}`;
           messageEl.classList.remove('hidden');
           
           // Auto hide after 3 seconds
           setTimeout(() => {
               messageEl.classList.add('hidden');
           }, 3000);
       }

       // Add activity to recent activities
       function addActivity(activity) {
           const activitiesEl = document.querySelector('.activities');
           const newActivity = document.createElement('div');
           newActivity.className = 'activity-item';
           newActivity.textContent = `${new Date().toLocaleTimeString()} - ${activity}`;
           
           // Insert as first item
           activitiesEl.insertBefore(newActivity, activitiesEl.children[1]);
           
           // Keep only last 5 activities
           const activities = activitiesEl.querySelectorAll('.activity-item');
           if (activities.length > 6) { // Keep header + 5 items
               activities[activities.length - 1].remove();
           }
       }

       // Print form
       function printForm() {
           window.print();
           showMessage('Print dialog opened');
       }

       // Export data
       function exportData() {
           const data = JSON.stringify(farmData, null, 2);
           const blob = new Blob([data], { type: 'application/json' });
           const url = URL.createObjectURL(blob);
           const a = document.createElement('a');
           a.href = url;
           a.download = `farm-data-${new Date().toISOString().split('T')[0]}.json`;
           a.click();
           URL.revokeObjectURL(url);
           showMessage('Data exported successfully', 'success');
       }

       // Generate report
       function generateReport() {
           const report = {
               totalLivestock: farmData.totalPigs,
               breedingSows: farmData.breedingSows,
               piglets: farmData.piglets,
               finishers: farmData.finishers,
               sickAnimals: farmData.sick,
               healthyPercentage: farmData.totalPigs > 0 ? 
                   ((farmData.totalPigs - farmData.sick) / farmData.totalPigs * 100).toFixed(1) : 100,
               totalRecords: farmData.records.length,
               lastUpdate: new Date().toLocaleString('th-TH')
           };

           const reportText = `
=== รายงานฟาร์มสุกร ===
วันที่: ${report.lastUpdate}

จำนวนสุกรทั้งหมด: ${report.totalLivestock} ตัว
- แม่พันธุ์: ${report.breedingSows} ตัว
- ลูกสุกร: ${report.piglets} ตัว  
- สุกรขุน: ${report.finishers} ตัว

สถานะสุขภาพ:
- สุขภาพดี: ${report.healthyPercentage}%
- ป่วย/รักษา: ${report.sickAnimals} ตัว

จำนวนบันทึกทั้งหมด: ${report.totalRecords} รายการ
           `;

           // Show report in alert for demo
           alert(reportText);
           showMessage('Report generated successfully', 'success');
           addActivity('สร้างรายงานสรุป');
       }

       // Auto-save function
       function autoSave() {
           if (farmData.records.length > 0) {
               saveToGitHub();
               console.log('Auto-saved at', new Date().toLocaleTimeString());
           }
       }

       // Simulated GitHub integration
       function saveToGitHub() {
           // Simulate API call to GitHub
           return new Promise((resolve) => {
               setTimeout(() => {
                   localStorage.setItem('farmData', JSON.stringify(farmData));
                   console.log('Data saved to GitHub (simulated)');
                   resolve();
               }, 500);
           });
       }

       function loadDataFromGitHub() {
           // Simulate loading from GitHub
           try {
               const savedData = localStorage.getItem('farmData');
               if (savedData) {
                   const parsed = JSON.parse(savedData);
                   // Merge with default structure
                   farmData = { ...farmData, ...parsed };
                   console.log('Data loaded from GitHub (simulated)');
               }
           } catch (error) {
               console.error('Error loading data:', error);
               showMessage('Error loading saved data', 'error');
           }
       }

       // Responsive behavior
       function handleResize() {
           const width = window.innerWidth;
           if (width < 768) {
               // Mobile view adjustments
               document.body.classList.add('mobile-view');
           } else if (width < 1200) {
               // Tablet view adjustments
               document.body.classList.add('tablet-view');
           } else {
               // Desktop view
               document.body.classList.add('desktop-view');
           }
       }

       // Initialize responsive behavior
       window.addEventListener('resize', handleResize);
       handleResize();

       // PWA Installation
       let deferredPrompt;
       window.addEventListener('beforeinstallprompt', (e) => {
           e.preventDefault();
           deferredPrompt = e;
           showMessage('App can be installed - look for install option in browser menu');
       });

       // Service Worker for offline functionality
       if ('serviceWorker' in navigator) {
           window.addEventListener('load', () => {
               const swCode = `
                   const CACHE_NAME = 'farm-management-v1';
                   const urlsToCache = ['/'];
                   
                   self.addEventListener('install', (event) => {
                       event.waitUntil(
                           caches.open(CACHE_NAME)
                               .then((cache) => cache.addAll(urlsToCache))
                       );
                   });
                   
                   self.addEventListener('fetch', (event) => {
                       event.respondWith(
                           caches.match(event.request)
                               .then((response) => {
                                   return response || fetch(event.request);
                               })
                       );
                   });
               `;
               
               const blob = new Blob([swCode], { type: 'application/javascript' });
               const swUrl = URL.createObjectURL(blob);
               
               navigator.serviceWorker.register(swUrl)
                   .then(() => console.log('SW registered'))
                   .catch(() => console.log('SW registration failed'));
           });
       }

       // Keyboard shortcuts
       document.addEventListener('keydown', (e) => {
           if (e.ctrlKey) {
               switch(e.key) {
                   case 's':
                       e.preventDefault();
                       saveData();
                       break;
                   case 'n':
                       e.preventDefault();
                       resetForm();
                       break;
                   case 'p':
                       e.preventDefault();
                       printForm();
                       break;
               }
           }
       });

       // Form validation enhancements
       document.getElementById('quantity').addEventListener('input', function() {
           if (this.value < 1) {
               this.setCustomValidity('จำนวนต้องมากกว่า 0');
           } else {
               this.setCustomValidity('');
           }
       });

       document.getElementById('avgWeight').addEventListener('input', function() {
           if (this.value < 0) {
               this.setCustomValidity('น้ำหนักต้องเป็นค่าบวก');
           } else {
               this.setCustomValidity('');
           }
       });

       // Touch gesture support for mobile
       let touchStartX = 0;
       let touchEndX = 0;

       document.addEventListener('touchstart', (e) => {
           touchStartX = e.changedTouches[0].screenX;
       });

       document.addEventListener('touchend', (e) => {
           touchEndX = e.changedTouches[0].screenX;
           handleGesture();
       });

       function handleGesture() {
           const threshold = 100;
           if (touchEndX < touchStartX - threshold) {
               // Swipe left - next tab
               console.log('Swipe left detected');
           }
           if (touchEndX > touchStartX + threshold) {
               // Swipe right - previous tab  
               console.log('Swipe right detected');
           }
       }

       // Network status monitoring
       window.addEventListener('online', () => {
           showMessage('กลับมาออนไลน์แล้ว - ข้อมูลจะถูกซิงค์', 'success');
           saveToGitHub();
       });

       window.addEventListener('offline', () => {
           showMessage('ออฟไลน์ - ข้อมูลจะถูกบันทึกในเครื่อง', 'info');
       });

       // Initialize app state
       console.log('Farm Management System initialized');
       console.log('Current data:', farmData);
   </script>
</body>
</html>
