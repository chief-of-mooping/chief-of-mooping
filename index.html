<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการฟาร์มสุกรมาตรฐานสากล</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Niramit:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Niramit', sans-serif;
            background: linear-gradient(135deg, #1e40af 0%, #059669 100%);
            min-height: 100vh;
            color: #1f2937;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #059669;
            font-size: 1.3rem;
            font-weight: 500;
        }
        
        .nav-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .nav-tab {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 18px 30px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            color: #374151;
        }
        
        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            transform: translateY(-3px);
        }
        
        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            border-left: 6px solid #2563eb;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), transparent);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }
        
        .metric-card h3 {
            font-size: 1.2rem;
            color: #475569;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .metric-value {
            font-size: 3rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 8px;
        }
        
        .metric-unit {
            font-size: 1.1rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .section {
            background: #f8fafc;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
        }
        
        .section h3 {
            font-size: 1.6rem;
            color: #1e40af;
            margin-bottom: 25px;
            font-weight: 600;
            padding-bottom: 15px;
            border-bottom: 3px solid #e2e8f0;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 10px;
        }
        
        .form-group input,
        .form-group select {
            padding: 15px 20px;
            border: 3px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1.1rem;
            font-family: 'Niramit', sans-serif;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
            transform: translateY(-2px);
        }
        
        .btn {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
            margin-top: 20px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(37, 99, 235, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #059669, #047857);
            box-shadow: 0 10px 20px rgba(5, 150, 105, 0.3);
        }
        
        .btn-success:hover {
            box-shadow: 0 15px 30px rgba(5, 150, 105, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            box-shadow: 0 10px 20px rgba(220, 38, 38, 0.3);
        }
        
        .btn-danger:hover {
            box-shadow: 0 15px 30px rgba(220, 38, 38, 0.4);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            margin-top: 25px;
        }
        
        .data-table th {
            background: linear-gradient(135deg, #1e40af, #1d4ed8);
            color: white;
            padding: 20px 18px;
            font-weight: 600;
            font-size: 1.1rem;
            text-align: left;
        }
        
        .data-table td {
            padding: 18px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 1.1rem;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8fafc;
        }
        
        .data-table tr:hover {
            background: #e0f2fe;
            transform: scale(1.001);
            transition: all 0.2s ease;
        }
        
        .alert {
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 6px solid #f59e0b;
        }
        
        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border-left: 6px solid #ef4444;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 6px solid #10b981;
        }
        
        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .status-active {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-sold {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-dead {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .qr-code {
            width: 90px;
            height: 90px;
            background: #f3f4f6;
            border: 3px solid #d1d5db;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 500;
        }
        
        .progress-bar {
            width: 100%;
            height: 15px;
            background: #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #059669, #047857);
            transition: width 0.5s ease;
            border-radius: 8px;
        }
        
        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .chart-container h3 {
            font-size: 1.5rem;
            color: #1e40af;
            margin-bottom: 25px;
            font-weight: 600;
        }
        
        .chart-canvas {
            width: 100%;
            height: 350px;
            border-radius: 15px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .nav-tab {
                flex: 1;
                min-width: 140px;
                text-align: center;
                font-size: 1rem;
                padding: 15px 20px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .metric-value {
                font-size: 2.5rem;
            }
            
            .data-table {
                font-size: 0.9rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ระบบจัดการฟาร์มสุกรมาตรฐานสากล</h1>
            <p>Advanced Pig Farm Management System - Professional Edition</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">แดชบอร์ด</button>
            <button class="nav-tab" onclick="showTab('batches')">จัดการ Batch</button>
            <button class="nav-tab" onclick="showTab('pigs')">ข้อมูลสุกร</button>
            <button class="nav-tab" onclick="showTab('feed')">จัดการอาหาร</button>
            <button class="nav-tab" onclick="showTab('sales')">ขายและกำไร</button>
            <button class="nav-tab" onclick="showTab('breeding')">การผสมพันธุ์</button>
            <button class="nav-tab" onclick="showTab('health')">สุขภาพและวัคซีน</button>
            <button class="nav-tab" onclick="showTab('reports')">รายงาน</button>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="metric-card">
                    <h3>จำนวนสุกรทั้งหมด</h3>
                    <div class="metric-value" id="totalPigs">0</div>
                    <div class="metric-unit">ตัว</div>
                </div>
                <div class="metric-card">
                    <h3>Batch ที่ใช้งาน</h3>
                    <div class="metric-value" id="activeBatches">0</div>
                    <div class="metric-unit">กลุ่ม</div>
                </div>
                <div class="metric-card">
                    <h3>FCR เฉลี่ย</h3>
                    <div class="metric-value" id="avgFCR">0.00</div>
                    <div class="metric-unit">kg อาหาร/kg น้ำหนัก</div>
                </div>
                <div class="metric-card">
                    <h3>ADG เฉลี่ย</h3>
                    <div class="metric-value" id="avgADG">0.00</div>
                    <div class="metric-unit">kg/วัน</div>
                </div>
                <div class="metric-card">
                    <h3>รายได้เดือนนี้</h3>
                    <div class="metric-value" id="monthlyRevenue">0</div>
                    <div class="metric-unit">บาท</div>
                </div>
                <div class="metric-card">
                    <h3>กำไรสุทธิ</h3>
                    <div class="metric-value" id="netProfit">0</div>
                    <div class="metric-unit">บาท</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>แนวโน้ม FCR รายเดือน</h3>
                <canvas id="fcrChart" class="chart-canvas"></canvas>
            </div>
            
            <div class="section">
                <h3>การแจ้งเตือนสำคัญ</h3>
                <div id="alertsContainer">
                    <div class="alert alert-success">
                        ระบบพร้อมใช้งาน - เริ่มต้นการจัดการฟาร์มของคุณ
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Batches Tab -->
        <div id="batches" class="tab-content">
            <div class="section">
                <h3>เพิ่ม Batch ใหม่</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>รหัส Batch</label>
                        <input type="text" id="batchId" placeholder="เช่น BATCH-2024-001">
                    </div>
                    <div class="form-group">
                        <label>วันเกิด</label>
                        <input type="date" id="batchBirthDate">
                    </div>
                    <div class="form-group">
                        <label>จำนวนสุกร</label>
                        <input type="number" id="batchPigCount" placeholder="45">
                    </div>
                    <div class="form-group">
                        <label>ขั้นตอนปัจจุบัน</label>
                        <select id="batchStage">
                            <option value="creep">Creep (0-3 สัปดาห์)</option>
                            <option value="starter">Starter (3-8 สัปดาห์)</option>
                            <option value="grower">Grower (8-16 สัปดาห์)</option>
                            <option value="finisher">Finisher (16-24 สัปดาห์)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>น้ำหนักเฉลี่ย (kg)</label>
                        <input type="number" step="0.1" id="batchWeight" placeholder="28.5">
                    </div>
                    <div class="form-group">
                        <label>น้ำหนักเป้าหมาย (kg)</label>
                        <input type="number" id="batchTargetWeight" placeholder="100">
                    </div>
                </div>
                <button class="btn" onclick="addBatch()">เพิ่ม Batch</button>
            </div>
            
            <div class="section">
                <h3>รายการ Batch ทั้งหมด</h3>
                <table class="data-table" id="batchesTable">
                    <thead>
                        <tr>
                            <th>รหัส Batch</th>
                            <th>วันเกิด</th>
                            <th>อายุ (วัน)</th>
                            <th>จำนวน</th>
                            <th>ขั้นตอน</th>
                            <th>น้ำหนักเฉลี่ย</th>
                            <th>FCR</th>
                            <th>ต้นทุน</th>
                            <th>สถานะ</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="batchesTableBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Pigs Tab -->
        <div id="pigs" class="tab-content">
            <div class="section">
                <h3>ลงทะเบียนสุกรใหม่</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>รหัสสุกร</label>
                        <input type="text" id="pigId" placeholder="PIG-2024-001">
                    </div>
                    <div class="form-group">
                        <label>Batch ที่สังกัด</label>
                        <select id="pigBatchId">
                            <option value="">เลือก Batch</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>หมายเลขติดหู</label>
                        <input type="text" id="pigTagNumber" placeholder="001">
                    </div>
                    <div class="form-group">
                        <label>วันเกิด</label>
                        <input type="date" id="pigBirthDate">
                    </div>
                    <div class="form-group">
                        <label>สายพันธุ์</label>
                        <select id="pigBreed">
                            <option value="LandracexYorkshire">Landrace x Yorkshire</option>
                            <option value="DurocxYorkshire">Duroc x Yorkshire</option>
                            <option value="LandracexDuroc">Landrace x Duroc</option>
                            <option value="PietranxYorkshire">Pietran x Yorkshire</option>
                            <option value="Other">อื่นๆ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>เพศ</label>
                        <select id="pigSex">
                            <option value="male">ผู้</option>
                            <option value="female">เมีย</option>
                            <option value="castrated">ตอนแล้ว</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>น้ำหนักปัจจุบัน (kg)</label>
                        <input type="number" step="0.1" id="pigCurrentWeight" placeholder="28.5">
                    </div>
                    <div class="form-group">
                        <label>รหัสแม่พันธุ์</label>
                        <input type="text" id="pigParentSow" placeholder="SOW-2023-045">
                    </div>
                    <div class="form-group">
                        <label>รหัสพ่อพันธุ์</label>
                        <input type="text" id="pigParentBoar" placeholder="BOAR-2022-003">
                    </div>
                </div>
                <button class="btn" onclick="addPig()">ลงทะเบียนสุกร</button>
            </div>
            
            <div class="section">
                <h3>รายการสุกรทั้งหมด</h3>
                <table class="data-table" id="pigsTable">
                    <thead>
                        <tr>
                            <th>QR Code</th>
                            <th>รหัสสุกร</th>
                            <th>หมายเลขหู</th>
                            <th>Batch</th>
                            <th>อายุ (วัน)</th>
                            <th>สายพันธุ์</th>
                            <th>เพศ</th>
                            <th>น้ำหนักปัจจุบัน</th>
                            <th>ADG</th>
                            <th>สถานะ</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="pigsTableBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Feed Management Tab -->
        <div id="feed" class="tab-content">
            <div class="section">
                <h3>เพิ่มอาหารสุกรใหม่</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>รหัสอาหาร</label>
                        <input type="text" id="feedId" placeholder="FEED-001">
                    </div>
                    <div class="form-group">
                        <label>ประเภทอาหาร</label>
                        <select id="feedType">
                            <option value="creep">Creep Feed</option>
                            <option value="starter">Starter Feed</option>
                            <option value="grower">Grower Feed</option>
                            <option value="finisher">Finisher Feed</option>
                            <option value="sow">Sow Feed</option>
                            <option value="boar">Boar Feed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ยี่ห้อ/ชื่อสินค้า</label>
                        <input type="text" id="feedBrand" placeholder="CP Starter">
                    </div>
                    <div class="form-group">
                        <label>ราคาต่อถุง (บาท)</label>
                        <input type="number" id="feedPrice" placeholder="650">
                    </div>
                    <div class="form-group">
                        <label>น้ำหนักต่อถุง (kg)</label>
                        <input type="number" id="feedWeight" placeholder="20">
                    </div>
                    <div class="form-group">
                        <label>โปรตีน (%)</label>
                        <input type="number" step="0.1" id="feedProtein" placeholder="18.5">
                    </div>
                </div>
                <button class="btn" onclick="addFeed()">เพิ่มอาหาร</button>
            </div>
            
            <div class="section">
                <h3>บันทึกการให้อาหาร</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Batch ที่ให้อาหาร</label>
                        <select id="feedingBatchId">
                            <option value="">เลือก Batch</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ประเภทอาหาร</label>
                        <select id="feedingFeedId">
                            <option value="">เลือกอาหาร</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ปริมาณ (kg)</label>
                        <input type="number" step="0.1" id="feedingAmount" placeholder="50.0">
                    </div>
                    <div class="form-group">
                        <label>วันที่ให้อาหาร</label>
                        <input type="date" id="feedingDate">
                    </div>
                </div>
                <button class="btn btn-success" onclick="recordFeeding()">บันทึกการให้อาหาร</button>
            </div>
            
            <div class="section">
                <h3>สต็อกอาหารคงเหลือ</h3>
                <table class="data-table" id="feedTable">
                    <thead>
                        <tr>
                            <th>รหัส</th>
                            <th>ประเภท</th>
                            <th>ยี่ห้อ</th>
                            <th>ราคา/ถุง</th>
                            <th>ราคา/kg</th>
                            <th>โปรตีน</th>
                            <th>สต็อกคงเหลือ</th>
                            <th>สถานะ</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="feedTableBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Sales Tab -->
        <div id="sales" class="tab-content">
            <div class="section">
                <h3>บันทึกการขาย</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>รหัสการขาย</label>
                        <input type="text" id="saleId" placeholder="SALE-001">
                    </div>
                    <div class="form-group">
                        <label>วันที่ขาย</label>
                        <input type="date" id="saleDate">
                    </div>
                    <div class="form-group">
                        <label>Batch ที่ขาย</label>
                        <select id="saleBatchId">
                            <option value="">เลือก Batch</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>จำนวนสุกรที่ขาย</label>
                        <input type="number" id="salePigCount" placeholder="2">
                    </div>
                    <div class="form-group">
                        <label>น้ำหนักรวม (kg)</label>
                        <input type="number" step="0.1" id="saleTotalWeight" placeholder="185.5">
                    </div>
                    <div class="form-group">
                        <label>ราคาต่อกิโลกรัม (บาท)</label>
                        <input type="number" step="0.1" id="salePricePerKg" placeholder="85">
                    </div>
                </div>
                <button class="btn btn-success" onclick="recordSale()">บันทึกการขาย</button>
            </div>
            
            <div class="section">
                <h3>สรุปการขายและกำไร</h3
<div class="dashboard-grid">
                   <div class="metric-card">
                       <h3>ยอดขายรวม</h3>
                       <div class="metric-value" id="totalSalesRevenue">0</div>
                       <div class="metric-unit">บาท</div>
                   </div>
                   <div class="metric-card">
                       <h3>ต้นทุนรวม</h3>
                       <div class="metric-value" id="totalSalesCost">0</div>
                       <div class="metric-unit">บาท</div>
                   </div>
                   <div class="metric-card">
                       <h3>กำไรสุทธิ</h3>
                       <div class="metric-value" id="totalSalesProfit">0</div>
                       <div class="metric-unit">บาท</div>
                   </div>
                   <div class="metric-card">
                       <h3>ROI</h3>
                       <div class="metric-value" id="totalROI">0.00</div>
                       <div class="metric-unit">%</div>
                   </div>
               </div>
               
               <table class="data-table" id="salesTable">
                   <thead>
                       <tr>
                           <th>รหัสการขาย</th>
                           <th>วันที่</th>
                           <th>Batch</th>
                           <th>จำนวน</th>
                           <th>น้ำหนักรวม</th>
                           <th>ราคา/kg</th>
                           <th>รายได้</th>
                           <th>กำไร</th>
                           <th>กำไรต่อตัว</th>
                       </tr>
                   </thead>
                   <tbody id="salesTableBody">
                   </tbody>
               </table>
           </div>
       </div>
       
       <!-- Breeding Tab -->
       <div id="breeding" class="tab-content">
           <div class="section">
               <h3>บันทึกการผสมพันธุ์</h3>
               <div class="form-grid">
                   <div class="form-group">
                       <label>รหัสการผสม</label>
                       <input type="text" id="breedingId" placeholder="BREED-001">
                   </div>
                   <div class="form-group">
                       <label>รหัสแม่พันธุ์</label>
                       <input type="text" id="breedingSowId" placeholder="SOW-2023-045">
                   </div>
                   <div class="form-group">
                       <label>รหัสพ่อพันธุ์</label>
                       <input type="text" id="breedingBoarId" placeholder="BOAR-2022-003">
                   </div>
                   <div class="form-group">
                       <label>วันที่ผสม</label>
                       <input type="date" id="breedingDate" onchange="calculateFarrowDate()">
                   </div>
                   <div class="form-group">
                       <label>วันที่คาดว่าจะคลอด</label>
                       <input type="date" id="expectedFarrowDate" readonly>
                   </div>
                   <div class="form-group">
                       <label>วิธีการผสม</label>
                       <select id="breedingMethod">
                           <option value="natural">ผสมธรรมชาติ</option>
                           <option value="ai">ผสมเทียม (AI)</option>
                       </select>
                   </div>
               </div>
               <button class="btn" onclick="recordBreeding()">บันทึกการผสม</button>
           </div>
           
           <div class="section">
               <h3>ประวัติการผสมและคลอด</h3>
               <table class="data-table" id="breedingTable">
                   <thead>
                       <tr>
                           <th>รหัสการผสม</th>
                           <th>แม่พันธุ์</th>
                           <th>พ่อพันธุ์</th>
                           <th>วันที่ผสม</th>
                           <th>คาดว่าจะคลอด</th>
                           <th>วิธีการ</th>
                           <th>สถานะ</th>
                           <th>จัดการ</th>
                       </tr>
                   </thead>
                   <tbody id="breedingTableBody">
                   </tbody>
               </table>
           </div>
       </div>
       
       <!-- Health Tab -->
       <div id="health" class="tab-content">
           <div class="section">
               <h3>บันทึกการฉีดวัคซีน</h3>
               <div class="form-grid">
                   <div class="form-group">
                       <label>สุกรที่ฉีดวัคซีน</label>
                       <select id="vaccinePigId">
                           <option value="">เลือกสุกร</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label>ชื่อวัคซีน</label>
                       <input type="text" id="vaccineName" placeholder="Classical Swine Fever">
                   </div>
                   <div class="form-group">
                       <label>วันที่ฉีด</label>
                       <input type="date" id="vaccineDate">
                   </div>
                   <div class="form-group">
                       <label>วันที่ฉีดครั้งต่อไป</label>
                       <input type="date" id="vaccineNextDate">
                   </div>
                   <div class="form-group">
                       <label>ผู้ฉีด</label>
                       <input type="text" id="vaccineGivenBy" placeholder="สัตวแพทย์">
                   </div>
                   <div class="form-group">
                       <label>หมายเหตุ</label>
                       <input type="text" id="vaccineNotes" placeholder="ปกติดี">
                   </div>
               </div>
               <button class="btn" onclick="recordVaccination()">บันทึกวัคซีน</button>
           </div>
           
           <div class="section">
               <h3>ประวัติการฉีดวัคซีน</h3>
               <table class="data-table" id="healthTable">
                   <thead>
                       <tr>
                           <th>รหัสสุกร</th>
                           <th>ชื่อวัคซีน</th>
                           <th>วันที่ฉีด</th>
                           <th>ครั้งต่อไป</th>
                           <th>ผู้ฉีด</th>
                           <th>หมายเหตุ</th>
                           <th>สถานะ</th>
                       </tr>
                   </thead>
                   <tbody id="healthTableBody">
                   </tbody>
               </table>
           </div>
       </div>
       
       <!-- Reports Tab -->
       <div id="reports" class="tab-content">
           <div class="section">
               <h3>รายงานประสิทธิภาพ FCR</h3>
               <div class="dashboard-grid">
                   <div class="metric-card">
                       <h3>FCR เป้าหมาย Starter</h3>
                       <div class="metric-value">1.50</div>
                       <div class="metric-unit">มาตรฐาน</div>
                   </div>
                   <div class="metric-card">
                       <h3>FCR เป้าหมาย Grower</h3>
                       <div class="metric-value">2.20</div>
                       <div class="metric-unit">มาตรฐาน</div>
                   </div>
                   <div class="metric-card">
                       <h3>FCR เป้าหมาย Finisher</h3>
                       <div class="metric-value">2.80</div>
                       <div class="metric-unit">มาตรฐาน</div>
                   </div>
                   <div class="metric-card">
                       <h3>FCR เฉลี่ยฟาร์ม</h3>
                       <div class="metric-value" id="reportAvgFCR">0.00</div>
                       <div class="metric-unit">ปัจจุบัน</div>
                   </div>
               </div>
           </div>
           
           <div class="section">
               <h3>รายงานการเงิน</h3>
               <div class="dashboard-grid">
                   <div class="metric-card">
                       <h3>รายได้รวม</h3>
                       <div class="metric-value" id="reportTotalRevenue">0</div>
                       <div class="metric-unit">บาท</div>
                   </div>
                   <div class="metric-card">
                       <h3>ต้นทุนรวม</h3>
                       <div class="metric-value" id="reportTotalCost">0</div>
                       <div class="metric-unit">บาท</div>
                   </div>
                   <div class="metric-card">
                       <h3>กำไรสุทธิ</h3>
                       <div class="metric-value" id="reportNetProfit">0</div>
                       <div class="metric-unit">บาท</div>
                   </div>
                   <div class="metric-card">
                       <h3>Profit Margin</h3>
                       <div class="metric-value" id="reportProfitMargin">0.00</div>
                       <div class="metric-unit">%</div>
                   </div>
               </div>
           </div>
           
           <div class="section">
               <h3>รายงานการผลิต</h3>
               <table class="data-table" id="productionReportTable">
                   <thead>
                       <tr>
                           <th>Batch</th>
                           <th>จำนวนเริ่มต้น</th>
                           <th>จำนวนขาย</th>
                           <th>Mortality Rate</th>
                           <th>FCR เฉลี่ย</th>
                           <th>ADG เฉลี่ย</th>
                           <th>ต้นทุนต่อตัว</th>
                           <th>กำไรต่อตัว</th>
                       </tr>
                   </thead>
                   <tbody id="productionReportBody">
                   </tbody>
               </table>
           </div>
       </div>
   </div>

   <script>
       // Global Data Storage
       let farmData = {
           version: "4.0.0",
           farmProfile: {
               name: "ฟาร์มสุกรตัวอย่าง",
               location: "จังหวัดเชียงราย",
               establishedDate: "2024-01-01",
               farmSize: "medium",
               capacity: 500
           },
           batches: [],
           pigs: [],
           feeds: [],
           sales: [],
           breeding: [],
           health: [],
           feeding: []
       };

       // Initialize the application
       document.addEventListener('DOMContentLoaded', function() {
           loadData();
           updateDashboard();
           updateAllDropdowns();
           setDefaultDates();
       });

       // Tab Management
       function showTab(tabName) {
           // Hide all tab contents
           const tabs = document.querySelectorAll('.tab-content');
           tabs.forEach(tab => tab.classList.remove('active'));
           
           // Remove active class from all nav tabs
           const navTabs = document.querySelectorAll('.nav-tab');
           navTabs.forEach(tab => tab.classList.remove('active'));
           
           // Show selected tab
           document.getElementById(tabName).classList.add('active');
           
           // Add active class to clicked nav tab
           event.target.classList.add('active');
           
           // Update dropdowns and displays
           updateAllDropdowns();
           updateDashboard();
       }

       // Data Management Functions
       function saveData() {
           localStorage.setItem('pigFarmData', JSON.stringify(farmData));
       }

       function loadData() {
           const saved = localStorage.getItem('pigFarmData');
           if (saved) {
               farmData = JSON.parse(saved);
           }
       }

       function exportData() {
           const dataStr = JSON.stringify(farmData, null, 2);
           const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
           
           const exportFileDefaultName = `farm-data-${new Date().toISOString().split('T')[0]}.json`;
           
           const linkElement = document.createElement('a');
           linkElement.setAttribute('href', dataUri);
           linkElement.setAttribute('download', exportFileDefaultName);
           linkElement.click();
       }

       function importData(event) {
           const file = event.target.files[0];
           if (file) {
               const reader = new FileReader();
               reader.onload = function(e) {
                   try {
                       farmData = JSON.parse(e.target.result);
                       saveData();
                       updateDashboard();
                       updateAllDropdowns();
                       alert('นำเข้าข้อมูลสำเร็จ!');
                   } catch (error) {
                       alert('ไฟล์ข้อมูลไม่ถูกต้อง!');
                   }
               };
               reader.readAsText(file);
           }
       }

       // Batch Management
       function addBatch() {
           const batchId = document.getElementById('batchId').value;
           const birthDate = document.getElementById('batchBirthDate').value;
           const pigCount = parseInt(document.getElementById('batchPigCount').value);
           const stage = document.getElementById('batchStage').value;
           const weight = parseFloat(document.getElementById('batchWeight').value);
           const targetWeight = parseFloat(document.getElementById('batchTargetWeight').value);

           if (!batchId || !birthDate || !pigCount || !stage || !weight) {
               alert('กรุณากรอกข้อมูลให้ครบถ้วน');
               return;
           }

           const batch = {
               batchId: batchId,
               birthDate: birthDate,
               currentStage: stage,
               pigCount: pigCount,
               averageWeight: weight,
               targetWeight: targetWeight || 100,
               feedAllocated: 0,
               feedConsumed: 0,
               fcrTarget: getTargetFCR(stage),
               fcrActual: 0,
               costToDate: 0,
               estimatedSaleDate: calculateSaleDate(birthDate),
               status: 'active'
           };

           farmData.batches.push(batch);
           saveData();
           updateBatchesTable();
           updateAllDropdowns();
           clearBatchForm();
           alert('เพิ่ม Batch สำเร็จ!');
       }

       function getTargetFCR(stage) {
           const targets = {
               'creep': 1.2,
               'starter': 1.5,
               'grower': 2.2,
               'finisher': 2.8
           };
           return targets[stage] || 2.5;
       }

       function calculateSaleDate(birthDate) {
           const birth = new Date(birthDate);
           birth.setDate(birth.getDate() + 168); // 24 weeks
           return birth.toISOString().split('T')[0];
       }

       function updateBatchesTable() {
           const tbody = document.getElementById('batchesTableBody');
           tbody.innerHTML = '';

           farmData.batches.forEach(batch => {
               const age = calculateAge(batch.birthDate);
               const row = document.createElement('tr');
               row.innerHTML = `
                   <td>${batch.batchId}</td>
                   <td>${formatDate(batch.birthDate)}</td>
                   <td>${age}</td>
                   <td>${batch.pigCount}</td>
                   <td>${getStageText(batch.currentStage)}</td>
                   <td>${batch.averageWeight.toFixed(1)} kg</td>
                   <td>${batch.fcrActual.toFixed(2)}</td>
                   <td>${formatCurrency(batch.costToDate)}</td>
                   <td><span class="status-badge status-${batch.status}">${getStatusText(batch.status)}</span></td>
                   <td>
                       <button class="btn btn-danger" onclick="deleteBatch('${batch.batchId}')">ลบ</button>
                   </td>
               `;
               tbody.appendChild(row);
           });
       }

       function deleteBatch(batchId) {
           if (confirm('คุณต้องการลบ Batch นี้หรือไม่?')) {
               farmData.batches = farmData.batches.filter(b => b.batchId !== batchId);
               saveData();
               updateBatchesTable();
               updateAllDropdowns();
           }
       }

       function clearBatchForm() {
           document.getElementById('batchId').value = '';
           document.getElementById('batchBirthDate').value = '';
           document.getElementById('batchPigCount').value = '';
           document.getElementById('batchWeight').value = '';
           document.getElementById('batchTargetWeight').value = '';
       }

       // Pig Management
       function addPig() {
           const pigId = document.getElementById('pigId').value;
           const batchId = document.getElementById('pigBatchId').value;
           const tagNumber = document.getElementById('pigTagNumber').value;
           const birthDate = document.getElementById('pigBirthDate').value;
           const breed = document.getElementById('pigBreed').value;
           const sex = document.getElementById('pigSex').value;
           const currentWeight = parseFloat(document.getElementById('pigCurrentWeight').value);
           const parentSow = document.getElementById('pigParentSow').value;
           const parentBoar = document.getElementById('pigParentBoar').value;

           if (!pigId || !batchId || !tagNumber || !birthDate || !currentWeight) {
               alert('กรุณากรอกข้อมูลให้ครบถ้วน');
               return;
           }

           const pig = {
               pigId: pigId,
               batchId: batchId,
               tagNumber: tagNumber,
               birthDate: birthDate,
               breed: breed,
               sex: sex,
               parentSowId: parentSow,
               parentBoarId: parentBoar,
               currentWeight: currentWeight,
               currentStage: getCurrentStageByAge(birthDate),
               weightHistory: [{date: new Date().toISOString().split('T')[0], weight: currentWeight}],
               feedHistory: [],
               healthRecords: [],
               status: 'active'
           };

           farmData.pigs.push(pig);
           saveData();
           updatePigsTable();
           updateAllDropdowns();
           clearPigForm();
           alert('ลงทะเบียนสุกรสำเร็จ!');
       }

       function getCurrentStageByAge(birthDate) {
           const age = calculateAge(birthDate);
           if (age <= 21) return 'creep';
           if (age <= 56) return 'starter';
           if (age <= 112) return 'grower';
           return 'finisher';
       }

       function updatePigsTable() {
           const tbody = document.getElementById('pigsTableBody');
           tbody.innerHTML = '';

           farmData.pigs.forEach(pig => {
               const age = calculateAge(pig.birthDate);
               const adg = calculateADG(pig);
               const row = document.createElement('tr');
               row.innerHTML = `
                   <td><div class="qr-code">QR-${pig.tagNumber}</div></td>
                   <td>${pig.pigId}</td>
                   <td>${pig.tagNumber}</td>
                   <td>${pig.batchId}</td>
                   <td>${age}</td>
                   <td>${pig.breed}</td>
                   <td>${getSexText(pig.sex)}</td>
                   <td>${pig.currentWeight.toFixed(1)} kg</td>
                   <td>${adg.toFixed(2)} kg/วัน</td>
                   <td><span class="status-badge status-${pig.status}">${getStatusText(pig.status)}</span></td>
                   <td>
                       <button class="btn btn-danger" onclick="deletePig('${pig.pigId}')">ลบ</button>
                   </td>
               `;
               tbody.appendChild(row);
           });
       }

       function calculateADG(pig) {
           if (pig.weightHistory.length < 2) return 0;
           const firstRecord = pig.weightHistory[0];
           const lastRecord = pig.weightHistory[pig.weightHistory.length - 1];
           const weightGain = lastRecord.weight - firstRecord.weight;
           const daysDiff = (new Date(lastRecord.date) - new Date(firstRecord.date)) / (1000 * 60 * 60 * 24);
           return daysDiff > 0 ? weightGain / daysDiff : 0;
       }

       function deletePig(pigId) {
           if (confirm('คุณต้องการลบสุกรนี้หรือไม่?')) {
               farmData.pigs = farmData.pigs.filter(p => p.pigId !== pigId);
               saveData();
               updatePigsTable();
               updateAllDropdowns();
           }
       }

       function clearPigForm() {
           document.getElementById('pigId').value = '';
           document.getElementById('pigBatchId').value = '';
           document.getElementById('pigTagNumber').value = '';
           document.getElementById('pigBirthDate').value = '';
           document.getElementById('pigCurrentWeight').value = '';
           document.getElementById('pigParentSow').value = '';
           document.getElementById('pigParentBoar').value = '';
       }

       // Feed Management
       function addFeed() {
           const feedId = document.getElementById('feedId').value;
           const type = document.getElementById('feedType').value;
           const brand = document.getElementById('feedBrand').value;
           const price = parseFloat(document.getElementById('feedPrice').value);
           const weight = parseFloat(document.getElementById('feedWeight').value);
           const protein = parseFloat(document.getElementById('feedProtein').value);

           if (!feedId || !type || !brand || !price || !weight) {
               alert('กรุณากรอกข้อมูลให้ครบถ้วน');
               return;
           }

           const feed = {
               feedId: feedId,
               type: type,
               brand: brand,
               pricePerBag: price,
               weightPerBag: weight,
               protein: protein || 0,
               energy: 3200,
               currentStock: 0,
               minStock: 10,
               expiryDate: "2024-12-31"
           };

           farmData.feeds.push(feed);
           saveData();
           updateFeedTable();
           updateAllDropdowns();
           clearFeedForm();
           alert('เพิ่มอาหารสำเร็จ!');
       }

       function updateFeedTable() {
           const tbody = document.getElementById('feedTableBody');
           tbody.innerHTML = '';

           farmData.feeds.forEach(feed => {
               const pricePerKg = feed.pricePerBag / feed.weightPerBag;
               const stockStatus = feed.currentStock <= feed.minStock ? 'ต่ำ' : 'ปกติ';
               const statusClass = feed.currentStock <= feed.minStock ? 'status-dead' : 'status-active';
               
               const row = document.createElement('tr');
               row.innerHTML = `
                   <td>${feed.feedId}</td>
                   <td>${getFeedTypeText(feed.type)}</td>
                   <td>${feed.brand}</td>
                   <td>${formatCurrency(feed.pricePerBag)}</td>
                   <td>${formatCurrency(pricePerKg)}</td>
                   <td>${feed.protein}%</td>
                   <td>${feed.currentStock} ถุง</td>
                   <td><span class="status-badge ${statusClass}">${stockStatus}</span></td>
                   <td>
                       <button class="btn btn-danger" onclick="deleteFeed('${feed.feedId}')">ลบ</button>
                   </td>
               `;
               tbody.appendChild(row);
           });
       }

       function recordFeeding() {
           const batchId = document.getElementById('feedingBatchId').value;
           const feedId = document.getElementById('feedingFeedId').value;
           const amount = parseFloat(document.getElementById('feedingAmount').value);
           const date = document.getElementById('feedingDate').value;

           if (!batchId || !feedId || !amount || !date) {
               alert('กรุณากรอกข้อมูลให้ครบถ้วน');
               return;
           }

           const feeding = {
               id: Date.now().toString(),
               batchId: batchId,
               feedId: feedId,
               amount: amount,
               date: date,
               cost: calculateFeedingCost(feedId, amount)
           };

           farmData.feeding.push(feeding);
           updateBatchFeedConsumption(batchId, amount);
           saveData();
           clearFeedingForm();
           alert('บันทึกการให้อาหารสำเร็จ!');
       }

       function calculateFeedingCost(feedId, amount) {
           const feed = farmData.feeds.find(f => f.feedId === feedId);
           if (feed) {
               const pricePerKg = feed.pricePerBag / feed.weightPerBag;
               return amount * pricePerKg;
           }
           return 0;
       }

       function updateBatchFeedConsumption(batchId, amount) {
           const batch = farmData.batches.find(b => b.batchId === batchId);
           if (batch) {
               batch.feedConsumed += amount;
               batch.fcrActual = batch.feedConsumed / (batch.averageWeight * batch.pigCount);
               batch.costToDate += calculateFeedingCost(document.getElementById('feedingFeedId').value, amount);
           }
       }

       function clearFeedingForm() {
           document.getElementById('feedingBatchId').value = '';
           document.getElementById('feedingFeedId').value = '';
           document.getElementById('feedingAmount').value = '';
           document.getElementById('feedingDate').value = '';
       }

       function clearFeedForm() {
           document.getElementById('feedId').value = '';
           document.getElementById('feedBrand').value = '';
           document.getElementById('feedPrice').value = '';
           document.getElementById('feedWeight').value = '';
           document.getElementById('feedProtein').value = '';
       }

       // Sales Management
       function recordSale() {
           const saleId = document.getElementById('saleId').value;
           const date = document.getElementById('saleDate').value;
           const batchId = document.getElementById('saleBatchId').value;
           const pigCount = parseInt(document.getElementById('salePigCount').value);
           const totalWeight = parseFloat(document.getElementById('saleTotalWeight').value);
           const pricePerKg = parseFloat(document.getElementById('salePricePerKg').value);

           if (!saleId || !date || !batchId || !pigCount || !totalWeight || !pricePerKg) {
               alert('กรุณากรอกข้อมูลให้ครบถ้วน');
               return;
           }

           const totalRevenue = totalWeight * pricePerKg;
           const totalCost = calculateBatchCost(batchId, pigCount);
           const profit = totalRevenue - totalCost;

           const sale = {
               saleId: saleId,
               date: date,
               batchId: batchId,
               pigIds: [],
               totalPigs: pigCount,
               totalWeight: totalWeight,
               pricePerKg: pricePerKg,
               transportCost: 0,
               totalRevenue: totalRevenue,
               netRevenue: totalRevenue,
               totalCost: totalCost,
               profit: profit,
               buyer: "ไม่ระบุ"
           };

           farmData.sales.push(sale);
           updateBatchAfterSale(batchId, pigCount);
           saveData();
           updateSalesTable();
           updateDashboard();
           clearSaleForm();
           alert('บันทึกการขายสำเร็จ!');
       }

       function calculateBatchCost(batchId, pigCount) {
           const batch = farmData.batches.find(b => b.batchId === batchId);
           if (batch) {
               const costPerPig = batch.costToDate / batch.pigCount;
               return costPerPig * pigCount;
           }
           return 0;
       }

       function updateBatchAfterSale(batchId, soldPigs) {
           const batch = farmData.batches.find(b => b.batchId === batchId);
           if (batch) {
               batch.pigCount -= soldPigs;
               if (batch.pigCount <= 0) {
                   batch.status = 'sold';
               }
           }
       }

       function updateSalesTable() {
           const tbody = document.getElementById('salesTableBody');
           tbody.innerHTML = '';

           farmData.sales.forEach(sale => {
               const profitPerPig = sale.profit / sale.totalPigs;
               const row = document.createElement('tr');
               row.innerHTML = `
                   <td>${sale.saleId}</td>
                   <td>${formatDate(sale.date)}</td>
                   <td>${sale.batchId}</td>
                   <td>${sale.totalPigs}</td>
                   <td>${sale.totalWeight.toFixed(1)} kg</td>
                   <td>${formatCurrency(sale.pricePerKg)}</td>
                   <td>${formatCurrency(sale.totalRevenue)}</td>
                   <td>${formatCurrency(sale.profit)}</td>
                   <td>${formatCurrency(profitPerPig)}</td>
               `;
tbody.appendChild(row);
           });
       }

       function clearSaleForm() {
           document.getElementById('saleId').value = '';
           document.getElementById('saleDate').value = '';
           document.getElementById('saleBatchId').value = '';
           document.getElementById('salePigCount').value = '';
           document.getElementById('saleTotalWeight').value = '';
           document.getElementById('salePricePerKg').value = '';
       }

       // Breeding Management
       function calculateFarrowDate() {
           const breedingDate = document.getElementById('breedingDate').value;
           if (breedingDate) {
               const date = new Date(breedingDate);
               date.setDate(date.getDate() + 114); // 114 days gestation
               document.getElementById('expectedFarrowDate').value = date.toISOString().split('T')[0];
           }
       }

       function recordBreeding() {
           const breedingId = document.getElementById('breedingId').value;
           const sowId = document.getElementById('breedingSowId').value;
           const boarId = document.getElementById('breedingBoarId').value;
           const date = document.getElementById('breedingDate').value;
           const expectedFarrow = document.getElementById('expectedFarrowDate').value;
           const method = document.getElementById('breedingMethod').value;

           if (!breedingId || !sowId || !boarId || !date) {
               alert('กรุณากรอกข้อมูลให้ครบถ้วน');
               return;
           }

           const breeding = {
               breedingId: breedingId,
               sowId: sowId,
               boarId: boarId,
               breedingDate: date,
               expectedFarrowDate: expectedFarrow,
               method: method,
               status: 'bred',
               actualFarrowDate: null,
               totalBorn: 0,
               totalAlive: 0,
               avgBirthWeight: 0
           };

           farmData.breeding.push(breeding);
           saveData();
           updateBreedingTable();
           clearBreedingForm();
           alert('บันทึกการผสมสำเร็จ!');
       }

       function updateBreedingTable() {
           const tbody = document.getElementById('breedingTableBody');
           tbody.innerHTML = '';

           farmData.breeding.forEach(breeding => {
               const row = document.createElement('tr');
               row.innerHTML = `
                   <td>${breeding.breedingId}</td>
                   <td>${breeding.sowId}</td>
                   <td>${breeding.boarId}</td>
                   <td>${formatDate(breeding.breedingDate)}</td>
                   <td>${formatDate(breeding.expectedFarrowDate)}</td>
                   <td>${getBreedingMethodText(breeding.method)}</td>
                   <td><span class="status-badge status-${breeding.status}">${getBreedingStatusText(breeding.status)}</span></td>
                   <td>
                       <button class="btn btn-danger" onclick="deleteBreeding('${breeding.breedingId}')">ลบ</button>
                   </td>
               `;
               tbody.appendChild(row);
           });
       }

       function clearBreedingForm() {
           document.getElementById('breedingId').value = '';
           document.getElementById('breedingSowId').value = '';
           document.getElementById('breedingBoarId').value = '';
           document.getElementById('breedingDate').value = '';
           document.getElementById('expectedFarrowDate').value = '';
       }

       function deleteBreeding(breedingId) {
           if (confirm('คุณต้องการลบข้อมูลการผสมนี้หรือไม่?')) {
               farmData.breeding = farmData.breeding.filter(b => b.breedingId !== breedingId);
               saveData();
               updateBreedingTable();
           }
       }

       // Health Management
       function recordVaccination() {
           const pigId = document.getElementById('vaccinePigId').value;
           const vaccineName = document.getElementById('vaccineName').value;
           const date = document.getElementById('vaccineDate').value;
           const nextDate = document.getElementById('vaccineNextDate').value;
           const givenBy = document.getElementById('vaccineGivenBy').value;
           const notes = document.getElementById('vaccineNotes').value;

           if (!pigId || !vaccineName || !date) {
               alert('กรุณากรอกข้อมูลให้ครบถ้วน');
               return;
           }

           const vaccination = {
               id: Date.now().toString(),
               pigId: pigId,
               vaccineName: vaccineName,
               date: date,
               nextDate: nextDate,
               givenBy: givenBy,
               notes: notes,
               status: 'completed'
           };

           farmData.health.push(vaccination);
           saveData();
           updateHealthTable();
           clearVaccineForm();
           alert('บันทึกการฉีดวัคซีนสำเร็จ!');
       }

       function updateHealthTable() {
           const tbody = document.getElementById('healthTableBody');
           tbody.innerHTML = '';

           farmData.health.forEach(record => {
               const status = isVaccineDue(record.nextDate) ? 'ครบกำหนด' : 'ปกติ';
               const statusClass = isVaccineDue(record.nextDate) ? 'status-dead' : 'status-active';
               
               const row = document.createElement('tr');
               row.innerHTML = `
                   <td>${record.pigId}</td>
                   <td>${record.vaccineName}</td>
                   <td>${formatDate(record.date)}</td>
                   <td>${record.nextDate ? formatDate(record.nextDate) : '-'}</td>
                   <td>${record.givenBy}</td>
                   <td>${record.notes}</td>
                   <td><span class="status-badge ${statusClass}">${status}</span></td>
               `;
               tbody.appendChild(row);
           });
       }

       function isVaccineDue(nextDate) {
           if (!nextDate) return false;
           const today = new Date();
           const dueDate = new Date(nextDate);
           return dueDate <= today;
       }

       function clearVaccineForm() {
           document.getElementById('vaccinePigId').value = '';
           document.getElementById('vaccineName').value = '';
           document.getElementById('vaccineDate').value = '';
           document.getElementById('vaccineNextDate').value = '';
           document.getElementById('vaccineGivenBy').value = '';
           document.getElementById('vaccineNotes').value = '';
       }

       // Dashboard Updates
       function updateDashboard() {
           updateMetrics();
           updateAlerts();
           updateSalesMetrics();
           updateReports();
           drawFCRChart();
       }

       function updateMetrics() {
           const totalPigs = farmData.pigs.filter(p => p.status === 'active').length;
           const activeBatches = farmData.batches.filter(b => b.status === 'active').length;
           const avgFCR = calculateAverageFCR();
           const avgADG = calculateAverageADG();
           const monthlyRevenue = calculateMonthlyRevenue();
           const netProfit = calculateNetProfit();

           document.getElementById('totalPigs').textContent = totalPigs;
           document.getElementById('activeBatches').textContent = activeBatches;
           document.getElementById('avgFCR').textContent = avgFCR.toFixed(2);
           document.getElementById('avgADG').textContent = avgADG.toFixed(2);
           document.getElementById('monthlyRevenue').textContent = formatNumber(monthlyRevenue);
           document.getElementById('netProfit').textContent = formatNumber(netProfit);
       }

       function calculateAverageFCR() {
           const activeBatches = farmData.batches.filter(b => b.status === 'active');
           if (activeBatches.length === 0) return 0;
           const totalFCR = activeBatches.reduce((sum, batch) => sum + batch.fcrActual, 0);
           return totalFCR / activeBatches.length;
       }

       function calculateAverageADG() {
           const activePigs = farmData.pigs.filter(p => p.status === 'active');
           if (activePigs.length === 0) return 0;
           const totalADG = activePigs.reduce((sum, pig) => sum + calculateADG(pig), 0);
           return totalADG / activePigs.length;
       }

       function calculateMonthlyRevenue() {
           const currentMonth = new Date().getMonth();
           const currentYear = new Date().getFullYear();
           return farmData.sales
               .filter(sale => {
                   const saleDate = new Date(sale.date);
                   return saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear;
               })
               .reduce((sum, sale) => sum + sale.totalRevenue, 0);
       }

       function calculateNetProfit() {
           return farmData.sales.reduce((sum, sale) => sum + sale.profit, 0);
       }

       function updateSalesMetrics() {
           const totalRevenue = farmData.sales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
           const totalCost = farmData.sales.reduce((sum, sale) => sum + sale.totalCost, 0);
           const totalProfit = farmData.sales.reduce((sum, sale) => sum + sale.profit, 0);
           const roi = totalCost > 0 ? (totalProfit / totalCost) * 100 : 0;

           document.getElementById('totalSalesRevenue').textContent = formatNumber(totalRevenue);
           document.getElementById('totalSalesCost').textContent = formatNumber(totalCost);
           document.getElementById('totalSalesProfit').textContent = formatNumber(totalProfit);
           document.getElementById('totalROI').textContent = roi.toFixed(2);
       }

       function updateReports() {
           const avgFCR = calculateAverageFCR();
           const totalRevenue = farmData.sales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
           const totalCost = farmData.sales.reduce((sum, sale) => sum + sale.totalCost, 0);
           const netProfit = totalRevenue - totalCost;
           const profitMargin = totalRevenue > 0 ? (netProfit / totalRevenue) * 100 : 0;

           document.getElementById('reportAvgFCR').textContent = avgFCR.toFixed(2);
           document.getElementById('reportTotalRevenue').textContent = formatNumber(totalRevenue);
           document.getElementById('reportTotalCost').textContent = formatNumber(totalCost);
           document.getElementById('reportNetProfit').textContent = formatNumber(netProfit);
           document.getElementById('reportProfitMargin').textContent = profitMargin.toFixed(2);

           updateProductionReport();
       }

       function updateProductionReport() {
           const tbody = document.getElementById('productionReportBody');
           tbody.innerHTML = '';

           farmData.batches.forEach(batch => {
               const soldPigs = farmData.sales
                   .filter(sale => sale.batchId === batch.batchId)
                   .reduce((sum, sale) => sum + sale.totalPigs, 0);
               
               const mortalityRate = batch.pigCount > 0 ? ((batch.pigCount - soldPigs) / batch.pigCount) * 100 : 0;
               const costPerHead = batch.pigCount > 0 ? batch.costToDate / batch.pigCount : 0;
               const profitPerHead = calculateProfitPerHead(batch.batchId);

               const row = document.createElement('tr');
               row.innerHTML = `
                   <td>${batch.batchId}</td>
                   <td>${batch.pigCount}</td>
                   <td>${soldPigs}</td>
                   <td>${mortalityRate.toFixed(1)}%</td>
                   <td>${batch.fcrActual.toFixed(2)}</td>
                   <td>0.65</td>
                   <td>${formatCurrency(costPerHead)}</td>
                   <td>${formatCurrency(profitPerHead)}</td>
               `;
               tbody.appendChild(row);
           });
       }

       function calculateProfitPerHead(batchId) {
           const batchSales = farmData.sales.filter(sale => sale.batchId === batchId);
           const totalProfit = batchSales.reduce((sum, sale) => sum + sale.profit, 0);
           const totalSoldPigs = batchSales.reduce((sum, sale) => sum + sale.totalPigs, 0);
           return totalSoldPigs > 0 ? totalProfit / totalSoldPigs : 0;
       }

       function updateAlerts() {
           const alertsContainer = document.getElementById('alertsContainer');
           alertsContainer.innerHTML = '';

           // Check for low feed stock
           const lowStockFeeds = farmData.feeds.filter(feed => feed.currentStock <= feed.minStock);
           lowStockFeeds.forEach(feed => {
               const alert = document.createElement('div');
               alert.className = 'alert alert-warning';
               alert.textContent = `แจ้งเตือน: อาหาร ${feed.brand} เหลือน้อย (${feed.currentStock} ถุง)`;
               alertsContainer.appendChild(alert);
           });

           // Check for vaccination due
           const dueVaccinations = farmData.health.filter(record => isVaccineDue(record.nextDate));
           if (dueVaccinations.length > 0) {
               const alert = document.createElement('div');
               alert.className = 'alert alert-danger';
               alert.textContent = `แจ้งเตือน: มีสุกร ${dueVaccinations.length} ตัว ที่ครบกำหนดฉีดวัคซีน`;
               alertsContainer.appendChild(alert);
           }

           // Check for ready to sell pigs
           const readyToSell = farmData.batches.filter(batch => {
               return batch.averageWeight >= batch.targetWeight && batch.status === 'active';
           });
           readyToSell.forEach(batch => {
               const alert = document.createElement('div');
               alert.className = 'alert alert-success';
               alert.textContent = `แจ้งเตือน: Batch ${batch.batchId} พร้อมขาย (น้ำหนักถึงเป้าหมายแล้ว)`;
               alertsContainer.appendChild(alert);
           });

           if (alertsContainer.children.length === 0) {
               const alert = document.createElement('div');
               alert.className = 'alert alert-success';
               alert.textContent = 'ไม่มีการแจ้งเตือน - ทุกอย่างเป็นปกติ';
               alertsContainer.appendChild(alert);
           }
       }

       // Chart Drawing
       function drawFCRChart() {
           const canvas = document.getElementById('fcrChart');
           const ctx = canvas.getContext('2d');
           
           // Clear canvas
           ctx.clearRect(0, 0, canvas.width, canvas.height);
           
           // Set canvas size
           canvas.width = canvas.offsetWidth;
           canvas.height = canvas.offsetHeight;
           
           // Sample data for FCR trend
           const months = ['ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.'];
           const fcrData = [2.3, 2.1, 2.4, 2.2, 2.0, 2.3];
           const targetFCR = 2.2;
           
           const padding = 60;
           const chartWidth = canvas.width - 2 * padding;
           const chartHeight = canvas.height - 2 * padding;
           
           // Draw axes
           ctx.strokeStyle = '#374151';
           ctx.lineWidth = 2;
           ctx.beginPath();
           ctx.moveTo(padding, padding);
           ctx.lineTo(padding, canvas.height - padding);
           ctx.lineTo(canvas.width - padding, canvas.height - padding);
           ctx.stroke();
           
           // Draw target line
           ctx.strokeStyle = '#ef4444';
           ctx.lineWidth = 2;
           ctx.setLineDash([10, 5]);
           const targetY = canvas.height - padding - ((targetFCR - 1.5) / 1.5) * chartHeight;
           ctx.beginPath();
           ctx.moveTo(padding, targetY);
           ctx.lineTo(canvas.width - padding, targetY);
           ctx.stroke();
           ctx.setLineDash([]);
           
           // Draw FCR line
           ctx.strokeStyle = '#2563eb';
           ctx.lineWidth = 3;
           ctx.beginPath();
           
           for (let i = 0; i < fcrData.length; i++) {
               const x = padding + (i / (fcrData.length - 1)) * chartWidth;
               const y = canvas.height - padding - ((fcrData[i] - 1.5) / 1.5) * chartHeight;
               
               if (i === 0) {
                   ctx.moveTo(x, y);
               } else {
                   ctx.lineTo(x, y);
               }
               
               // Draw data points
               ctx.fillStyle = '#2563eb';
               ctx.beginPath();
               ctx.arc(x, y, 6, 0, 2 * Math.PI);
               ctx.fill();
           }
           ctx.stroke();
           
           // Draw labels
           ctx.fillStyle = '#374151';
           ctx.font = '14px Niramit';
           ctx.textAlign = 'center';
           
           // X-axis labels
           for (let i = 0; i < months.length; i++) {
               const x = padding + (i / (months.length - 1)) * chartWidth;
               ctx.fillText(months[i], x, canvas.height - padding + 25);
           }
           
           // Y-axis labels
           ctx.textAlign = 'right';
           for (let i = 0; i <= 3; i++) {
               const value = 1.5 + (i * 0.5);
               const y = canvas.height - padding - (i / 3) * chartHeight;
               ctx.fillText(value.toFixed(1), padding - 10, y + 5);
           }
           
           // Chart title
           ctx.fillStyle = '#1e40af';
           ctx.font = 'bold 16px Niramit';
           ctx.textAlign = 'center';
           ctx.fillText('แนวโน้ม FCR รายเดือน', canvas.width / 2, 30);
           
           // Legend
           ctx.font = '12px Niramit';
           ctx.textAlign = 'left';
           ctx.fillStyle = '#2563eb';
           ctx.fillText('● FCR จริง', canvas.width - 150, 50);
           ctx.fillStyle = '#ef4444';
           ctx.fillText('--- เป้าหมาย (2.2)', canvas.width - 150, 70);
       }

       // Utility Functions
       function updateAllDropdowns() {
           updateBatchDropdowns();
           updatePigDropdowns();
           updateFeedDropdowns();
       }

       function updateBatchDropdowns() {
           const activeBatches = farmData.batches.filter(b => b.status === 'active');
           const dropdowns = ['pigBatchId', 'feedingBatchId', 'saleBatchId'];
           
           dropdowns.forEach(dropdownId => {
               const dropdown = document.getElementById(dropdownId);
               if (dropdown) {
                   dropdown.innerHTML = '<option value="">เลือก Batch</option>';
                   activeBatches.forEach(batch => {
                       const option = document.createElement('option');
                       option.value = batch.batchId;
                       option.textContent = `${batch.batchId} (${batch.pigCount} ตัว)`;
                       dropdown.appendChild(option);
                   });
               }
           });
       }

       function updatePigDropdowns() {
           const activePigs = farmData.pigs.filter(p => p.status === 'active');
           const dropdown = document.getElementById('vaccinePigId');
           
           if (dropdown) {
               dropdown.innerHTML = '<option value="">เลือกสุกร</option>';
               activePigs.forEach(pig => {
                   const option = document.createElement('option');
                   option.value = pig.pigId;
                   option.textContent = `${pig.pigId} (${pig.tagNumber})`;
                   dropdown.appendChild(option);
               });
           }
       }

       function updateFeedDropdowns() {
           const dropdown = document.getElementById('feedingFeedId');
           
           if (dropdown) {
               dropdown.innerHTML = '<option value="">เลือกอาหาร</option>';
               farmData.feeds.forEach(feed => {
                   const option = document.createElement('option');
                   option.value = feed.feedId;
                   option.textContent = `${feed.brand} (${getFeedTypeText(feed.type)})`;
                   dropdown.appendChild(option);
               });
           }
       }

       function setDefaultDates() {
           const today = new Date().toISOString().split('T')[0];
           const dateInputs = ['feedingDate', 'saleDate', 'vaccineDate'];
           
           dateInputs.forEach(inputId => {
               const input = document.getElementById(inputId);
               if (input) {
                   input.value = today;
               }
           });
       }

       // Helper Functions
       function calculateAge(birthDate) {
           const birth = new Date(birthDate);
           const today = new Date();
           const diffTime = Math.abs(today - birth);
           return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
       }

       function formatDate(dateString) {
           if (!dateString) return '-';
           const date = new Date(dateString);
           return date.toLocaleDateString('th-TH');
       }

       function formatCurrency(amount) {
           return new Intl.NumberFormat('th-TH', {
               style: 'currency',
               currency: 'THB',
               minimumFractionDigits: 0
           }).format(amount);
       }

       function formatNumber(number) {
           return new Intl.NumberFormat('th-TH').format(number);
       }

       function getStageText(stage) {
           const stages = {
               'creep': 'Creep',
               'starter': 'Starter',
               'grower': 'Grower',
               'finisher': 'Finisher'
           };
           return stages[stage] || stage;
       }

       function getStatusText(status) {
           const statuses = {
               'active': 'ใช้งาน',
               'sold': 'ขายแล้ว',
               'dead': 'ตาย'
           };
           return statuses[status] || status;
       }

       function getSexText(sex) {
           const sexes = {
               'male': 'ผู้',
               'female': 'เมีย',
               'castrated': 'ตอนแล้ว'
           };
           return sexes[sex] || sex;
       }

       function getFeedTypeText(type) {
           const types = {
               'creep': 'Creep Feed',
               'starter': 'Starter Feed',
               'grower': 'Grower Feed',
               'finisher': 'Finisher Feed',
               'sow': 'Sow Feed',
               'boar': 'Boar Feed'
           };
           return types[type] || type;
       }

       function getBreedingMethodText(method) {
           const methods = {
               'natural': 'ธรรมชาติ',
               'ai': 'ผสมเทียม'
           };
           return methods[method] || method;
       }

       function getBreedingStatusText(status) {
           const statuses = {
               'bred': 'ผสมแล้ว',
               'farrowed': 'คลอดแล้ว',
               'failed': 'ล้มเหลว'
           };
           return statuses[status] || status;
       }

       function deleteFeed(feedId) {
           if (confirm('คุณต้องการลบอาหารนี้หรือไม่?')) {
               farmData.feeds = farmData.feeds.filter(f => f.feedId !== feedId);
               saveData();
               updateFeedTable();
               updateAllDropdowns();
           }
       }

       // Initialize charts on window resize
       window.addEventListener('resize', function() {
           setTimeout(drawFCRChart, 100);
       });
   </script>
</body>
</html>
               
