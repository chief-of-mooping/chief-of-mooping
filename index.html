
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <!-- Mobile Optimization -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£">
    <meta name="application-name" content="‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£">
    <meta name="theme-color" content="#2c3e50">
    <meta name="msapplication-TileColor" content="#2c3e50">
    
    <!-- Icons for Mobile -->
    <link rel="apple-touch-icon" sizes="180x180" href="./app-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./app-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./app-icon.png">
    <link rel="shortcut icon" href="./app-icon.png">
    <meta name="msapplication-TileImage" content="./app-icon.png">
    <link rel="manifest" href="data:application/json;charset=utf-8;base64,eyJuYW1lIjoi4Lij4Liw4Lia4Lia4LiH4LiB4Liy4Lij4LiU4Lit4Lii4Liy4LiU4LiB4Liy4Lij4Lil4Liy4Lij4LjM4LiZ4Li44LiB4Lij4LjMIiwic2hvcnRfbmFtZSI6IuC4pOC4suC4o+C5jOC4oeC4lOC4iOC4seC4lOC4hOC4quC4uOC4geC4o+C5jCIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZjhmOWZhIiwidGhlbWVfY29sb3IiOiIjMmMzZTUwIiwiaWNvbnMiOlt7InNyYyI6Ii4vYXBwLWljb24ucG5nIiwic2l6ZXMiOiIxODB4MTgwIiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic3JjIjoiLi9hcHAtaWNvbi5wbmciLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIn0seyJzcmMiOiIuL2FwcC1pY29uLnBuZyIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9wbmcifV19">

    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
            -webkit-text-size-adjust: 100%;
            touch-action: manipulation;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .header h1 {
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            overflow-x: auto;
            overflow-y: hidden;
            padding: 8px;
            gap: 4px;
            -webkit-overflow-scrolling: touch;
        }

        .nav-tab {
            flex: 0 0 auto;
            padding: 12px 16px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            border-radius: 8px;
            white-space: nowrap;
            min-width: 80px;
            color: #666;
            position: relative;
            touch-action: manipulation;
        }

        .nav-tab:active {
            transform: scale(0.98);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: #2c3e50;
            font-weight: 700;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .container {
                padding: 20px;
            }
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .form-label.required::after {
            content: " *";
            color: #e74c3c;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
            appearance: none;
            -webkit-appearance: none;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 8px;
            margin-bottom: 8px;
            text-align: center;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
            box-shadow: 0 4px 12px rgba(149, 165, 166, 0.3);
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 13px;
            border-radius: 8px;
        }

        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 16px;
            font-weight: 500;
            border-left: 4px solid;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-left-color: #27ae60;
        }

        .alert-error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-left-color: #e74c3c;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border-left-color: #f39c12;
        }

        .hidden {
            display: none;
        }

        .stock-item {
            display: flex;
            flex-direction: column;
            padding: 16px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            background: white;
        }

        .stock-item.low-stock {
            border-color: #f39c12;
            background: linear-gradient(135deg, #fef9e7, #fff3cd);
        }

        .stock-item.out-of-stock {
            border-color: #e74c3c;
            background: linear-gradient(135deg, #fdedec, #f8d7da);
        }

        .stock-info {
            margin-bottom: 12px;
        }

        .stock-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 6px;
            color: #2c3e50;
        }

        .stock-details {
            font-size: 13px;
            color: #666;
            margin-bottom: 3px;
        }

        .stock-status {
            font-size: 13px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
            margin-top: 4px;
        }

        .stock-status.normal {
            background: #d4edda;
            color: #27ae60;
        }

        .stock-status.low {
            background: #fff3cd;
            color: #f39c12;
        }

        .stock-status.empty {
            background: #f8d7da;
            color: #e74c3c;
        }

        .stock-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .stock-actions .btn {
            flex: 1;
            margin: 0;
            min-width: 80px;
        }

        .usage-form {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            border: 1px solid #dee2e6;
        }

        .usage-form h3 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .usage-history {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            font-size: 14px;
            overflow-x: auto;
            display: block;
            white-space: nowrap;
        }

        .table thead, .table tbody, .table tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        .table th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            border-radius: 8px 8px 0 0;
        }

        .table td {
            padding: 10px 8px;
            border-bottom: 1px solid #dee2e6;
            font-size: 13px;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, white, #f8f9fa);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 2px 16px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .stat-number {
            font-size: 24px;
            font-weight: 800;
            color: #3498db;
            margin-bottom: 6px;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            font-weight: 500;
        }

        /* Touch and Mobile Optimizations */
        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 12px;
        }

        /* Improved mobile table */
        @media (max-width: 768px) {
            .table {
                display: table;
                white-space: nowrap;
                min-width: 600px;
            }

            .stock-item {
                border-radius: 12px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .stat-card {
                padding: 16px;
            }

            .stat-number {
                font-size: 20px;
            }

            .nav-tab {
                font-size: 12px;
                padding: 10px 12px;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Safe area for iPhone X and above */
        @supports (padding-top: constant(safe-area-inset-top)) {
            .header {
                padding-top: calc(20px + constant(safe-area-inset-top));
            }
        }

        @supports (padding-top: env(safe-area-inset-top)) {
            .header {
                padding-top: calc(20px + env(safe-area-inset-top));
            }
        }

        /* Manual Install Button */
        .manual-install {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 12px 16px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(231, 76, 60, 0.4);
            z-index: 999999;
            border: none;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .manual-install:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(231, 76, 60, 0.5);
        }

        .manual-install:active {
            transform: scale(0.95);
        }

        /* ‡∏ã‡πà‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô standalone mode ‡πÅ‡∏•‡πâ‡∏ß */
        @media (display-mode: standalone) {
            .manual-install {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà -->
    <button id="manualInstall" class="manual-install" onclick="showInstallInstructions()">
        üì± ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ
    </button>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üê∑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£ ‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏¢‡∏≤</p>
        </div>

        <!-- Alert Messages -->
        <div id="alertMessage" class="alert hidden"></div>

        <!-- Low Stock Warnings -->
        <div id="stockWarnings"></div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('overview')">üè† ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
            <button class="nav-tab" onclick="showSection('pigs')">üê∑ ‡∏™‡∏∏‡∏Å‡∏£</button>
            <button class="nav-tab" onclick="showSection('feeds')">üåæ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
            <button class="nav-tab" onclick="showSection('medical')">üíä ‡∏¢‡∏≤</button>
            <button class="nav-tab" onclick="showSection('usage')">üìù ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
            <button class="nav-tab" onclick="showSection('sales')">üí∞ ‡∏Ç‡∏≤‡∏¢</button>
            <button class="nav-tab" onclick="showSection('reports')">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
        </div>

        <!-- Overview Section -->
        <div id="overview" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalPigs">-</div>
                    <div class="stat-label">‡∏™‡∏∏‡∏Å‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="feedItems">-</div>
                    <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="medicalItems">-</div>
                    <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="lowStockItems">-</div>
                    <div class="stat-label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                <div id="stockSummary">
                    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                </div>
            </div>
        </div>

        <!-- Pigs Management Section -->
        <div id="pigs" class="content-section">
            <div class="card">
                <div class="card-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Å‡∏£</div>
                <div class="form-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label required">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏∏‡∏Å‡∏£</label>
                            <select class="form-select" id="pigType">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="sow">‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                                <option value="boar">‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                                <option value="piglet">‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£</option>
                                <option value="grower">‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô</option>
                                <option value="finisher">‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                            <input type="number" class="form-input" id="pigQuantity" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label required">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏≤‡∏£‡πå‡∏°</label>
                            <input type="date" class="form-input" id="pigEntryDate">
                        </div>
                    </div>

                    <div>
                        <div class="form-group">
                            <label class="form-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</label>
                            <input type="number" class="form-input" id="pigWeight" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏ß‡∏±‡∏ô)</label>
                            <input type="number" class="form-input" id="pigAge">
                        </div>

                        <div class="form-group">
                            <label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                            <input type="text" class="form-input" id="pigNotes">
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="addPig()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button class="btn btn-secondary" onclick="clearPigForm()">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏Å‡∏£‡πÉ‡∏ô‡∏ü‡∏≤‡∏£‡πå‡∏°</div>
                <div id="pigsList">
                    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Å‡∏£</p>
                </div>
            </div>
        </div>

        <!-- Feeds Section with Stock Management -->
        <div id="feeds" class="content-section">
            <div class="card">
                <div class="card-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</div>
                <div class="form-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label required">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                            <select class="form-select" id="feedType">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="prestarter">Pre-Starter (‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£‡πÅ‡∏£‡∏Å‡πÄ‡∏Å‡∏¥‡∏î)</option>
                                <option value="starter">Starter (‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£ 1-2 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</option>
                                <option value="grower">Grower (‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô 2-4 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</option>
                                <option value="finisher">Finisher (‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏Ç‡∏≤‡∏¢)</option>
                                <option value="sow">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                                <option value="boar">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠/‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå</label>
                            <input type="text" class="form-input" id="feedBrand">
                        </div>

                        <div class="form-group">
                            <label class="form-label required">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</label>
                            <input type="number" class="form-input" id="feedQuantity" step="0.1">
                        </div>
                    </div>

                    <div>
                        <div class="form-group">
                            <label class="form-label required">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" class="form-input" id="feedPrice" step="0.01">
                        </div>

                        <div class="form-group">
                            <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label>
                            <input type="date" class="form-input" id="feedPurchaseDate">
                        </div>

                        <div class="form-group">
                            <label class="form-label">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</label>
                            <input type="date" class="form-input" id="feedExpiryDate">
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="addFeed()">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
                    <button class="btn btn-secondary" onclick="clearFeedForm()">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>
                <div id="feedStock">
                    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>
                </div>
            </div>
        </div>

        <!-- Medical Section with Stock Management -->
        <div id="medical" class="content-section">
            <div class="card">
                <div class="card-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</div>
                <div class="form-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label required">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                            <select class="form-select" id="medicalType">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="vaccine">‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</option>
                                <option value="antibiotic">‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞</option>
                                <option value="vitamin">‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô</option>
                                <option value="deworming">‡∏¢‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏û‡∏¢‡∏≤‡∏ò‡∏¥</option>
                                <option value="hormone">‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô</option>
                                <option value="supplement">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°</option>
                                <option value="disinfectant">‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</label>
                            <input type="text" class="form-input" id="medicalName">
                        </div>

                        <div class="form-group">
                            <label class="form-label">‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠/‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ú‡∏•‡∏¥‡∏ï</label>
                            <input type="text" class="form-input" id="medicalBrand">
                       </div>

                       <div class="form-group">
                           <label class="form-label required">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                           <input type="number" class="form-input" id="medicalQuantity" step="1">
                       </div>
                   </div>

                   <div>
                       <div class="form-group">
                           <label class="form-label required">‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                           <select class="form-select" id="medicalUnit">
                               <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
                               <option value="dose">‡πÇ‡∏î‡∏™</option>
                               <option value="ml">‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏•‡∏¥‡∏ï‡∏£</option>
                               <option value="tablet">‡πÄ‡∏°‡πá‡∏î</option>
                               <option value="bottle">‡∏Ç‡∏ß‡∏î</option>
                               <option value="vial">‡∏´‡∏•‡∏≠‡∏î</option>
                               <option value="kg">‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°</option>
                               <option value="gram">‡∏Å‡∏£‡∏±‡∏°</option>
                           </select>
                       </div>

                       <div class="form-group">
                           <label class="form-label required">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                           <input type="number" class="form-input" id="medicalPrice" step="0.01">
                       </div>

                       <div class="form-group">
                           <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label>
                           <input type="date" class="form-input" id="medicalPurchaseDate">
                       </div>

                       <div class="form-group">
                           <label class="form-label">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</label>
                           <input type="date" class="form-input" id="medicalExpiryDate">
                       </div>
                   </div>
               </div>

               <div style="margin-top: 20px;">
                   <button class="btn btn-success" onclick="addMedical()">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
                   <button class="btn btn-secondary" onclick="clearMedicalForm()">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
               </div>
           </div>

           <div class="card">
               <div class="card-title">üíä ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</div>
               <div id="medicalStock">
                   <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</p>
               </div>
           </div>
       </div>

       <!-- Daily Usage Section -->
       <div id="usage" class="content-section">
           <div class="card">
               <div class="card-title">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</div>
               
               <div class="usage-form">
                   <h3>üåæ ‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
                   <div class="form-grid">
                       <div class="form-group">
                           <label class="form-label required">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                           <select class="form-select" id="useFeedSelect">
                               <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label class="form-label required">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</label>
                           <input type="number" class="form-input" id="useFeedAmount" step="0.1">
                       </div>
                   </div>
                   <button class="btn btn-warning" onclick="useFeed()">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
               </div>

               <div class="usage-form">
                   <h3>üíä ‡πÉ‡∏ä‡πâ‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</h3>
                   <div class="form-grid">
                       <div class="form-group">
                           <label class="form-label required">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</label>
                           <select class="form-select" id="useMedicalSelect">
                               <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label class="form-label required">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</label>
                           <input type="number" class="form-input" id="useMedicalAmount" step="0.1">
                       </div>
                   </div>
                   <button class="btn btn-warning" onclick="useMedical()">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</button>
               </div>
           </div>

           <div class="usage-history">
               <h3>üìä ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
               <div id="todayUsage">
                   <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
               </div>
           </div>
       </div>

       <!-- Sales Section -->
       <div id="sales" class="content-section">
           <div class="card">
               <div class="card-title">üí∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
               <div class="form-grid">
                   <div>
                       <div class="form-group">
                           <label class="form-label required">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label>
                           <input type="date" class="form-input" id="saleDate">
                       </div>

                       <div class="form-group">
                           <label class="form-label required">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏∏‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label>
                           <select class="form-select" id="saleType">
                               <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                               <option value="piglet">‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£</option>
                               <option value="grower">‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô</option>
                               <option value="finisher">‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô</option>
                               <option value="sow">‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                               <option value="boar">‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                           </select>
                       </div>

                       <div class="form-group">
                           <label class="form-label required">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢ (‡∏ï‡∏±‡∏ß)</label>
                           <input type="number" class="form-input" id="saleQuantity" min="1">
                       </div>

                       <div class="form-group">
                           <label class="form-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏° (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</label>
                           <input type="number" class="form-input" id="saleWeight" step="0.1">
                       </div>
                   </div>

                   <div>
                       <div class="form-group">
                           <label class="form-label required">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                           <input type="number" class="form-input" id="salePricePerKg" step="0.01">
                       </div>

                       <div class="form-group">
                           <label class="form-label">‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á (‡∏ö‡∏≤‡∏ó)</label>
                           <input type="number" class="form-input" id="saleTransportCost" step="0.01">
                       </div>

                       <div class="form-group">
                           <label class="form-label">‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠</label>
                           <input type="text" class="form-input" id="saleBuyer">
                       </div>

                       <div class="form-group">
                           <label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                           <input type="text" class="form-input" id="saleNotes">
                       </div>
                   </div>
               </div>

               <div style="margin-top: 20px;">
                   <button class="btn btn-success" onclick="addSale()">üí∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</button>
                   <button class="btn btn-secondary" onclick="clearSaleForm()">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
               </div>
           </div>

           <div class="card">
               <div class="card-title">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
               <div class="table-container">
                   <div id="salesHistory">
                       <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>
                   </div>
               </div>
           </div>
       </div>

       <!-- Reports Section -->
       <div id="reports" class="content-section">
           <div class="card">
               <div class="card-title">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ</div>
               <div class="form-grid">
                   <div>
                       <div class="form-group">
                           <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
                           <select class="form-select" id="reportType">
                               <option value="overview">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°</option>
                               <option value="stock">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</option>
                               <option value="usage">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                               <option value="financial">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</option>
                               <option value="livestock">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏Å‡∏£</option>
                               <option value="sales">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</option>
                           </select>
                       </div>

                       <button class="btn btn-primary" onclick="generateReport()" style="margin-top: 30px;">üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                       <button class="btn btn-secondary" onclick="exportReport()">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                   </div>
               </div>

               <div id="reportResults" style="margin-top: 30px;">
                   <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>
               </div>
           </div>
      </div>
  </div>

  <script>
      // === PWA ‡πÅ‡∏•‡∏∞ Mobile App Functionality ===
      let deferredPrompt;
      let isStandalone = false;

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô PWA standalone mode ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
          isStandalone = true;
      }
      
      if (window.navigator && window.navigator.standalone === true) {
          isStandalone = true;
      }

      // PWA Install Prompt
      window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          deferredPrompt = e;
      });

      function installPWA() {
          if (deferredPrompt) {
              deferredPrompt.prompt();
              deferredPrompt.userChoice.then((choiceResult) => {
                  if (choiceResult.outcome === 'accepted') {
                      console.log('User accepted the install prompt');
                  }
                  deferredPrompt = null;
              });
          }
      }

      // Register Service Worker for offline functionality
      if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
              const swCode = `
                  const CACHE_NAME = 'farm-app-v2.0.0';
                  const urlsToCache = [
                      '/',
                      '/offline.html'
                  ];

                  self.addEventListener('install', event => {
                      event.waitUntil(
                          caches.open(CACHE_NAME)
                              .then(cache => cache.addAll(urlsToCache))
                      );
                  });

                  self.addEventListener('fetch', event => {
                      event.respondWith(
                          caches.match(event.request)
                              .then(response => {
                                  if (response) {
                                      return response;
                                  }
                                  return fetch(event.request);
                              })
                      );
                  });
              `;

              const blob = new Blob([swCode], { type: 'application/javascript' });
              const swUrl = URL.createObjectURL(blob);

              navigator.serviceWorker.register(swUrl)
                  .then(registration => {
                      console.log('SW registered: ', registration);
                  })
                  .catch(registrationError => {
                      console.log('SW registration failed: ', registrationError);
                  });
          });
      }

      // === ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ===
      const SYSTEM_VERSION = "2.0.0";
      const STORAGE_KEY = "farmManagementSystem";

      // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô
      const DEFAULT_DATA_STRUCTURE = {
          version: SYSTEM_VERSION,
          lastUpdate: new Date().toISOString(),
          settings: {
              lowStockThreshold: {
                  feeds: 50,
                  medical: 5
              },
              currency: "‡∏ö‡∏≤‡∏ó",
              language: "th"
          },
          farmData: {
              pigs: [],
              feeds: [],
              medical: [],
              sales: [],
              usage: []
          }
      };

      // ‡∏Ñ‡πà‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥
      const LOW_STOCK_THRESHOLD = {
          feeds: 50, // ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°
          medical: 5 // ‡∏´‡∏ô‡πà‡∏ß‡∏¢
      };

      // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å
      let farmSystemData = DEFAULT_DATA_STRUCTURE;
      let farmData = farmSystemData.farmData;

      // === Mobile Optimizations ===
      
      // Prevent zoom on double tap
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function (event) {
          const now = (new Date()).getTime();
          if (now - lastTouchEnd <= 300) {
              event.preventDefault();
          }
          lastTouchEnd = now;
      }, false);

      // Handle viewport changes (for keyboard appearing)
      function handleViewportChange() {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty('--vh', `${vh}px`);
      }

      window.addEventListener('resize', handleViewportChange);
      window.addEventListener('orientationchange', handleViewportChange);
      handleViewportChange();

      // Touch feedback for buttons
      document.addEventListener('touchstart', function(e) {
          if (e.target.classList.contains('btn') || e.target.classList.contains('nav-tab')) {
              e.target.style.transform = 'scale(0.98)';
          }
      });

      document.addEventListener('touchend', function(e) {
          if (e.target.classList.contains('btn') || e.target.classList.contains('nav-tab')) {
              setTimeout(() => {
                  e.target.style.transform = '';
              }, 100);
          }
      });

      // === ‡∏£‡∏∞‡∏ö‡∏ö Data Migration ===
      function migrateData(savedData) {
          try {
              if (!savedData.version) {
                  console.log('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤...');
                  
                  if (savedData.pigs || savedData.feeds || savedData.medical) {
                      return {
                          ...DEFAULT_DATA_STRUCTURE,
                          farmData: {
                              pigs: savedData.pigs || [],
                              feeds: savedData.feeds || [],
                              medical: savedData.medical || [],
                              sales: savedData.sales || [],
                              usage: savedData.usage || []
                          }
                      };
                  }
              }

              if (savedData.version !== SYSTEM_VERSION) {
                  console.log(`üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô ${savedData.version} ‡πÄ‡∏õ‡πá‡∏ô ${SYSTEM_VERSION}...`);
                  
                  const migratedData = {
                      ...DEFAULT_DATA_STRUCTURE,
                      farmData: savedData.farmData || savedData,
                      version: SYSTEM_VERSION,
                      lastUpdate: new Date().toISOString(),
                      previousVersion: savedData.version || "1.0.0"
                  };

                  return performVersionMigration(migratedData, savedData.version || "1.0.0");
              }

              return {
                  ...savedData,
                  lastUpdate: new Date().toISOString()
              };

          } catch (error) {
              console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
              backupOldData(savedData);
              return DEFAULT_DATA_STRUCTURE;
          }
      }

      function performVersionMigration(data, fromVersion) {
          console.log(`üîß ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ migrate ‡∏à‡∏≤‡∏Å ${fromVersion} ‡πÄ‡∏õ‡πá‡∏ô ${SYSTEM_VERSION}`);

          if (fromVersion.startsWith("1.")) {
              data.farmData.feeds = data.farmData.feeds.map(feed => ({
                  ...feed,
                  originalQuantity: feed.originalQuantity || feed.quantity
              }));

              data.farmData.medical = data.farmData.medical.map(med => ({
                  ...med,
                  originalQuantity: med.originalQuantity || med.quantity
              }));

              if (!data.settings) {
                  data.settings = DEFAULT_DATA_STRUCTURE.settings;
              }
          }

          return data;
      }

      function backupOldData(oldData) {
          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
          const backupKey = `${STORAGE_KEY}_backup_${timestamp}`;
          
          try {
              localStorage.setItem(backupKey, JSON.stringify(oldData));
              
              const blob = new Blob([JSON.stringify(oldData, null, 2)], {type: 'application/json'});
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `farm-backup-${timestamp.split('T')[0]}.json`;
              
              setTimeout(() => {
                  if (confirm('‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                      a.click();
                  }
                  URL.revokeObjectURL(url);
              }, 1000);
              
              console.log(`üíæ ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏µ‡πà: ${backupKey}`);
              
          } catch (error) {
              console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ:', error);
          }
      }

      // === ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ===
      function saveAllData() {
          try {
              farmSystemData.farmData = farmData;
              farmSystemData.lastUpdate = new Date().toISOString();
              
              const dataToSave = JSON.stringify(farmSystemData);
              localStorage.setItem(STORAGE_KEY, dataToSave);
              
              console.log(`üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô ${SYSTEM_VERSION} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`);
              
          } catch (error) {
              console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
              showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
          }
      }

      function loadAllData() {
          try {
              const savedData = localStorage.getItem(STORAGE_KEY);
              
              if (savedData) {
                  const parsedData = JSON.parse(savedData);
                  farmSystemData = migrateData(parsedData);
                  farmData = farmSystemData.farmData;
                  
                  console.log(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô ${farmSystemData.version} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`);
                  
                  if (farmSystemData.previousVersion) {
                      showAlert(`‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô ${farmSystemData.previousVersion} ‡πÄ‡∏õ‡πá‡∏ô ${SYSTEM_VERSION} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
                  }
                  
              } else {
                  console.log('‚ÑπÔ∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà');
                  farmSystemData = DEFAULT_DATA_STRUCTURE;
                  farmData = farmSystemData.farmData;
              }
              
          } catch (error) {
              console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
              
              if (localStorage.getItem(STORAGE_KEY)) {
                  backupOldData(localStorage.getItem(STORAGE_KEY));
              }
              
              farmSystemData = DEFAULT_DATA_STRUCTURE;
              farmData = farmSystemData.farmData;
              
              showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏•‡∏∞‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ', 'error');
          }
      }

      // === ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ===
      document.addEventListener('DOMContentLoaded', function() {
          loadAllData();
          updateOverview();
          updateUsageSelects();
          checkStockLevels();
          setDefaultDates();
          addDataManagementSection();
          
          console.log('üì± Mobile Farm App ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
          
          if (isStandalone) {
              document.getElementById('manualInstall').style.display = 'none';
          }
      });

      function setDefaultDates() {
          const today = new Date().toISOString().split('T')[0];
          document.getElementById('pigEntryDate').value = today;
          document.getElementById('feedPurchaseDate').value = today;
          document.getElementById('medicalPurchaseDate').value = today;
          document.getElementById('saleDate').value = today;
      }

      function showSection(sectionName) {
          document.querySelectorAll('.content-section').forEach(section => {
              section.classList.remove('active');
          });

          document.querySelectorAll('.nav-tab').forEach(tab => {
              tab.classList.remove('active');
          });

          document.getElementById(sectionName).classList.add('active');
          event.target.classList.add('active');

          window.scrollTo(0, 0);

          switch(sectionName) {
              case 'overview':
                  updateOverview();
                  checkStockLevels();
                  break;
              case 'pigs':
                  displayPigs();
                  break;
              case 'feeds':
                  displayFeeds();
                  break;
              case 'medical':
                  displayMedical();
                  break;
              case 'usage':
                  updateUsageSelects();
                  displayTodayUsage();
                  break;
              case 'sales':
                  displaySales();
                  break;
          }
      }

      function showAlert(message, type = 'success') {
          const alertEl = document.getElementById('alertMessage');
          alertEl.textContent = message;
          alertEl.className = `alert alert-${type}`;
          alertEl.classList.remove('hidden');

          setTimeout(() => {
              alertEl.classList.add('hidden');
          }, 5000);

          alertEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }

      // === ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏Å‡∏£ ===
      function addPig() {
          const pigType = document.getElementById('pigType').value;
          const quantity = parseInt(document.getElementById('pigQuantity').value);
          const entryDate = document.getElementById('pigEntryDate').value;
          const weight = parseFloat(document.getElementById('pigWeight').value) || 0;
          const age = parseInt(document.getElementById('pigAge').value) || 0;
          const notes = document.getElementById('pigNotes').value;

          if (!pigType || !quantity || !entryDate) {
              showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
              return;
          }

          const newPig = {
              id: Date.now(),
              type: pigType,
              quantity: quantity,
              entryDate: entryDate,
              weight: weight,
              age: age,
              notes: notes,
              createdDate: new Date().toISOString()
          };

          farmData.pigs.push(newPig);
          saveAllData();
          displayPigs();
          updateOverview();
          clearPigForm();
          showAlert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Å‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
      }

      function clearPigForm() {
          document.getElementById('pigType').value = '';
          document.getElementById('pigQuantity').value = '';
          document.getElementById('pigWeight').value = '';
          document.getElementById('pigAge').value = '';
          document.getElementById('pigNotes').value = '';
          document.getElementById('pigEntryDate').value = new Date().toISOString().split('T')[0];
      }

      function displayPigs() {
          const container = document.getElementById('pigsList');
          
          if (farmData.pigs.length === 0) {
              container.innerHTML = '<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Å‡∏£</p>';
              return;
          }

          const typeNames = {
              'sow': '‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå',
              'boar': '‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå',
              'piglet': '‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£',
              'grower': '‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô',
              'finisher': '‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô'
          };

          let html = '<div class="table-container"><table class="table"><thead><tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</th><th>‡∏≠‡∏≤‡∏¢‡∏∏</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏≤‡∏£‡πå‡∏°</th><th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody>';

          farmData.pigs.forEach(pig => {
              html += `
                  <tr>
                      <td>${typeNames[pig.type]}</td>
                      <td>${pig.quantity} ‡∏ï‡∏±‡∏ß</td>
                      <td>${pig.weight > 0 ? pig.weight + ' ‡∏Å‡∏Å.' : '-'}</td>
                      <td>${pig.age > 0 ? pig.age + ' ‡∏ß‡∏±‡∏ô' : '-'}</td>
                      <td>${new Date(pig.entryDate).toLocaleDateString('th-TH')}</td>
                      <td>
                          <button class="btn btn-small btn-danger" onclick="deletePig(${pig.id})">üóëÔ∏è ‡∏•‡∏ö</button>
                      </td>
                  </tr>
              `;
          });

          html += '</tbody></table></div>';
          container.innerHTML = html;
      }

      function deletePig(id) {
          if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Å‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
              farmData.pigs = farmData.pigs.filter(pig => pig.id !== id);
              saveAllData();
              displayPigs();
              updateOverview();
              showAlert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
          }
      }

      // === ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ===
      function addFeed() {
          const feedType = document.getElementById('feedType').value;
          const brand = document.getElementById('feedBrand').value;
          const quantity = parseFloat(document.getElementById('feedQuantity').value);
          const price = parseFloat(document.getElementById('feedPrice').value);
          const purchaseDate = document.getElementById('feedPurchaseDate').value;
          const expiryDate = document.getElementById('feedExpiryDate').value;

          if (!feedType || !brand || !quantity || !price || !purchaseDate) {
              showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
              return;
          }

          const newFeed = {
              id: Date.now(),
              type: feedType,
              brand: brand,
              quantity: quantity,
              originalQuantity: quantity,
              price: price,
              purchaseDate: purchaseDate,
              expiryDate: expiryDate,
              createdDate: new Date().toISOString()
          };

          farmData.feeds.push(newFeed);
          saveAllData();
          displayFeeds();
          updateUsageSelects();
          checkStockLevels();
          clearFeedForm();
          showAlert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
      }

      function clearFeedForm() {
          document.getElementById('feedType').value = '';
          document.getElementById('feedBrand').value = '';
          document.getElementById('feedQuantity').value = '';
          document.getElementById('feedPrice').value = '';
          document.getElementById('feedExpiryDate').value = '';
          document.getElementById('feedPurchaseDate').value = new Date().toISOString().split('T')[0];
      }

      function displayFeeds() {
          const container = document.getElementById('feedStock');
          
          if (farmData.feeds.length === 0) {
              container.innerHTML = '<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>';
              return;
          }

          const feedTypes = {
              'prestarter': 'Pre-Starter',
              'starter': 'Starter',
              'grower': 'Grower',
              'finisher': 'Finisher',
              'sow': '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå',
              'boar': '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå'
          };

          let html = '';
          farmData.feeds.forEach(feed => {
              const totalValue = feed.quantity * feed.price;
              const stockStatus = getStockStatus(feed.quantity, 'feed');
              const daysRemaining = calculateDaysRemaining(feed.quantity, 'feed');
              
              html += `
                  <div class="stock-item ${stockStatus === 'empty' ? 'out-of-stock' : stockStatus === 'low' ? 'low-stock' : ''}">
                      <div class="stock-info">
                          <div class="stock-name">üåæ ${feedTypes[feed.type]} - ${feed.brand}</div>
                          <div class="stock-details">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${feed.quantity} ‡∏Å‡∏Å. ‡∏à‡∏≤‡∏Å ${feed.originalQuantity} ‡∏Å‡∏Å.</div>
                          <div class="stock-details">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤: ${feed.price} ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å. | ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${totalValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                          <div class="stock-details">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠: ${new Date(feed.purchaseDate).toLocaleDateString('th-TH')} ${feed.expiryDate ? '| ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: ' + new Date(feed.expiryDate).toLocaleDateString('th-TH') : ''}</div>
                          <div class="stock-status ${stockStatus}">${getStockStatusText(stockStatus, daysRemaining)}</div>
                      </div>
                      <div class="stock-actions">
                          <button class="btn btn-small btn-warning" onclick="restockFeed(${feed.id})">‚ûï ‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
                          <button class="btn btn-small btn-danger" onclick="deleteFeed(${feed.id})">üóëÔ∏è ‡∏•‡∏ö</button>
                      </div>
                  </div>
              `;
          });

          container.innerHTML = html;
      }

      function restockFeed(id) {
          const feed = farmData.feeds.find(f => f.id === id);
          if (feed) {
              const additionalStock = prompt('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)?');
              if (additionalStock && !isNaN(additionalStock) && parseFloat(additionalStock) > 0) {
                  feed.quantity += parseFloat(additionalStock);
                  feed.originalQuantity += parseFloat(additionalStock);
                  saveAllData();
                  displayFeeds();
                  checkStockLevels();
                  showAlert('‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
              }
          }
      }

      function deleteFeed(id) {
          if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
              farmData.feeds = farmData.feeds.filter(feed => feed.id !== id);
              saveAllData();
              displayFeeds();
              updateUsageSelects();
              checkStockLevels();
              showAlert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
          }
      }

      // === ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô ===
      function addMedical() {
          const type = document.getElementById('medicalType').value;
          const name = document.getElementById('medicalName').value;
          const brand = document.getElementById('medicalBrand').value;
          const quantity = parseInt(document.getElementById('medicalQuantity').value);
          const unit = document.getElementById('medicalUnit').value;
          const price = parseFloat(document.getElementById('medicalPrice').value);
          const purchaseDate = document.getElementById('medicalPurchaseDate').value;
          const expiryDate = document.getElementById('medicalExpiryDate').value;

          if (!type || !name || !quantity || !unit || !price || !purchaseDate) {
              showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
              return;
          }

          const newMedical = {
              id: Date.now(),
              type: type,
              name: name,
              brand: brand,
              quantity: quantity,
              originalQuantity: quantity,
              unit: unit,
              price: price,
              purchaseDate: purchaseDate,
              expiryDate: expiryDate,
              createdDate: new Date().toISOString()
          };

          farmData.medical.push(newMedical);
          saveAllData();
          displayMedical();
          updateUsageSelects();
          checkStockLevels();
          clearMedicalForm();
          showAlert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
      }

      function clearMedicalForm() {
          document.getElementById('medicalType').value = '';
          document.getElementById('medicalName').value = '';
          document.getElementById('medicalBrand').value = '';
          document.getElementById('medicalQuantity').value = '';
          document.getElementById('medicalUnit').value = '';
          document.getElementById('medicalPrice').value = '';
          document.getElementById('medicalExpiryDate').value = '';
          document.getElementById('medicalPurchaseDate').value = new Date().toISOString().split('T')[0];
      }

      function displayMedical() {
          const container = document.getElementById('medicalStock');
          
          if (farmData.medical.length === 0) {
              container.innerHTML = '<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</p>';
              return;
          }

          const medicalTypes = {
              'vaccine': '‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô',
              'antibiotic': '‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞',
              'vitamin': '‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô',
              'deworming': '‡∏¢‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏û‡∏¢‡∏≤‡∏ò‡∏¥',
              'hormone': '‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô',
              'supplement': '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°',
              'disinfectant': '‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠'
          };

          let html = '';
          farmData.medical.forEach(med => {
              const totalValue = med.quantity * med.price;
              const stockStatus = getStockStatus(med.quantity, 'medical');
              const daysRemaining = calculateDaysRemaining(med.quantity, 'medical');
              
              html += `
                  <div class="stock-item ${stockStatus === 'empty' ? 'out-of-stock' : stockStatus === 'low' ? 'low-stock' : ''}">
                      <div class="stock-info">
                          <div class="stock-name">üíä ${medicalTypes[med.type]} - ${med.name}</div>
                          <div class="stock-details">${med.brand ? '‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠: ' + med.brand + ' | ' : ''}‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${med.quantity} ${med.unit} ‡∏à‡∏≤‡∏Å ${med.originalQuantity} ${med.unit}</div>
                          <div class="stock-details">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤: ${med.price} ‡∏ö‡∏≤‡∏ó/${med.unit} | ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${totalValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                          <div class="stock-details">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠: ${new Date(med.purchaseDate).toLocaleDateString('th-TH')} ${med.expiryDate ? '| ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: ' + new Date(med.expiryDate).toLocaleDateString('th-TH') : ''}</div>
                          <div class="stock-status ${stockStatus}">${getStockStatusText(stockStatus, daysRemaining)}</div>
                      </div>
                      <div class="stock-actions">
                          <button class="btn btn-small btn-warning" onclick="restockMedical(${med.id})">‚ûï ‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
                          <button class="btn btn-small btn-danger" onclick="deleteMedical(${med.id})">üóëÔ∏è ‡∏•‡∏ö</button>
                      </div>
                  </div>
              `;
          });

          container.innerHTML = html;
      }

      function restockMedical(id) {
          const medical = farmData.medical.find(m => m.id === id);
          if (medical) {
              const additionalStock = prompt(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà (${medical.unit})?`);
              if (additionalStock && !isNaN(additionalStock) && parseFloat(additionalStock) > 0) {
                  medical.quantity += parseFloat(additionalStock);
                  medical.originalQuantity += parseFloat(additionalStock);
                  saveAllData();
                  displayMedical();
                  checkStockLevels();
                  showAlert('‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
              }
          }
      }

      function deleteMedical(id) {
          if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
              farmData.medical = farmData.medical.filter(med => med.id !== id);
              saveAllData();
              displayMedical();
              updateUsageSelects();
              checkStockLevels();
              showAlert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
          }
      }

      // === ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ===
      function updateUsageSelects() {
          const feedSelect = document.getElementById('useFeedSelect');
          feedSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</option>';
          
          farmData.feeds.forEach(feed => {
              if (feed.quantity > 0) {
                  const feedTypes = {
                      'prestarter': 'Pre-Starter',
                      'starter': 'Starter',
                      'grower': 'Grower',
                      'finisher': 'Finisher',
                      'sow': '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå',
                      'boar': '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå'
                  };
                  feedSelect.innerHTML += `<option value="${feed.id}">${feedTypes[feed.type]} - ${feed.brand} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${feed.quantity} ‡∏Å‡∏Å.)</option>`;
              }
          });

          const medicalSelect = document.getElementById('useMedicalSelect');
          medicalSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</option>';
          
          farmData.medical.forEach(med => {
              if (med.quantity > 0) {
                  const medicalTypes = {
                      'vaccine': '‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô',
                      'antibiotic': '‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞',
                      'vitamin': '‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô',
                      'deworming': '‡∏¢‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏û‡∏¢‡∏≤‡∏ò‡∏¥',
                      'hormone': '‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô',
                      'supplement': '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°',
                      'disinfectant': '‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠'
                  };
                  medicalSelect.innerHTML += `<option value="${med.id}">${medicalTypes[med.type]} - ${med.name} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${med.quantity} ${med.unit})</option>`;
              }
          });
      }

      function useFeed() {
          const feedId = document.getElementById('useFeedSelect').value;
          const amount = parseFloat(document.getElementById('useFeedAmount').value);

          if (!feedId || !amount || amount <= 0) {
              showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
              return;
          }

          const feed = farmData.feeds.find(f => f.id == feedId);
          if (!feed) {
              showAlert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', 'error');
              return;
          }

          if (amount > feed.quantity) {
              showAlert(`‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${feed.quantity} ‡∏Å‡∏Å.)`, 'error');
              return;
          }

          const usage = {
              id: Date.now(),
              type: 'feed',
              itemId: feedId,
              itemName: `${feed.type} - ${feed.brand}`,
              amount: amount,
              unit: '‡∏Å‡∏Å.',
              date: new Date().toISOString().split('T')[0],
              time: new Date().toISOString()
          };

          farmData.usage.push(usage);
          feed.quantity -= amount;
          
          saveAllData();
          updateUsageSelects();
          displayFeeds();
          displayTodayUsage();
          checkStockLevels();
          
          document.getElementById('useFeedSelect').value = '';
          document.getElementById('useFeedAmount').value = '';
          
          showAlert(`‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ${amount} ‡∏Å‡∏Å. ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
      }

      function useMedical() {
          const medicalId = document.getElementById('useMedicalSelect').value;
          const amount = parseFloat(document.getElementById('useMedicalAmount').value);

          if (!medicalId || !amount || amount <= 0) {
              showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
              return;
          }

          const medical = farmData.medical.find(m => m.id == medicalId);
          if (!medical) {
              showAlert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', 'error');
              return;
          }

          if (amount > medical.quantity) {
              showAlert(`‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${medical.quantity} ${medical.unit})`, 'error');
              return;
          }

          const usage = {
              id: Date.now(),
              type: 'medical',
              itemId: medicalId,
              itemName: `${medical.type} - ${medical.name}`,
              amount: amount,
              unit: medical.unit,
              date: new Date().toISOString().split('T')[0],
              time: new Date().toISOString()
          };

          farmData.usage.push(usage);
          medical.quantity -= amount;
          
          saveAllData();
          updateUsageSelects();
          displayMedical();
          displayTodayUsage();
          checkStockLevels();
          
          document.getElementById('useMedicalSelect').value = '';
          document.getElementById('useMedicalAmount').value = '';
          
          showAlert(`‡πÉ‡∏ä‡πâ‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô ${amount} ${medical.unit} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
      }

      function displayTodayUsage() {
          const container = document.getElementById('todayUsage');
          const today = new Date().toISOString().split('T')[0];
          const todayUsage = farmData.usage.filter(usage => usage.date === today);

          if (todayUsage.length === 0) {
              container.innerHTML = '<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';
              return;
          }

          let html = '<div class="table-container"><table class="table"><thead><tr><th>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤</th><th>üìã ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr></thead><tbody>';

          todayUsage.forEach(usage => {
              const time = new Date(usage.time).toLocaleTimeString('th-TH');
              const typeText = usage.type === 'feed' ? 'üåæ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£' : 'üíä ‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô';
              
              html += `
                  <tr>
                      <td>${time}</td>
                      <td>${typeText}</td>
                      <td>${usage.itemName}</td>
                      <td>${usage.amount} ${usage.unit}</td>
                  </tr>
              `;
          });

          html += '</tbody></table></div>';
          container.innerHTML = html;
      }

      // === ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å ===
      function getStockStatus(quantity, type) {
          const threshold = LOW_STOCK_THRESHOLD[type === 'feed' ? 'feeds' : 'medical'];
          
          if (quantity <= 0) return 'empty';
          if (quantity <= threshold) return 'low';
          return 'normal';
      }

      function getStockStatusText(status, daysRemaining) {
          switch(status) {
              case 'empty':
                  return 'üî¥ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î';
              case 'low':
                  return `üü° ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥ ${daysRemaining ? '(‡∏û‡∏≠‡πÉ‡∏ä‡πâ ' + daysRemaining + ' ‡∏ß‡∏±‡∏ô)' : ''}`;
              case 'normal':
                  return `üü¢ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏Å‡∏ï‡∏¥ ${daysRemaining ? '(‡∏û‡∏≠‡πÉ‡∏ä‡πâ ' + daysRemaining + ' ‡∏ß‡∏±‡∏ô)' : ''}`;
              default:
                  return '‚ùì ‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
          }
      }

      function calculateDaysRemaining(quantity, type) {
          const sevenDaysAgo = new Date();
          sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
          const sevenDaysAgoStr = sevenDaysAgo.toISOString().split('T')[0];
          
          const recentUsage = farmData.usage.filter(usage => 
              usage.type === type && usage.date >= sevenDaysAgoStr
          );
          
          const totalUsed = recentUsage.reduce((sum, usage) => sum + usage.amount, 0);
          const dailyAverage = totalUsed / 7;
          
          if (dailyAverage <= 0) return null;
          return Math.floor(quantity / dailyAverage);
      }

      function checkStockLevels() {
          const warnings = [];
          
          farmData.feeds.forEach(feed => {
              const status = getStockStatus(feed.quantity, 'feed');
              if (status === 'low' || status === 'empty') {
                  const feedTypes = {
                      'prestarter': 'Pre-Starter',
                      'starter': 'Starter',
                      'grower': 'Grower',
                      'finisher': 'Finisher',
                      'sow': '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå',
                      'boar': '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå'
                  };
                  warnings.push({
                      type: 'warning',
                      message: `üåæ ${feedTypes[feed.type]} - ${feed.brand} ${status === 'empty' ? '‡∏´‡∏°‡∏î' : '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢'} (${feed.quantity} ‡∏Å‡∏Å.)`
                  });
              }
          });
          
          farmData.medical.forEach(med => {
              const status = getStockStatus(med.quantity, 'medical');
              if (status === 'low' || status === 'empty') {
                  const medicalTypes = {
                      'vaccine': '‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô',
                      'antibiotic': '‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞',
                      'vitamin': '‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô',
                      'deworming': '‡∏¢‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏û‡∏¢‡∏≤‡∏ò‡∏¥',
                      'hormone': '‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô',
                      'supplement': '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°',
                      'disinfectant': '‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠'
                  };
                  warnings.push({
                      type: 'warning',
                      message: `üíä ${medicalTypes[med.type]} - ${med.name} ${status === 'empty' ? '‡∏´‡∏°‡∏î' : '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢'} (${med.quantity} ${med.unit})`
                  });
              }
          });

          const warningsContainer = document.getElementById('stockWarnings');
          if (warnings.length > 0) {
              let html = '<div class="alert alert-warning"><strong>‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å:</strong><ul style="margin: 10px 0; padding-left: 20px;">';
              warnings.forEach(warning => {
                  html += `<li>${warning.message}</li>`;
              });
              html += '</ul></div>';
              warningsContainer.innerHTML = html;
          } else {
              warningsContainer.innerHTML = '';
          }
      }

      // === ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ===
      function addSale() {
          const date = document.getElementById('saleDate').value;
          const type = document.getElementById('saleType').value;
          const quantity = parseInt(document.getElementById('saleQuantity').value);
          const weight = parseFloat(document.getElementById('saleWeight').value) || 0;
          const pricePerKg = parseFloat(document.getElementById('salePricePerKg').value);
          const transportCost = parseFloat(document.getElementById('saleTransportCost').value) || 0;
          const buyer = document.getElementById('saleBuyer').value;
          const notes = document.getElementById('saleNotes').value;

          if (!date || !type || !quantity || !pricePerKg) {
              showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
              return;
          }

          const totalRevenue = weight * pricePerKg;
          const netRevenue = totalRevenue - transportCost;

          const newSale = {
              id: Date.now(),
              date: date,
              type: type,
              quantity: quantity,
              weight: weight,
              pricePerKg: pricePerKg,
              transportCost: transportCost,
              totalRevenue: totalRevenue,
              netRevenue: netRevenue,
              buyer: buyer,
              notes: notes,
              createdDate: new Date().toISOString()
          };

          farmData.sales.push(newSale);
          saveAllData();
          displaySales();
          updateOverview();
          clearSaleForm();
          showAlert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
      }

      function clearSaleForm() {
          document.getElementById('saleType').value = '';
          document.getElementById('saleQuantity').value = '';
          document.getElementById('saleWeight').value = '';
          document.getElementById('salePricePerKg').value = '';
          document.getElementById('saleTransportCost').value = '';
          document.getElementById('saleBuyer').value = '';
          document.getElementById('saleNotes').value = '';
          document.getElementById('saleDate').value = new Date().toISOString().split('T')[0];
      }

      function displaySales() {
          const container = document.getElementById('salesHistory');
          
          if (farmData.sales.length === 0) {
              container.innerHTML = '<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>';
              return;
          }

          const saleTypes = {
              'piglet': '‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£',
              'grower': '‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô',
              'finisher': '‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô',
              'sow': '‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå',
              'boar': '‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå'
          };

          let html = '<table class="table"><thead><tr><th>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>üê∑ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‚öñÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</th><th>üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th><th>üë§ ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠</th><th>üîß ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody>';

          farmData.sales.forEach(sale => {
              html += `
                  <tr>
                      <td>${new Date(sale.date).toLocaleDateString('th-TH')}</td>
                      <td>${saleTypes[sale.type]}</td>
                      <td>${sale.quantity} ‡∏ï‡∏±‡∏ß</td>
                      <td>${sale.weight > 0 ? sale.weight + ' ‡∏Å‡∏Å.' : '-'}</td>
                      <td>${sale.netRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                      <td>${sale.buyer || '-'}</td>
                      <td>
                          <button class="btn btn-small btn-danger" onclick="deleteSale(${sale.id})">üóëÔ∏è ‡∏•‡∏ö</button>
                      </td>
                  </tr>
              `;
          });

          html += '</tbody></table>';
          container.innerHTML = html;
      }

      function deleteSale(id) {
          if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
              farmData.sales = farmData.sales.filter(sale => sale.id !== id);
              saveAllData();
              displaySales();
              updateOverview();
              showAlert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
          }
      }

      // === ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° ===
      function updateOverview() {
          const totalPigs = farmData.pigs.reduce((sum, pig) => sum + pig.quantity, 0);
          const feedItems = farmData.feeds.length;
          const medicalItems = farmData.medical.length;
          
          const lowStockFeeds = farmData.feeds.filter(feed => getStockStatus(feed.quantity, 'feed') !== 'normal');
          const lowStockMedical = farmData.medical.filter(med => getStockStatus(med.quantity, 'medical') !== 'normal');
          const lowStockTotal = lowStockFeeds.length + lowStockMedical.length;

          document.getElementById('totalPigs').textContent = totalPigs || '-';
          document.getElementById('feedItems').textContent = feedItems || '-';
          document.getElementById('medicalItems').textContent = medicalItems || '-';
          document.getElementById('lowStockItems').textContent = lowStockTotal || '-';

          const summaryContainer = document.getElementById('stockSummary');
          if (farmData.feeds.length > 0 || farmData.medical.length > 0 || farmData.usage.length > 0) {
              const totalFeedValue = farmData.feeds.reduce((sum, feed) => sum + (feed.quantity * feed.price), 0);
              const totalMedicalValue = farmData.medical.reduce((sum, med) => sum + (med.quantity * med.price), 0);
              const totalSales = farmData.sales.reduce((sum, sale) => sum + sale.netRevenue, 0);
              
              const today = new Date().toISOString().split('T')[0];
              const todayUsage = farmData.usage.filter(usage => usage.date === today);
              const todayFeedUsage = todayUsage.filter(u => u.type === 'feed').reduce((sum, u) => sum + u.amount, 0);
              const todayMedicalUsage = todayUsage.filter(u => u.type === 'medical').reduce((sum, u) => sum + u.amount, 0);

              summaryContainer.innerHTML = `
                  <div class="form-grid">
                      <div>
                          <h4>üí∞ ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h4>
                          <p><strong>üåæ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£:</strong> ${totalFeedValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                          <p><strong>üíä ‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô:</strong> ${totalMedicalValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                          <p><strong>üíµ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${(totalFeedValue + totalMedicalValue).toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                      </div>
                      <div>
                          <h4>üìä ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                          <p><strong>üåæ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:</strong> ${todayFeedUsage.toLocaleString()} ‡∏Å‡∏Å.</p>
                          <p><strong>üíä ‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:</strong> ${todayMedicalUsage} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</p>
                          <p><strong>üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°:</strong> ${totalSales.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                      </div>
                  </div>
                  <div style="margin-top: 20px;">
                      <h4>üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h4>
                      <p><strong>üìù ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong> ${farmData.usage.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                      <p><strong>‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å:</strong> ${lowStockTotal} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                      <p><strong>üïê ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> ${new Date().toLocaleString('th-TH')}</p>
                  </div>
              `;
          } else {
              summaryContainer.innerHTML = '<p>üöÄ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
          }
      }

      // === ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ===
      function generateReport() {
          const type = document.getElementById('reportType').value;
          const container = document.getElementById('reportResults');
          
          switch(type) {
              case 'overview':
                  generateOverviewReport(container);
                  break;
              case 'stock':
                  generateStockReport(container);
                  break;
              case 'usage':
                  generateUsageReport(container);
                  break;
              case 'financial':
                  generateFinancialReport(container);
                  break;
              case 'livestock':
                  generateLivestockReport(container);
                  break;
              case 'sales':
                  generateSalesReport(container);
                  break;
          }
      }

      function generateUsageReport(container) {
          const last30Days = new Date();
          last30Days.setDate(last30Days.getDate() - 30);
          const last30DaysStr = last30Days.toISOString().split('T')[0];
          
          const recentUsage = farmData.usage.filter(usage => usage.date >= last30DaysStr);
          const feedUsage = recentUsage.filter(u => u.type === 'feed');
          const medicalUsage = recentUsage.filter(u => u.type === 'medical');
          
          const totalFeedUsed = feedUsage.reduce((sum, u) => sum + u.amount, 0);
          const totalMedicalUsed = medicalUsage.reduce((sum, u) => sum + u.amount, 0);
          const avgFeedPerDay = totalFeedUsed / 30;
          const avgMedicalPerDay = totalMedicalUsed / 30;

          const usageByDate = {};
          recentUsage.forEach(usage => {
              if (!usageByDate[usage.date]) {
                  usageByDate[usage.date] = [];
              }
              usageByDate[usage.date].push(usage);
          });

          const sortedDates = Object.keys(usageByDate).sort().reverse();

          let tableHTML = '';
          
          if (sortedDates.length === 0) {
              tableHTML = `
                  <tr>
                      <td colspan="5" style="text-align: center; padding: 40px; color: #666;">
                          ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô 30 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                      </td>
                  </tr>
              `;
          } else {
              sortedDates.forEach((date, dateIndex) => {
                  const dateUsage = usageByDate[date];
                  const formattedDate = new Date(date).toLocaleDateString('th-TH');
                  
                  dateUsage.forEach((usage, usageIndex) => {
                      const typeText = usage.type === 'feed' ? 'üåæ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£' : 'üíä ‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô';
                      const timeText = new Date(usage.time).toLocaleTimeString('th-TH', {
                          hour: '2-digit',
                          minute: '2-digit'
                      });
                      
                      const isFirstRowOfDate = usageIndex === 0;
                      
                      tableHTML += `
                          <tr style="border-bottom: 1px solid #f0f0f0;">
                              <td style="${isFirstRowOfDate ? 'border-left: 4px solid #3498db; font-weight: 600;' : 'padding-left: 20px; color: #999;'}">${isFirstRowOfDate ? formattedDate : ''}</td>
                              <td>
                                  <span style="display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; ${usage.type === 'feed' ? 'background: #e8f5e8; color: #27ae60;' : 'background: #fef9e7; color: #f39c12;'}">${typeText}</span>
                              </td>
                              <td style="font-weight: 500;">${usage.itemName}</td>
                              <td style="text-align: right; font-weight: 600;">${usage.amount} ${usage.unit}</td>
                              <td style="color: #666; font-size: 14px;">${timeText}</td>
                          </tr>
                      `;
                  });
                  
                  if (dateIndex < sortedDates.length - 1) {
                      tableHTML += `
                          <tr>
                              <td colspan="5" style="height: 8px; background: #f8f9fa; border: none;"></td>
                          </tr>
                      `;
                  }
              });
          }

          container.innerHTML = `
              <div class="card">
                  <div class="card-title">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (30 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</div>
                  
                  <div class="form-grid" style="margin-bottom: 30px;">
                      <div>
                          <h4>üåæ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h4>
                          <p><strong>‡πÉ‡∏ä‡πâ‡∏£‡∏ß‡∏°:</strong> ${totalFeedUsed.toLocaleString()} ‡∏Å‡∏Å.</p>
                          <p><strong>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</strong> ${avgFeedPerDay.toFixed(1)} ‡∏Å‡∏Å.</p>
                          <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á:</strong> ${feedUsage.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                      </div>
                      <div>
                          <h4>üíä ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</h4>
                          <p><strong>‡πÉ‡∏ä‡πâ‡∏£‡∏ß‡∏°:</strong> ${totalMedicalUsed.toLocaleString()} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</p>
                          <p><strong>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</strong> ${avgMedicalPerDay.toFixed(1)} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</p>
                          <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á:</strong> ${medicalUsage.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                      </div>
                  </div>

                  <div style="margin-top: 30px;">
                      <h4>üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô</h4>
                      <div class="table-container" style="max-height: 600px; overflow-y: auto; border: 1px solid #ddd; border-radius: 12px; margin-top: 15px;">
                          <table class="table" style="margin: 0;">
                              <thead style="position: sticky; top: 0; background: #34495e; z-index: 10;">
                                  <tr>
                                      <th style="width: 120px; color: white;">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                      <th style="width: 120px; color: white;">üìã ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                      <th style="min-width: 250px; color: white;">üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                      <th style="width: 100px; color: white;">üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                      <th style="width: 80px; color: white;">‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  ${tableHTML}
                              </tbody>
                          </table>
                      </div>
                      
                      <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 12px;">
                          <div class="form-grid">
                              <div>
                                  <p><strong>üìÖ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong> ${sortedDates.length} ‡∏ß‡∏±‡∏ô</p>
                                  <p><strong>üìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${recentUsage.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                              </div>
                              <div>
                                  <p><strong>üöÄ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:</strong> ${sortedDates.length > 0 ? new Date(sortedDates[sortedDates.length - 1]).toLocaleDateString('th-TH') : '-'}</p>
                                  <p><strong>üîÑ ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> ${sortedDates.length > 0 ? new Date(sortedDates[0]).toLocaleDateString('th-TH') : '-'}</p>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          `;
      }

      function generateStockReport(container) {
          const totalFeedValue = farmData.feeds.reduce((sum, feed) => sum + (feed.quantity * feed.price), 0);
          const totalMedicalValue = farmData.medical.reduce((sum, med) => sum + (med.quantity * med.price), 0);
          const lowStockItems = [
              ...farmData.feeds.filter(feed => getStockStatus(feed.quantity, 'feed') !== 'normal'),
              ...farmData.medical.filter(med => getStockStatus(med.quantity, 'medical') !== 'normal')
          ];

          let html = `
              <div class="card">
                  <div class="card-title">üì¶ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏±‡∏á</div>
                  <div class="form-grid">
                      <div>
                          <h4>üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</h4>
                          <p>üåæ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£: ${totalFeedValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                          <p>üíä ‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô: ${totalMedicalValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                          <p><strong>üíµ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${(totalFeedValue + totalMedicalValue).toLocaleString()} ‡∏ö‡∏≤‡∏ó</strong></p>
                      </div>
                      <div>
                          <h4>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏ï‡πá‡∏≠‡∏Å</h4>
                          <p>üåæ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£: ${farmData.feeds.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                          <p>üíä ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤: ${farmData.medical.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                          <p>‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏¥‡∏°: ${lowStockItems.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                      </div>
                  </div>
          `;

          if (lowStockItems.length > 0) {
              html += `
                  <div style="margin-top: 20px;">
                      <h4>‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</h4>
                      <div class="table-container">
                          <table class="table">
                              <thead>
                                  <tr><th>üìã ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>üì¶ ‡∏ä‡∏∑‡πà‡∏≠</th><th>üî¢ ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr>
                              </thead>
                              <tbody>
              `;

              lowStockItems.forEach(item => {
                  const isFood = item.hasOwnProperty('brand');
                  const status = getStockStatus(item.quantity, isFood ? 'feed' : 'medical');
                  const statusText = status === 'empty' ? 'üî¥ ‡∏´‡∏°‡∏î' : 'üü° ‡∏ï‡πà‡∏≥';
                  const typeIcon = isFood ? 'üåæ' : 'üíä';
                  
                  html += `
                      <tr>
                          <td>${typeIcon} ${isFood ? '‡∏≠‡∏≤‡∏´‡∏≤‡∏£' : '‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô'}</td>
                          <td>${isFood ? item.brand : item.name}</td>
                          <td>${item.quantity} ${isFood ? '‡∏Å‡∏Å.' : item.unit}</td>
                          <td>${statusText}</td>
                      </tr>
                  `;
              });

              html += '</tbody></table></div>';
          }

          html += '</div>';
          container.innerHTML = html;
      }

      function generateFinancialReport(container) {
          const totalSales = farmData.sales.reduce((sum, sale) => sum + sale.netRevenue, 0);
          const feedCosts = farmData.feeds.reduce((sum, feed) => sum + (feed.originalQuantity * feed.price), 0);
          const medicalCosts = farmData.medical.reduce((sum, med) => sum + (med.originalQuantity * med.price), 0);
          const totalCosts = feedCosts + medicalCosts;
          const profit = totalSales - totalCosts;

          container.innerHTML = `
              <div class="card">
                  <div class="card-title">üí∞ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</div>
                  <div class="form-grid">
                      <div>
                          <h4>üíµ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</h4>
                          <p>üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢: ${totalSales.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                          <p>üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢: ${farmData.sales.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                      </div>
                      <div>
                          <h4>üí∏ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h4>
                          <p>üåæ ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£: ${feedCosts.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                          <p>üíä ‡∏Ñ‡πà‡∏≤‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô: ${medicalCosts.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                          <p><strong>üí≥ ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢: ${totalCosts.toLocaleString()} ‡∏ö‡∏≤‡∏ó</strong></p>
                      </div>
                  </div>
                  
                  <div style="margin-top: 20px;">
                      <h4>üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h4>
                      <p><strong>üíé ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${profit.toLocaleString()} ‡∏ö‡∏≤‡∏ó</strong></p>
                      <p>üìä ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£: ${totalSales > 0 ? (profit / totalSales * 100).toFixed(2) : 0}%</p>
                      <p>üìã ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ${totalSales > 0 ? (totalCosts / totalSales * 100).toFixed(2) : 0}%</p>
                  </div>
              </div>
          `;
      }

      function generateLivestockReport(container) {
          const totalPigs = farmData.pigs.reduce((sum, pig) => sum + pig.quantity, 0);
          const pigsByType = {};
          
          farmData.pigs.forEach(pig => {
              if (!pigsByType[pig.type]) {
                  pigsByType[pig.type] = { count: 0, total: 0 };
              }
              pigsByType[pig.type].count++;
              pigsByType[pig.type].total += pig.quantity;
          });

          const typeNames = {
              'sow': 'üê∑ ‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå',
              'boar': 'üêó ‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå',
              'piglet': 'üêΩ ‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£',
              'grower': 'üê∑ ‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô',
              'finisher': 'ü•© ‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô'
          };

          let html = `
              <div class="card">
                  <div class="card-title">üê∑ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏Å‡∏£</div>
                  <div class="table-container">
                      <table class="table">
                          <thead>
                              <tr><th>üê∑ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏∏‡∏Å‡∏£</th><th>üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</th><th>üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</th><th>üìä ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</th></tr>
                          </thead>
                          <tbody>
          `;

          Object.keys(pigsByType).forEach(type => {
              const percentage = totalPigs > 0 ? (pigsByType[type].total / totalPigs * 100).toFixed(1) : 0;
              html += `
                  <tr>
                      <td>${typeNames[type]}</td>
                      <td>${pigsByType[type].count}</td>
                      <td>${pigsByType[type].total}</td>
                      <td>${percentage}%</td>
                  </tr>
              `;
          });

          html += `
                          </tbody>
                      </table>
                  </div>
                  <div style="margin-top: 20px;">
                      <p><strong>üê∑ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalPigs} ‡∏ï‡∏±‡∏ß</strong></p>
                      <p>üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${farmData.pigs.length} ‡∏Å‡∏•‡∏∏‡πà‡∏°</p>
                  </div>
              </div>
          `;

          container.innerHTML = html;
      }

      function generateSalesReport(container) {
          const salesByType = {};
          let totalRevenue = 0;
          let totalQuantity = 0;

          farmData.sales.forEach(sale => {
              if (!salesByType[sale.type]) {
                  salesByType[sale.type] = { quantity: 0, revenue: 0, count: 0 };
              }
              salesByType[sale.type].quantity += sale.quantity;
              salesByType[sale.type].revenue += sale.netRevenue;
              salesByType[sale.type].count++;
              totalRevenue += sale.netRevenue;
              totalQuantity += sale.quantity;
          });

          const saleTypes = {
              'piglet': 'üêΩ ‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£',
              'grower': 'üê∑ ‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô',
              'finisher': 'ü•© ‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô',
              'sow': 'üê∑ ‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå',
              'boar': 'üêó ‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå'
          };

          let html = `
              <div class="card">
                  <div class="card-title">üí∞ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
                  <div class="table-container">
                      <table class="table">
                          <thead>
                              <tr><th>üê∑ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏∏‡∏Å‡∏£</th><th>üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</th><th>üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏ö‡∏≤‡∏ó)</th><th>üìä ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</th></tr>
                          </thead>
                          <tbody>
          `;

          Object.keys(salesByType).forEach(type => {
              const percentage = totalRevenue > 0 ? (salesByType[type].revenue / totalRevenue * 100).toFixed(1) : 0;
              html += `
                  <tr>
                      <td>${saleTypes[type]}</td>
                      <td>${salesByType[type].quantity}</td>
                      <td>${salesByType[type].revenue.toLocaleString()}</td>
                      <td>${percentage}%</td>
                  </tr>
              `;
          });

          html += `
                          </tbody>
                      </table>
                  </div>
                  <div style="margin-top: 20px;">
                      <p><strong>üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°: ${totalRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</strong></p>
                      <p>üê∑ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢: ${totalQuantity} ‡∏ï‡∏±‡∏ß</p>
                      <p>üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢: ${farmData.sales.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                      <p>üíµ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ï‡∏±‡∏ß: ${totalQuantity > 0 ? (totalRevenue / totalQuantity).toLocaleString() : 0} ‡∏ö‡∏≤‡∏ó</p>
                  </div>
              </div>
          `;

          container.innerHTML = html;
      }

      function generateOverviewReport(container) {
          const totalPigs = farmData.pigs.reduce((sum, pig) => sum + pig.quantity, 0);
          const totalSales = farmData.sales.reduce((sum, sale) => sum + sale.netRevenue, 0);
          const totalStockValue = farmData.feeds.reduce((sum, feed) => sum + (feed.quantity * feed.price), 0) +
                                farmData.medical.reduce((sum, med) => sum + (med.quantity * med.price), 0);

          container.innerHTML = `
              <div class="card">
                  <div class="card-title">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°</div>
                  <div class="form-grid">
                      <div>
                          <h4>üê∑ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏∏‡∏Å‡∏£</h4>
                          <p>üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏∏‡∏Å‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalPigs} ‡∏ï‡∏±‡∏ß</p>
                          <p>üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°: ${farmData.pigs.length} ‡∏Å‡∏•‡∏∏‡πà‡∏°</p>
                      </div>
                      <div>
                          <h4>üí∞ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h4>
                          <p>üíµ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°: ${totalSales.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                          <p>üì¶ ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${totalStockValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                      </div>
                  </div>
                  
                  <div style="margin-top: 20px;">
                      <h4>üìã ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</h4>
                      <p>üåæ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£: ${farmData.feeds.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                      <p>üíä ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤: ${farmData.medical.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                      <p>üìù ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${farmData.usage.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                      <p>üí∞ ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${farmData.sales.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                  </div>
              </div>
          `;
      }

      function exportReport() {
          const reportData = {
              exportDate: new Date().toISOString(),
              version: SYSTEM_VERSION,
              farmData: farmData,
              summary: {
                  totalPigs: farmData.pigs.reduce((sum, pig) => sum + pig.quantity, 0),
                  totalSales: farmData.sales.reduce((sum, sale) => sum + sale.netRevenue, 0),
                  totalStockValue: farmData.feeds.reduce((sum, feed) => sum + (feed.quantity * feed.price), 0) +
                                 farmData.medical.reduce((sum, med) => sum + (med.quantity * med.price), 0),
                  lowStockItems: [
                      ...farmData.feeds.filter(feed => getStockStatus(feed.quantity, 'feed') !== 'normal'),
                      ...farmData.medical.filter(med => getStockStatus(med.quantity, 'medical') !== 'normal')
                  ].length
              }
          };

          const blob = new Blob([JSON.stringify(reportData, null, 2)], {type: 'application/json'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `farm-report-${new Date().toISOString().split('T')[0]}.json`;
          a.click();
          URL.revokeObjectURL(url);
          
          showAlert('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
      }

      // === ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ===
      function exportSystemData() {
          const exportData = {
              ...farmSystemData,
              exportDate: new Date().toISOString(),
              exportVersion: SYSTEM_VERSION
          };

          const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `farm-data-v${SYSTEM_VERSION}-${new Date().toISOString().split('T')[0]}.json`;
          a.click();
          URL.revokeObjectURL(url);
          
          showAlert('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
      }

      function importBackupData(fileInput) {
          const file = fileInput.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = function(e) {
              try {
                  const importedData = JSON.parse(e.target.result);
                  const migratedData = migrateData(importedData);
                  
                  if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå ${file.name} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà`)) {
                      farmSystemData = migratedData;
                      farmData = migratedData.farmData;
                      saveAllData();
                      
                      updateOverview();
                      updateUsageSelects();
                      checkStockLevels();
                      
                      showAlert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ${file.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`, 'success');
                      
                      setTimeout(() => location.reload(), 1000);
                  }
              } catch (error) {
                  showAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå', 'error');
                  console.error('Import error:', error);
              }
          };
          reader.readAsText(file);
      }

      function viewBackupHistory() {
          const backupKeys = [];
          for (let i = 0; i < localStorage.length; i++) {
              const key = localStorage.key(i);
              if (key.startsWith(`${STORAGE_KEY}_backup_`)) {
                  backupKeys.push(key);
              }
          }
          
          if (backupKeys.length === 0) {
              showAlert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'error');
              return;
          }
          
          let message = '‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö:\n\n';
          backupKeys.forEach(key => {
              const timestamp = key.replace(`${STORAGE_KEY}_backup_`, '');
              const date = new Date(timestamp.replace(/-/g, ':')).toLocaleString('th-TH');
              message += `‚Ä¢ ${date}\n`;
          });
          
          alert(message);
      }

      function addDataManagementSection() {
          const overviewSection = document.getElementById('overview');
          const dataManagementHTML = `
              <div class="card">
                  <div class="card-title">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏≥‡∏£‡∏≠‡∏á</div>
                  <div class="form-grid">
                      <div>
                          <h4>‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h4>
                          <p><strong>üì± ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô:</strong> ${farmSystemData.version}</p>
                          <p><strong>üïê ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> ${new Date(farmSystemData.lastUpdate).toLocaleString('th-TH')}</p>
                          ${farmSystemData.previousVersion ? `<p><strong>‚¨ÜÔ∏è ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡∏à‡∏≤‡∏Å:</strong> ${farmSystemData.previousVersion}</p>` : ''}
                          ${isStandalone ? '<p><strong>üì± ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span style="color: #27ae60;">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ‡πÅ‡∏•‡πâ‡∏ß</span></p>' : '<p><strong>üåê ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span style="color: #f39c12;">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö</span></p>'}
                      </div>
                      <div>
                          <h4>üîß ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                          <button class="btn btn-primary" onclick="exportSystemData()">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô</button>
                          <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importBackupData(this)">
                          <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                          <button class="btn btn-warning" onclick="viewBackupHistory()">üìã ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏£‡∏≠‡∏á</button>
                      </div>
                  </div>
              </div>
          `;
          
          const statsGrid = overviewSection.querySelector('.stats-grid');
          if (statsGrid) {
              statsGrid.insertAdjacentHTML('afterend', dataManagementHTML);
          }
      }

      // Mobile-specific optimizations
      function optimizeForMobile() {
          document.addEventListener('focusin', function(e) {
              if (e.target.matches('input, select, textarea')) {
                  document.body.style.position = 'fixed';
                  document.body.style.width = '100%';
              }
          });

          document.addEventListener('focusout', function(e) {
              if (e.target.matches('input, select, textarea')) {
                  document.body.style.position = '';
                  document.body.style.width = '';
              }
          });

          function hapticFeedback() {
              if (navigator.vibrate) {
                  navigator.vibrate(50);
              }
          }

          document.addEventListener('click', function(e) {
              if (e.target.matches('.btn, .nav-tab')) {
                  hapticFeedback();
              }
          });

          document.body.style.webkitOverflowScrolling = 'touch';
          
          setTimeout(function() {
              window.scrollTo(0, 1);
          }, 100);
      }

      // Auto-save ‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
      setInterval(saveAllData, 30000);

      // Initialize mobile optimizations
      document.addEventListener('DOMContentLoaded', function() {
          optimizeForMobile();
      });

      // Handle online/offline status
      window.addEventListener('online', function() {
          showAlert('üåê ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'success');
      });

      window.addEventListener('offline', function() {
          showAlert('üì¥ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‡πÅ‡∏ï‡πà‡πÅ‡∏≠‡∏õ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ', 'warning');
      });

      // Add PWA update detection
      if ('serviceWorker' in navigator) {
          navigator.serviceWorker.addEventListener('controllerchange', function() {
              if (confirm('üîÑ ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏≠‡∏õ‡πÉ‡∏´‡∏°‡πà ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                  window.location.reload();
              }
          });
      }

      // Prevent zoom on double tap for better mobile experience
      let lastTouchTime = 0;
      document.addEventListener('touchend', function(event) {
          const currentTime = new Date().getTime();
          const tapLength = currentTime - lastTouchTime;
          if (tapLength < 500 && tapLength > 0) {
              event.preventDefault();
          }
          lastTouchTime = currentTime;
      });

      // Add loading states for better UX
      function showLoading(buttonElement) {
          const originalText = buttonElement.textContent;
          buttonElement.innerHTML = '<span class="loading"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
          buttonElement.disabled = true;
          
          return function hideLoading() {
              buttonElement.textContent = originalText;
              buttonElement.disabled = false;
          };
      }

      // Enhanced error handling
      window.addEventListener('error', function(e) {
          console.error('App Error:', e.error);
          showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
      });

      // Add swipe gestures for navigation (optional)
      let startX = 0;
      let startY = 0;

      document.addEventListener('touchstart', function(e) {
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
      });

      document.addEventListener('touchend', function(e) {
          if (!startX || !startY) return;
          
          const endX = e.changedTouches[0].clientX;
          const endY = e.changedTouches[0].clientY;
          
          const diffX = startX - endX;
          const diffY = startY - endY;
          
          // Horizontal swipe
          if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
              if (diffX > 0) {
                  // Swipe left - next section
                  console.log('Swiped left');
              } else {
                  // Swipe right - previous section  
                  console.log('Swiped right');
              }
          }
          
          startX = 0;
          startY = 0;
      });

      // === Manual Install Instructions ===
      function showInstallInstructions() {
          const userAgent = navigator.userAgent.toLowerCase();
          let instructions = '';
          
          if (userAgent.includes('iphone') || userAgent.includes('ipad')) {
              instructions = `üì± ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏ô iOS:\n1. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Share (üì§) ‡πÉ‡∏ô Safari\n2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏Æ‡∏°"\n3. ‡∏Å‡∏î "‡πÄ‡∏û‡∏¥‡πà‡∏°" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á`;
          } else if (userAgent.includes('android')) {
              instructions = `üì± ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏ô Android:\n1. ‡∏Å‡∏î‡πÄ‡∏°‡∏ô‡∏π (‚ãÆ) ‡πÉ‡∏ô Chrome\n2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Add to Home screen"\n3. ‡∏Å‡∏î "Add" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á`;
          } else {
              instructions = `üíª ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå:\n1. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚äï ‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ö URL (Chrome)\n2. ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡πÄ‡∏°‡∏ô‡∏π ‚Üí "Install app"\n3. ‡∏Å‡∏î "Install" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á`;
          }
          
          alert(instructions);
      }

      // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß
      if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
          document.addEventListener('DOMContentLoaded', function() {
              const installBtn = document.getElementById('manualInstall');
              if (installBtn) installBtn.style.display = 'none';
          });
      }

      console.log('üéâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£ Mobile App ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
      console.log(`üì± ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô: ${SYSTEM_VERSION}`);
      console.log('üîß ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏Å‡∏£, ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡∏¢‡∏≤, ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô, ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢, ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô, PWA, Mobile Optimized');
      console.log(`üì≤ PWA Status: ${isStandalone ? 'Installed' : 'Web Browser'}`);
  </script>
</body>
</html>
