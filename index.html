<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#2c3e50">
    <title>ระบบจัดการฟาร์มสุกร</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 12px;
        }

        @media (min-width: 768px) {
            .container {
                padding: 20px;
                max-width: 1200px;
            }
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .header h1 {
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* RESPONSIVE NAVIGATION */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            padding: 8px;
            position: relative;
        }

        /* Mobile Navigation - Horizontal Scroll */
        @media (max-width: 767px) {
            .nav-tabs {
                overflow-x: auto;
                overflow-y: hidden;
                gap: 4px;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .nav-tabs::-webkit-scrollbar {
                display: none;
            }
            
            .nav-tab {
                flex: 0 0 auto;
                padding: 12px 16px;
                font-size: 13px;
                white-space: nowrap;
                min-width: 80px;
            }
        }

        /* Tablet Navigation - Balanced */
        @media (min-width: 768px) and (max-width: 1023px) {
            .nav-tabs {
                gap: 8px;
            }
            
            .nav-tab {
                flex: 1;
                padding: 16px 20px;
                font-size: 15px;
                text-align: center;
            }
        }

        /* Desktop Navigation - Full Width */
        @media (min-width: 1024px) {
            .nav-tabs {
                gap: 12px;
                padding: 10px;
            }
            
            .nav-tab {
                flex: 1;
                padding: 18px 24px;
                font-size: 16px;
                text-align: center;
                font-weight: 600;
            }
        }

        .nav-tab {
            cursor: pointer;
            border: none;
            background: transparent;
            font-weight: 600;
            transition: all 0.3s ease;
            border-radius: 10px;
            color: #666;
            position: relative;
            touch-action: manipulation;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-tab:hover:not(.active) {
            background: #f1f3f4;
            color: #2c3e50;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .nav-tab:active {
            transform: scale(0.98);
        }

        @media (max-width: 480px) {
            .nav-tab .tab-text {
                display: none;
            }
            
            .nav-tab .tab-emoji {
                font-size: 18px;
            }
        }

        @media (min-width: 481px) {
            .nav-tab .tab-emoji {
                margin-right: 6px;
            }
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: #2c3e50;
            font-weight: 700;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .form-label.required::after {
            content: " *";
            color: #e74c3c;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
            appearance: none;
            -webkit-appearance: none;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 8px;
            margin-bottom: 8px;
            text-align: center;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
            box-shadow: 0 4px 12px rgba(149, 165, 166, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 13px;
            border-radius: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 16px;
            }
        }

        .stat-card {
            background: linear-gradient(135deg, white, #f8f9fa);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 2px 16px rgba(0,0,0,0.08);
        }

        .stat-number {
            font-size: 24px;
            font-weight: 800;
            color: #3498db;
            margin-bottom: 6px;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            font-weight: 500;
        }

        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 16px;
            font-weight: 500;
            border-left: 4px solid;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-left-color: #27ae60;
        }

        .alert-error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-left-color: #e74c3c;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border-left-color: #f39c12;
        }

        .hidden {
            display: none;
        }

        .manual-install {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 12px 16px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(231, 76, 60, 0.4);
            z-index: 999999;
            border: none;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .manual-install:hover {
            transform: scale(1.05);
        }

        @media (display-mode: standalone) {
            .manual-install {
                display: none !important;
            }
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 600px;
        }

        .table th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
        }

        .table td {
            padding: 10px 8px;
            border-bottom: 1px solid #dee2e6;
            font-size: 13px;
        }

        .table tr:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <button id="manualInstall" class="manual-install" onclick="showInstallInstructions()">
        📱 ติดตั้งแอป
    </button>

    <div class="container">
        <div class="header">
            <h1>ระบบจัดการฟาร์มสุกร</h1>
            <p>ระบบการจัดการ จำนวนสุกร อาหาร ยา การขาย สรุปรายงาน</p>
        </div>

        <div id="alertMessage" class="alert hidden"></div>
        <div id="stockWarnings"></div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('overview')">
                <span class="tab-emoji">🏠</span>
                <span class="tab-text">ภาพรวม</span>
            </button>
            <button class="nav-tab" onclick="showSection('pigs')">
                <span class="tab-emoji">🐷</span>
                <span class="tab-text">สุกร</span>
            </button>
            <button class="nav-tab" onclick="showSection('feeds')">
                <span class="tab-emoji">🌾</span>
                <span class="tab-text">อาหาร</span>
            </button>
            <button class="nav-tab" onclick="showSection('medical')">
                <span class="tab-emoji">💊</span>
                <span class="tab-text">ยา</span>
            </button>
            <button class="nav-tab" onclick="showSection('usage')">
                <span class="tab-emoji">📝</span>
                <span class="tab-text">ใช้งาน</span>
            </button>
            <button class="nav-tab" onclick="showSection('sales')">
                <span class="tab-emoji">💰</span>
                <span class="tab-text">ขาย</span>
            </button>
            <button class="nav-tab" onclick="showSection('reports')">
                <span class="tab-emoji">📊</span>
                <span class="tab-text">รายงาน</span>
            </button>
        </div>

        <!-- Overview Section -->
        <div id="overview" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalPigs">-</div>
                    <div class="stat-label">สุกรทั้งหมด</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="feedItems">-</div>
                    <div class="stat-label">รายการอาหาร</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="medicalItems">-</div>
                    <div class="stat-label">รายการยา</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="lowStockItems">-</div>
                    <div class="stat-label">สินค้าใกล้หมด</div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">📈 สรุปสถานะสต็อกวันนี้</div>
                <div id="stockSummary">
                    <p>ระบบพร้อมใช้งาน กรุณาเริ่มบันทึกข้อมูล</p>
                </div>
            </div>
        </div>

        <!-- Pigs Section -->
        <div id="pigs" class="content-section">
            <div class="card">
                <div class="card-title">➕ เพิ่มข้อมูลสุกร</div>
                <div class="form-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label required">ประเภทสุกร</label>
                            <select class="form-select" id="pigType">
                                <option value="">เลือกประเภท</option>
                                <option value="sow">แม่พันธุ์</option>
                                <option value="boar">พ่อพันธุ์</option>
                                <option value="piglet">ลูกสุกร</option>
                                <option value="grower">สุกรรุ่น</option>
                                <option value="finisher">สุกรขุน</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">จำนวน</label>
                            <input type="number" class="form-input" id="pigQuantity" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label required">วันที่เข้าฟาร์ม</label>
                            <input type="date" class="form-input" id="pigEntryDate">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label class="form-label">น้ำหนักเฉลี่ย (กิโลกรัม)</label>
                            <input type="number" class="form-input" id="pigWeight" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">อายุ (วัน)</label>
                            <input type="number" class="form-input" id="pigAge">
                        </div>
                        <div class="form-group">
                            <label class="form-label">หมายเหตุ</label>
                            <input type="text" class="form-input" id="pigNotes">
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="addPig()">💾 บันทึกข้อมูล</button>
                    <button class="btn btn-secondary" onclick="clearPigForm()">🔄 ล้างฟอร์ม</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">📋 รายการสุกรในฟาร์ม</div>
                <div id="pigsList">
                    <p>ยังไม่มีข้อมูลสุกร</p>
                </div>
            </div>
        </div>

        <!-- Feeds Section -->
        <div id="feeds" class="content-section">
            <div class="card">
                <div class="card-title">➕ เพิ่มอาหารเข้าสต็อก</div>
                <div class="form-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label required">ประเภทอาหาร</label>
                            <select class="form-select" id="feedType">
                                <option value="">เลือกประเภท</option>
                                <option value="prestarter">Pre-Starter (ลูกสุกรแรกเกิด)</option>
                                <option value="starter">Starter (ลูกสุกร 1-2 เดือน)</option>
                                <option value="grower">Grower (สุกรรุ่น 2-4 เดือน)</option>
                                <option value="finisher">Finisher (สุกรขุนใกล้ขาย)</option>
                                <option value="sow">อาหารแม่พันธุ์</option>
                                <option value="boar">อาหารพ่อพันธุ์</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">ชื่อยี่ห้อ/ผลิตภัณฑ์</label>
                            <input type="text" class="form-input" id="feedBrand">
                        </div>
                        <div class="form-group">
                            <label class="form-label required">จำนวน (กิโลกรัม)</label>
                            <input type="number" class="form-input" id="feedQuantity" step="0.1">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label class="form-label required">ราคาต่อกิโลกรัม (บาท)</label>
                            <input type="number" class="form-input" id="feedPrice" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">วันที่ซื้อ</label>
                            <input type="date" class="form-input" id="feedPurchaseDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">วันหมดอายุ</label>
                            <input type="date" class="form-input" id="feedExpiryDate">
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="addFeed()">✅ เพิ่มอาหารเข้าสต็อก</button>
                    <button class="btn btn-secondary" onclick="clearFeedForm()">🔄 ล้างฟอร์ม</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">📦 สต็อกอาหาร</div>
                <div id="feedStock">
                    <p>ยังไม่มีข้อมูลอาหาร</p>
                </div>
            </div>
        </div>

        <!-- Medical Section -->
        <div id="medical" class="content-section">
            <div class="card">
                <div class="card-title">➕ เพิ่มยาและวัคซีนเข้าสต็อก</div>
                <div class="form-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label required">ประเภท</label>
                            <select class="form-select" id="medicalType">
                                <option value="">เลือกประเภท</option>
                                <option value="vaccine">วัคซีน</option>
                                <option value="antibiotic">ยาปฏิชีวนะ</option>
                                <option value="vitamin">วิตามิน</option>
                                <option value="deworming">ยาถ่ายพยาธิ</option>
                                <option value="hormone">ฮอร์โมน</option>
                                <option value="supplement">อาหารเสริม</option>
                                <option value="disinfectant">ยาฆ่าเชื้อ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">ชื่อยา/วัคซีน</label>
                            <input type="text" class="form-input" id="medicalName">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ยี่ห้อ/บริษัทผลิต</label>
                            <input type="text" class="form-input" id="medicalBrand">
                        </div>
                        <div class="form-group">
                            <label class="form-label required">จำนวน</label>
                            <input type="number" class="form-input" id="medicalQuantity" step="1">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label class="form-label required">หน่วย</label>
                            <select class="form-select" id="medicalUnit">
                                <option value="">เลือกหน่วย</option>
                                <option value="dose">โดส</option>
                                <option value="ml">มิลลิลิตร</option>
                                <option value="tablet">เม็ด</option>
                                <option value="bottle">ขวด</option>
                                <option value="vial">หลอด</option>
                                <option value="kg">กิโลกรัม</option>
                                <option value="gram">กรัม</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">ราคาต่อหน่วย (บาท)</label>
                            <input type="number" class="form-input" id="medicalPrice" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">วันที่ซื้อ</label>
                            <input type="date" class="form-input" id="medicalPurchaseDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">วันหมดอายุ</label>
                            <input type="date" class="form-input" id="medicalExpiryDate">
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="addMedical()">✅ เพิ่มยา/วัคซีนเข้าสต็อก</button>
                    <button class="btn btn-secondary" onclick="clearMedicalForm()">🔄 ล้างฟอร์ม</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">💊 สต็อกยาและวัคซีน</div>
                <div id="medicalStock">
                    <p>ยังไม่มีข้อมูลยาและวัคซีน</p>
                </div>
            </div>
        </div>

        <!-- Usage Section -->
        <div id="usage" class="content-section">
            <div class="card">
                <div class="card-title">📝 บันทึกการใช้งานประจำวัน</div>
                <p>ระบบการใช้งานจะมาในเวอร์ชันถัดไป</p>
            </div>
        </div>

        <!-- Sales Section -->
        <div id="sales" class="content-section">
            <div class="card">
                <div class="card-title">💰 บันทึกการขาย</div>
                <p>ระบบการขายจะมาในเวอร์ชันถัดไป</p>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="content-section">
            <div class="card">
                <div class="card-title">📊 รายงานสรุป</div>
                <p>ระบบรายงานจะมาในเวอร์ชันถัดไป</p>
            </div>
        </div>
    </div>

    <script>
        // System Version
        const SYSTEM_VERSION = "3.0.0";
        const STORAGE_KEY = "pigFarmManagementSystem";

        // Data Structure
        let farmData = {
            pigs: [],
            feeds: [],
            medical: [],
            version: SYSTEM_VERSION
        };

        // Load data from localStorage
        function loadData() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    farmData = { ...farmData, ...parsed };
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(farmData));
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        // Show alert message
        function showAlert(message, type = 'success') {
            const alertEl = document.getElementById('alertMessage');
            alertEl.textContent = message;
            alertEl.className = `alert alert-${type}`;
            alertEl.classList.remove('hidden');
            
            setTimeout(() => {
                alertEl.classList.add('hidden');
            }, 5000);
        }

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            // Remove active class from all tabs
           document.querySelectorAll('.nav-tab').forEach(tab => {
               tab.classList.remove('active');
           });
           
           // Show selected section
           document.getElementById(sectionName).classList.add('active');
           
           // Add active class to clicked tab
           event.target.classList.add('active');
           
           // Update displays based on section
           switch(sectionName) {
               case 'overview':
                   updateOverview();
                   break;
               case 'pigs':
                   displayPigs();
                   break;
               case 'feeds':
                   displayFeeds();
                   break;
               case 'medical':
                   displayMedical();
                   break;
           }
       }

       // Pig Management
       function addPig() {
           const pigType = document.getElementById('pigType').value;
           const quantity = parseInt(document.getElementById('pigQuantity').value);
           const entryDate = document.getElementById('pigEntryDate').value;
           const weight = parseFloat(document.getElementById('pigWeight').value) || 0;
           const age = parseInt(document.getElementById('pigAge').value) || 0;
           const notes = document.getElementById('pigNotes').value;

           if (!pigType || !quantity || !entryDate) {
               showAlert('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน', 'error');
               return;
           }

           const newPig = {
               id: Date.now(),
               type: pigType,
               quantity: quantity,
               entryDate: entryDate,
               weight: weight,
               age: age,
               notes: notes,
               createdDate: new Date().toISOString()
           };

           farmData.pigs.push(newPig);
           saveData();
           displayPigs();
           updateOverview();
           clearPigForm();
           showAlert('เพิ่มข้อมูลสุกรเรียบร้อยแล้ว');
       }

       function clearPigForm() {
           document.getElementById('pigType').value = '';
           document.getElementById('pigQuantity').value = '';
           document.getElementById('pigWeight').value = '';
           document.getElementById('pigAge').value = '';
           document.getElementById('pigNotes').value = '';
           document.getElementById('pigEntryDate').value = new Date().toISOString().split('T')[0];
       }

       function displayPigs() {
           const container = document.getElementById('pigsList');
           
           if (farmData.pigs.length === 0) {
               container.innerHTML = '<p>ยังไม่มีข้อมูลสุกร</p>';
               return;
           }

           const typeNames = {
               'sow': 'แม่พันธุ์',
               'boar': 'พ่อพันธุ์',
               'piglet': 'ลูกสุกร',
               'grower': 'สุกรรุ่น',
               'finisher': 'สุกรขุน'
           };

           let html = `
               <div class="table-container">
                   <table class="table">
                       <thead>
                           <tr>
                               <th>ประเภท</th>
                               <th>จำนวน</th>
                               <th>น้ำหนัก</th>
                               <th>อายุ</th>
                               <th>วันที่เข้าฟาร์ม</th>
                               <th>การจัดการ</th>
                           </tr>
                       </thead>
                       <tbody>
           `;

           farmData.pigs.forEach(pig => {
               html += `
                   <tr>
                       <td>${typeNames[pig.type]}</td>
                       <td>${pig.quantity} ตัว</td>
                       <td>${pig.weight > 0 ? pig.weight + ' กก.' : '-'}</td>
                       <td>${pig.age > 0 ? pig.age + ' วัน' : '-'}</td>
                       <td>${new Date(pig.entryDate).toLocaleDateString('th-TH')}</td>
                       <td>
                           <button class="btn btn-small btn-danger" onclick="deletePig(${pig.id})">🗑️ ลบ</button>
                       </td>
                   </tr>
               `;
           });

           html += '</tbody></table></div>';
           container.innerHTML = html;
       }

       function deletePig(id) {
           if (confirm('ต้องการลบข้อมูลสุกรนี้หรือไม่?')) {
               farmData.pigs = farmData.pigs.filter(pig => pig.id !== id);
               saveData();
               displayPigs();
               updateOverview();
               showAlert('ลบข้อมูลเรียบร้อยแล้ว');
           }
       }

       // Feed Management
       function addFeed() {
           const feedType = document.getElementById('feedType').value;
           const brand = document.getElementById('feedBrand').value;
           const quantity = parseFloat(document.getElementById('feedQuantity').value);
           const price = parseFloat(document.getElementById('feedPrice').value);
           const purchaseDate = document.getElementById('feedPurchaseDate').value;
           const expiryDate = document.getElementById('feedExpiryDate').value;

           if (!feedType || !brand || !quantity || !price || !purchaseDate) {
               showAlert('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน', 'error');
               return;
           }

           const newFeed = {
               id: Date.now(),
               type: feedType,
               brand: brand,
               quantity: quantity,
               originalQuantity: quantity,
               price: price,
               purchaseDate: purchaseDate,
               expiryDate: expiryDate,
               createdDate: new Date().toISOString()
           };

           farmData.feeds.push(newFeed);
           saveData();
           displayFeeds();
           updateOverview();
           clearFeedForm();
           showAlert('เพิ่มอาหารเข้าสต็อกเรียบร้อยแล้ว');
       }

       function clearFeedForm() {
           document.getElementById('feedType').value = '';
           document.getElementById('feedBrand').value = '';
           document.getElementById('feedQuantity').value = '';
           document.getElementById('feedPrice').value = '';
           document.getElementById('feedExpiryDate').value = '';
           document.getElementById('feedPurchaseDate').value = new Date().toISOString().split('T')[0];
       }

       function displayFeeds() {
           const container = document.getElementById('feedStock');
           
           if (farmData.feeds.length === 0) {
               container.innerHTML = '<p>ยังไม่มีข้อมูลอาหาร</p>';
               return;
           }

           const feedTypes = {
               'prestarter': 'Pre-Starter',
               'starter': 'Starter',
               'grower': 'Grower',
               'finisher': 'Finisher',
               'sow': 'อาหารแม่พันธุ์',
               'boar': 'อาหารพ่อพันธุ์'
           };

           let html = '';

           farmData.feeds.forEach(feed => {
               const totalValue = feed.quantity * feed.price;

               html += `
                   <div style="padding: 16px; border: 2px solid #e0e6ed; border-radius: 12px; margin-bottom: 12px; background: white;">
                       <div style="margin-bottom: 12px;">
                           <div style="font-weight: 700; font-size: 16px; margin-bottom: 6px; color: #2c3e50;">
                               🌾 ${feedTypes[feed.type]} - ${feed.brand}
                           </div>
                           <div style="font-size: 13px; color: #666; margin-bottom: 3px;">
                               คงเหลือ: ${feed.quantity} กก. จาก ${feed.originalQuantity} กก.
                           </div>
                           <div style="font-size: 13px; color: #666; margin-bottom: 3px;">
                               💰 ราคา: ${feed.price} บาท/กก. | มูลค่าคงเหลือ: ${totalValue.toLocaleString()} บาท
                           </div>
                           <div style="font-size: 13px; color: #666; margin-bottom: 3px;">
                               📅 วันที่ซื้อ: ${new Date(feed.purchaseDate).toLocaleDateString('th-TH')}
                               ${feed.expiryDate ? '| หมดอายุ: ' + new Date(feed.expiryDate).toLocaleDateString('th-TH') : ''}
                           </div>
                       </div>
                       <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                           <button class="btn btn-small btn-danger" onclick="deleteFeed(${feed.id})">🗑️ ลบ</button>
                       </div>
                   </div>
               `;
           });

           container.innerHTML = html;
       }

       function deleteFeed(id) {
           if (confirm('ต้องการลบอาหารนี้หรือไม่?')) {
               farmData.feeds = farmData.feeds.filter(feed => feed.id !== id);
               saveData();
               displayFeeds();
               updateOverview();
               showAlert('ลบข้อมูลเรียบร้อยแล้ว');
           }
       }

       // Medical Management
       function addMedical() {
           const type = document.getElementById('medicalType').value;
           const name = document.getElementById('medicalName').value;
           const brand = document.getElementById('medicalBrand').value;
           const quantity = parseInt(document.getElementById('medicalQuantity').value);
           const unit = document.getElementById('medicalUnit').value;
           const price = parseFloat(document.getElementById('medicalPrice').value);
           const purchaseDate = document.getElementById('medicalPurchaseDate').value;
           const expiryDate = document.getElementById('medicalExpiryDate').value;

           if (!type || !name || !quantity || !unit || !price || !purchaseDate) {
               showAlert('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน', 'error');
               return;
           }

           const newMedical = {
               id: Date.now(),
               type: type,
               name: name,
               brand: brand,
               quantity: quantity,
               originalQuantity: quantity,
               unit: unit,
               price: price,
               purchaseDate: purchaseDate,
               expiryDate: expiryDate,
               createdDate: new Date().toISOString()
           };

           farmData.medical.push(newMedical);
           saveData();
           displayMedical();
           updateOverview();
           clearMedicalForm();
           showAlert('เพิ่มยา/วัคซีนเข้าสต็อกเรียบร้อยแล้ว');
       }

       function clearMedicalForm() {
           document.getElementById('medicalType').value = '';
           document.getElementById('medicalName').value = '';
           document.getElementById('medicalBrand').value = '';
           document.getElementById('medicalQuantity').value = '';
           document.getElementById('medicalUnit').value = '';
           document.getElementById('medicalPrice').value = '';
           document.getElementById('medicalExpiryDate').value = '';
           document.getElementById('medicalPurchaseDate').value = new Date().toISOString().split('T')[0];
       }

       function displayMedical() {
           const container = document.getElementById('medicalStock');
           
           if (farmData.medical.length === 0) {
               container.innerHTML = '<p>ยังไม่มีข้อมูลยาและวัคซีน</p>';
               return;
           }

           const medicalTypes = {
               'vaccine': 'วัคซีน',
               'antibiotic': 'ยาปฏิชีวนะ',
               'vitamin': 'วิตามิน',
               'deworming': 'ยาถ่ายพยาธิ',
               'hormone': 'ฮอร์โมน',
               'supplement': 'อาหารเสริม',
               'disinfectant': 'ยาฆ่าเชื้อ'
           };

           let html = '';

           farmData.medical.forEach(med => {
               const totalValue = med.quantity * med.price;

               html += `
                   <div style="padding: 16px; border: 2px solid #e0e6ed; border-radius: 12px; margin-bottom: 12px; background: white;">
                       <div style="margin-bottom: 12px;">
                           <div style="font-weight: 700; font-size: 16px; margin-bottom: 6px; color: #2c3e50;">
                               💊 ${medicalTypes[med.type]} - ${med.name}
                           </div>
                           <div style="font-size: 13px; color: #666; margin-bottom: 3px;">
                               ${med.brand ? 'ยี่ห้อ: ' + med.brand + ' | ' : ''}คงเหลือ: ${med.quantity} ${med.unit} จาก ${med.originalQuantity} ${med.unit}
                           </div>
                           <div style="font-size: 13px; color: #666; margin-bottom: 3px;">
                               💰 ราคา: ${med.price} บาท/${med.unit} | มูลค่าคงเหลือ: ${totalValue.toLocaleString()} บาท
                           </div>
                           <div style="font-size: 13px; color: #666; margin-bottom: 3px;">
                               📅 วันที่ซื้อ: ${new Date(med.purchaseDate).toLocaleDateString('th-TH')}
                               ${med.expiryDate ? '| หมดอายุ: ' + new Date(med.expiryDate).toLocaleDateString('th-TH') : ''}
                           </div>
                       </div>
                       <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                           <button class="btn btn-small btn-danger" onclick="deleteMedical(${med.id})">🗑️ ลบ</button>
                       </div>
                   </div>
               `;
           });

           container.innerHTML = html;
       }

       function deleteMedical(id) {
           if (confirm('ต้องการลบยา/วัคซีนนี้หรือไม่?')) {
               farmData.medical = farmData.medical.filter(med => med.id !== id);
               saveData();
               displayMedical();
               updateOverview();
               showAlert('ลบข้อมูลเรียบร้อยแล้ว');
           }
       }

       // Update Overview
       function updateOverview() {
           const totalPigs = farmData.pigs.reduce((sum, pig) => sum + pig.quantity, 0);
           const feedItems = farmData.feeds.length;
           const medicalItems = farmData.medical.length;
           const lowStockItems = 0; // Simplified for now

           document.getElementById('totalPigs').textContent = totalPigs || '-';
           document.getElementById('feedItems').textContent = feedItems || '-';
           document.getElementById('medicalItems').textContent = medicalItems || '-';
           document.getElementById('lowStockItems').textContent = lowStockItems || '-';

           // Update summary
           const summaryContainer = document.getElementById('stockSummary');
           
           if (farmData.feeds.length > 0 || farmData.medical.length > 0) {
               const totalFeedValue = farmData.feeds.reduce((sum, feed) => sum + (feed.quantity * feed.price), 0);
               const totalMedicalValue = farmData.medical.reduce((sum, med) => sum + (med.quantity * med.price), 0);

               summaryContainer.innerHTML = `
                   <div class="form-grid">
                       <div>
                           <h4>💰 มูลค่าสต็อกคงเหลือ</h4>
                           <p><strong>🌾 อาหาร:</strong> ${totalFeedValue.toLocaleString()} บาท</p>
                           <p><strong>💊 ยาและวัคซีน:</strong> ${totalMedicalValue.toLocaleString()} บาท</p>
                           <p><strong>💵 รวมทั้งหมด:</strong> ${(totalFeedValue + totalMedicalValue).toLocaleString()} บาท</p>
                       </div>
                       <div>
                           <h4>📊 สถิติการจัดการ</h4>
                           <p><strong>🐷 สุกรทั้งหมด:</strong> ${totalPigs} ตัว</p>
                           <p><strong>📝 รายการอาหาร:</strong> ${farmData.feeds.length} รายการ</p>
                           <p><strong>💊 รายการยา:</strong> ${farmData.medical.length} รายการ</p>
                       </div>
                   </div>
                   <div style="margin-top: 20px;">
                       <p><strong>🕐 อัพเดทล่าสุด:</strong> ${new Date().toLocaleString('th-TH')}</p>
                   </div>
               `;
           } else {
               summaryContainer.innerHTML = '<p>🚀 ระบบพร้อมใช้งาน กรุณาเริ่มบันทึกข้อมูล</p>';
           }
       }

       // Install Instructions
       function showInstallInstructions() {
           const userAgent = navigator.userAgent.toLowerCase();
           let instructions = '';

           if (userAgent.includes('iphone') || userAgent.includes('ipad')) {
               instructions = `📱 วิธีติดตั้งใน iOS:
1. กดปุ่ม Share (📤) ใน Safari
2. เลือก "เพิ่มไปยังหน้าจอโฮม"
3. กด "เพิ่ม" เพื่อติดตั้ง`;
           } else if (userAgent.includes('android')) {
               instructions = `📱 วิธีติดตั้งใน Android:
1. กดเมนู (⋮) ใน Chrome
2. เลือก "Add to Home screen"
3. กด "Add" เพื่อติดตั้ง`;
           } else {
               instructions = `💻 วิธีติดตั้งในคอมพิวเตอร์:
1. กดปุ่ม ⊕ ในแถบ URL (Chrome)
2. หรือกดเมนู → "Install app"
3. กด "Install" เพื่อติดตั้ง`;
           }

           alert(instructions);
       }

       // Set default dates
       function setDefaultDates() {
           const today = new Date().toISOString().split('T')[0];
           document.getElementById('pigEntryDate').value = today;
           document.getElementById('feedPurchaseDate').value = today;
           document.getElementById('medicalPurchaseDate').value = today;
       }

       // Initialize system
       document.addEventListener('DOMContentLoaded', function() {
           console.log('🚀 Initializing Pig Farm Management System...');
           loadData();
           updateOverview();
           setDefaultDates();
           
           // Hide install button if standalone
           if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
               document.getElementById('manualInstall').style.display = 'none';
           }
           
           console.log('✅ System ready!');
       });

       // Auto-save every 30 seconds
       setInterval(saveData, 30000);

       console.log('🎉 ระบบจัดการฟาร์มสุกร Mobile App v3.0.0 พร้อมใช้งาน');
   </script>
</body>
</html>
