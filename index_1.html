        function simulateUsage() {
            // Simulate usage with random data
            const simulatedData = {
                weather: ['sunny', 'rainy', 'cloudy', 'cold'][Math.floor(Math.random() * 4)],
                economic: ['good', 'normal', 'poor'][Math.floor(Math.random() * 3)]
            };

            // Record usage and pattern
            aiMemory.recordUsage(simulatedData);
            aiMemory.recordPattern(simulatedData);
            
            // Update display
            updateAIDisplay();
            updateDebugPanel();
            
            showFeedback('จำลองการใช้งานเรียบร้อย! AI ได้เรียนรู้เพิ่มขึ้น', 'success');
        }

        function resetAIMemory() {
            if (confirm('ต้องการลบความทรงจำของ AI ทั้งหมดหรือไม่?\n(จะไม่สามารถย้อนกลับได้)')) {
                if (aiMemory.resetMemory()) {
                    updateAIDisplay();
                    clearProfileForm();
                    updateDebugPanel();
                    showFeedback('รีเซ็ต AI Memory แล้ว เริ่มต้นใหม่!', 'info');
                } else {
                    showFeedback('เกิดข้อผิดพลาดในการรีเซ็ต', 'error');
                }
            }
        }

        function clearProfileForm() {
            document.getElementById('userName').value = '';
            document.getElementById('businessGoal').value = '';
            document.getElementById('experienceLevel').value = '';
            document.getElementById('riskTolerance').value = '';
        }

        function loadProfileForm() {
            const profile = aiMemory.profile;
            document.getElementById('userName').value = profile.userName || '';
            document.getElementById('businessGoal').value = profile.businessGoal || '';
            document.getElementById('experienceLevel').value = profile.experienceLevel || '';
            document.getElementById('riskTolerance').value = profile.riskTolerance || '';
        }

        function updateAIDisplay() {
            // Update greeting
            document.getElementById('aiGreeting').innerHTML = 
                `<i class="fas fa-robot"></i> ${aiMemory.getPersonalizedGreeting()}`;
            
            // Update insight
            document.getElementById('aiInsight').textContent = aiMemory.getPersonalizedInsight();
            
            // Update statistics
            document.getElementById('usageCount').textContent = aiMemory.usage.totalCalculations || 0;
            
            const profileFilledFields = Object.keys(aiMemory.profile).filter(k => 
                aiMemory.profile[k] && k !== 'createdAt' && k !== 'lastActive').length;
            document.getElementById('dataPoints').textContent = 
                profileFilledFields + aiMemory.patterns.pricePatterns.length;
            
            // Update learning progress
            aiMemory.updateLearning();
            const progress = aiMemory.learning.learningProgress;
            document.getElementById('learningPercent').textContent = `${progress}%`;
            document.getElementById('learningBar').style.width = `${progress}%`;
            
            // Update accuracy (simulated based on usage)
            const accuracy = Math.min(95, 50 + (aiMemory.usage.totalCalculations * 5));
            document.getElementById('aiAccuracy').textContent = `${accuracy}%`;
            
            // Update personality
            if (aiMemory.learning.personalityType) {
                document.getElementById('personalityText').textContent = 
                    `คุณเป็นประเภท: ${aiMemory.learning.personalityType}`;
            }
        }

        function updateDebugPanel() {
            const debugInfo = aiMemory.getDebugInfo();
            const debugContent = document.getElementById('debugContent');
            
            debugContent.innerHTML = `
                <div style="margin-bottom: 8px;">
                    <strong>Profile:</strong> ${debugInfo.profile.userName || 'ไม่มี'}<br>
                    <strong>Goal:</strong> ${debugInfo.profile.businessGoal || 'ไม่มี'}<br>
                    <strong>Experience:</strong> ${debugInfo.profile.experienceLevel || 'ไม่มี'}
                </div>
                <div style="margin-bottom: 8px;">
                    <strong>การใช้งาน:</strong> ${debugInfo.usage.totalCalculations} ครั้ง<br>
                    <strong>Patterns:</strong> ${debugInfo.patterns}<br>
                    <strong>Learning:</strong> ${debugInfo.learning.learningProgress}%
                </div>
                <div style="font-size: 0.8rem; color: #ccc;">
                    <strong>localStorage Keys:</strong><br>
                    ${Object.keys(localStorage).filter(k => k.startsWith('aiMooPing')).join('<br>')}
                </div>
            `;
        }

        function showFeedback(message, type = 'info') {
            // Remove existing feedback
            const existingFeedback = document.querySelector('.feedback');
            if (existingFeedback) {
                existingFeedback.remove();
            }

            // Create new feedback
            const feedback = document.createElement('div');
            feedback.className = `feedback ${type}`;
            feedback.textContent = message;

            document.body.appendChild(feedback);

            // Auto remove after 3 seconds
            setTimeout(() => {
                feedback.style.animation = 'feedbackHide 0.3s ease';
                setTimeout(() => {
                    if (feedback.parentNode) {
                        feedback.remove();
                    }
                }, 300);
            }, 3000);
        }

        // ========== INITIALIZATION ========== //

        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Load profile form
                loadProfileForm();
                
                // Update AI display
                updateAIDisplay();
                
                // Update debug panel
                updateDebugPanel();
                
                console.log('Memory System initialized successfully');
                console.log('Current AI Memory:', aiMemory.getDebugInfo());
            } catch (error) {
                console.error('Initialization failed:', error);
                showFeedback('เกิดข้อผิดพลาดในการเริ่มต้นระบบ', 'error');
            }
        });

        // Auto-update debug panel every 5 seconds
        setInterval(updateDebugPanel, 5000);

        // Test localStorage availability
        function testLocalStorage() {
            try {
                const test = 'test';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch (e) {
                return false;
            }
        }

        // Check if localStorage is available
        if (!testLocalStorage()) {
            showFeedback('localStorage ไม่สามารถใช้งานได้ ระบบความจำอาจทำงานไม่ปกติ', 'error');
        }
    </script>
</body>
</html>
