<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Check-in UP</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>
<body>
  <h1>QR สำหรับเช็คชื่อ (สแกนแล้วเข้าสู่ระบบ)</h1>
  <div id="qr"></div>
  <p id="status"></p>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDeD73Yg2QhPXl0dD40uvCsVejpf38OYeY",
      authDomain: "qr-checkin-up.firebaseapp.com",
      projectId: "qr-checkin-up",
      storageBucket: "qr-checkin-up.firebasestorage.app",
      messagingSenderId: "780428257804",
      appId: "1:780428257804:web:31b68ff043623144679c29"
    };

    firebase.initializeApp(firebaseConfig);
    const qrDiv = document.getElementById('qr');

    function generateQR() {
      const sessionId = new Date().toISOString().split('T')[0];
      const token = btoa(JSON.stringify({ session: sessionId, timestamp: Date.now() }));
      const targetUrl = `https://kittisak.github.io/qr-checkin-up/checkin.html?token=${token}`;

      qrDiv.innerHTML = '';
      QRCode.toCanvas(document.createElement('canvas'), targetUrl, (err, canvas) => {
        if (!err) qrDiv.appendChild(canvas);
      });
    }

    setInterval(generateQR, 30000);
    generateQR();
  </script>
</body>
</html>
