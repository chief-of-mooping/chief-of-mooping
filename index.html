<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Check-in UP</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>
<body>
  <h1>QR สำหรับเช็คชื่อ (สแกนแล้วเข้าสู่ระบบ)</h1>
  <div id="qr"></div>
  <p id="status"></p>

  <script>
    function generateQR() {
      const sessionId = new Date().toISOString().split('T')[0];
      const token = btoa(JSON.stringify({ session: sessionId, timestamp: Date.now() }));
      const targetUrl = `https://kittisak.github.io/qr-checkin-up/checkin.html?token=${token}`;

      const qrDiv = document.getElementById('qr');
      qrDiv.innerHTML = '';
      const canvas = document.createElement('canvas');
      QRCode.toCanvas(canvas, targetUrl, (err) => {
        if (!err) qrDiv.appendChild(canvas);
        else document.getElementById('status').textContent = 'เกิดข้อผิดพลาดในการสร้าง QR';
      });
    }

    setInterval(generateQR, 30000);
    generateQR();
  </script>
</body>
</html>
