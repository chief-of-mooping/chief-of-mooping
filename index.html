<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê∑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi8J+QtyDguKPguLDguJrguJrguIHguLLguKPguIjguLHguJTguIHguLLguKPguJ/guLLguKPguYzguKHguKrguLjguIHguKPiLCJzaG9ydF9uYW1lIjoi8J+QtyDguJ/guLLguKPguYzguKHguKrguLjguIHguKPiLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsInN0YXJ0X3VybCI6Ii8iLCJ0aGVtZV9jb2xvciI6IiMyNzk2NGEiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzE2NTgzNCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpwWlhkQ2IzZzlJakFnTUNBNU5pQTVOaUlnWm1sc2JEMGlJekkzPWVGSGRGTVJpTGIxcmtwSDV3dFNmQmg2U2lFM3hGSjVhS2VLQWVoSmJNVXhDSWlCS0lRZUlLQmdJaUVLTVFoVGNKQ0pOSXhDRHdoNUtUTG9TOEtFZGNxSFY5ZVpuRHdoU1ZObHpDaWlRblU5aWRtYm1JbGRLWUhCVzFDaWNuVXZodXgzY0poSWxjdG1RUkVjSEJDaWNaelpnNWZzaWNkRGljRlJoOVh6SHB5SkpOJyJ9XX0=">
    <style>
        :root {
            --primary: linear-gradient(135deg, #16a34a, #0ea5e9);
            --primary-dark: #15803d;
            --primary-light: #22c55e;
            --secondary: #64748b;
            --background: #f8fafc;
            --surface: #ffffff;
            --error: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding-bottom: 80px;
        }

        /* Header */
        .header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* Navigation */
        .nav {
            background: white;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 60px;
            z-index: 99;
            overflow-x: auto;
            white-space: nowrap;
        }

        .nav-container {
            display: flex;
            gap: 0.5rem;
            padding: 0 1rem;
            min-width: max-content;
        }

        .nav-btn {
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-light);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            white-space: nowrap;
            min-width: max-content;
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
        }

        .nav-btn:hover:not(.active) {
            background: var(--background);
        }

        /* Main Content */
        .main {
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--surface);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        label {
            font-weight: 500;
            color: var(--text);
        }

        input, select, textarea {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            min-height: 44px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-top: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--background);
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: var(--background);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid;
        }

        .alert-warning {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }

        .alert-danger {
            background: #fee2e2;
            border-color: #ef4444;
            color: #dc2626;
        }

        .alert-success {
            background: #d1fae5;
            border-color: #10b981;
            color: #047857;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .card {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .nav-container {
                padding: 0 0.5rem;
            }

            .nav-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }

            table {
                font-size: 0.8rem;
            }

            th, td {
                padding: 0.5rem;
            }
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-dark);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Hide elements */
        .hidden {
            display: none !important;
        }

        /* Progress bar */
        .progress {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üê∑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£</h1>
    </div>

    <nav class="nav">
        <div class="nav-container">
            <button class="nav-btn active" onclick="showSection('overview')">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
            <button class="nav-btn" onclick="showSection('pigs')">üê∑ ‡∏™‡∏∏‡∏Å‡∏£</button>
            <button class="nav-btn" onclick="showSection('feeds')">üåæ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
            <button class="nav-btn" onclick="showSection('medical')">üíä ‡∏¢‡∏≤</button>
            <button class="nav-btn" onclick="showSection('usage')">üìù ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
            <button class="nav-btn" onclick="showSection('sales')">üí∞ ‡∏Ç‡∏≤‡∏¢</button>
            <button class="nav-btn" onclick="showSection('reports')">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
        </div>
    </nav>

    <main class="main">
        <!-- Overview Section -->
        <section id="overview" class="section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üê∑</div>
                    <div class="stat-value" id="totalPigs">0</div>
                    <div class="stat-label">‡∏™‡∏∏‡∏Å‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üåæ</div>
                    <div class="stat-value" id="totalFeeds">0</div>
                    <div class="stat-label">‡∏ä‡∏ô‡∏¥‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üíä</div>
                    <div class="stat-value" id="totalMedical">0</div>
                    <div class="stat-label">‡∏ä‡∏ô‡∏¥‡∏î‡∏¢‡∏≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-value" id="monthlyRevenue">0</div>
                    <div class="stat-label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
                </div>
            </div>

            <div id="alerts-container"></div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="exportData()">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            </div>
        </section>

        <!-- Pigs Section -->
        <section id="pigs" class="section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üê∑ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Å‡∏£</h3>
                </div>
                <form id="pigForm" onsubmit="addPig(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏∏‡∏Å‡∏£</label>
                            <select id="pigType" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå">‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                                <option value="‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå">‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                                <option value="‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£">‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£</option>
                                <option value="‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô">‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô</option>
                                <option value="‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô">‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏ï‡∏±‡∏ß)</label>
                            <input type="number" id="pigQuantity" min="1" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏Å‡∏Å.)</label>
                            <input type="number" id="pigWeight" step="0.1" min="0">
                        </div>
                        <div class="form-group">
                            <label>‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏ß‡∏±‡∏ô)</label>
                            <input type="number" id="pigAge" min="0">
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏≤‡∏£‡πå‡∏°</label>
                            <input type="date" id="pigEntryDate" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                            <input type="text" id="pigNotes">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Å‡∏£</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏Å‡∏£</h3>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                <th>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</th>
                                <th>‡∏≠‡∏≤‡∏¢‡∏∏</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="pigsTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Feeds Section -->
        <section id="feeds" class="section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üåæ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
                </div>
                <form id="feedForm" onsubmit="addFeed(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                            <select id="feedType" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="Pre-Starter">Pre-Starter</option>
                                <option value="Starter">Starter</option>
                                <option value="Grower">Grower</option>
                                <option value="Finisher">Finisher</option>
                                <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                                <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</label>
                            <input type="text" id="feedBrand" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Å‡∏Å.)</label>
                            <input type="number" id="feedQuantity" step="0.1" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="feedPrice" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label>
                            <input type="date" id="feedPurchaseDate" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</label>
                            <input type="date" id="feedExpiryDate">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</th>
                                <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏ã‡∏∑‡πâ‡∏≠</th>
                                <th>‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="feedsTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Medical Section -->
        <section id="medical" class="section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üíä ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏¢‡∏≤</h3>
                </div>
                <form id="medicalForm" onsubmit="addMedical(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏¢‡∏≤</label>
                            <select id="medicalType" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô">‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</option>
                                <option value="‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞">‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞</option>
                                <option value="‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô">‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô</option>
                                <option value="‡∏¢‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏û‡∏¢‡∏≤‡∏ò‡∏¥">‡∏¢‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏û‡∏¢‡∏≤‡∏ò‡∏¥</option>
                                <option value="‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô">‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô</option>
                                <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°</option>
                                <option value="‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠">‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</label>
                            <input type="text" id="medicalName" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</label>
                            <input type="text" id="medicalBrand" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                            <input type="number" id="medicalQuantity" step="0.1" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                            <select id="medicalUnit" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
                                <option value="‡∏Ç‡∏ß‡∏î">‡∏Ç‡∏ß‡∏î</option>
                                <option value="‡∏Å‡∏•‡πà‡∏≠‡∏á">‡∏Å‡∏•‡πà‡∏≠‡∏á</option>
                                <option value="‡∏ã‡∏≠‡∏á">‡∏ã‡∏≠‡∏á</option>
                                <option value="‡∏Å‡∏£‡∏±‡∏°">‡∏Å‡∏£‡∏±‡∏°</option>
                                <option value="‡∏°‡∏•.">‡∏°‡∏•.</option>
                                <option value="‡πÄ‡∏°‡πá‡∏î">‡πÄ‡∏°‡πá‡∏î</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="medicalPrice" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label>
                            <input type="date" id="medicalPurchaseDate" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</label>
                            <input type="date" id="medicalExpiryDate">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏¢‡∏≤</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üè• ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏¢‡∏≤</h3>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</th>
                                <th>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</th>
                                <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏ã‡∏∑‡πâ‡∏≠</th>
                                <th>‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="medicalTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Usage Section -->
        <section id="usage" class="section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
                </div>
                <form id="usageForm" onsubmit="addUsage(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                            <select id="usageType" required onchange="updateUsageItems()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                                <option value="‡∏¢‡∏≤">‡∏¢‡∏≤</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                            <select id="usageItem" required onchange="updateUsageUnit()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</label>
                            <input type="number" id="usageAmount" step="0.1" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                            <input type="text" id="usageUnit" readonly>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="date" id="usageDate" required>
                        </div>
                        <div class="form-group">
                            <label>‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <input type="time" id="usageTime" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìä ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="usageTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Sales Section -->
        <section id="sales" class="section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üí∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h3>
                </div>
                <form id="salesForm" onsubmit="addSale(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏∏‡∏Å‡∏£</label>
                            <select id="salesType" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå">‡πÅ‡∏°‡πà‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                                <option value="‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå">‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                                <option value="‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£">‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏Å‡∏£</option>
                                <option value="‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô">‡∏™‡∏∏‡∏Å‡∏£‡∏£‡∏∏‡πà‡∏ô</option>
                                <option value="‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô">‡∏™‡∏∏‡∏Å‡∏£‡∏Ç‡∏∏‡∏ô</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏ï‡∏±‡∏ß)</label>
                           <input type="number" id="salesQuantity" min="1" required>
                       </div>
                       <div class="form-group">
                           <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏° (‡∏Å‡∏Å.)</label>
                           <input type="number" id="salesWeight" step="0.1" min="0" required>
                       </div>
                       <div class="form-group">
                           <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                           <input type="number" id="salesPricePerKg" step="0.01" min="0" required>
                       </div>
                       <div class="form-group">
                           <label>‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á (‡∏ö‡∏≤‡∏ó)</label>
                           <input type="number" id="salesTransportCost" step="0.01" min="0" value="0">
                       </div>
                       <div class="form-group">
                           <label>‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠</label>
                           <input type="text" id="salesBuyer">
                       </div>
                       <div class="form-group">
                           <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label>
                           <input type="date" id="salesDate" required>
                       </div>
                       <div class="form-group">
                           <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                           <input type="text" id="salesNotes">
                       </div>
                   </div>
                   <div class="card" style="background: #f0f9ff; border-color: #0ea5e9;">
                       <h4>üíµ ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h4>
                       <p>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°: <span id="totalRevenue">0</span> ‡∏ö‡∏≤‡∏ó</p>
                       <p>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: <span id="netRevenue">0</span> ‡∏ö‡∏≤‡∏ó</p>
                   </div>
                   <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</button>
               </form>
           </div>

           <div class="card">
               <div class="card-header">
                   <h3 class="card-title">üìà ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h3>
               </div>
               <div class="table-container">
                   <table>
                       <thead>
                           <tr>
                               <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                               <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                               <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                               <th>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</th>
                               <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å.</th>
                               <th>‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á</th>
                               <th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th>
                               <th>‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠</th>
                               <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                           </tr>
                       </thead>
                       <tbody id="salesTable"></tbody>
                   </table>
               </div>
           </div>
       </section>

       <!-- Reports Section -->
       <section id="reports" class="section">
           <div class="card">
               <div class="card-header">
                   <h3 class="card-title">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°</h3>
               </div>
               <div class="stats-grid">
                   <div class="stat-card">
                       <div class="stat-icon">üê∑</div>
                       <div class="stat-value" id="reportTotalPigs">0</div>
                       <div class="stat-label">‡∏™‡∏∏‡∏Å‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ï‡∏±‡∏ß)</div>
                   </div>
                   <div class="stat-card">
                       <div class="stat-icon">‚öñÔ∏è</div>
                       <div class="stat-value" id="reportTotalWeight">0</div>
                       <div class="stat-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏° (‡∏Å‡∏Å.)</div>
                   </div>
                   <div class="stat-card">
                       <div class="stat-icon">üí∞</div>
                       <div class="stat-value" id="reportTotalRevenue">0</div>
                       <div class="stat-label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</div>
                   </div>
                   <div class="stat-card">
                       <div class="stat-icon">üìà</div>
                       <div class="stat-value" id="reportAvgPrice">0</div>
                       <div class="stat-label">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</div>
                   </div>
               </div>
           </div>

           <div class="card">
               <div class="card-header">
                   <h3 class="card-title">üì¶ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</h3>
               </div>
               <div id="stockReport"></div>
           </div>

           <div class="card">
               <div class="card-header">
                   <h3 class="card-title">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h3>
               </div>
               <div id="usageReport"></div>
           </div>

           <div class="card">
               <div class="card-header">
                   <h3 class="card-title">üíµ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h3>
               </div>
               <div class="form-grid">
                   <div class="form-group">
                       <label>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
                       <select id="reportMonth">
                           <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                           <option value="1">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</option>
                           <option value="2">‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                           <option value="3">‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°</option>
                           <option value="4">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô</option>
                           <option value="5">‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°</option>
                           <option value="6">‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô</option>
                           <option value="7">‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°</option>
                           <option value="8">‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°</option>
                           <option value="9">‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô</option>
                           <option value="10">‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°</option>
                           <option value="11">‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô</option>
                           <option value="12">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label>‡∏õ‡∏µ</label>
                       <select id="reportYear"></select>
                   </div>
                   <div class="form-group">
                       <button class="btn btn-primary" onclick="generateFinancialReport()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                   </div>
               </div>
               <div id="financialReport"></div>
           </div>
       </section>
   </main>

   <script>
       // Global Variables
       let farmData = {
           version: "2.0.0",
           pigs: [],
           feeds: [],
           medical: [],
           sales: [],
           usage: []
       };

       // Initialize App
       document.addEventListener('DOMContentLoaded', function() {
           loadData();
           initializeDates();
           updateOverview();
           updateAllTables();
           checkLowStock();
           generateReports();
           
           // Auto-save every 30 seconds
           setInterval(saveData, 30000);
           
           // Register service worker for PWA
           if ('serviceWorker' in navigator) {
               navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgKGV2ZW50KSA9PiB7CiAgZXZlbnQud2FpdFVudGlsKAogICAgY2FjaGVzLm9wZW4oJ2Zhcm0tdjEnKS50aGVuKChjYWNoZSkgPT4gewogICAgICByZXR1cm4gY2FjaGUuYWRkQWxsKFsnLyddKTsKICAgIH0pCiAgKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgKGV2ZW50KSA9PiB7CiAgZXZlbnQucmVzcG9uZFdpdGgoCiAgICBjYWNoZXMubWF0Y2goZXZlbnQucmVxdWVzdCkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8IGZldGNoKGV2ZW50LnJlcXVlc3QpOwogICAgfSkKICApOwp9KTs=');
           }
       });

       // Navigation
       function showSection(sectionId) {
           // Hide all sections
           document.querySelectorAll('.section').forEach(section => {
               section.classList.remove('active');
           });
           
           // Remove active class from all nav buttons
           document.querySelectorAll('.nav-btn').forEach(btn => {
               btn.classList.remove('active');
           });
           
           // Show selected section
           document.getElementById(sectionId).classList.add('active');
           
           // Add active class to clicked nav button
           event.target.classList.add('active');
           
           // Update data for specific sections
           if (sectionId === 'overview') {
               updateOverview();
               checkLowStock();
           } else if (sectionId === 'reports') {
               generateReports();
           }
       }

       // Data Management
       function loadData() {
           try {
               const saved = localStorage.getItem('farmData');
               if (saved) {
                   const data = JSON.parse(saved);
                   
                   // Check version and migrate if needed
                   if (!data.version || data.version !== farmData.version) {
                       farmData = migrateData(data);
                   } else {
                       farmData = data;
                   }
               }
           } catch (error) {
               console.error('Error loading data:', error);
               showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'danger');
           }
       }

       function saveData() {
           try {
               localStorage.setItem('farmData', JSON.stringify(farmData));
           } catch (error) {
               console.error('Error saving data:', error);
               showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'danger');
           }
       }

       function migrateData(oldData) {
           // Handle data migration for different versions
           const newData = {
               version: "2.0.0",
               pigs: oldData.pigs || [],
               feeds: oldData.feeds || [],
               medical: oldData.medical || [],
               sales: oldData.sales || [],
               usage: oldData.usage || []
           };
           
           // Add missing properties to existing records
           newData.feeds.forEach(feed => {
               if (!feed.originalQuantity) {
                   feed.originalQuantity = feed.quantity;
               }
           });
           
           newData.medical.forEach(med => {
               if (!med.originalQuantity) {
                   med.originalQuantity = med.quantity;
               }
           });
           
           showAlert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
           return newData;
       }

       function exportData() {
           try {
               const dataStr = JSON.stringify(farmData, null, 2);
               const dataBlob = new Blob([dataStr], {type: 'application/json'});
               const url = URL.createObjectURL(dataBlob);
               const link = document.createElement('a');
               link.href = url;
               link.download = `farm-data-${new Date().toISOString().split('T')[0]}.json`;
               link.click();
               URL.revokeObjectURL(url);
               showAlert('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
           } catch (error) {
               console.error('Error exporting data:', error);
               showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'danger');
           }
       }

       function importData(event) {
           const file = event.target.files[0];
           if (!file) return;
           
           const reader = new FileReader();
           reader.onload = function(e) {
               try {
                   const data = JSON.parse(e.target.result);
                   farmData = migrateData(data);
                   saveData();
                   updateOverview();
                   updateAllTables();
                   checkLowStock();
                   generateReports();
                   showAlert('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
               } catch (error) {
                   console.error('Error importing data:', error);
                   showAlert('‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'danger');
               }
           };
           reader.readAsText(file);
       }

       // Utility Functions
       function generateId() {
           return Date.now().toString(36) + Math.random().toString(36).substr(2);
       }

       function formatDate(date) {
           return new Date(date).toLocaleDateString('th-TH');
       }

       function formatCurrency(amount) {
           return new Intl.NumberFormat('th-TH').format(amount);
       }

       function initializeDates() {
           const today = new Date().toISOString().split('T')[0];
           const now = new Date().toTimeString().split(' ')[0].substr(0, 5);
           
           // Set default dates
           document.getElementById('pigEntryDate').value = today;
           document.getElementById('feedPurchaseDate').value = today;
           document.getElementById('medicalPurchaseDate').value = today;
           document.getElementById('usageDate').value = today;
           document.getElementById('usageTime').value = now;
           document.getElementById('salesDate').value = today;
           
           // Populate year dropdown for reports
           const yearSelect = document.getElementById('reportYear');
           const currentYear = new Date().getFullYear();
           yearSelect.innerHTML = '<option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>';
           for (let year = currentYear - 2; year <= currentYear + 1; year++) {
               yearSelect.innerHTML += `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year + 543}</option>`;
           }
       }

       function showAlert(message, type = 'success') {
           const alertsContainer = document.getElementById('alerts-container');
           const alert = document.createElement('div');
           alert.className = `alert alert-${type}`;
           alert.innerHTML = `
               <span>${message}</span>
               <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 1.2rem; cursor: pointer;">&times;</button>
           `;
           alertsContainer.appendChild(alert);
           
           // Auto remove after 5 seconds
           setTimeout(() => {
               if (alert.parentElement) {
                   alert.remove();
               }
           }, 5000);
       }

       // Pig Management
       function addPig(event) {
           event.preventDefault();
           
           const pig = {
               id: generateId(),
               type: document.getElementById('pigType').value,
               quantity: parseInt(document.getElementById('pigQuantity').value),
               weight: parseFloat(document.getElementById('pigWeight').value) || 0,
               age: parseInt(document.getElementById('pigAge').value) || 0,
               entryDate: document.getElementById('pigEntryDate').value,
               notes: document.getElementById('pigNotes').value
           };
           
           farmData.pigs.push(pig);
           saveData();
           updatePigsTable();
           updateOverview();
           document.getElementById('pigForm').reset();
           initializeDates();
           showAlert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Å‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
       }

       function deletePig(id) {
           if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Å‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
               farmData.pigs = farmData.pigs.filter(pig => pig.id !== id);
               saveData();
               updatePigsTable();
               updateOverview();
               showAlert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Å‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
           }
       }

       function updatePigsTable() {
           const tbody = document.getElementById('pigsTable');
           tbody.innerHTML = '';
           
           farmData.pigs.forEach(pig => {
               const row = tbody.insertRow();
               row.innerHTML = `
                   <td>${pig.type}</td>
                   <td>${pig.quantity} ‡∏ï‡∏±‡∏ß</td>
                   <td>${pig.weight} ‡∏Å‡∏Å.</td>
                   <td>${pig.age} ‡∏ß‡∏±‡∏ô</td>
                   <td>${formatDate(pig.entryDate)}</td>
                   <td>
                       <button class="btn btn-danger" onclick="deletePig('${pig.id}')">‡∏•‡∏ö</button>
                   </td>
               `;
           });
       }

       // Feed Management
       function addFeed(event) {
           event.preventDefault();
           
           const quantity = parseFloat(document.getElementById('feedQuantity').value);
           const feed = {
               id: generateId(),
               type: document.getElementById('feedType').value,
               brand: document.getElementById('feedBrand').value,
               quantity: quantity,
               originalQuantity: quantity,
               price: parseFloat(document.getElementById('feedPrice').value),
               purchaseDate: document.getElementById('feedPurchaseDate').value,
               expiryDate: document.getElementById('feedExpiryDate').value
           };
           
           farmData.feeds.push(feed);
           saveData();
           updateFeedsTable();
           updateOverview();
           updateUsageItems();
           checkLowStock();
           document.getElementById('feedForm').reset();
           initializeDates();
           showAlert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
       }

       function deleteFeed(id) {
           if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
               farmData.feeds = farmData.feeds.filter(feed => feed.id !== id);
               saveData();
               updateFeedsTable();
               updateOverview();
               updateUsageItems();
               checkLowStock();
               showAlert('‡∏•‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
           }
       }

       function updateFeedsTable() {
           const tbody = document.getElementById('feedsTable');
           tbody.innerHTML = '';
           
           farmData.feeds.forEach(feed => {
               const row = tbody.insertRow();
               const lowStock = feed.quantity < 50;
               if (lowStock) row.style.backgroundColor = '#fee2e2';
               
               row.innerHTML = `
                   <td>${feed.type}</td>
                   <td>${feed.brand}</td>
                   <td>${feed.quantity} ‡∏Å‡∏Å. ${lowStock ? '‚ö†Ô∏è' : ''}</td>
                   <td>${formatCurrency(feed.price)} ‡∏ö‡∏≤‡∏ó</td>
                   <td>${formatDate(feed.purchaseDate)}</td>
                   <td>${feed.expiryDate ? formatDate(feed.expiryDate) : '-'}</td>
                   <td>
                       <button class="btn btn-danger" onclick="deleteFeed('${feed.id}')">‡∏•‡∏ö</button>
                   </td>
               `;
           });
       }

       // Medical Management
       function addMedical(event) {
           event.preventDefault();
           
           const quantity = parseFloat(document.getElementById('medicalQuantity').value);
           const medical = {
               id: generateId(),
               type: document.getElementById('medicalType').value,
               name: document.getElementById('medicalName').value,
               brand: document.getElementById('medicalBrand').value,
               quantity: quantity,
               originalQuantity: quantity,
               unit: document.getElementById('medicalUnit').value,
               price: parseFloat(document.getElementById('medicalPrice').value),
               purchaseDate: document.getElementById('medicalPurchaseDate').value,
               expiryDate: document.getElementById('medicalExpiryDate').value
           };
           
           farmData.medical.push(medical);
           saveData();
           updateMedicalTable();
           updateOverview();
           updateUsageItems();
           checkLowStock();
           document.getElementById('medicalForm').reset();
           initializeDates();
           showAlert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏¢‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
       }

       function deleteMedical(id) {
           if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
               farmData.medical = farmData.medical.filter(med => med.id !== id);
               saveData();
               updateMedicalTable();
               updateOverview();
               updateUsageItems();
               checkLowStock();
               showAlert('‡∏•‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏¢‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
           }
       }

       function updateMedicalTable() {
           const tbody = document.getElementById('medicalTable');
           tbody.innerHTML = '';
           
           farmData.medical.forEach(med => {
               const row = tbody.insertRow();
               const lowStock = med.quantity < 5;
               if (lowStock) row.style.backgroundColor = '#fee2e2';
               
               row.innerHTML = `
                   <td>${med.type}</td>
                   <td>${med.name}</td>
                   <td>${med.brand}</td>
                   <td>${med.quantity} ${lowStock ? '‚ö†Ô∏è' : ''}</td>
                   <td>${med.unit}</td>
                   <td>${formatCurrency(med.price)} ‡∏ö‡∏≤‡∏ó</td>
                   <td>${formatDate(med.purchaseDate)}</td>
                   <td>${med.expiryDate ? formatDate(med.expiryDate) : '-'}</td>
                   <td>
                       <button class="btn btn-danger" onclick="deleteMedical('${med.id}')">‡∏•‡∏ö</button>
                   </td>
               `;
           });
       }

       // Usage Management
       function updateUsageItems() {
           const type = document.getElementById('usageType').value;
           const select = document.getElementById('usageItem');
           select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>';
           
           if (type === '‡∏≠‡∏≤‡∏´‡∏≤‡∏£') {
               farmData.feeds.forEach(feed => {
                   if (feed.quantity > 0) {
                       select.innerHTML += `<option value="${feed.id}" data-unit="‡∏Å‡∏Å.">${feed.type} - ${feed.brand}</option>`;
                   }
               });
           } else if (type === '‡∏¢‡∏≤') {
               farmData.medical.forEach(med => {
                   if (med.quantity > 0) {
                       select.innerHTML += `<option value="${med.id}" data-unit="${med.unit}">${med.type} - ${med.name}</option>`;
                   }
               });
           }
       }

       function updateUsageUnit() {
           const select = document.getElementById('usageItem');
           const unit = select.options[select.selectedIndex]?.dataset.unit || '';
           document.getElementById('usageUnit').value = unit;
       }

       function addUsage(event) {
           event.preventDefault();
           
           const type = document.getElementById('usageType').value;
           const itemId = document.getElementById('usageItem').value;
           const amount = parseFloat(document.getElementById('usageAmount').value);
           
           // Find the item and check stock
           let item, itemName;
           if (type === '‡∏≠‡∏≤‡∏´‡∏≤‡∏£') {
               item = farmData.feeds.find(f => f.id === itemId);
               itemName = `${item.type} - ${item.brand}`;
           } else {
               item = farmData.medical.find(m => m.id === itemId);
               itemName = `${item.type} - ${item.name}`;
           }
           
           if (!item || item.quantity < amount) {
               showAlert('‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠', 'danger');
               return;
           }
           
           // Record usage
           const usage = {
               id: generateId(),
               type: type,
               itemId: itemId,
               itemName: itemName,
               amount: amount,
               unit: document.getElementById('usageUnit').value,
               date: document.getElementById('usageDate').value,
               time: document.getElementById('usageTime').value
           };
           
           farmData.usage.push(usage);
           
           // Update stock
           item.quantity -= amount;
           
           saveData();
           updateUsageTable();
           updateFeedsTable();
           updateMedicalTable();
           updateUsageItems();
           checkLowStock();
           document.getElementById('usageForm').reset();
           initializeDates();
           showAlert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
       }

       function deleteUsage(id) {
           if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
               const usage = farmData.usage.find(u => u.id === id);
               if (usage) {
                   // Restore stock
                   if (usage.type === '‡∏≠‡∏≤‡∏´‡∏≤‡∏£') {
                       const item = farmData.feeds.find(f => f.id === usage.itemId);
                       if (item) item.quantity += usage.amount;
                   } else {
                       const item = farmData.medical.find(m => m.id === usage.itemId);
                       if (item) item.quantity += usage.amount;
                   }
                   
                   farmData.usage = farmData.usage.filter(u => u.id !== id);
                   saveData();
                   updateUsageTable();
                   updateFeedsTable();
                   updateMedicalTable();
                   updateUsageItems();
                   checkLowStock();
                   showAlert('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
               }
           }
       }

       function updateUsageTable() {
           const tbody = document.getElementById('usageTable');
           tbody.innerHTML = '';
           
           // Sort by date and time (newest first)
           const sortedUsage = [...farmData.usage].sort((a, b) => {
               const dateTimeA = new Date(`${a.date}T${a.time}`);
               const dateTimeB = new Date(`${b.date}T${b.time}`);
               return dateTimeB - dateTimeA;
           });
           
           sortedUsage.forEach(usage => {
               const row = tbody.insertRow();
               row.innerHTML = `
                   <td>${formatDate(usage.date)}</td>
                   <td>${usage.time}</td>
                   <td>${usage.type}</td>
                   <td>${usage.itemName}</td>
                   <td>${usage.amount}</td>
                   <td>${usage.unit}</td>
                   <td>
                       <button class="btn btn-danger" onclick="deleteUsage('${usage.id}')">‡∏•‡∏ö</button>
                   </td>
               `;
           });
       }

       // Sales Management
       function addSale(event) {
           event.preventDefault();
           
           const quantity = parseInt(document.getElementById('salesQuantity').value);
           const weight = parseFloat(document.getElementById('salesWeight').value);
           const pricePerKg = parseFloat(document.getElementById('salesPricePerKg').value);
           const transportCost = parseFloat(document.getElementById('salesTransportCost').value) || 0;
           
           const totalRevenue = weight * pricePerKg;
           const netRevenue = totalRevenue - transportCost;
           
           const sale = {
               id: generateId(),
               date: document.getElementById('salesDate').value,
               type: document.getElementById('salesType').value,
               quantity: quantity,
               weight: weight,
               pricePerKg: pricePerKg,
               transportCost: transportCost,
               totalRevenue: totalRevenue,
               netRevenue: netRevenue,
               buyer: document.getElementById('salesBuyer').value,
               notes: document.getElementById('salesNotes').value
           };
           
           farmData.sales.push(sale);
           saveData();
           updateSalesTable();
           updateOverview();
           document.getElementById('salesForm').reset();
           initializeDates();
           showAlert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
       }

       function deleteSale(id) {
           if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
               farmData.sales = farmData.sales.filter(sale => sale.id !== id);
               saveData();
               updateSalesTable();
               updateOverview();
               showAlert('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
           }
       }

       function updateSalesTable() {
           const tbody = document.getElementById('salesTable');
           tbody.innerHTML = '';
           
           // Sort by date (newest first)
           const sortedSales = [...farmData.sales].sort((a, b) => new Date(b.date) - new Date(a.date));
           
           sortedSales.forEach(sale => {
               const row = tbody.insertRow();
               row.innerHTML = `
                   <td>${formatDate(sale.date)}</td>
                   <td>${sale.type}</td>
                   <td>${sale.quantity} ‡∏ï‡∏±‡∏ß</td>
                   <td>${sale.weight} ‡∏Å‡∏Å.</td>
                   <td>${formatCurrency(sale.pricePerKg)} ‡∏ö‡∏≤‡∏ó</td>
                   <td>${formatCurrency(sale.transportCost)} ‡∏ö‡∏≤‡∏ó</td>
                   <td>${formatCurrency(sale.netRevenue)} ‡∏ö‡∏≤‡∏ó</td>
                   <td>${sale.buyer || '-'}</td>
                   <td>
                       <button class="btn btn-danger" onclick="deleteSale('${sale.id}')">‡∏•‡∏ö</button>
                   </td>
               `;
           });
       }

       // Calculate sales revenue in real-time
       function calculateRevenue() {
           const weight = parseFloat(document.getElementById('salesWeight').value) || 0;
           const pricePerKg = parseFloat(document.getElementById('salesPricePerKg').value) || 0;
           const transportCost = parseFloat(document.getElementById('salesTransportCost').value) || 0;
           
           const totalRevenue = weight * pricePerKg;
           const netRevenue = totalRevenue - transportCost;
           
           document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
           document.getElementById('netRevenue').textContent = formatCurrency(netRevenue);
       }

       // Add event listeners for real-time calculation
       document.addEventListener('DOMContentLoaded', function() {
           ['salesWeight', 'salesPricePerKg', 'salesTransportCost'].forEach(id => {
               document.getElementById(id).addEventListener('input', calculateRevenue);
           });
       });

       // Overview and Statistics
       function updateOverview() {
           // Total pigs
           const totalPigs = farmData.pigs.reduce((sum, pig) => sum + pig.quantity, 0);
           document.getElementById('totalPigs').textContent = totalPigs;
           
           // Total feed types
           document.getElementById('totalFeeds').textContent = farmData.feeds.length;
           
           // Total medical types
           document.getElementById('totalMedical').textContent = farmData.medical.length;
           
           // Monthly revenue
           const currentMonth = new Date().getMonth();
           const currentYear = new Date().getFullYear();
           const monthlyRevenue = farmData.sales
               .filter(sale => {
                   const saleDate = new Date(sale.date);
                   return saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear;
               })
               .reduce((sum, sale) => sum + sale.netRevenue, 0);
           
           document.getElementById('monthlyRevenue').textContent = formatCurrency(monthlyRevenue);
       }

       function updateAllTables() {
           updatePigsTable();
           updateFeedsTable();
           updateMedicalTable();
           updateUsageTable();
           updateSalesTable();
       }

       // Low Stock Alerts
       function checkLowStock() {
           const alertsContainer = document.getElementById('alerts-container');
           
           // Remove existing low stock alerts
           alertsContainer.querySelectorAll('.alert-warning').forEach(alert => {
               if (alert.textContent.includes('‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥')) {
                   alert.remove();
               }
           });
           
           const alerts = [];
           
           // Check feed stock
           farmData.feeds.forEach(feed => {
               if (feed.quantity < 50) {
                   const daysLeft = calculateDaysLeft(feed, '‡∏≠‡∏≤‡∏´‡∏≤‡∏£');
                   alerts.push(`üåæ ${feed.type} - ${feed.brand} ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${feed.quantity} ‡∏Å‡∏Å. (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${daysLeft} ‡∏ß‡∏±‡∏ô)`);
               }
           });
           
           // Check medical stock
           farmData.medical.forEach(med => {
               if (med.quantity < 5) {
                   const daysLeft = calculateDaysLeft(med, '‡∏¢‡∏≤');
                   alerts.push(`üíä ${med.type} - ${med.name} ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${med.quantity} ${med.unit} (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${daysLeft} ‡∏ß‡∏±‡∏ô)`);
               }
           });
           
           if (alerts.length > 0) {
               const alertDiv = document.createElement('div');
               alertDiv.className = 'alert alert-warning';
               alertDiv.innerHTML = `
                   <strong>‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥:</strong><br>
                   ${alerts.join('<br>')}
               `;
               alertsContainer.appendChild(alertDiv);
           }
       }

       function calculateDaysLeft(item, type) {
           // Calculate average daily usage from last 7 days
           const sevenDaysAgo = new Date();
           sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
           
           const recentUsage = farmData.usage.filter(usage => {
               return usage.itemId === item.id && 
                      usage.type === type && 
                      new Date(usage.date) >= sevenDaysAgo;
           });
           
           if (recentUsage.length === 0) return '‚àû';
           
           const totalUsed = recentUsage.reduce((sum, usage) => sum + usage.amount, 0);
           const avgDailyUsage = totalUsed / 7;
           
           if (avgDailyUsage === 0) return '‚àû';
           
           return Math.floor(item.quantity / avgDailyUsage);
       }

       // Reports
       function generateReports() {
           generateOverviewReport();
           generateStockReport();
           generateUsageReport();
           generateFinancialReport();
       }

       function generateOverviewReport() {
           const totalPigs = farmData.pigs.reduce((sum, pig) => sum + pig.quantity, 0);
           const totalWeight = farmData.pigs.reduce((sum, pig) => sum + (pig.quantity * pig.weight), 0);
           const totalRevenue = farmData.sales.reduce((sum, sale) => sum + sale.netRevenue, 0);
           const avgPrice = farmData.sales.length > 0 ? 
               farmData.sales.reduce((sum, sale) => sum + sale.pricePerKg, 0) / farmData.sales.length : 0;
           
           document.getElementById('reportTotalPigs').textContent = totalPigs;
           document.getElementById('reportTotalWeight').textContent = formatCurrency(totalWeight);
           document.getElementById('reportTotalRevenue').textContent = formatCurrency(totalRevenue);
           document.getElementById('reportAvgPrice').textContent = formatCurrency(avgPrice);
       }

       function generateStockReport() {
           const container = document.getElementById('stockReport');
           let html = '<h4>üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h4><div class="table-container"><table><thead><tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</th><th>‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th></tr></thead><tbody>';
           
           farmData.feeds.forEach(feed => {
               const used = feed.originalQuantity - feed.quantity;
               const percentage = feed.originalQuantity > 0 ? (feed.quantity / feed.originalQuantity * 100).toFixed(1) : 0;
               html += `
                   <tr>
                       <td>${feed.type}</td>
                       <td>${feed.brand}</td>
                       <td>${feed.quantity} ‡∏Å‡∏Å.</td>
                       <td>${used.toFixed(1)} ‡∏Å‡∏Å.</td>
                       <td>
                           <div class="progress">
                               <div class="progress-bar" style="width: ${percentage}%"></div>
                           </div>
                           ${percentage}%
                       </td>
                   </tr>
               `;
           });
           
           html += '</tbody></table></div>';
           html += '<h4>üíä ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏¢‡∏≤</h4><div class="table-container"><table><thead><tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</th><th>‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th></tr></thead><tbody>';
           
           farmData.medical.forEach(med => {
               const used = med.originalQuantity - med.quantity;
               const percentage = med.originalQuantity > 0 ? (med.quantity / med.originalQuantity * 100).toFixed(1) : 0;
               html += `
                   <tr>
                       <td>${med.type}</td>
                       <td>${med.name}</td>
                       <td>${med.quantity} ${med.unit}</td>
                       <td>${used.toFixed(1)} ${med.unit}</td>
                       <td>
                           <div class="progress">
                               <div class="progress-bar" style="width: ${percentage}%"></div>
                           </div>
                           ${percentage}%
                       </td>
                   </tr>
               `;
           });
           
           html += '</tbody></table></div>';
           container.innerHTML = html;
       }

       function generateUsageReport() {
           const container = document.getElementById('usageReport');
           const sevenDaysAgo = new Date();
           sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
           
           const recentUsage = farmData.usage.filter(usage => new Date(usage.date) >= sevenDaysAgo);
           
           // Group by type and item
           const grouped = {};
           recentUsage.forEach(usage => {
               const key = `${usage.type}-${usage.itemName}`;
               if (!grouped[key]) {
                   grouped[key] = {
                       type: usage.type,
                       itemName: usage.itemName,
                       unit: usage.unit,
                       totalAmount: 0,
                       count: 0
                   };
               }
               grouped[key].totalAmount += usage.amount;
               grouped[key].count += 1;
           });
           
           let html = '<div class="table-container"><table><thead><tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏ß‡∏°</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏Ñ‡∏£‡∏±‡πâ‡∏á</th><th>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</th></tr></thead><tbody>';
           
           Object.values(grouped).forEach(item => {
               const avgPerDay = (item.totalAmount / 7).toFixed(2);
               html += `
                   <tr>
                       <td>${item.type}</td>
                       <td>${item.itemName}</td>
                       <td>${item.totalAmount}</td>
                       <td>${item.unit}</td>
                       <td>${item.count}</td>
                       <td>${avgPerDay}</td>
                   </tr>
               `;
           });
           
           html += '</tbody></table></div>';
           container.innerHTML = html;
       }

       function generateFinancialReport() {
           const container = document.getElementById('financialReport');
           const month = document.getElementById('reportMonth').value;
           const year = document.getElementById('reportYear').value;
           
           let filteredSales = farmData.sales;
           
           if (month || year) {
               filteredSales = farmData.sales.filter(sale => {
                   const saleDate = new Date(sale.date);
                   const matchMonth = !month || saleDate.getMonth() + 1 == month;
                   const matchYear = !year || saleDate.getFullYear() == year;
                   return matchMonth && matchYear;
               });
           }
           
           // Group by type
           const grouped = {};
           filteredSales.forEach(sale => {
               if (!grouped[sale.type]) {
                   grouped[sale.type] = {
                       quantity: 0,
                       weight: 0,
                       totalRevenue: 0,
                       netRevenue: 0,
                       transportCost: 0,
                       count: 0
                   };
               }
               grouped[sale.type].quantity += sale.quantity;
               grouped[sale.type].weight += sale.weight;
               grouped[sale.type].totalRevenue += sale.totalRevenue;
               grouped[sale.type].netRevenue += sale.netRevenue;
               grouped[sale.type].transportCost += sale.transportCost;
               grouped[sale.type].count += 1;
           });
           
           let html = '<div class="stats-grid">';
           
           const totalRevenue = filteredSales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
           const totalNetRevenue = filteredSales.reduce((sum, sale) => sum + sale.netRevenue, 0);
           const totalTransportCost = filteredSales.reduce((sum, sale) => sum + sale.transportCost, 0);
           const totalQuantity = filteredSales.reduce((sum, sale) => sum + sale.quantity, 0);
           
           html += `
               <div class="stat-card">
                   <div class="stat-icon">üí∞</div>
                   <div class="stat-value">${formatCurrency(totalRevenue)}</div>
                   <div class="stat-label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</div>
               </div>
               <div class="stat-card">
                   <div class="stat-icon">üíµ</div>
                   <div class="stat-value">${formatCurrency(totalNetRevenue)}</div>
                   <div class="stat-label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡∏ö‡∏≤‡∏ó)</div>
               </div>
               <div class="stat-card">
                   <div class="stat-icon">üöö</div>
                   <div class="stat-value">${formatCurrency(totalTransportCost)}</div>
                   <div class="stat-label">‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</div>
               </div>
               <div class="stat-card">
                   <div class="stat-icon">üê∑</div>
                   <div class="stat-value">${totalQuantity}</div>
                   <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≤‡∏¢ (‡∏ï‡∏±‡∏ß)</div>
               </div>
           `;
           
           html += '</div>';
           
           if (Object.keys(grouped).length > 0) {
               html += '<div class="table-container"><table><thead><tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏∏‡∏Å‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</th><th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</th><th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th><th>‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á</th><th>‡∏Ñ‡∏£‡∏±‡πâ‡∏á</th></tr></thead><tbody>';
               
               Object.entries(grouped).forEach(([type, data]) => {
                   html += `
                       <tr>
                           <td>${type}</td>
                           <td>${data.quantity} ‡∏ï‡∏±‡∏ß</td>
                           <td>${data.weight.toFixed(1)} ‡∏Å‡∏Å.</td>
                           <td>${formatCurrency(data.totalRevenue)} ‡∏ö‡∏≤‡∏ó</td>
                           <td>${formatCurrency(data.netRevenue)} ‡∏ö‡∏≤‡∏ó</td>
                           <td>${formatCurrency(data.transportCost)} ‡∏ö‡∏≤‡∏ó</td>
                           <td>${data.count}</td>
                       </tr>
                   `;
               });
               
               html += '</tbody></table></div>';
           } else {
               html += '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>';
           }
           
           container.innerHTML = html;
       }

       // PWA Installation
       let deferredPrompt;
       
       window.addEventListener('beforeinstallprompt', (e) => {
           e.preventDefault();
           deferredPrompt = e;
           
           // Show install button
           const installAlert = document.createElement('div');
           installAlert.className = 'alert alert-success';
           installAlert.innerHTML = `
               <strong>üì± ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ:</strong> ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ
               <button onclick="installApp()" class="btn btn-primary" style="margin-left: 1rem;">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</button>
               <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 1.2rem; cursor: pointer;">&times;</button>
           `;
           document.getElementById('alerts-container').appendChild(installAlert);
       });
       
       function installApp() {
           if (deferredPrompt) {
               deferredPrompt.prompt();
               deferredPrompt.userChoice.then((choiceResult) => {
                   if (choiceResult.outcome === 'accepted') {
                       showAlert('‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                   }
                   deferredPrompt = null;
               });
           }
       }

       // Keyboard Shortcuts
       document.addEventListener('keydown', function(e) {
           if (e.ctrlKey || e.metaKey) {
               switch(e.key) {
                   case 's':
                       e.preventDefault();
                       saveData();
                       showAlert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'success');
                       break;
                   case 'e':
                       e.preventDefault();
                       exportData();
                       break;
               }
           }
       });

       // Touch Gestures for Mobile
       let touchStartX = 0;
       let touchEndX = 0;
       
       document.addEventListener('touchstart', function(e) {
           touchStartX = e.changedTouches[0].screenX;
       });
       
       document.addEventListener('touchend', function(e) {
           touchEndX = e.changedTouches[0].screenX;
           handleSwipe();
       });
       
       function handleSwipe() {
           const swipeThreshold = 50;
           const diff = touchStartX - touchEndX;
           
           if (Math.abs(diff) > swipeThreshold) {
               const currentSection = document.querySelector('.section.active').id;
               const sections = ['overview', 'pigs', 'feeds', 'medical', 'usage', 'sales', 'reports'];
               const currentIndex = sections.indexOf(currentSection);
               
               if (diff > 0 && currentIndex < sections.length - 1) {
                   // Swipe left - next section
                   showSection(sections[currentIndex + 1]);
                   document.querySelector(`button[onclick="showSection('${sections[currentIndex + 1]}')"]`).click();
               } else if (diff < 0 && currentIndex > 0) {
                   // Swipe right - previous section
                   showSection(sections[currentIndex - 1]);
                   document.querySelector(`button[onclick="showSection('${sections[currentIndex - 1]}')"]`).click();
               }
           }
       }

       // Responsive table handling
       function makeTablesResponsive() {
           const tables = document.querySelectorAll('table');
           tables.forEach(table => {
               if (window.innerWidth < 768) {
                   table.style.fontSize = '0.8rem';
               } else {
                   table.style.fontSize = '0.9rem';
               }
           });
       }
       
       window.addEventListener('resize', makeTablesResponsive);
       document.addEventListener('DOMContentLoaded', makeTablesResponsive);

       // Offline detection
       window.addEventListener('online', function() {
           showAlert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'success');
       });
       
       window.addEventListener('offline', function() {
           showAlert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï - ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå', 'warning');
       });

       // Form validation
       function validateForm(formId) {
           const form = document.getElementById(formId);
           const inputs = form.querySelectorAll('input[required], select[required]');
           let isValid = true;
           
           inputs.forEach(input => {
               if (!input.value.trim()) {
                   input.style.borderColor = 'var(--error)';
                   isValid = false;
               } else {
                   input.style.borderColor = 'var(--border)';
               }
           });
           
           return isValid;
       }

       // Auto-complete for buyer names
       function setupAutoComplete() {
           const buyerInput = document.getElementById('salesBuyer');
           const uniqueBuyers = [...new Set(farmData.sales.map(sale => sale.buyer).filter(buyer => buyer))];
           
           if (uniqueBuyers.length > 0) {
               const datalist = document.createElement('datalist');
               datalist.id = 'buyersList';
               uniqueBuyers.forEach(buyer => {
                   const option = document.createElement('option');
                   option.value = buyer;
                   datalist.appendChild(option);
               });
               
               buyerInput.setAttribute('list', 'buyersList');
               document.body.appendChild(datalist);
           }
       }

       // Initialize auto-complete when sales data changes
       document.addEventListener('DOMContentLoaded', setupAutoComplete);

       // Print functionality
       function printReport(sectionId) {
           const section = document.getElementById(sectionId);
           const printWindow = window.open('', '_blank');
           printWindow.document.write(`
               <html>
                   <head>
                       <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£</title>
                       <style>
                           body { font-family: Arial, sans-serif; padding: 20px; }
                           table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                           th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                           th { background-color: #f2f2f2; }
                           .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
                           .stat-card { border: 1px solid #ddd; padding: 20px; text-align: center; }
                           .stat-value { font-size: 24px; font-weight: bold; color: #16a34a; }
                           @media print { .no-print { display: none; } }
                       </style>
                   </head>
                   <body>
                       <h1>üê∑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£</h1>
                       <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå: ${new Date().toLocaleDateString('th-TH')}</p>
                       ${section.innerHTML}
                   </body>
               </html>
           `);
           printWindow.document.close();
           printWindow.print();
       }

       // Data validation and cleanup
       function cleanupData() {
           // Remove invalid entries
           farmData.pigs = farmData.pigs.filter(pig => pig.quantity > 0);
           farmData.feeds = farmData.feeds.filter(feed => feed.quantity >= 0);
           farmData.medical = farmData.medical.filter(med => med.quantity >= 0);
           
           // Fix negative quantities
           farmData.feeds.forEach(feed => {
               if (feed.quantity < 0) feed.quantity = 0;
           });
           farmData.medical.forEach(med => {
               if (med.quantity < 0) med.quantity = 0;
           });
           
           saveData();
       }

       // Performance monitoring
       function measurePerformance() {
           const start = performance.now();
           updateAllTables();
           const end = performance.now();
           console.log(`Table update took ${end - start} milliseconds`);
       }

       // Initialize app
       window.addEventListener('load', function() {
           cleanupData();
           setupAutoComplete();
           
           // Show app ready message
           setTimeout(() => {
               showAlert('üê∑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏∏‡∏Å‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!', 'success');
           }, 1000);
       });
   </script>
</body>
</html>
