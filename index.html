<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการฟาร์มสุกรอัจฉริยะ</title>
    <meta name="theme-color" content="#059669">
    <meta name="description" content="ระบบจัดการฟาร์มสุกรสำหรับเกษตรกรไทย">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi4Lij4Liw4Lia4Lia4LiI4Lix4LiU4LiB4Liy4Lij4Lif4Liy4Lij4LmM4Lih4Liq4Li44LiB4Lij4Lit4Lix4LiI4Lix4Lij4Li04Lii4Liw77iPIiwic2hvcnRfbmFtZSI6IuC4n+C4suC4o+C5jOC4oeC4quC4uOC4geC4oyIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjMDU5NjY5IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB3aWR0aD0nNDgnIGhlaWdodD0nNDgnIGZpbGw9J25vbmUnJTNFJTNDcGF0aCBkPSdNMjQgNGM4LjggMCAxNiA3LjIgMTYgMTZ2NGMwIDEuMS0uOSAyLTIgMmgtMjhhLTIgMiAwIDAgMS0yLTJ2LTRjMC04LjggNy4yLTE2IDE2LTE2eicgZmlsbD0nJTIzMDU5NjY5Jy8lM0UlM0NwYXRoIGQ9J004IDI0aDMyYTIgMiAwIDAgMSAyIDJ2MTJjMCA0LjQtMy42IDgtOCA4SDEyYy00LjQgMC04LTMuNi04LTh2LTEyYTIgMiAwIDAgMSAyLTJ6JyBmaWxsPSclMjMwNTk2NjknLyUzRSUzQ3BhdGggZD0nTTE2IDMwdjRhMiAyIDAgMCAwIDIgMmg0YTIgMiAwIDAgMCAyLTJ2LTRoMHonIGZpbGw9JyUyMzBkNzM0NicvJTNFJTNDL3N2ZyUzRSIsInNpemVzIjoiYW55IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Niramit:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #059669;
            --primary-dark: #0d7747;
            --secondary: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #dc2626;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-500: #6b7280;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Niramit', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        /* Navigation */
        .nav {
            display: none;
        }

        .nav.active {
            display: block;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--primary);
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .nav-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255,255,255,0.15);
        }

        .hamburger {
            display: block;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        /* Main Content */
        main {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            border: 1px solid var(--gray-200);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-800);
            margin: 0;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .kpi-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid var(--gray-200);
            box-shadow: 0 2px 4px -1px rgba(0,0,0,0.06);
        }

        .kpi-label {
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-bottom: 0.25rem;
        }

        .kpi-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }

        .kpi-change {
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .positive { color: var(--success); }
        .negative { color: var(--danger); }
        .neutral { color: var(--gray-500); }

        /* Charts */
        .chart-container {
            width: 100%;
            height: 300px;
            position: relative;
            margin: 1rem 0;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-input, .form-select, .form-textarea {
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            justify-content: center;
            min-height: 44px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(5, 150, 105, 0.3);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            min-height: 36px;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin: 1rem 0;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .table th, .table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .table th {
            background: var(--gray-50);
            font-weight: 600;
            color: var(--gray-700);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-500);
        }

        /* Progress Bars */
        .progress {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border: 1px solid;
        }

        .alert-success {
            background: #ecfdf5;
            border-color: #10b981;
            color: #065f46;
        }

        .alert-warning {
            background: #fffbeb;
            border-color: #f59e0b;
            color: #92400e;
        }

        .alert-danger {
            background: #fef2f2;
            border-color: #dc2626;
            color: #991b1b;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .quick-action {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: var(--gray-700);
        }

        .quick-action:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .quick-action-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .quick-action-label {
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Error state */
        .error {
            border-color: var(--danger) !important;
        }

        .error-message {
            color: var(--danger);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* Responsive */
        @media (min-width: 768px) {
            .hamburger {
                display: none;
            }

            .nav {
                display: block;
                position: static;
                background: transparent;
                padding: 0;
                box-shadow: none;
            }

            .nav-list {
                flex-direction: row;
                gap: 0.25rem;
            }

            .form-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }

            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }

        @media (min-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .chart-container {
                height: 400px;
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            :root {
                --gray-50: #1f2937;
                --gray-100: #374151;
                --gray-200: #4b5563;
                --gray-300: #6b7280;
                --gray-500: #9ca3af;
                --gray-700: #d1d5db;
                --gray-800: #f9fafb;
                --gray-900: #ffffff;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .font-semibold { font-weight: 600; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-4 { margin-top: 1rem; }
        .ml-2 { margin-left: 0.5rem; }
        .mr-2 { margin-right: 0.5rem; }
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .hidden { display: none; }
        .flex { display: flex; }
        .grid { display: grid; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .w-full { width: 100%; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">KTP</div>
                    <span>ระบบจัดการฟาร์มสุกรอัจฉริยะ</span>
                </div>
                <button class="hamburger" onclick="toggleNav()" aria-label="เมนู">☰</button>
                <nav class="nav" id="nav">
                    <ul class="nav-list">
                        <li><a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">📊 แผงควบคุม</a></li>
                        <li><a href="#pigs" class="nav-link" onclick="showSection('pigs')">🐷 จัดการสุกร</a></li>
                        <li><a href="#feeding" class="nav-link" onclick="showSection('feeding')">🥗 การให้อาหาร</a></li>
                        <li><a href="#health" class="nav-link" onclick="showSection('health')">💊 สุขภาพ</a></li>
                        <li><a href="#stock" class="nav-link" onclick="showSection('stock')">📦 สต็อก</a></li>
                        <li><a href="#sales" class="nav-link" onclick="showSection('sales')">💰 การขาย</a></li>
                        <li><a href="#reports" class="nav-link" onclick="showSection('reports')">📈 รายงาน</a></li>
                        <li><a href="#references" class="nav-link" onclick="showSection('references')">📚 แหล่งข้อมูล</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="card-title">ภาพรวมฟาร์ม</h2>
                        <span id="current-date" class="text-sm text-gray-500"></span>
                    </div>
                    
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-label">จำนวนสุกรทั้งหมด</div>
                            <div class="kpi-value" id="total-pigs">0</div>
                            <div class="kpi-change neutral">
                                <span>ตัว</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">พร้อมขาย</div>
                            <div class="kpi-value" id="ready-for-sale">0</div>
                            <div class="kpi-change positive">
                                <span>ตัว (≥110กก.)</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">FCR เฉลี่ย</div>
                            <div class="kpi-value" id="avg-fcr">0.00</div>
                            <div class="kpi-change" id="fcr-change">
                                <span>เป้า: 2.35</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">ADG เฉลี่ย</div>
                            <div class="kpi-value" id="avg-adg">0</div>
                            <div class="kpi-change" id="adg-change">
                                <span>กรัม/วัน (เป้า: 700)</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">สต็อกอาหาร</div>
                            <div class="kpi-value" id="feed-stock">0</div>
                            <div class="kpi-change neutral">
                                <span id="feed-days">กก. (0 วัน)</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">รายได้เดือนนี้</div>
                            <div class="kpi-value" id="monthly-income">0</div>
                            <div class="kpi-change positive">
                                <span>บาท</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">สถานการณ์ฟาร์มโดยรวม</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="radarChart" class="chart-canvas"></canvas>
                        </div>
                        <div class="text-sm text-gray-500">
                            แสดง 6 มิติ: FCR, ADG, สุขภาพ, การเงิน, สต็อก, ความพร้อมผลิต (0-100%)
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">สัดส่วนสุกร</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="pieChart" class="chart-canvas"></canvas>
                        </div>
                        <div class="text-sm text-gray-500">
                            แสดงสัดส่วนสุกรแต่ละกลุ่ม
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">📊 FCR เปรียบเทียบ</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="barChart" class="chart-canvas"></canvas>
                        </div>
                        <div class="text-sm text-gray-500">
                            เปรียบเทียบ FCR แต่ละกลุ่มกับเป้าหมาย 2.35
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">⚡ งานด่วน</h3>
                    </div>
                    <div class="quick-actions">
                        <a href="#" class="quick-action" onclick="openModal('addPigModal')">
                            <div class="quick-action-icon">➕</div>
                            <div class="quick-action-label">เพิ่มสุกร</div>
                        </a>
                        <a href="#" class="quick-action" onclick="openModal('feedingModal')">
                            <div class="quick-action-icon">🥗</div>
                            <div class="quick-action-label">บันทึกอาหาร</div>
                        </a>
                        <a href="#" class="quick-action" onclick="openModal('healthModal')">
                            <div class="quick-action-icon">💊</div>
                            <div class="quick-action-label">บันทึกวัคซีน</div>
                        </a>
                        <a href="#" class="quick-action" onclick="openModal('stockModal')">
                            <div class="quick-action-icon">📦</div>
                            <div class="quick-action-label">อัพเดทสต็อก</div>
                        </a>
                        <a href="#" class="quick-action" onclick="openModal('salesModal')">
                            <div class="quick-action-icon">💰</div>
                            <div class="quick-action-label">บันทึกการขาย</div>
                        </a>
                        <a href="#" class="quick-action" onclick="showSection('reports')">
                            <div class="quick-action-icon">📊</div>
                            <div class="quick-action-label">รายงาน</div>
                        </a>
                        <a href="#" class="quick-action" onclick="exportData()">
                            <div class="quick-action-icon">💾</div>
                            <div class="quick-action-label">สำรองข้อมูล</div>
                        </a>
                        <a href="#" class="quick-action" onclick="openModal('importModal')">
                            <div class="quick-action-icon">📥</div>
                            <div class="quick-action-label">นำเข้าข้อมูล</div>
                        </a>
                    </div>
                </div>

                <div id="alerts-container">
                    <!-- Alerts will be inserted here -->
                </div>
            </section>

            <!-- Pigs Management Section -->
            <section id="pigs" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">จัดการสุกร</h2>
                        <button class="btn btn-primary" onclick="openModal('addPigModal')">
                            ➕ เพิ่มสุกร
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table" id="pigsTable">
                            <thead>
                                <tr>
                                    <th>รหัส</th>
                                    <th>กลุ่ม</th>
                                    <th>น้ำหนัก (กก.)</th>
                                    <th>อายุ (วัน)</th>
                                    <th>เพศ</th>
                                    <th>FCR</th>
                                    <th>ADG</th>
                                   <th>สถานะ</th>
                                   <th>การจัดการ</th>
                               </tr>
                           </thead>
                           <tbody id="pigsTableBody">
                               <!-- Data will be inserted here -->
                           </tbody>
                       </table>
                   </div>
               </div>
           </section>

           <!-- Feeding Section -->
           <section id="feeding" class="section">
               <div class="card">
                   <div class="card-header">
                       <h2 class="card-title">การให้อาหาร</h2>
                       <button class="btn btn-primary" onclick="openModal('feedingModal')">
                           🥗 บันทึกการให้อาหาร
                       </button>
                   </div>
                   
                   <div class="dashboard-grid">
                       <div class="card">
                           <h3 class="card-title mb-4">📈 แนวโน้มการใช้อาหาร</h3>
                           <div class="chart-container">
                               <canvas id="feedingTrendChart" class="chart-canvas"></canvas>
                           </div>
                       </div>
                       
                       <div class="card">
                           <h3 class="card-title mb-4">💰 ต้นทุนอาหาร</h3>
                           <div class="kpi-grid">
                               <div class="kpi-card">
                                   <div class="kpi-label">วันนี้</div>
                                   <div class="kpi-value" id="daily-feed-cost">0</div>
                                   <div class="kpi-change neutral">บาท</div>
                               </div>
                               <div class="kpi-card">
                                   <div class="kpi-label">เดือนนี้</div>
                                   <div class="kpi-value" id="monthly-feed-cost">0</div>
                                   <div class="kpi-change neutral">บาท</div>
                               </div>
                           </div>
                       </div>
                   </div>

                   <div class="card">
                       <h3 class="card-title">ประวัติการให้อาหาร</h3>
                       <div class="table-container">
                           <table class="table" id="feedingTable">
                               <thead>
                                   <tr>
                                       <th>วันที่</th>
                                       <th>กลุ่ม</th>
                                       <th>ประเภทอาหาร</th>
                                       <th>ปริมาณ (กก.)</th>
                                       <th>ต้นทุน (บาท)</th>
                                       <th>การจัดการ</th>
                                   </tr>
                               </thead>
                               <tbody id="feedingTableBody">
                                   <!-- Data will be inserted here -->
                               </tbody>
                           </table>
                       </div>
                   </div>
               </div>
           </section>

           <!-- Health Section -->
           <section id="health" class="section">
               <div class="card">
                   <div class="card-header">
                       <h2 class="card-title">การจัดการสุขภาพสุกร</h2>
                       <button class="btn btn-primary" onclick="openModal('healthModal')">
                           💊 บันทึกการรักษา/วัคซีน
                       </button>
                   </div>

                   <div class="dashboard-grid">
                       <div class="card">
                           <h3 class="card-title">วัคซีนครบกำหนด</h3>
                           <div id="vaccine-alerts">
                               <div class="alert alert-warning">
                                   <strong>วันนี้:</strong> ไม่มีวัคซีนครบกำหนด
                               </div>
                           </div>
                       </div>

                       <div class="card">
                           <h3 class="card-title">สถิติสุขภาพสุกร</h3>
                           <div class="kpi-grid">
                               <div class="kpi-card">
                                   <div class="kpi-label">อัตราการตาย</div>
                                   <div class="kpi-value" id="mortality-rate">0.0</div>
                                   <div class="kpi-change neutral">% (เป้า: <5%)</div>
                               </div>
                               <div class="kpi-card">
                                   <div class="kpi-label">สุกรป่วย</div>
                                   <div class="kpi-value" id="sick-pigs">0</div>
                                   <div class="kpi-change neutral">ตัว</div>
                               </div>
                           </div>
                       </div>
                   </div>

                   <div class="card">
                       <h3 class="card-title">ประวัติสุขภาพสุกร</h3>
                       <div class="table-container">
                           <table class="table" id="healthTable">
                               <thead>
                                   <tr>
                                       <th>วันที่</th>
                                       <th>รหัสสุกร</th>
                                       <th>ประเภท</th>
                                       <th>รายละเอียด</th>
                                       <th>ค่าใช้จ่าย</th>
                                       <th>การจัดการ</th>
                                   </tr>
                               </thead>
                               <tbody id="healthTableBody">
                                   <!-- Data will be inserted here -->
                               </tbody>
                           </table>
                       </div>
                   </div>
               </div>
           </section>

           <!-- Stock Section -->
           <section id="stock" class="section">
               <div class="card">
                   <div class="card-header">
                       <h2 class="card-title">จัดการสต็อก</h2>
                       <button class="btn btn-primary" onclick="openModal('stockModal')">
                           📦 อัพเดทสต็อก
                       </button>
                   </div>

                   <div class="dashboard-grid">
                       <div class="card">
                           <h3 class="card-title">สต็อกอาหาร</h3>
                           <div class="space-y-4" id="feed-stock-list">
                               <!-- Feed stock items will be inserted here -->
                           </div>
                       </div>

                       <div class="card">
                           <h3 class="card-title">สต็อกยาและวัคซีน</h3>
                           <div class="space-y-4" id="medicine-stock-list">
                               <!-- Medicine stock items will be inserted here -->
                           </div>
                       </div>

                       <div class="card">
                           <h3 class="card-title">มูลค่าสต็อก</h3>
                           <div class="kpi-grid">
                               <div class="kpi-card">
                                   <div class="kpi-label">อาหาร</div>
                                   <div class="kpi-value" id="feed-stock-value">0</div>
                                   <div class="kpi-change neutral">บาท</div>
                               </div>
                               <div class="kpi-card">
                                   <div class="kpi-label">ยา/วัคซีน</div>
                                   <div class="kpi-value" id="medicine-stock-value">0</div>
                                   <div class="kpi-change neutral">บาท</div>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
           </section>

           <!-- Sales Section -->
           <section id="sales" class="section">
               <div class="card">
                   <div class="card-header">
                       <h2 class="card-title">การขายสุกร</h2>
                       <button class="btn btn-primary" onclick="openModal('salesModal')">
                           💰 บันทึกการขาย
                       </button>
                   </div>

                   <div class="dashboard-grid">
                       <div class="card">
                           <h3 class="card-title">สรุปการขาย</h3>
                           <div class="kpi-grid">
                               <div class="kpi-card">
                                   <div class="kpi-label">ขายเดือนนี้</div>
                                   <div class="kpi-value" id="monthly-sales-count">0</div>
                                   <div class="kpi-change neutral">ตัว</div>
                               </div>
                               <div class="kpi-card">
                                   <div class="kpi-label">รายได้เดือนนี้</div>
                                   <div class="kpi-value" id="monthly-sales-income">0</div>
                                   <div class="kpi-change positive">บาท</div>
                               </div>
                               <div class="kpi-card">
                                   <div class="kpi-label">ราคาเฉลี่ย/กก.</div>
                                   <div class="kpi-value" id="avg-price-per-kg">0</div>
                                   <div class="kpi-change neutral">บาท</div>
                               </div>
                           </div>
                       </div>

                       <div class="card">
                           <h3 class="card-title">สุกรพร้อมขาย</h3>
                           <div id="ready-pigs-list">
                               <!-- Ready pigs will be listed here -->
                           </div>
                       </div>
                   </div>

                   <div class="card">
                       <h3 class="card-title">ประวัติการขาย</h3>
                       <div class="table-container">
                           <table class="table" id="salesTable">
                               <thead>
                                   <tr>
                                       <th>วันที่</th>
                                       <th>รหัสสุกร</th>
                                       <th>น้ำหนัก (กก.)</th>
                                       <th>ราคา/กก.</th>
                                       <th>รายได้</th>
                                       <th>ผู้ซื้อ</th>
                                       <th>การจัดการ</th>
                                   </tr>
                               </thead>
                               <tbody id="salesTableBody">
                                   <!-- Data will be inserted here -->
                               </tbody>
                           </table>
                       </div>
                   </div>
               </div>
           </section>

           <!-- Reports Section -->
           <section id="reports" class="section">
               <div class="card">
                   <div class="card-header">
                       <h2 class="card-title">รายงาน</h2>
                       <button class="btn btn-primary" onclick="generatePDFReport()">
                           📄 ส่งออก PDF
                       </button>
                   </div>

                   <div class="dashboard-grid">
                       <div class="card">
                           <h3 class="card-title">ประสิทธิภาพการผลิต</h3>
                           <div class="chart-container">
                               <canvas id="performanceChart" class="chart-canvas"></canvas>
                           </div>
                       </div>

                       <div class="card">
                           <h3 class="card-title">รายงานการเงิน</h3>
                           <div class="kpi-grid">
                               <div class="kpi-card">
                                   <div class="kpi-label">รายได้รวม</div>
                                   <div class="kpi-value" id="total-income">0</div>
                                   <div class="kpi-change neutral">บาท</div>
                               </div>
                               <div class="kpi-card">
                                   <div class="kpi-label">ค่าใช้จ่ายรวม</div>
                                   <div class="kpi-value" id="total-expenses">0</div>
                                   <div class="kpi-change neutral">บาท</div>
                               </div>
                               <div class="kpi-card">
                                   <div class="kpi-label">กำไรสุทธิ</div>
                                   <div class="kpi-value" id="net-profit">0</div>
                                   <div class="kpi-change" id="profit-change">บาท</div>
                               </div>
                               <div class="kpi-card">
                                   <div class="kpi-label">ROI</div>
                                   <div class="kpi-value" id="roi">0.0</div>
                                   <div class="kpi-change neutral">%</div>
                               </div>
                           </div>
                       </div>

                       <div class="card">
                           <h3 class="card-title">แนวโน้มรายเดือน</h3>
                           <div class="chart-container">
                               <canvas id="monthlyTrendChart" class="chart-canvas"></canvas>
                           </div>
                       </div>
                   </div>
               </div>
           </section>

           <!-- References Section -->
           <section id="references" class="section">
               <div class="card">
                   <div class="card-header">
                       <h2 class="card-title">แหล่งข้อมูลและมาตรฐาน</h2>
                   </div>

                   <div class="dashboard-grid">
                       <div class="card">
                           <h3 class="card-title">แหล่งข้อมูลอ้างอิง</h3>
                           <div class="space-y-3">
                               <div class="p-3 border border-gray-200 rounded-lg">
                                   <h4 class="font-semibold">กรมปศุสัตว์</h4>
                                   <p class="text-sm text-gray-600">มาตรฐาน FCR (2.35), ADG (700g/วัน), ตารางวัคซีน</p>
                                   <a href="https://dld.go.th" class="text-blue-600 text-sm" target="_blank">dld.go.th</a>
                               </div>
                               <div class="p-3 border border-gray-200 rounded-lg">
                                   <h4 class="font-semibold">สมาคมสัตวแพทย์ควบคุมฟาร์มสุกรไทย</h4>
                                   <p class="text-sm text-gray-600">มาตรฐานฟาร์มและแนวทางปฏิบัติ</p>
                                   <a href="https://tsva.or.th" class="text-blue-600 text-sm" target="_blank">tsva.or.th</a>
                               </div>
                               <div class="p-3 border border-gray-200 rounded-lg">
                                   <h4 class="font-semibold">สมาคมผู้เลี้ยงสุกรแห่งชาติ</h4>
                                   <p class="text-sm text-gray-600">ข้อมูลประสิทธิภาพและต้นทุน</p>
                                   <a href="https://swinethailand.com" class="text-blue-600 text-sm" target="_blank">swinethailand.com</a>
                               </div>
                           </div>
                       </div>

                       <div class="card">
                           <h3 class="card-title">มาตรฐานทางวิชาการ</h3>
                           <div class="space-y-3">
                               <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                                   <h4 class="font-semibold text-green-800">FCR เป้าหมาย: 2.35</h4>
                                   <p class="text-sm text-green-600">Feed Conversion Ratio ตามมาตรฐานกรมปศุสัตว์</p>
                               </div>
                               <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                   <h4 class="font-semibold text-blue-800">ADG เป้าหมาย: 700 กรัม/วัน</h4>
                                   <p class="text-sm text-blue-600">Average Daily Gain อัตราการเจริญเติบโต</p>
                               </div>
                               <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                   <h4 class="font-semibold text-yellow-800">อัตราการตาย: < 5%</h4>
                                   <p class="text-sm text-yellow-600">Mortality Rate เป้าหมายตามมาตรฐาน</p>
                               </div>
                           </div>
                       </div>

                       <div class="card">
                           <h3 class="card-title">ข้อมูลต้นทุน</h3>
                           <div class="space-y-3">
                               <div class="p-3 border border-gray-200 rounded-lg">
                                   <h4 class="font-semibold">ลูกพันธุ์สุกร</h4>
                                   <p class="text-sm text-gray-600">2,700 บาท/16กก. (168.75 บาท/กก.)</p>
                               </div>
                               <div class="p-3 border border-gray-200 rounded-lg">
                                   <h4 class="font-semibold">ราคาอาหาร</h4>
                                   <ul class="text-sm text-gray-600">
                                       <li>• หมูเล็ก: 20 บาท/กก.</li>
                                       <li>• หมูรุ่น: 18 บาท/กก.</li>
                                       <li>• หมูขุน: 16 บาท/กก.</li>
                                   </ul>
                               </div>
                           </div>
                       </div>
                   </div>

                   <div class="card">
                       <h3 class="card-title">สูตรการคำนวณ</h3>
                       <div class="space-y-4">
                           <div class="p-4 bg-gray-50 rounded-lg">
                               <h4 class="font-semibold mb-2">FCR (Feed Conversion Ratio)</h4>
                               <code class="bg-white p-2 rounded border text-sm block">
                                   FCR = อาหารรวม(กก.) ÷ (น้ำหนักปัจจุบัน - น้ำหนักเริ่มต้น)
                               </code>
                           </div>
                           <div class="p-4 bg-gray-50 rounded-lg">
                               <h4 class="font-semibold mb-2">ADG (Average Daily Gain)</h4>
                               <code class="bg-white p-2 rounded border text-sm block">
                                   ADG = (น้ำหนักปัจจุบัน - น้ำหนักเริ่มต้น) × 1000 ÷ จำนวนวันเลี้ยง
                               </code>
                           </div>
                       </div>
                   </div>
               </div>
           </section>
       </div>
   </main>

   <!-- Modals -->
   
   <!-- Add Pig Modal -->
   <div id="addPigModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title">เพิ่มสุกร</h3>
               <button class="modal-close" onclick="closeModal('addPigModal')">&times;</button>
           </div>
           <form id="addPigForm">
               <div class="form-grid">
                   <div class="form-group">
                       <label class="form-label">รหัสสุกร <span class="text-danger">*</span></label>
                       <input type="text" class="form-input" name="pigId" required>
                       <span class="error-message hidden"></span>
                   </div>
                   <div class="form-group">
                       <label class="form-label">กลุ่ม <span class="text-danger">*</span></label>
                       <select class="form-select" name="group" required>
                           <option value="">เลือกกลุ่ม</option>
                           <option value="อนุบาล">อนุบาล</option>
                           <option value="รุ่น">รุ่น</option>
                           <option value="ขุน">ขุน</option>
                           <option value="พันธุ์">พันธุ์</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">น้ำหนักเริ่มต้น (กก.) <span class="text-danger">*</span></label>
                       <input type="number" class="form-input" name="initialWeight" step="0.1" required min="0">
                   </div>
                   <div class="form-group">
                       <label class="form-label">น้ำหนักปัจจุบัน (กก.) <span class="text-danger">*</span></label>
                       <input type="number" class="form-input" name="currentWeight" step="0.1" required min="0">
                   </div>
                   <div class="form-group">
                       <label class="form-label">เพศ <span class="text-danger">*</span></label>
                       <select class="form-select" name="gender" required>
                           <option value="">เลือกเพศ</option>
                           <option value="เมีย">เมีย</option>
                           <option value="ผู้">ผู้</option>
                           <option value="ขุน">ขุน</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">สายพันธุ์</label>
                       <input type="text" class="form-input" name="breed" placeholder="เช่น ลูกผสม, ยอร์คเชียร์">
                   </div>
                   <div class="form-group">
                       <label class="form-label">วันที่เข้าฟาร์ม <span class="text-danger">*</span></label>
                       <input type="date" class="form-input" name="entryDate" required>
                   </div>
               </div>
               <div class="flex gap-2 mt-4">
                   <button type="submit" class="btn btn-primary">บันทึก</button>
                   <button type="button" class="btn btn-secondary" onclick="closeModal('addPigModal')">ยกเลิก</button>
               </div>
           </form>
       </div>
   </div>

   <!-- Edit Pig Modal -->
   <div id="editPigModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title">แก้ไขข้อมูลสุกร</h3>
               <button class="modal-close" onclick="closeModal('editPigModal')">&times;</button>
           </div>
           <form id="editPigForm">
               <input type="hidden" name="index" id="editPigIndex">
               <div class="form-grid">
                   <div class="form-group">
                       <label class="form-label">รหัสสุกร</label>
                       <input type="text" class="form-input" name="pigId" readonly>
                   </div>
                   <div class="form-group">
                       <label class="form-label">กลุ่ม <span class="text-danger">*</span></label>
                       <select class="form-select" name="group" required>
                           <option value="">เลือกกลุ่ม</option>
                           <option value="อนุบาล">อนุบาล</option>
                           <option value="รุ่น">รุ่น</option>
                           <option value="ขุน">ขุน</option>
                           <option value="พันธุ์">พันธุ์</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">น้ำหนักปัจจุบัน (กก.) <span class="text-danger">*</span></label>
                       <input type="number" class="form-input" name="currentWeight" step="0.1" required min="0">
                   </div>
                   <div class="form-group">
                       <label class="form-label">สายพันธุ์</label>
                       <input type="text" class="form-input" name="breed">
                   </div>
               </div>
               <div class="flex gap-2 mt-4">
                   <button type="submit" class="btn btn-primary">บันทึก</button>
                   <button type="button" class="btn btn-secondary" onclick="closeModal('editPigModal')">ยกเลิก</button>
               </div>
           </form>
       </div>
   </div>

   <!-- Feeding Modal -->
   <div id="feedingModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title">บันทึกการให้อาหาร</h3>
               <button class="modal-close" onclick="closeModal('feedingModal')">&times;</button>
           </div>
           <form id="feedingForm">
               <div class="form-grid">
                   <div class="form-group">
                       <label class="form-label">วันที่ <span class="text-danger">*</span></label>
                       <input type="date" class="form-input" name="date" required>
                   </div>
                   <div class="form-group">
                       <label class="form-label">กลุ่มสุกร <span class="text-danger">*</span></label>
                       <select class="form-select" name="group" required>
                           <option value="">เลือกกลุ่ม</option>
                           <option value="อนุบาล">อนุบาล</option>
                           <option value="รุ่น">รุ่น</option>
                           <option value="ขุน">ขุน</option>
                           <option value="พันธุ์">พันธุ์</option>
                           <option value="ทั้งหมด">ทั้งหมด</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">ประเภทอาหาร <span class="text-danger">*</span></label>
                       <select class="form-select" name="feedType" required>
                           <option value="">เลือกประเภท</option>
                           <option value="หมูเล็ก">หมูเล็ก (20 บาท/กก.)</option>
                           <option value="หมูรุ่น">หมูรุ่น (18 บาท/กก.)</option>
                           <option value="หมูขุน">หมูขุน (16 บาท/กก.)</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">ปริมาณ (กก.) <span class="text-danger">*</span></label>
                       <input type="number" class="form-input" name="amount" step="0.1" required min="0">
                   </div>
                   <div class="form-group">
                       <label class="form-label">หมายเหตุ</label>
                       <textarea class="form-textarea" name="notes" rows="2"></textarea>
                   </div>
               </div>
               <div class="flex gap-2 mt-4">
                   <button type="submit" class="btn btn-primary">บันทึก</button>
                   <button type="button" class="btn btn-secondary" onclick="closeModal('feedingModal')">ยกเลิก</button>
               </div>
           </form>
       </div>
   </div>

   <!-- Health Modal -->
   <div id="healthModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title">บันทึกสุขภาพสุกร/วัคซีน</h3>
               <button class="modal-close" onclick="closeModal('healthModal')">&times;</button>
           </div>
           <form id="healthForm">
               <div class="form-grid">
                   <div class="form-group">
                       <label class="form-label">วันที่ <span class="text-danger">*</span></label>
                       <input type="date" class="form-input" name="date" required>
                   </div>
                   <div class="form-group">
                       <label class="form-label">รหัสสุกร <span class="text-danger">*</span></label>
                       <select class="form-select" name="pigId" required>
                           <option value="">เลือกสุกร</option>
                           <option value="ทั้งหมด">ทั้งหมด</option>
                       </select>
                   </div>
                   <div class="form-group">
                   <label class="form-label">ประเภท <span class="text-danger">*</span></label>
                       <select class="form-select" name="type" required>
                           <option value="">เลือกประเภท</option>
                           <option value="วัคซีน">วัคซีน</option>
                           <option value="รักษา">รักษา</option>
                           <option value="ตรวจสุขภาพ">ตรวจสุขภาพ</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">ชื่อวัคซีน/ยา</label>
                       <select class="form-select" name="vaccine">
                           <option value="">เลือกวัคซีน/ยา</option>
                           <option value="PRRS">PRRS (Porcine Reproductive and Respiratory Syndrome)</option>
                           <option value="MHFD">MHFD (Mycoplasma hyopneumoniae + FMD)</option>
                           <option value="PCV2">PCV2 (Porcine Circovirus Type 2)</option>
                           <option value="กาฬโรค">กาฬโรค (Classical Swine Fever)</option>
                           <option value="อื่นๆ">อื่นๆ</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">ค่าใช้จ่าย (บาท)</label>
                       <input type="number" class="form-input" name="cost" step="0.01" min="0">
                   </div>
                   <div class="form-group">
                       <label class="form-label">หมายเหตุ</label>
                       <textarea class="form-textarea" name="notes" rows="2"></textarea>
                   </div>
               </div>
               <div class="flex gap-2 mt-4">
                   <button type="submit" class="btn btn-primary">บันทึก</button>
                   <button type="button" class="btn btn-secondary" onclick="closeModal('healthModal')">ยกเลิก</button>
               </div>
           </form>
       </div>
   </div>

   <!-- Stock Modal -->
   <div id="stockModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title">อัพเดทสต็อก</h3>
               <button class="modal-close" onclick="closeModal('stockModal')">&times;</button>
           </div>
           <form id="stockForm">
               <div class="form-grid">
                   <div class="form-group">
                       <label class="form-label">วันที่ <span class="text-danger">*</span></label>
                       <input type="date" class="form-input" name="date" required>
                   </div>
                   <div class="form-group">
                       <label class="form-label">ประเภท <span class="text-danger">*</span></label>
                       <select class="form-select" name="type" required>
                           <option value="">เลือกประเภท</option>
                           <option value="อาหาร">อาหาร</option>
                           <option value="ยา">ยา</option>
                           <option value="วัคซีน">วัคซีน</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">รายการ <span class="text-danger">*</span></label>
                       <input type="text" class="form-input" name="item" required placeholder="เช่น อาหารหมูเล็ก, วัคซีน PRRS">
                   </div>
                   <div class="form-group">
                       <label class="form-label">การดำเนินการ <span class="text-danger">*</span></label>
                       <select class="form-select" name="action" required>
                           <option value="">เลือกการดำเนินการ</option>
                           <option value="เพิ่ม">เพิ่มสต็อก</option>
                           <option value="ใช้">ใช้สต็อก</option>
                           <option value="ปรับปรุง">ปรับปรุงยอด</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">จำนวน <span class="text-danger">*</span></label>
                       <input type="number" class="form-input" name="quantity" step="0.1" required min="0">
                   </div>
                   <div class="form-group">
                       <label class="form-label">หน่วย <span class="text-danger">*</span></label>
                       <select class="form-select" name="unit" required>
                           <option value="">เลือกหน่วย</option>
                           <option value="กก.">กก.</option>
                           <option value="โดส">โดส</option>
                           <option value="ขวด">ขวด</option>
                           <option value="ถุง">ถุง</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">ราคาต่อหน่วย (บาท)</label>
                       <input type="number" class="form-input" name="unitPrice" step="0.01" min="0">
                   </div>
                   <div class="form-group">
                       <label class="form-label">วันหมดอายุ</label>
                       <input type="date" class="form-input" name="expiryDate">
                   </div>
               </div>
               <div class="flex gap-2 mt-4">
                   <button type="submit" class="btn btn-primary">บันทึก</button>
                   <button type="button" class="btn btn-secondary" onclick="closeModal('stockModal')">ยกเลิก</button>
               </div>
           </form>
       </div>
   </div>

   <!-- Sales Modal -->
   <div id="salesModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title">บันทึกการขายสุกร</h3>
               <button class="modal-close" onclick="closeModal('salesModal')">&times;</button>
           </div>
           <form id="salesForm">
               <div class="form-grid">
                   <div class="form-group">
                       <label class="form-label">วันที่ขาย <span class="text-danger">*</span></label>
                       <input type="date" class="form-input" name="date" required>
                   </div>
                   <div class="form-group">
                       <label class="form-label">รหัสสุกร <span class="text-danger">*</span></label>
                       <select class="form-select" name="pigId" required onchange="updateSaleWeight()">
                           <option value="">เลือกสุกร</option>
                       </select>
                   </div>
                   <div class="form-group">
                       <label class="form-label">น้ำหนักขาย (กก.)</label>
                       <input type="number" class="form-input" name="weight" step="0.1" readonly>
                   </div>
                   <div class="form-group">
                       <label class="form-label">ราคา/กก. <span class="text-danger">*</span></label>
                       <input type="number" class="form-input" name="pricePerKg" step="0.01" required min="0" onchange="calculateTotalPrice()">
                   </div>
                   <div class="form-group">
                       <label class="form-label">รายได้รวม</label>
                       <input type="number" class="form-input" name="totalPrice" readonly>
                   </div>
                   <div class="form-group">
                       <label class="form-label">ผู้ซื้อ</label>
                       <input type="text" class="form-input" name="buyer" placeholder="ชื่อผู้ซื้อ/บริษัท">
                   </div>
                   <div class="form-group">
                       <label class="form-label">หมายเหตุ</label>
                       <textarea class="form-textarea" name="notes" rows="2"></textarea>
                   </div>
               </div>
               <div class="flex gap-2 mt-4">
                   <button type="submit" class="btn btn-primary">บันทึก</button>
                   <button type="button" class="btn btn-secondary" onclick="closeModal('salesModal')">ยกเลิก</button>
               </div>
           </form>
       </div>
   </div>

   <!-- Import Data Modal -->
   <div id="importModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title">นำเข้าข้อมูล</h3>
               <button class="modal-close" onclick="closeModal('importModal')">&times;</button>
           </div>
           <form id="importForm">
               <div class="form-group">
                   <label class="form-label">เลือกไฟล์ JSON</label>
                   <input type="file" class="form-input" accept=".json" id="importFile" required>
               </div>
               <div class="alert alert-warning">
                   <strong>คำเตือน:</strong> การนำเข้าข้อมูลจะแทนที่ข้อมูลทั้งหมดที่มีอยู่ กรุณาสำรองข้อมูลก่อนดำเนินการ
               </div>
               <div class="flex gap-2 mt-4">
                   <button type="submit" class="btn btn-primary">นำเข้า</button>
                   <button type="button" class="btn btn-secondary" onclick="closeModal('importModal')">ยกเลิก</button>
               </div>
           </form>
       </div>
   </div>

   <!-- Chart.js Library -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

   <script>
       // Data Storage
       let farmData = {
           pigs: JSON.parse(localStorage.getItem('farmPigs') || '[]'),
           feeding: JSON.parse(localStorage.getItem('farmFeeding') || '[]'),
           health: JSON.parse(localStorage.getItem('farmHealth') || '[]'),
           stock: JSON.parse(localStorage.getItem('farmStock') || '[]'),
           sales: JSON.parse(localStorage.getItem('farmSales') || '[]'),
           settings: JSON.parse(localStorage.getItem('farmSettings') || '{}')
       };

       // Chart instances
       let charts = {};

       // Navigation
       function showSection(sectionId) {
           // Hide all sections
           document.querySelectorAll('.section').forEach(section => {
               section.classList.remove('active');
           });
           
           // Show selected section
           document.getElementById(sectionId).classList.add('active');
           
           // Update navigation
           document.querySelectorAll('.nav-link').forEach(link => {
               link.classList.remove('active');
           });
           document.querySelector(`[onclick="showSection('${sectionId}')"]`).classList.add('active');
           
           // Close mobile menu
           document.getElementById('nav').classList.remove('active');
           
           // Update page based on section
           if (sectionId === 'dashboard') {
               updateDashboard();
           } else if (sectionId === 'pigs') {
               updatePigsTable();
           } else if (sectionId === 'feeding') {
               updateFeedingSection();
           } else if (sectionId === 'health') {
               updateHealthSection();
           } else if (sectionId === 'stock') {
               updateStockSection();
           } else if (sectionId === 'sales') {
               updateSalesSection();
           } else if (sectionId === 'reports') {
               updateReportsSection();
           }
       }

       function toggleNav() {
           document.getElementById('nav').classList.toggle('active');
       }

       // Modal functions
       function openModal(modalId) {
           document.getElementById(modalId).classList.add('active');
           
           // Setup form defaults
           if (modalId === 'feedingModal') {
               document.querySelector('#feedingForm [name="date"]').value = new Date().toISOString().split('T')[0];
           } else if (modalId === 'healthModal') {
               document.querySelector('#healthForm [name="date"]').value = new Date().toISOString().split('T')[0];
               updatePigSelectOptions();
           } else if (modalId === 'stockModal') {
               document.querySelector('#stockForm [name="date"]').value = new Date().toISOString().split('T')[0];
           } else if (modalId === 'salesModal') {
               document.querySelector('#salesForm [name="date"]').value = new Date().toISOString().split('T')[0];
               updateSalesPigOptions();
           }
       }

       function closeModal(modalId) {
           document.getElementById(modalId).classList.remove('active');
           // Clear form
           const form = document.querySelector(`#${modalId} form`);
           if (form) {
               form.reset();
               // Clear any error states
               form.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
               form.querySelectorAll('.error-message').forEach(el => el.textContent = '');
           }
       }

       // Data Management Functions
       function saveData() {
           localStorage.setItem('farmPigs', JSON.stringify(farmData.pigs));
           localStorage.setItem('farmFeeding', JSON.stringify(farmData.feeding));
           localStorage.setItem('farmHealth', JSON.stringify(farmData.health));
           localStorage.setItem('farmStock', JSON.stringify(farmData.stock));
           localStorage.setItem('farmSales', JSON.stringify(farmData.sales));
           localStorage.setItem('farmSettings', JSON.stringify(farmData.settings));
       }

       // Fixed FCR calculation
       function calculateFCR(pig) {
           // Get feeding records for this pig based on entry date
           const entryDate = new Date(pig.entryDate);
           const feedingRecords = farmData.feeding.filter(record => {
               const recordDate = new Date(record.date);
               return recordDate >= entryDate && (record.group === pig.group || record.group === 'ทั้งหมด');
           });

           // Calculate total feed consumed
           const totalFeed = feedingRecords.reduce((sum, record) => {
               // Estimate individual pig's share based on group size
               const groupPigs = farmData.pigs.filter(p => p.group === record.group).length || 1;
               return sum + (record.amount / groupPigs);
           }, 0);

           const weightGain = pig.currentWeight - pig.initialWeight;
           return weightGain > 0 ? (totalFeed / weightGain).toFixed(2) : '0.00';
       }

       function calculateADG(pig) {
           const entryDate = new Date(pig.entryDate);
           const today = new Date();
           const daysInFarm = Math.floor((today - entryDate) / (1000 * 60 * 60 * 24)) || 1;
           const weightGain = pig.currentWeight - pig.initialWeight;
           
           return Math.round((weightGain * 1000) / daysInFarm);
       }

       function calculateRadarScores() {
           const totalPigs = farmData.pigs.length;
           if (totalPigs === 0) return [0, 0, 0, 0, 0, 0];

           // FCR Score
           const fcrValues = farmData.pigs.map(pig => parseFloat(calculateFCR(pig)));
           const avgFCR = fcrValues.reduce((sum, fcr) => sum + fcr, 0) / totalPigs;
           const fcrScore = avgFCR > 0 ? Math.min(100, (2.35 / avgFCR) * 100) : 0;

           // ADG Score
           const avgADG = farmData.pigs.reduce((sum, pig) => sum + calculateADG(pig), 0) / totalPigs;
           const adgScore = Math.min(100, (avgADG / 700) * 100);

           // Health Score
           const deadPigs = farmData.health.filter(h => h.type === 'รักษา' && h.notes && h.notes.includes('ตาย')).length;
           const mortalityRate = totalPigs > 0 ? (deadPigs / totalPigs) * 100 : 0;
           const healthScore = Math.max(0, 100 - (mortalityRate * 20));

           // Financial Score
           const totalIncome = farmData.sales.reduce((sum, sale) => sum + sale.totalPrice, 0);
           const totalCosts = farmData.feeding.reduce((sum, f) => sum + f.cost, 0) + 
                            farmData.health.reduce((sum, h) => sum + (h.cost || 0), 0);
           const roi = totalCosts > 0 ? ((totalIncome - totalCosts) / totalCosts) * 100 : 0;
           const financialScore = Math.min(100, Math.max(0, roi + 50));

           // Stock Score
           const totalFeedStock = farmData.stock
               .filter(s => s.type === 'อาหาร')
               .reduce((sum, s) => sum + s.quantity, 0);
           
           // Calculate actual daily consumption
           const last7DaysFeeding = farmData.feeding
               .filter(f => new Date(f.date) >= new Date(Date.now() - 7 * 24 * 60 * 60 * 1000))
               .reduce((sum, f) => sum + f.amount, 0);
           const dailyFeedConsumption = last7DaysFeeding / 7 || 50;
           
           const feedDays = dailyFeedConsumption > 0 ? totalFeedStock / dailyFeedConsumption : 0;
           const stockScore = Math.min(100, (feedDays / 30) * 100);

           // Production Score
           const readyForSale = farmData.pigs.filter(p => p.currentWeight >= 110).length;
           const productionScore = totalPigs > 0 ? (readyForSale / totalPigs) * 100 : 0;

           return [fcrScore, adgScore, healthScore, financialScore, stockScore, productionScore];
       }

       // Dashboard Functions
       function updateDashboard() {
           // Update current date
           document.getElementById('current-date').textContent = 
               new Date().toLocaleDateString('th-TH', { 
                   year: 'numeric', 
                   month: 'long', 
                   day: 'numeric' 
               });

           // Update KPIs
           updateKPIs();
           
           // Update charts
           updateRadarChart();
           updatePieChart();
           updateBarChart();
           
           // Update alerts
           updateAlerts();
       }

       function updateKPIs() {
           const totalPigs = farmData.pigs.length;
           const readyForSale = farmData.pigs.filter(p => p.currentWeight >= 110).length;
           
           // Calculate averages
           const fcrValues = farmData.pigs.map(pig => parseFloat(calculateFCR(pig)));
           const avgFCR = totalPigs > 0 ? 
               fcrValues.reduce((sum, fcr) => sum + fcr, 0) / totalPigs : 0;
           const avgADG = totalPigs > 0 ? 
               farmData.pigs.reduce((sum, pig) => sum + calculateADG(pig), 0) / totalPigs : 0;

           // Calculate feed stock and consumption
           const totalFeedStock = farmData.stock
               .filter(s => s.type === 'อาหาร')
               .reduce((sum, s) => sum + s.quantity, 0);
           
           // Calculate actual daily consumption from recent feeding records
           const last7Days = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
           const recentFeeding = farmData.feeding.filter(f => new Date(f.date) >= last7Days);
           const dailyConsumption = recentFeeding.length > 0 ?
               recentFeeding.reduce((sum, f) => sum + f.amount, 0) / 7 : 50;
           
           const feedDays = Math.floor(totalFeedStock / dailyConsumption);

           // Calculate monthly income from sales
           const currentMonth = new Date().toISOString().slice(0, 7);
           const monthlyIncome = farmData.sales
               .filter(s => s.date.startsWith(currentMonth))
               .reduce((sum, s) => sum + s.totalPrice, 0);

           // Update DOM
           document.getElementById('total-pigs').textContent = totalPigs;
           document.getElementById('ready-for-sale').textContent = readyForSale;
           document.getElementById('avg-fcr').textContent = avgFCR.toFixed(2);
           document.getElementById('avg-adg').textContent = Math.round(avgADG);
           document.getElementById('feed-stock').textContent = Math.round(totalFeedStock);
           document.getElementById('feed-days').textContent = `กก. (${feedDays} วัน)`;
           document.getElementById('monthly-income').textContent = monthlyIncome.toLocaleString();

           // Update FCR and ADG indicators
           const fcrChange = document.getElementById('fcr-change');
           const fcrDiff = avgFCR > 0 ? ((avgFCR - 2.35) / 2.35) * 100 : 0;
           fcrChange.className = fcrDiff <= 0 ? 'kpi-change positive' : 'kpi-change negative';
           fcrChange.innerHTML = `<span>${fcrDiff > 0 ? '+' : ''}${fcrDiff.toFixed(1)}% จากเป้า</span>`;

           const adgChange = document.getElementById('adg-change');
           const adgDiff = ((avgADG - 700) / 700) * 100;
           adgChange.className = adgDiff >= 0 ? 'kpi-change positive' : 'kpi-change negative';
           adgChange.innerHTML = `<span>${adgDiff > 0 ? '+' : ''}${adgDiff.toFixed(1)}% จากเป้า</span>`;
       }

       function updateRadarChart() {
           const ctx = document.getElementById('radarChart').getContext('2d');
           
           if (charts.radar) {
               charts.radar.destroy();
           }

           const scores = calculateRadarScores();
           
           charts.radar = new Chart(ctx, {
               type: 'radar',
               data: {
                   labels: ['FCR', 'ADG', 'สุขภาพ', 'การเงิน', 'สต็อก', 'ความพร้อมผลิต'],
                   datasets: [{
                       label: 'คะแนนปัจจุบัน',
                       data: scores,
                       backgroundColor: 'rgba(5, 150, 105, 0.2)',
                       borderColor: 'rgba(5, 150, 105, 1)',
                       borderWidth: 2,
                       pointBackgroundColor: 'rgba(5, 150, 105, 1)',
                       pointBorderColor: '#fff',
                       pointBorderWidth: 2
                   }]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   scales: {
                       r: {
                           beginAtZero: true,
                           max: 100,
                           ticks: {
                               stepSize: 20,
                               callback: function(value) {
                                   return value + '%';
                               }
                           },
                           pointLabels: {
                               font: {
                                   family: 'Niramit',
                                   size: 12
                               }
                           }
                       }
                   },
                   plugins: {
                       legend: {
                           display: false
                       }
                   }
               }
           });
       }

       function updatePieChart() {
           const ctx = document.getElementById('pieChart').getContext('2d');
           
           if (charts.pie) {
               charts.pie.destroy();
           }

           const groups = {};
           farmData.pigs.forEach(pig => {
               groups[pig.group] = (groups[pig.group] || 0) + 1;
           });

           const labels = Object.keys(groups);
           const data = Object.values(groups);
           const colors = ['#059669', '#2563eb', '#f59e0b', '#dc2626'];

           charts.pie = new Chart(ctx, {
               type: 'pie',
               data: {
                   labels: labels,
                   datasets: [{
                       data: data,
                       backgroundColor: colors.slice(0, labels.length),
                       borderColor: '#fff',
                       borderWidth: 2
                   }]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   plugins: {
                       legend: {
                           position: 'bottom',
                           labels: {
                               font: {
                                   family: 'Niramit',
                                   size: 12
                               },
                               generateLabels: function(chart) {
                                   const data = chart.data;
                                   const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                   return data.labels.map((label, i) => {
                                       const value = data.datasets[0].data[i];
                                       const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                       return {
                                           text: `${label}: ${value} ตัว (${percentage}%)`,
                                           fillStyle: data.datasets[0].backgroundColor[i]
                                       };
                                   });
                               }
                           }
                       }
                   }
               }
           });
       }

       function updateBarChart() {
           const ctx = document.getElementById('barChart').getContext('2d');
           
           if (charts.bar) {
               charts.bar.destroy();
           }

           const groups = {};
           farmData.pigs.forEach(pig => {
               if (!groups[pig.group]) {
                   groups[pig.group] = [];
               }
               groups[pig.group].push(parseFloat(calculateFCR(pig)));
           });

           const labels = Object.keys(groups);
           const avgFCRs = labels.map(group => {
               const fcrs = groups[group];
               return fcrs.length > 0 ? fcrs.reduce((a, b) => a + b, 0) / fcrs.length : 0;
           });

           charts.bar = new Chart(ctx, {
               type: 'bar',
               data: {
                   labels: labels,
                   datasets: [{
                       label: 'FCR ปัจจุบัน',
                       data: avgFCRs,
                       backgroundColor: avgFCRs.map(fcr => fcr <= 2.35 ? '#10b981' : '#dc2626'),
                       borderColor: '#fff',
                       borderWidth: 1
                   }]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   scales: {
                       y: {
                           beginAtZero: true,
                           max: 4,
                           ticks: {
                               font: {
                                   family: 'Niramit'
                               }
                           }
                       },
                       x: {
                           ticks: {
                               font: {
                                   family: 'Niramit'
                               }
                           }
                       }
                   },
                   plugins: {
                       legend: {
                           display: false
                       }
                   }
               }
           });

           // Add target line manually
           const chartArea = charts.bar.chartArea;
           if (chartArea) {
               const ctx = charts.bar.ctx;
               const y = charts.bar.scales.y.getPixelForValue(2.35);
               
               ctx.save();
               ctx.beginPath();
               ctx.moveTo(chartArea.left, y);
               ctx.lineTo(chartArea.right, y);
               ctx.lineWidth = 2;
               ctx.strokeStyle = '#f59e0b';
               ctx.setLineDash([5, 5]);
               ctx.stroke();
               ctx.restore();
               
               ctx.font = '12px Niramit';
               ctx.fillStyle = '#f59e0b';
               ctx.textAlign = 'right';
               ctx.fillText('เป้าหมาย 2.35', chartArea.right - 10, y - 5);
           }
       }

       function updateAlerts() {
           const alertsContainer = document.getElementById('alerts-container');
           alertsContainer.innerHTML = '';

           // Check vaccine due dates
           const today = new Date();
           
           // Vaccine schedule based on pig age
           const vaccineSchedule = {
               'PRRS': [21, 42, 70],
               'MHFD': [35, 63],
               'PCV2': [28, 56],
               'กาฬโรค': [42, 84]
           };

           let vaccineAlerts = [];

           farmData.pigs.forEach(pig => {
               const pigAge = calculateAge(pig.entryDate);
               
               Object.entries(vaccineSchedule).forEach(([vaccine, scheduleDays]) => {
                   scheduleDays.forEach(day => {
                       if (pigAge >= day - 3 && pigAge <= day + 3) {
                           // Check if already vaccinated
                           const vaccineRecords = farmData.health.filter(h => 
                               h.pigId === pig.id && 
                               h.vaccine === vaccine && 
                               h.type === 'วัคซีน'
                           );
                           
                           const recentVaccine = vaccineRecords.find(v => {
                               const vaccineDaysAgo = calculateAge(v.date);
                               return vaccineDaysAgo <= 7;
                           });
                           if (!recentVaccine) {
                               vaccineAlerts.push({
                                   pigId: pig.id,
                                   vaccine: vaccine,
                                   dueAge: day,
                                   currentAge: pigAge,
                                   urgent: pigAge >= day
                               });
                           }
                       }
                   });
               });
           });

           // Display vaccine alerts
           if (vaccineAlerts.length > 0) {
               const urgentAlerts = vaccineAlerts.filter(a => a.urgent);
               const upcomingAlerts = vaccineAlerts.filter(a => !a.urgent);

               if (urgentAlerts.length > 0) {
                   alertsContainer.innerHTML += `
                       <div class="alert alert-danger">
                           <strong>⚠️ วัคซีนเกินกำหนด:</strong> 
                           ${urgentAlerts.map(a => `${a.vaccine} สำหรับสุกร ${a.pigId}`).join(', ')}
                       </div>
                   `;
               }

               if (upcomingAlerts.length > 0) {
                   alertsContainer.innerHTML += `
                       <div class="alert alert-warning">
                           <strong>📅 วัคซีนใกล้ครบกำหนด:</strong> 
                           ${upcomingAlerts.map(a => `${a.vaccine} สำหรับสุกร ${a.pigId} (${a.dueAge - a.currentAge} วัน)`).join(', ')}
                       </div>
                   `;
               }
           }

           // Check low stock
           farmData.stock.forEach(item => {
               if (item.type === 'อาหาร' && item.quantity <= 100) {
                   alertsContainer.innerHTML += `
                       <div class="alert alert-warning">
                           ⚠️ ${item.item} เหลือน้อย: ${item.quantity} ${item.unit}
                       </div>
                   `;
               }
               
               // Check expiry dates
               if (item.expiryDate) {
                   const daysToExpiry = Math.ceil((new Date(item.expiryDate) - today) / (1000 * 60 * 60 * 24));
                   if (daysToExpiry <= 30 && daysToExpiry > 0) {
                       alertsContainer.innerHTML += `
                           <div class="alert alert-warning">
                               ⏰ ${item.item} จะหมดอายุใน ${daysToExpiry} วัน
                           </div>
                       `;
                   } else if (daysToExpiry <= 0) {
                       alertsContainer.innerHTML += `
                           <div class="alert alert-danger">
                               ❌ ${item.item} หมดอายุแล้ว
                           </div>
                       `;
                   }
               }
           });

           // Check pigs ready for sale
           const readyForSale = farmData.pigs.filter(p => p.currentWeight >= 110);
           if (readyForSale.length > 0) {
               alertsContainer.innerHTML += `
                   <div class="alert alert-success">
                       ✅ มีสุกรพร้อมขาย ${readyForSale.length} ตัว: ${readyForSale.map(p => p.id).join(', ')}
                   </div>
               `;
           }

           if (alertsContainer.innerHTML === '') {
               alertsContainer.innerHTML = '<div class="alert alert-success">✅ ไม่มีการแจ้งเตือนในขณะนี้</div>';
           }
       }

       // Form Validation
       function validateForm(formData, formType) {
           const errors = {};

           switch (formType) {
               case 'pig':
                   if (!formData.pigId || formData.pigId.trim() === '') {
                       errors.pigId = 'กรุณากรอกรหัสสุกร';
                   } else if (farmData.pigs.find(p => p.id === formData.pigId)) {
                       errors.pigId = 'รหัสสุกรนี้มีอยู่แล้ว';
                   }
                   
                   if (parseFloat(formData.currentWeight) < parseFloat(formData.initialWeight)) {
                       errors.currentWeight = 'น้ำหนักปัจจุบันต้องมากกว่าหรือเท่ากับน้ำหนักเริ่มต้น';
                   }
                   break;

               case 'feeding':
                   if (parseFloat(formData.amount) <= 0) {
                       errors.amount = 'ปริมาณต้องมากกว่า 0';
                   }
                   break;

               case 'sales':
                   if (!formData.pigId) {
                       errors.pigId = 'กรุณาเลือกสุกร';
                   }
                   if (parseFloat(formData.pricePerKg) <= 0) {
                       errors.pricePerKg = 'ราคาต้องมากกว่า 0';
                   }
                   break;
           }

           return errors;
       }

       function showFormErrors(form, errors) {
           // Clear previous errors
           form.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
           form.querySelectorAll('.error-message').forEach(el => {
               el.textContent = '';
               el.classList.add('hidden');
           });

           // Show new errors
           Object.entries(errors).forEach(([field, message]) => {
               const input = form.querySelector(`[name="${field}"]`);
               if (input) {
                   input.classList.add('error');
                   const errorEl = input.parentElement.querySelector('.error-message');
                   if (errorEl) {
                       errorEl.textContent = message;
                       errorEl.classList.remove('hidden');
                   }
               }
           });
       }

       // Form Handlers
       document.getElementById('addPigForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const formData = new FormData(e.target);
           const pigData = {
               id: formData.get('pigId'),
               group: formData.get('group'),
               initialWeight: parseFloat(formData.get('initialWeight')),
               currentWeight: parseFloat(formData.get('currentWeight')),
               gender: formData.get('gender'),
               breed: formData.get('breed') || 'ไม่ระบุ',
               entryDate: formData.get('entryDate'),
               addedDate: new Date().toISOString()
           };

           // Validate
           const errors = validateForm(pigData, 'pig');
           if (Object.keys(errors).length > 0) {
               showFormErrors(e.target, errors);
               return;
           }

           farmData.pigs.push(pigData);
           saveData();
           closeModal('addPigModal');
           updateDashboard();
           updatePigsTable();
           
           // Show success message
           showNotification('บันทึกข้อมูลสุกรเรียบร้อยแล้ว', 'success');
       });

       document.getElementById('editPigForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const formData = new FormData(e.target);
           const index = parseInt(formData.get('index'));
           
           // Update pig data
           farmData.pigs[index].group = formData.get('group');
           farmData.pigs[index].currentWeight = parseFloat(formData.get('currentWeight'));
           farmData.pigs[index].breed = formData.get('breed') || farmData.pigs[index].breed;
           farmData.pigs[index].lastUpdated = new Date().toISOString();

           saveData();
           closeModal('editPigModal');
           updateDashboard();
           updatePigsTable();
           
           showNotification('แก้ไขข้อมูลสุกรเรียบร้อยแล้ว', 'success');
       });

       document.getElementById('feedingForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const formData = new FormData(e.target);
           const feedType = formData.get('feedType');
           let cost = 0;
           
           // Calculate cost based on feed type
           const amount = parseFloat(formData.get('amount'));
           switch(feedType) {
               case 'หมูเล็ก':
                   cost = amount * 20;
                   break;
               case 'หมูรุ่น':
                   cost = amount * 18;
                   break;
               case 'หมูขุน':
                   cost = amount * 16;
                   break;
           }

           const feedingData = {
               id: Date.now(),
               date: formData.get('date'),
               group: formData.get('group'),
               feedType: feedType,
               amount: amount,
               cost: cost,
               notes: formData.get('notes'),
               addedDate: new Date().toISOString()
           };

           // Validate
           const errors = validateForm(feedingData, 'feeding');
           if (Object.keys(errors).length > 0) {
               showFormErrors(e.target, errors);
               return;
           }

           farmData.feeding.push(feedingData);
           
           // Auto-deduct from stock
           updateFeedStock(feedType, amount);
           
           saveData();
           closeModal('feedingModal');
           updateDashboard();
           updateFeedingSection();
           
           showNotification('บันทึกการให้อาหารเรียบร้อยแล้ว', 'success');
       });

       document.getElementById('healthForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const formData = new FormData(e.target);
           const healthData = {
               id: Date.now(),
               date: formData.get('date'),
               pigId: formData.get('pigId'),
               type: formData.get('type'),
               vaccine: formData.get('vaccine'),
               cost: parseFloat(formData.get('cost')) || 0,
               notes: formData.get('notes'),
               addedDate: new Date().toISOString()
           };

           farmData.health.push(healthData);
           saveData();
           closeModal('healthModal');
           updateDashboard();
           updateHealthSection();
           
           showNotification('บันทึกข้อมูลสุขภาพเรียบร้อยแล้ว', 'success');
       });

       document.getElementById('stockForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const formData = new FormData(e.target);
           const stockData = {
               id: Date.now(),
               date: formData.get('date'),
               type: formData.get('type'),
               item: formData.get('item'),
               action: formData.get('action'),
               quantity: parseFloat(formData.get('quantity')),
               unit: formData.get('unit'),
               unitPrice: parseFloat(formData.get('unitPrice')) || 0,
               expiryDate: formData.get('expiryDate'),
               addedDate: new Date().toISOString()
           };

           // Update stock
           const existingIndex = farmData.stock.findIndex(s => 
               s.item === stockData.item && s.type === stockData.type
           );

           if (existingIndex !== -1) {
               if (stockData.action === 'เพิ่ม') {
                   farmData.stock[existingIndex].quantity += stockData.quantity;
               } else if (stockData.action === 'ใช้') {
                   farmData.stock[existingIndex].quantity -= stockData.quantity;
                   if (farmData.stock[existingIndex].quantity < 0) {
                       farmData.stock[existingIndex].quantity = 0;
                   }
               } else if (stockData.action === 'ปรับปรุง') {
                   farmData.stock[existingIndex].quantity = stockData.quantity;
               }
               farmData.stock[existingIndex].unitPrice = stockData.unitPrice || farmData.stock[existingIndex].unitPrice;
               farmData.stock[existingIndex].expiryDate = stockData.expiryDate || farmData.stock[existingIndex].expiryDate;
           } else {
               farmData.stock.push({
                   ...stockData,
                   quantity: stockData.action === 'ใช้' ? 0 : stockData.quantity
               });
           }

           saveData();
           closeModal('stockModal');
           updateDashboard();
           updateStockSection();
           
           showNotification('อัพเดทสต็อกเรียบร้อยแล้ว', 'success');
       });

       document.getElementById('salesForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const formData = new FormData(e.target);
           const salesData = {
               id: Date.now(),
               date: formData.get('date'),
               pigId: formData.get('pigId'),
               weight: parseFloat(formData.get('weight')),
               pricePerKg: parseFloat(formData.get('pricePerKg')),
               totalPrice: parseFloat(formData.get('totalPrice')),
               buyer: formData.get('buyer') || 'ไม่ระบุ',
               notes: formData.get('notes'),
               addedDate: new Date().toISOString()
           };

           // Validate
           const errors = validateForm(salesData, 'sales');
           if (Object.keys(errors).length > 0) {
               showFormErrors(e.target, errors);
               return;
           }

           // Add to sales records
           farmData.sales.push(salesData);
           
           // Remove pig from active pigs
           const pigIndex = farmData.pigs.findIndex(p => p.id === salesData.pigId);
           if (pigIndex !== -1) {
               farmData.pigs.splice(pigIndex, 1);
           }

           saveData();
           closeModal('salesModal');
           updateDashboard();
           updateSalesSection();
           
           showNotification('บันทึกการขายเรียบร้อยแล้ว', 'success');
       });

       document.getElementById('importForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const fileInput = document.getElementById('importFile');
           const file = fileInput.files[0];
           
           if (!file) return;
           
           const reader = new FileReader();
           reader.onload = function(event) {
               try {
                   const importedData = JSON.parse(event.target.result);
                   
                   // Validate imported data structure
                   if (!importedData.pigs || !importedData.feeding || !importedData.health || !importedData.stock) {
                       throw new Error('รูปแบบไฟล์ไม่ถูกต้อง');
                   }
                   
                   // Import data
                   farmData = {
                       pigs: importedData.pigs || [],
                       feeding: importedData.feeding || [],
                       health: importedData.health || [],
                       stock: importedData.stock || [],
                       sales: importedData.sales || [],
                       settings: importedData.settings || {}
                   };
                   
                   saveData();
                   closeModal('importModal');
                   updateDashboard();
                   
                   showNotification('นำเข้าข้อมูลเรียบร้อยแล้ว', 'success');
               } catch (error) {
                   showNotification('เกิดข้อผิดพลาดในการนำเข้าข้อมูล: ' + error.message, 'error');
               }
           };
           
           reader.readAsText(file);
       });

       // Helper Functions
       function updateFeedStock(feedType, amount) {
           let stockItem = '';
           switch(feedType) {
               case 'หมูเล็ก':
                   stockItem = 'อาหารหมูเล็ก';
                   break;
               case 'หมูรุ่น':
                   stockItem = 'อาหารหมูรุ่น';
                   break;
               case 'หมูขุน':
                   stockItem = 'อาหารหมูขุน';
                   break;
           }

           if (stockItem) {
               const stockIndex = farmData.stock.findIndex(s => 
                   s.item === stockItem && s.type === 'อาหาร'
               );
               
               if (stockIndex !== -1) {
                   farmData.stock[stockIndex].quantity -= amount;
                   if (farmData.stock[stockIndex].quantity < 0) {
                       farmData.stock[stockIndex].quantity = 0;
                   }
               }
           }
       }

       function calculateAge(entryDate) {
           const entry = new Date(entryDate);
           const today = new Date();
           return Math.floor((today - entry) / (1000 * 60 * 60 * 24));
       }

       function updatePigSelectOptions() {
           const select = document.querySelector('#healthForm [name="pigId"]');
           select.innerHTML = '<option value="">เลือกสุกร</option><option value="ทั้งหมด">ทั้งหมด</option>';
           
           farmData.pigs.forEach(pig => {
               select.innerHTML += `<option value="${pig.id}">${pig.id} (${pig.group})</option>`;
           });
       }

       function updateSalesPigOptions() {
           const select = document.querySelector('#salesForm [name="pigId"]');
           select.innerHTML = '<option value="">เลือกสุกร</option>';
           
           // Only show pigs ready for sale (>=110kg)
           farmData.pigs.filter(p => p.currentWeight >= 110).forEach(pig => {
               select.innerHTML += `<option value="${pig.id}">${pig.id} - ${pig.currentWeight} กก.</option>`;
           });
       }

       function updateSaleWeight() {
           const pigId = document.querySelector('#salesForm [name="pigId"]').value;
           const weightInput = document.querySelector('#salesForm [name="weight"]');
           
           if (pigId) {
               const pig = farmData.pigs.find(p => p.id === pigId);
               if (pig) {
                   weightInput.value = pig.currentWeight;
                   calculateTotalPrice();
               }
           }
       }

       function calculateTotalPrice() {
           const weight = parseFloat(document.querySelector('#salesForm [name="weight"]').value) || 0;
           const pricePerKg = parseFloat(document.querySelector('#salesForm [name="pricePerKg"]').value) || 0;
           const totalPrice = weight * pricePerKg;
           
           document.querySelector('#salesForm [name="totalPrice"]').value = totalPrice.toFixed(2);
       }

       function showNotification(message, type = 'info') {
           const notification = document.createElement('div');
           notification.className = `alert alert-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'warning'} notification`;
           notification.style.cssText = `
               position: fixed;
               top: 20px;
               right: 20px;
               z-index: 2000;
               min-width: 250px;
               animation: slideIn 0.3s ease-out;
           `;
           notification.textContent = message;
           
           document.body.appendChild(notification);
           
           setTimeout(() => {
               notification.style.animation = 'slideOut 0.3s ease-in';
               setTimeout(() => notification.remove(), 300);
           }, 3000);
       }

       // Update functions for sections
       function updatePigsTable() {
           const tbody = document.getElementById('pigsTableBody');
           tbody.innerHTML = '';

           farmData.pigs.forEach((pig, index) => {
               const fcr = calculateFCR(pig);
               const adg = calculateADG(pig);
               const status = pig.currentWeight >= 110 ? 'พร้อมขาย' : 'เลี้ยงต่อ';
               const statusClass = pig.currentWeight >= 110 ? 'positive' : 'neutral';

               tbody.innerHTML += `
                   <tr>
                       <td>${pig.id}</td>
                       <td>${pig.group}</td>
                       <td>${pig.currentWeight}</td>
                       <td>${calculateAge(pig.entryDate)}</td>
                       <td>${pig.gender}</td>
                       <td>${fcr}</td>
                       <td>${adg}</td>
                       <td><span class="${statusClass}">${status}</span></td>
                       <td>
                           <button class="btn btn-secondary btn-sm" onclick="editPig(${index})">แก้ไข</button>
                           <button class="btn btn-danger btn-sm" onclick="deletePig(${index})">ลบ</button>
                       </td>
                   </tr>
               `;
           });

           if (farmData.pigs.length === 0) {
               tbody.innerHTML = '<tr><td colspan="9" class="text-center">ไม่พบข้อมูลสุกร</td></tr>';
           }
       }

       function editPig(index) {
           const pig = farmData.pigs[index];
           const form = document.getElementById('editPigForm');
           
           form.querySelector('[name="index"]').value = index;
           form.querySelector('[name="pigId"]').value = pig.id;
           form.querySelector('[name="group"]').value = pig.group;
           form.querySelector('[name="currentWeight"]').value = pig.currentWeight;
           form.querySelector('[name="breed"]').value = pig.breed;
           
           openModal('editPigModal');
       }

       function updateFeedingSection() {
           updateFeedingTable();
           updateFeedingCharts();
           updateFeedingCosts();
       }

       function updateFeedingTable() {
           const tbody = document.getElementById('feedingTableBody');
           tbody.innerHTML = '';

           farmData.feeding.slice(-20).reverse().forEach((record, index) => {
               tbody.innerHTML += `
                   <tr>
                       <td>${new Date(record.date).toLocaleDateString('th-TH')}</td>
                       <td>${record.group}</td>
                       <td>${record.feedType}</td>
                       <td>${record.amount}</td>
                       <td>${record.cost.toLocaleString()}</td>
                       <td>
                           <button class="btn btn-danger btn-sm" onclick="deleteFeeding(${farmData.feeding.length - 1 - index})">ลบ</button>
                       </td>
                   </tr>
               `;
           });

           if (farmData.feeding.length === 0) {
               tbody.innerHTML = '<tr><td colspan="6" class="text-center">ไม่พบข้อมูลการให้อาหาร</td></tr>';
           }
       }

       function updateFeedingCharts() {
           const ctx = document.getElementById('feedingTrendChart');
           if (!ctx) return;
           
           if (charts.feedingTrend) {
               charts.feedingTrend.destroy();
           }

           // Group feeding data by date
           const dailyFeeding = {};
           farmData.feeding.forEach(record => {
               const date = record.date;
               dailyFeeding[date] = (dailyFeeding[date] || 0) + record.amount;
           });

           const sortedDates = Object.keys(dailyFeeding).sort();
           const labels = sortedDates.slice(-30);
           const data = labels.map(date => dailyFeeding[date]);

           charts.feedingTrend = new Chart(ctx, {
               type: 'line',
               data: {
                   labels: labels.map(date => new Date(date).toLocaleDateString('th-TH', { month: 'short', day: 'numeric' })),
                   datasets: [{
                       label: 'อาหารรวม (กก.)',
                       data: data,
                       borderColor: '#059669',
                       backgroundColor: 'rgba(5, 150, 105, 0.1)',
                       borderWidth: 2,
                       fill: true,
                       tension: 0.4
                   }]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   scales: {
                       y: {
                           beginAtZero: true,
                           ticks: {
                               font: {
                                   family: 'Niramit'
                               }
                           }
                       },
                       x: {
                           ticks: {
                               font: {
                                   family: 'Niramit'
                               }
                           }
                       }
                   },
                   plugins: {
                       legend: {
                           labels: {
                               font: {
                                   family: 'Niramit'
                               }
                           }
                       }
                   }
               }
           });
       }

       function updateFeedingCosts() {
           const today = new Date().toISOString().split('T')[0];
           const thisMonth = new Date().toISOString().slice(0, 7);

           const dailyCost = farmData.feeding
               .filter(f => f.date === today)
               .reduce((sum, f) => sum + f.cost, 0);

           const monthlyCost = farmData.feeding
               .filter(f => f.date.startsWith(thisMonth))
               .reduce((sum, f) => sum + f.cost, 0);

           document.getElementById('daily-feed-cost').textContent = dailyCost.toLocaleString();
           document.getElementById('monthly-feed-cost').textContent = monthlyCost.toLocaleString();
       }

       function updateHealthSection() {
           updateVaccineAlerts();
           updateHealthStats();
           updateHealthTable();
       }

       function updateVaccineAlerts() {
           const alertsDiv = document.getElementById('vaccine-alerts');
           alertsDiv.innerHTML = '';

           const vaccineSchedule = {
               'PRRS': [21, 42, 70],
               'MHFD': [35, 63],
               'PCV2': [28, 56],
               'กาฬโรค': [42, 84]
           };

           let upcomingVaccines = [];

           farmData.pigs.forEach(pig => {
               const pigAge = calculateAge(pig.entryDate);
               
               Object.entries(vaccineSchedule).forEach(([vaccine, schedule]) => {
                   schedule.forEach(day => {
                       if (pigAge >= day - 3 && pigAge <= day + 3) {
                           const alreadyVaccinated = farmData.health.some(h => 
                               h.pigId === pig.id && 
                               h.vaccine === vaccine && 
                               h.type === 'วัคซีน' &&
                               Math.abs(calculateAge(h.date) - pigAge) <= 7
                           );
                           
                           if (!alreadyVaccinated) {
                               upcomingVaccines.push({
                                   pigId: pig.id,
                                   vaccine: vaccine,
                                   dueAge: day,
                                   currentAge: pigAge
                               });
                           }
                       }
                   });
               });
           });

           if (upcomingVaccines.length > 0) {
               upcomingVaccines.forEach(v => {
                   const urgency = v.currentAge >= v.dueAge ? 'danger' : 'warning';
                   alertsDiv.innerHTML += `
                       <div class="alert alert-${urgency}">
                           <strong>${v.vaccine}:</strong> สุกร ${v.pigId} 
                           (อายุ ${v.currentAge} วัน, ควรฉีดที่ ${v.dueAge} วัน)
                       </div>
                   `;
               });
           } else {
               alertsDiv.innerHTML = '<div class="alert alert-success">✅ ไม่มีวัคซีนที่ต้องฉีดในช่วงนี้</div>';
           }
       }

       function updateHealthStats() {
           const totalPigs = farmData.pigs.length;
           const sickPigs = farmData.health.filter(h => 
               h.type === 'รักษา' && 
               !h.notes?.includes('หายแล้ว') && 
               !h.notes?.includes('ตาย')
           ).length;

           const deadPigs = farmData.health.filter(h => 
               h.type === 'รักษา' && h.notes?.includes('ตาย')
           ).length;

           const mortalityRate = (totalPigs + deadPigs) > 0 ? 
               ((deadPigs / (totalPigs + deadPigs)) * 100).toFixed(1) : 0;

           document.getElementById('mortality-rate').textContent = mortalityRate;
           document.getElementById('sick-pigs').textContent = sickPigs;

           // Update mortality rate indicator
           const mortalityElement = document.getElementById('mortality-rate').parentNode.querySelector('.kpi-change');
           mortalityElement.className = parseFloat(mortalityRate) <= 5 ? 'kpi-change positive' : 'kpi-change negative';
       }

       function updateHealthTable() {
           const tbody = document.getElementById('healthTableBody');
           tbody.innerHTML = '';

           farmData.health.slice(-20).reverse().forEach((record, index) => {
               tbody.innerHTML += `
                   <tr>
                       <td>${new Date(record.date).toLocaleDateString('th-TH')}</td>
                       <td>${record.pigId}</td>
                       <td>${record.type}</td>
                       <td>${record.vaccine || record.notes || '-'}</td>
                       <td>${record.cost.toLocaleString()}</td>
                       <td>
                           <button class="btn btn-danger btn-sm" onclick="deleteHealth(${farmData.health.length - 1 - index})">ลบ</button>
                       </td>
                   </tr>
               `;
           });

           if (farmData.health.length === 0) {
               tbody.innerHTML = '<tr><td colspan="6" class="text-center">ไม่พบข้อมูลสุขภาพ</td></tr>';
           }
       }

       function updateStockSection() {
           updateFeedStockList();
           updateMedicineStockList();
           updateStockValues();
       }

       function updateFeedStockList() {
           const container = document.getElementById('feed-stock-list');
           container.innerHTML = '';

           const feedStock = farmData.stock.filter(s => s.type === 'อาหาร');
           const groupedFeed = {};

           feedStock.forEach(item => {
               if (!groupedFeed[item.item]) {
                   groupedFeed[item.item] = { 
                       quantity: 0, 
                       unit: item.unit, 
                       totalValue: 0,
                       unitPrice: item.unitPrice,
                       expiryDate: item.expiryDate
                   };
               }
               groupedFeed[item.item].quantity = item.quantity;
               groupedFeed[item.item].totalValue = item.quantity * item.unitPrice;
           });

           Object.entries(groupedFeed).forEach(([item, data]) => {
               // Calculate days remaining based on actual consumption
               const feedingLast7Days = farmData.feeding
                   .filter(f => new Date(f.date) >= new Date(Date.now() - 7 * 24 * 60 * 60 * 1000))
                   .reduce((sum, f) => sum + f.amount, 0);
               const dailyConsumption = feedingLast7Days / 7 || 50;
               const daysRemaining = Math.floor(data.quantity / dailyConsumption);
               
               const statusClass = daysRemaining <= 3 ? 'negative' : daysRemaining <= 7 ? 'warning' : 'positive';

               container.innerHTML += `
                   <div class="p-3 border border-gray-200 rounded-lg">
                       <div class="flex justify-between items-center mb-2">
                           <h4 class="font-semibold">${item}</h4>
                           <span class="${statusClass} text-sm">${daysRemaining} วัน</span>
                       </div>
                       <div class="text-sm text-gray-600">
                           คงเหลือ: ${data.quantity.toLocaleString()} ${data.unit}<br>
                           มูลค่า: ${data.totalValue.toLocaleString()} บาท
                       </div>
                       <div class="progress mt-2">
                           <div class="progress-bar" style="width: ${Math.min(100, (daysRemaining / 30) * 100)}%"></div>
                       </div>
                   </div>
               `;
           });

           if (Object.keys(groupedFeed).length === 0) {
               container.innerHTML = '<div class="text-center text-gray-500 p-4">ยังไม่มีข้อมูลสต็อกอาหาร</div>';
           }
       }

       function updateMedicineStockList() {
           const container = document.getElementById('medicine-stock-list');
           container.innerHTML = '';

           const medicineStock = farmData.stock.filter(s => s.type === 'ยา' || s.type === 'วัคซีน');
           const groupedMedicine = {};

           medicineStock.forEach(item => {
               if (!groupedMedicine[item.item]) {
                   groupedMedicine[item.item] = { 
                       quantity: 0, 
                       unit: item.unit, 
                       totalValue: 0, 
                       expiryDate: item.expiryDate,
                       unitPrice: item.unitPrice 
                   };
               }
               groupedMedicine[item.item].quantity = item.quantity;
               groupedMedicine[item.item].totalValue = item.quantity * item.unitPrice;
           });

           Object.entries(groupedMedicine).forEach(([item, data]) => {
               let expiryStatus = '';
               let statusClass = 'positive';

               if (data.expiryDate) {
                   const expiry = new Date(data.expiryDate);
                   const today = new Date();
                   const daysToExpiry = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));

                   if (daysToExpiry <= 0) {
                       expiryStatus = 'หมดอายุแล้ว';
                       statusClass = 'negative';
                   } else if (daysToExpiry <= 30) {
                       expiryStatus = `หมดอายุใน ${daysToExpiry} วัน`;
                       statusClass = 'warning';
                   } else {
                       expiryStatus = `หมดอายุ ${expiry.toLocaleDateString('th-TH')}`;
                       statusClass = 'positive';
                   }
               }

               container.innerHTML += `
                   <div class="p-3 border border-gray-200 rounded-lg">
                       <div class="flex justify-between items-center mb-2">
                           <h4 class="font-semibold">${item}</h4>
                           <span class="${statusClass} text-sm">${data.quantity} ${data.unit}</span>
                       </div>
                       <div class="text-sm text-gray-600">
                           มูลค่า: ${data.totalValue.toLocaleString()} บาท
                           ${expiryStatus ? `<br><span class="${statusClass}">${expiryStatus}</span>` : ''}
                       </div>
                   </div>
               `;
           });

           if (Object.keys(groupedMedicine).length === 0) {
               container.innerHTML = '<div class="text-center text-gray-500 p-4">ยังไม่มีข้อมูลสต็อกยา/วัคซีน</div>';
           }
       }

       function updateStockValues() {
           const feedValue = farmData.stock
               .filter(s => s.type === 'อาหาร')
               .reduce((sum, s) => sum + (s.quantity * s.unitPrice), 0);

           const medicineValue = farmData.stock
               .filter(s => s.type === 'ยา' || s.type === 'วัคซีน')
               .reduce((sum, s) => sum + (s.quantity * s.unitPrice), 0);

           document.getElementById('feed-stock-value').textContent = feedValue.toLocaleString();
           document.getElementById('medicine-stock-value').textContent = medicineValue.toLocaleString();
       }

       function updateSalesSection() {
           updateSalesStats();
           updateReadyPigsList();
           updateSalesTable();
       }

       function updateSalesStats() {
           const currentMonth = new Date().toISOString().slice(0, 7);
           const monthSales = farmData.sales.filter(s => s.date.startsWith(currentMonth));
           
           const monthlyCount = monthSales.length;
           const monthlyIncome = monthSales.reduce((sum, s) => sum + s.totalPrice, 0);
           const avgPricePerKg = monthSales.length > 0 ?
               monthSales.reduce((sum, s) => sum + s.pricePerKg, 0) / monthSales.length : 0;

           document.getElementById('monthly-sales-count').textContent = monthlyCount;
           document.getElementById('monthly-sales-income').textContent = monthlyIncome.toLocaleString();
           document.getElementById('avg-price-per-kg').textContent = avgPricePerKg.toFixed(2);
       }

       function updateReadyPigsList() {
           const container = document.getElementById('ready-pigs-list');
           const readyPigs = farmData.pigs.filter(p => p.currentWeight >= 110);
           
           if (readyPigs.length > 0) {
               container.innerHTML = readyPigs.map(pig => `
                   <div class="p-3 border border-gray-200 rounded-lg mb-2">
                       <div class="flex justify-between items-center">
                           <div>
                               <strong>${pig.id}</strong> - ${pig.currentWeight} กก.
                               <span class="text-sm text-gray-600">(${pig.group})</span>
                           </div>
                           <button class="btn btn-primary btn-sm" onclick="quickSale('${pig.id}')">
                               ขายด่วน
                           </button>
                       </div>
                   </div>
               `).join('');
           } else {
               container.innerHTML = '<div class="text-center text-gray-500 p-4">ไม่มีสุกรพร้อมขาย</div>';
           }
       }

       function updateSalesTable() {
           const tbody = document.getElementById('salesTableBody');
           tbody.innerHTML = '';

           farmData.sales.slice(-20).reverse().forEach((record, index) => {
               tbody.innerHTML += `
                   <tr>
                       <td>${new Date(record.date).toLocaleDateString('th-TH')}</td>
                       <td>${record.pigId}</td>
                       <td>${record.weight}</td>
                       <td>${record.pricePerKg}</td>
                       <td>${record.totalPrice.toLocaleString()}</td>
                       <td>${record.buyer}</td>
                       <td>
                           <button class="btn btn-danger btn-sm" onclick="deleteSale(${farmData.sales.length - 1 - index})">ลบ</button>
                       </td>
                   </tr>
               `;
           });

           if (farmData.sales.length === 0) {
               tbody.innerHTML = '<tr><td colspan="7" class="text-center">ไม่พบข้อมูลการขาย</td></tr>';
           }
       }

       function quickSale(pigId) {
           document.querySelector('#salesForm [name="pigId"]').value = pigId;
           updateSaleWeight();
           openModal('salesModal');
       }

       function updateReportsSection() {
           updateFinancialReport();
           updatePerformanceChart();
           updateMonthlyTrendChart();
       }

       function updateFinancialReport() {
           // Calculate financial metrics
           const totalIncome = farmData.sales.reduce((sum, sale) => sum + sale.totalPrice, 0);
           const feedCosts = farmData.feeding.reduce((sum, f) => sum + f.cost, 0);
           const healthCosts = farmData.health.reduce((sum, h) => sum + (h.cost || 0), 0);
           const totalExpenses = feedCosts + healthCosts;
           const netProfit = totalIncome - totalExpenses;
           const roi = totalExpenses > 0 ? ((netProfit / totalExpenses) * 100).toFixed(1) : 0;

           document.getElementById('total-income').textContent = totalIncome.toLocaleString();
           document.getElementById('total-expenses').textContent = totalExpenses.toLocaleString();
           document.getElementById('net-profit').textContent = netProfit.toLocaleString();
           document.getElementById('roi').textContent = roi;

           // Update profit indicator
           const profitElement = document.getElementById('profit-change');
           profitElement.className = netProfit >= 0 ? 'kpi-change positive' : 'kpi-change negative';
       }

       function updatePerformanceChart() {
           const ctx = document.getElementById('performanceChart');
           if (!ctx) return;

           if (charts.performance) {
               charts.performance.destroy();
           }

           // Calculate monthly performance from actual data
           const monthlyData = {};
           const currentMonth = new Date();
           
           // Initialize last 6 months
           for (let i = 5; i >= 0; i--) {
               const month = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - i, 1);
               const monthKey = month.toISOString().slice(0, 7);
               monthlyData[monthKey] = {
                   fcr: [],
                   adg: [],
                   mortality: 0,
                   totalPigs: 0
               };
           }

           // Populate with actual data
           farmData.pigs.forEach(pig => {
               const entryMonth = pig.entryDate.slice(0, 7);
               if (monthlyData[entryMonth]) {
                   monthlyData[entryMonth].fcr.push(parseFloat(calculateFCR(pig)));
                   monthlyData[entryMonth].adg.push(calculateADG(pig));
                   monthlyData[entryMonth].totalPigs++;
               }
           });

           // Calculate averages
           Object.keys(monthlyData).forEach(month => {
               const data = monthlyData[month];
               if (data.fcr.length > 0) {
                   data.avgFCR = data.fcr.reduce((a, b) => a + b, 0) / data.fcr.length;
                   data.avgADG = data.adg.reduce((a, b) => a + b, 0) / data.adg.length;
               } else {
                   data.avgFCR = 2.35;
                   data.avgADG = 700;
               }
               
               // Calculate mortality
               const monthDeaths = farmData.health.filter(h => 
                   h.date.startsWith(month) && h.notes?.includes('ตาย')
               ).length;
               data.mortality = data.totalPigs > 0 ? (monthDeaths / data.totalPigs) * 100 : 0;
           });

           const labels = Object.keys(monthlyData).map(month => 
               new Date(month + '-01').toLocaleDateString('th-TH', { month: 'short', year: 'numeric' })
           );

           charts.performance = new Chart(ctx, {
               type: 'line',
               data: {
                   labels: labels,
                   datasets: [{
                       label: 'FCR',
                       data: Object.values(monthlyData).map(d => d.avgFCR),
                       borderColor: '#059669',
                       backgroundColor: 'rgba(5, 150, 105, 0.1)',
                       yAxisID: 'y'
                   }, {
                       label: 'ADG (g/day)',
                       data: Object.values(monthlyData).map(d => d.avgADG),
                       borderColor: '#2563eb',
                       backgroundColor: 'rgba(37, 99, 235, 0.1)',
                       yAxisID: 'y1'
                   }, {
                       label: 'Mortality (%)',
                       data: Object.values(monthlyData).map(d => d.mortality),
                       borderColor: '#dc2626',
                       backgroundColor: 'rgba(220, 38, 38, 0.1)',
                       yAxisID: 'y2'
                   }]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   interaction: {
                       mode: 'index',
                       intersect: false,
                   },
                   scales: {
                       x: {
                           display: true,
                           title: {
                               display: true,
                               text: 'เดือน'
                           }
                       },
                       y: {
                           type: 'linear',
                           display: true,
                           position: 'left',
                           title: {
                               display: true,
                               text: 'FCR'
                           },
                       },
                       y1: {
                           type: 'linear',
                           display: true,
                           position: 'right',
                           title: {
                               display: true,
                               text: 'ADG (g/day)'
                           },
                           grid: {
                               drawOnChartArea: false,
                           },
                       },
                       y2: {
                           type: 'linear',
                           display: false,
                           title: {
                               display: true,
                               text: 'Mortality (%)'
                           },
                       }
                   },
                   plugins: {
                       legend: {
                           labels: {
                               font: {
                                   family: 'Niramit'
                               }
                           }
                       }
                   }
               }
           });
       }

       function updateMonthlyTrendChart() {
           const ctx = document.getElementById('monthlyTrendChart');
           if (!ctx) return;

           if (charts.monthlyTrend) {
               charts.monthlyTrend.destroy();
           }

           // Group data by month
           const monthlyData = {};
           const currentMonth = new Date();
           
           // Initialize last 6 months
           for (let i = 5; i >= 0; i--) {
               const month = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - i, 1);
               const monthKey = month.toISOString().slice(0, 7);
               monthlyData[monthKey] = {
                   income: 0,
                   expenses: 0
               };
           }

           // Calculate monthly income from sales
           farmData.sales.forEach(sale => {
               const month = sale.date.slice(0, 7);
               if (monthlyData[month]) {
                   monthlyData[month].income += sale.totalPrice;
               }
           });

           // Calculate monthly expenses
           farmData.feeding.forEach(record => {
               const month = record.date.slice(0, 7);
               if (monthlyData[month]) {
                   monthlyData[month].expenses += record.cost;
               }
           });

           farmData.health.forEach(record => {
               const month = record.date.slice(0, 7);
               if (monthlyData[month]) {
                   monthlyData[month].expenses += (record.cost || 0);
               }
           });

           const labels = Object.keys(monthlyData).map(month => 
               new Date(month + '-01').toLocaleDateString('th-TH', { month: 'short', year: 'numeric' })
           );

           const incomeData = Object.values(monthlyData).map(d => d.income);
           const expenseData = Object.values(monthlyData).map(d => d.expenses);

           charts.monthlyTrend = new Chart(ctx, {
               type: 'bar',
               data: {
                   labels: labels,
                   datasets: [{
                       label: 'รายได้',
                       data: incomeData,
                       backgroundColor: 'rgba(16, 185, 129, 0.8)',
                       borderColor: 'rgba(16, 185, 129, 1)',
                       borderWidth: 1
                   }, {
                       label: 'ค่าใช้จ่าย',
                       data: expenseData,
                       backgroundColor: 'rgba(220, 38, 38, 0.8)',
                       borderColor: 'rgba(220, 38, 38, 1)',
                       borderWidth: 1
                   }]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   scales: {
                       y: {
                           beginAtZero: true,
                           ticks: {
                               callback: function(value) {
                                   return value.toLocaleString() + ' ฿';
                               }
                           }
                       }
                   },
                   plugins: {
                       legend: {
                           labels: {
                               font: {
                                   family: 'Niramit'
                               }
                           }
                       }
                   }
               }
           });
       }

       // Delete Functions
       function deletePig(index) {
           if (confirm('คุณแน่ใจหรือไม่ที่จะลบข้อมูลสุกรนี้?')) {
               farmData.pigs.splice(index, 1);
               saveData();
               updateDashboard();
               updatePigsTable();
               showNotification('ลบข้อมูลสุกรเรียบร้อยแล้ว', 'success');
           }
       }

       function deleteFeeding(index) {
           if (confirm('คุณแน่ใจหรือไม่ที่จะลบข้อมูลการให้อาหารนี้?')) {
               farmData.feeding.splice(index, 1);
               saveData();
               updateDashboard();
               updateFeedingSection();
               showNotification('ลบข้อมูลการให้อาหารเรียบร้อยแล้ว', 'success');
           }
       }

       function deleteHealth(index) {
           if (confirm('คุณแน่ใจหรือไม่ที่จะลบข้อมูลสุขภาพนี้?')) {
               farmData.health.splice(index, 1);
               saveData();
               updateDashboard();
               updateHealthSection();
               showNotification('ลบข้อมูลสุขภาพเรียบร้อยแล้ว', 'success');
           }
       }

       function deleteSale(index) {
           if (confirm('คุณแน่ใจหรือไม่ที่จะลบข้อมูลการขายนี้?')) {
               farmData.sales.splice(index, 1);
               saveData();
               updateDashboard();
               updateSalesSection();
               showNotification('ลบข้อมูลการขายเรียบร้อยแล้ว', 'success');
           }
       }

       // Data Export/Import Functions
       function exportData() {
           const dataToExport = {
               pigs: farmData.pigs,
               feeding: farmData.feeding,
               health: farmData.health,
               stock: farmData.stock,
               sales: farmData.sales,
               exportDate: new Date().toISOString(),
               version: '2.0'
           };

           const dataStr = JSON.stringify(dataToExport, null, 2);
           const dataBlob = new Blob([dataStr], {type: 'application/json'});
           
           const link = document.createElement('a');
           link.href = URL.createObjectURL(dataBlob);
           link.download = `farm-data-backup-${new Date().toISOString().split('T')[0]}.json`;
           link.click();
           
           showNotification('สำรองข้อมูลเรียบร้อยแล้ว', 'success');
       }

       function generatePDFReport() {
           // Simple PDF generation using browser print
           const reportWindow = window.open('', '_blank');
           const reportContent = generateReportHTML();
           
           reportWindow.document.write(`
               <!DOCTYPE html>
               <html>
               <head>
                   <title>รายงานฟาร์มสุกร</title>
                   <style>
                       body { font-family: 'Niramit', sans-serif; margin: 20px; }
                       .header { text-align: center; border-bottom: 2px solid #059669; padding-bottom: 10px; margin-bottom: 20px; }
                       .section { margin-bottom: 20px; page-break-inside: avoid; }
                       .kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
                       .kpi-card { border: 1px solid #ddd; padding: 10px; border-radius: 5px; }
                       .table { width: 100%; border-collapse: collapse; margin: 10px 0; }
                       .table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                       .table th { background-color: #f5f5f5; }
                       @media print { 
                           .no-print { display: none; }
                           .section { page-break-inside: avoid; }
                       }
                   </style>
               </head>
               <body>
                   ${reportContent}
                   <div class="no-print" style="text-align: center; margin-top: 20px;">
                       <button onclick="window.print()" style="padding: 10px 20px; font-size: 16px;">พิมพ์รายงาน</button>
                       <button onclick="window.close()" style="padding: 10px 20px; font-size: 16px; margin-left: 10px;">ปิด</button>
                   </div>
               </body>
               </html>
           `);
           
           reportWindow.document.close();
       }

       function generateReportHTML() {
           const today = new Date().toLocaleDateString('th-TH', { 
               year: 'numeric', 
               month: 'long', 
               day: 'numeric' 
           });

           const totalPigs = farmData.pigs.length;
           const readyForSale = farmData.pigs.filter(p => p.currentWeight >= 110).length;
           const avgFCR = totalPigs > 0 ? 
               (farmData.pigs.reduce((sum, pig) => sum + parseFloat(calculateFCR(pig)), 0) / totalPigs).toFixed(2) : 0;
           const avgADG = totalPigs > 0 ? 
               Math.round(farmData.pigs.reduce((sum, pig) => sum + calculateADG(pig), 0) / totalPigs) : 0;

           const totalIncome = farmData.sales.reduce((sum, sale) => sum + sale.totalPrice, 0);
           const totalExpenses = farmData.feeding.reduce((sum, f) => sum + f.cost, 0) + 
                               farmData.health.reduce((sum, h) => sum + (h.cost || 0), 0);
           const netProfit = totalIncome - totalExpenses;

           return `
               <div class="header">
                   <h1>รายงานฟาร์มสุกรอัจฉริยะ</h1>
                   <p>วันที่สร้างรายงาน: ${today}</p>
               </div>

               <div class="section">
                   <h2>ภาพรวมฟาร์ม</h2>
                   <div class="kpi-grid">
                       <div class="kpi-card">
                           <strong>จำนวนสุกรทั้งหมด</strong><br>
                           ${totalPigs} ตัว
                       </div>
                       <div class="kpi-card">
                           <strong>พร้อมขาย</strong><br>
                           ${readyForSale} ตัว
                       </div>
                       <div class="kpi-card">
                           <strong>FCR เฉลี่ย</strong><br>
                           ${avgFCR} (เป้า: 2.35)
                       </div>
                       <div class="kpi-card">
                           <strong>ADG เฉลี่ย</strong><br>
                           ${avgADG} กรัม/วัน (เป้า: 700)
                       </div>
                       <div class="kpi-card">
                           <strong>อัตราการตาย</strong><br>
                           ${document.getElementById('mortality-rate').textContent}%
                       </div>
                       <div class="kpi-card">
                           <strong>กำไรสุทธิ</strong><br>
                           ${netProfit.toLocaleString()} บาท
                       </div>
                   </div>
               </div>

               <div class="section">
                   <h2>ข้อมูลสุกร</h2>
                   <table class="table">
                       <thead>
                           <tr>
                               <th>รหัสสุกร</th>
                               <th>กลุ่ม</th>
                               <th>น้ำหนัก (กก.)</th>
                               <th>อายุ (วัน)</th>
                               <th>FCR</th>
                               <th>ADG</th>
                               <th>สถานะ</th>
                           </tr>
                       </thead>
                       <tbody>
                           ${farmData.pigs.map(pig => `
                               <tr>
                                   <td>${pig.id}</td>
                                   <td>${pig.group}</td>
                                   <td>${pig.currentWeight}</td>
                                   <td>${calculateAge(pig.entryDate)}</td>
                                   <td>${calculateFCR(pig)}</td>
                                   <td>${calculateADG(pig)}</td>
                                   <td>${pig.currentWeight >= 110 ? 'พร้อมขาย' : 'เลี้ยงต่อ'}</td>
                               </tr>
                           `).join('')}
                       </tbody>
                   </table>
               </div>

               <div class="section">
                   <h2>สรุปการเงิน</h2>
                   <table class="table">
                       <tr>
                           <td><strong>รายได้รวม</strong></td>
                           <td style="text-align: right">${totalIncome.toLocaleString()} บาท</td>
                       </tr>
                       <tr>
                           <td>ค่าอาหาร</td>
                           <td style="text-align: right">${farmData.feeding.reduce((sum, f) => sum + f.cost, 0).toLocaleString()} บาท</td>
                       </tr>
                       <tr>
                           <td>ค่ารักษาพยาบาล</td>
                           <td style="text-align: right">${farmData.health.reduce((sum, h) => sum + (h.cost || 0), 0).toLocaleString()} บาท</td>
                       </tr>
                       <tr>
                           <td><strong>รวมค่าใช้จ่าย</strong></td>
                           <td style="text-align: right"><strong>${totalExpenses.toLocaleString()} บาท</strong></td>
                       </tr>
                       <tr>
                           <td><strong>กำไรสุทธิ</strong></td>
                           <td style="text-align: right"><strong>${netProfit.toLocaleString()} บาท</strong></td>
                       </tr>
                   </table>
               </div>

               <div class="section">
                   <h2>มาตรฐานอ้างอิง</h2>
                   <p><strong>แหล่งข้อมูล:</strong> กรมปศุสัตว์, สมาคมสัตวแพทย์ควบคุมฟาร์มสุกรไทย</p>
                   <ul>
                       <li>FCR เป้าหมาย: 2.35 (Feed Conversion Ratio)</li>
                       <li>ADG เป้าหมาย: 700 กรัม/วัน (Average Daily Gain)</li>
                       <li>อัตราการตาย: < 5% (Mortality Rate)</li>
                       <li>น้ำหนักขาย: ≥ 110 กก.</li>
                   </ul>
               </div>

               <div class="section">
                   <p style="text-align: center; color: #666; font-size: 0.9em;">
                       สร้างโดยระบบจัดการฟาร์มสุกรอัจฉริยะ v2.0<br>
                       พัฒนาโดย หจก.กิตติพิพัฒน์ สำหรับเกษตรกรไทย
                   </p>
               </div>
           `;
       }

       // Initialize app
       function initApp() {
           // Set current date for forms
           const today = new Date().toISOString().split('T')[0];
           document.querySelectorAll('input[type="date"]').forEach(input => {
               if (!input.value) {
                   input.value = today;
               }
           });

           // Load demo data if no data exists
           if (farmData.pigs.length === 0 && farmData.feeding.length === 0) {
               loadDemoData();
           }

           // Update dashboard
           updateDashboard();

           // Setup service worker for PWA
           if ('serviceWorker' in navigator) {
               navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZnVuY3Rpb24oZXZlbnQpIHsKICBldmVudC53YWl0VW50aWwoY2FjaGVzLm9wZW4oJ3YxJykudGhlbihmdW5jdGlvbihjYWNoZSkgewogICAgcmV0dXJuIGNhY2hlLmFkZEFsbChbJy8nXSk7CiAgfSkpOwp9KTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignZmV0Y2gnLCBmdW5jdGlvbihldmVudCkgewogIGV2ZW50LnJlc3BvbmRXaXRoKGNhY2hlcy5tYXRjaChldmVudC5yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICByZXR1cm4gcmVzcG9uc2UgfHwgZmV0Y2goZXZlbnQucmVxdWVzdCk7CiAgfSkpOwp9KTs=');
           }
       }

       function loadDemoData() {
           // Add demo pigs
           farmData.pigs = [
               {
                   id: 'PIG001',
                   group: 'ขุน',
                   initialWeight: 25,
                   currentWeight: 95,
                   gender: 'ขุน',
                   breed: 'ลูกผสม',
                   entryDate: '2025-03-01',
                   addedDate: new Date().toISOString()
               },
               {
                   id: 'PIG002',
                   group: 'ขุน',
                   initialWeight: 28,
                   currentWeight: 112,
                   gender: 'ขุน',
                   breed: 'ยอร์คเชียร์',
                   entryDate: '2025-02-15',
                   addedDate: new Date().toISOString()
               },
               {
                   id: 'PIG003',
                   group: 'รุ่น',
                   initialWeight: 16,
                   currentWeight: 45,
                   gender: 'เมีย',
                   breed: 'ลูกผสม',
                   entryDate: '2025-04-01',
                   addedDate: new Date().toISOString()
               },
               {
                   id: 'PIG004',
                   group: 'อนุบาล',
                   initialWeight: 8,
                   currentWeight: 20,
                   gender: 'ผู้',
                   breed: 'ลูกผสม',
                   entryDate: '2025-05-15',
                   addedDate: new Date().toISOString()
               }
           ];

           // Add demo feeding records
           const today = new Date();
           for (let i = 30; i >= 0; i--) {
               const date = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
               const dateStr = date.toISOString().split('T')[0];
               
               if (i % 2 === 0) {
                   farmData.feeding.push({
                       id: Date.now() + i,
                       date: dateStr,
                       group: 'ขุน',
                       feedType: 'หมูขุน',
                       amount: 45 + Math.random() * 10,
                       cost: (45 + Math.random() * 10) * 16,
                       notes: 'อาหารเช้า'
                   });
               }
               
               if (i % 3 === 0) {
                   farmData.feeding.push({
                       id: Date.now() + i + 1000,
                       date: dateStr,
                       group: 'รุ่น',
                       feedType: 'หมูรุ่น',
                       amount: 25 + Math.random() * 5,
                       cost: (25 + Math.random() * 5) * 18,
                       notes: 'อาหารเช้า'
                   });
               }
           }

           // Add demo health records
           farmData.health = [
               {
                   id: 1,
                   date: '2025-05-15',
                   pigId: 'PIG001',
                   type: 'วัคซีน',
                   vaccine: 'PRRS',
                   cost: 150,
                   notes: 'วัคซีนตามกำหนด'
               },
               {
                   id: 2,
                   date: '2025-05-20',
                   pigId: 'PIG002',
                   type: 'วัคซีน',
                   vaccine: 'กาฬโรค',
                   cost: 200,
                   notes: 'วัคซีนตามกำหนด'
               }
           ];

           // Add demo stock
           farmData.stock = [
               {
                   id: 1,
                   date: '2025-06-01',
                   type: 'อาหาร',
                   item: 'อาหารหมูขุน',
                   action: 'เพิ่ม',
                   quantity: 1000,
                   unit: 'กก.',
                   unitPrice: 16,
                   expiryDate: '2025-12-31'
               },
               {
                   id: 2,
                   date: '2025-06-01',
                   type: 'อาหาร',
                   item: 'อาหารหมูรุ่น',
                   action: 'เพิ่ม',
                   quantity: 500,
                   unit: 'กก.',
                   unitPrice: 18,
                   expiryDate: '2025-12-31'
               },
               {
                   id: 3,
                   date: '2025-06-01',
                   type: 'วัคซีน',
                   item: 'วัคซีน PRRS',
                   action: 'เพิ่ม',
                   quantity: 50,
                   unit: 'โดส',
                   unitPrice: 150,
                   expiryDate: '2026-06-01'
               }
           ];

           // Add demo sales
           farmData.sales = [
               {
                   id: 1,
                   date: '2025-05-25',
                   pigId: 'SOLD001',
                   weight: 115,
                   pricePerKg: 65,
                   totalPrice: 7475,
                   buyer: 'บริษัท ซีพีเอฟ จำกัด',
                   notes: 'ขายตามสัญญา'
               }
           ];

           saveData();
           showNotification('โหลดข้อมูลตัวอย่างเรียบร้อยแล้ว', 'success');
       }

       // Event Listeners
       document.addEventListener('DOMContentLoaded', function() {
           initApp();
       });

       // Handle modal clicks outside content
       document.querySelectorAll('.modal').forEach(modal => {
           modal.addEventListener('click', function(e) {
               if (e.target === modal) {
                   modal.classList.remove('active');
               }
           });
       });

       // Handle escape key for modals
       document.addEventListener('keydown', function(e) {
           if (e.key === 'Escape') {
               document.querySelectorAll('.modal.active').forEach(modal => {
                   modal.classList.remove('active');
               });
           }
       });

       // Auto-save form data periodically
       setInterval(function() {
           // Placeholder for auto-save functionality
       }, 30000); // Every 30 seconds

       // Update dashboard periodically
       setInterval(function() {
           if (document.getElementById('dashboard').classList.contains('active')) {
               updateDashboard();
           }
       }, 60000); // Every minute

       // Handle online/offline status
       window.addEventListener('online', function() {
           document.body.classList.remove('offline');
           showNotification('เชื่อมต่ออินเทอร์เน็ตแล้ว', 'success');
       });

       window.addEventListener('offline', function() {
           document.body.classList.add('offline');
           showNotification('ใช้งานออฟไลน์', 'warning');
       });

       // Prevent form submission on Enter key in input fields
       document.addEventListener('keydown', function(e) {
           if (e.key === 'Enter' && e.target.tagName === 'INPUT' && e.target.type !== 'submit') {
               e.preventDefault();
               // Move to next input field
               const inputs = Array.from(document.querySelectorAll('input:not([type="hidden"]), select, textarea'));
               const currentIndex = inputs.indexOf(e.target);
               if (currentIndex < inputs.length - 1) {
                   inputs[currentIndex + 1].focus();
               }
           }
       });

       // Performance monitoring
       if (window.performance && window.performance.mark) {
           window.performance.mark('app-start');
           
           window.addEventListener('load', function() {
               window.performance.mark('app-loaded');
               window.performance.measure('app-load-time', 'app-start', 'app-loaded');
               
               const measure = window.performance.getEntriesByName('app-load-time')[0];
               console.log(`แอปโหลดใน ${measure.duration.toFixed(2)} มิลลิวินาที`);
           });
       }

       // Error handling
       window.addEventListener('error', function(e) {
           console.error('เกิดข้อผิดพลาด:', e.error);
           showNotification('เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง', 'error');
       });

       window.addEventListener('unhandledrejection', function(e) {
           console.error('Promise rejection:', e.reason);
       });

       // Accessibility improvements
       document.addEventListener('keydown', function(e) {
           // Tab navigation improvements
           if (e.key === 'Tab') {
               document.body.classList.add('keyboard-navigation');
           }
       });

       document.addEventListener('mousedown', function() {
           document.body.classList.remove('keyboard-navigation');
       });

       // Export additional utility functions for external use
       window.FarmManager = {
           exportData,
           generatePDFReport,
           updateDashboard,
           farmData,
           calculateFCR,
           calculateADG,
           calculateRadarScores,
           showNotification
       };

       // Add CSS for animations and additional styles
       const style = document.createElement('style');
       style.textContent = `
           @keyframes slideIn {
               from {
                   transform: translateX(100%);
                   opacity: 0;
               }
               to {
                   transform: translateX(0);
                   opacity: 1;
               }
           }

           @keyframes slideOut {
               from {
                   transform: translateX(0);
                   opacity: 1;
               }
               to {
                   transform: translateX(100%);
                   opacity: 0;
               }
           }

           .notification {
               animation: slideIn 0.3s ease-out;
           }

           .keyboard-navigation button:focus,
           .keyboard-navigation input:focus,
           .keyboard-navigation select:focus,
           .keyboard-navigation textarea:focus,
           .keyboard-navigation a:focus {
               outline: 2px solid var(--primary);
               outline-offset: 2px;
           }
           
           .offline::before {
               content: "⚠️ ใช้งานออฟไลน์";
               position: fixed;
               top: 0;
               left: 0;
               right: 0;
               background: var(--warning);
               color: white;
               text-align: center;
               padding: 0.5rem;
               z-index: 1001;
               font-size: 0.875rem;
           }
           
           .offline main {
               padding-top: 3rem;
           }

           .rounded-lg {
               border-radius: 0.5rem;
           }

           .border {
               border-width: 1px;
           }

           .p-3 {
               padding: 0.75rem;
           }

           .mb-2 {
               margin-bottom: 0.5rem;
           }

           .text-gray-600 {
               color: var(--gray-600);
           }

           .bg-green-50 {
               background-color: #ecfdf5;
           }

           .border-green-200 {
               border-color: #10b981;
           }

           .text-green-800 {
               color: #065f46;
           }

           .text-green-600 {
               color: #059669;
           }

           .bg-blue-50 {
               background-color: #eff6ff;
           }

           .border-blue-200 {
               border-color: #2563eb;
           }

           .text-blue-800 {
               color: #1e40af;
           }

           .text-blue-600 {
               color: #2563eb;
           }

           .bg-yellow-50 {
               background-color: #fffbeb;
           }

           .border-yellow-200 {
               border-color: #f59e0b;
           }

           .text-yellow-800 {
               color: #92400e;
           }

           .text-yellow-600 {
               color: #d97706;
           }

           .text-danger {
               color: var(--danger);
           }

           .bg-white {
               background-color: white;
           }

           .border-gray-200 {
               border-color: var(--gray-200);
           }

           code {
               font-family: monospace;
               font-size: 0.875em;
           }

           .flex {
               display: flex;
           }

           .justify-between {
               justify-content: space-between;
           }

           .items-center {
               align-items: center;
           }
           
           @media (max-width: 767px) {
               .table-container {
                   font-size: 0.875rem;
               }
               
               .form-grid {
                   grid-template-columns: 1fr;
               }
               
               .kpi-grid {
                   grid-template-columns: repeat(2, 1fr);
               }
               
               .dashboard-grid {
                   grid-template-columns: 1fr;
               }
               
               .btn {
                   width: 100%;
                   margin-bottom: 0.5rem;
               }
               
               .modal-content {
                   margin: 1rem;
                   max-height: calc(100vh - 2rem);
               }
           }
           
           @media print {
               .nav, .quick-actions, button, .btn {
                   display: none !important;
               }
               
               .card {
                   box-shadow: none;
                   border: 1px solid #ddd;
                   break-inside: avoid;
               }
               
               .chart-container {
                   display: none;
               }
           }
       `;
       document.head.appendChild(style);

   </script>
</body>
</html>
